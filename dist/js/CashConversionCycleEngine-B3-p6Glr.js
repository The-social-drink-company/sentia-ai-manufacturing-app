import{D as t}from"./DateContextEngine-uchP7ITA.js";class e{constructor(e={}){this.dateEngine=new t,this.config={targetDSO:e.targetDSO||45,targetDPO:e.targetDPO||60,targetDIO:e.targetDIO||30,creditTerms:e.creditTerms||{net15:.1,net30:.5,net45:.25,net60:.15},paymentTerms:e.paymentTerms||{net30:.3,net60:.45,net90:.25},inventoryCategories:e.inventoryCategories||{rawMaterials:{turnoverDays:21,percentage:.4},workInProcess:{turnoverDays:7,percentage:.15},finishedGoods:{turnoverDays:35,percentage:.45}}}}calculateCashConversionCycle(t={}){const e=this.dateEngine.getCurrentContext(),n={annualRevenue:t.annualRevenue||4e7,annualCOGS:t.annualCOGS||26e6,averageReceivables:t.averageReceivables||null,averageInventory:t.averageInventory||null,averagePayables:t.averagePayables||null,...t},a=n.annualRevenue/365,r=n.annualCOGS/365,o=n.averageReceivables||this.calculateReceivables(a),i=n.averageInventory||this.calculateInventory(r),c=n.averagePayables||this.calculatePayables(r),s=this.calculateDSO(o,a,e),l=this.calculateDIO(i,r,e),g=this.calculateDPO(c,r,e),u=s+l-g;return{cashConversionCycle:Math.round(10*u)/10,components:{dso:Math.round(10*s)/10,dio:Math.round(10*l)/10,dpo:Math.round(10*g)/10},balanceSheetItems:{receivables:Math.round(o),inventory:Math.round(i),payables:Math.round(c)},benchmarks:{targetDSO:this.config.targetDSO,targetDIO:this.config.targetDIO,targetDPO:this.config.targetDPO,targetCCC:this.config.targetDSO+this.config.targetDIO-this.config.targetDPO},performance:{dsoVariance:Math.round(10*(s-this.config.targetDSO))/10,dioVariance:Math.round(10*(l-this.config.targetDIO))/10,dpoVariance:Math.round(10*(g-this.config.targetDPO))/10},workingCapitalImpact:this.calculateWorkingCapitalImpact(u,a),recommendations:this.generateRecommendations(s,l,g),calculatedAt:e.currentDate}}calculateDSO(t,e,n){const a=t/e;let r=1;return n.dayOfMonth>25&&[3,6,9,12].includes(n.currentMonth)&&(r=1.15),[12,1].includes(n.currentMonth)&&(r=1.08),[7,8].includes(n.currentMonth)&&(r=1.05),a*r}calculateDIO(t,e,n){const a=t/e;let r=1;return[10,11].includes(n.currentMonth)&&(r=1.2),[1,2].includes(n.currentMonth)&&(r=.85),[6,7,8].includes(n.currentMonth)&&(r=.95),a*r}calculateDPO(t,e,n){const a=t/e;let r=1;return n.dayOfMonth<=15&&(r=1.1),n.dayOfMonth>25&&[3,6,9,12].includes(n.currentMonth)&&(r=1.08),a*r}calculateReceivables(t){let e=0;return Object.entries(this.config.creditTerms).forEach(([t,n])=>{const a=parseInt(t.replace("net",""));e+=(a+7)*n}),t*e}calculateInventory(t){let e=0;return Object.entries(this.config.inventoryCategories).forEach(([n,a])=>{const r=t*a.turnoverDays*a.percentage;e+=r}),e}calculatePayables(t){let e=0;return Object.entries(this.config.paymentTerms).forEach(([t,n])=>{const a=parseInt(t.replace("net",""));e+=a*n}),.7*t*e}calculateWorkingCapitalImpact(t,e){const n=t-(this.config.targetDSO+this.config.targetDIO-this.config.targetDPO),a=n*e;return{cccVarianceDays:Math.round(10*n)/10,workingCapitalImpact:Math.round(a),annualInterestCost:Math.round(.055*a),optimizationPotential:Math.round(Math.abs(a))}}generateRecommendations(t,e,n){const a=[];t>this.config.targetDSO+5&&a.push({area:"Collections",priority:"high",issue:`DSO of ${t.toFixed(1)} days exceeds target by ${(t-this.config.targetDSO).toFixed(1)} days`,recommendation:"Implement automated collections processes, offer early payment discounts, review credit terms",impact:`Could free up £${Math.round(4e7*(t-this.config.targetDSO)/365).toLocaleString()} in working capital`}),e>this.config.targetDIO+5&&a.push({area:"Inventory",priority:"medium",issue:`Inventory days of ${e.toFixed(1)} exceeds target by ${(e-this.config.targetDIO).toFixed(1)} days`,recommendation:"Implement just-in-time ordering, improve demand forecasting, reduce safety stock levels",impact:`Could free up £${Math.round(26e6*(e-this.config.targetDIO)/365).toLocaleString()} in working capital`}),n<this.config.targetDPO-5&&a.push({area:"Payables",priority:"low",issue:`Payable days of ${n.toFixed(1)} below target by ${(this.config.targetDPO-n).toFixed(1)} days`,recommendation:"Negotiate extended payment terms with suppliers, optimize payment timing",impact:`Could improve cash flow by £${Math.round(26e6*(this.config.targetDPO-n)/365).toLocaleString()}`});const r=t+e-n,o=this.config.targetDSO+this.config.targetDIO-this.config.targetDPO;return r>o+10&&a.push({area:"Cash Conversion Cycle",priority:"high",issue:`CCC of ${r.toFixed(1)} days significantly exceeds target of ${o.toFixed(1)} days`,recommendation:"Comprehensive working capital optimization program focusing on collections and inventory",impact:`Total optimization potential: £${Math.round(4e7*(r-o)/365).toLocaleString()}`}),a}projectCCCOverTime(t=12){const e=[],n=this.calculateCashConversionCycle();for(let a=0;a<t;a++){const t=new Date;t.setMonth(t.getMonth()+a);const r={currentMonth:t.getMonth()+1,dayOfMonth:t.getDate(),currentDate:t.toISOString().split("T")[0]};let o=n.components.dso,i=n.components.dio,c=n.components.dpo;[12,1].includes(r.currentMonth)&&(o*=1.08),[7,8].includes(r.currentMonth)&&(o*=1.05),[10,11].includes(r.currentMonth)&&(i*=1.2),[1,2].includes(r.currentMonth)&&(i*=.85),[3,6,9,12].includes(r.currentMonth)&&(c*=1.08);const s=o+i-c;e.push({month:t.toLocaleDateString("en-US",{month:"short",year:"numeric"}),date:r.currentDate,ccc:Math.round(10*s)/10,dso:Math.round(10*o)/10,dio:Math.round(10*i)/10,dpo:Math.round(10*c)/10,workingCapitalImpact:Math.round(4e7*(s-n.benchmarks.targetCCC)/365)})}return e}analyzeCCCTrends(t){if(!t||t.length<3)return{trend:"insufficient_data",message:"Need at least 3 data points for trend analysis"};const e=t.length;let n=0,a=0,r=0,o=0;t.forEach((t,e)=>{n+=e,a+=t.ccc,r+=e*t.ccc,o+=e*e});const i=(e*r-n*a)/(e*o-n*n),c=i>1?"deteriorating":i<-1?"improving":"stable",s=t.map(t=>t.ccc),l=s.reduce((t,e)=>t+e,0)/s.length,g=s.reduce((t,e)=>t+Math.pow(e-l,2),0)/s.length,u=g>25?"high":g>10?"medium":"low";return{trend:c,slope:Math.round(100*i)/100,volatility:u,variance:Math.round(10*g)/10,averageCCC:Math.round(10*l)/10,recommendation:this.getTrendRecommendation(c,u,l)}}getTrendRecommendation(t,e,n){return"deteriorating"===t?"CCC is worsening over time. Immediate action needed on collections, inventory management, or supplier terms.":"improving"===t?"CCC is improving. Continue current optimization efforts and identify additional opportunities.":"high"===e?"CCC is highly volatile. Focus on stabilizing working capital processes and improving predictability.":"CCC is stable. Monitor for seasonal patterns and optimization opportunities."}}export{e as C};
