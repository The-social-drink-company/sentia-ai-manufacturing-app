import{C as h,d as j,a as w,b as k}from"./index-CvYnGs3W.js";import{r as l,ab as e}from"./vendor-C1LNgw1J.js";import"./data-layer-rESbPKUZ.js";import"./radix-CSh4aNe1.js";import"./router-BEPb3H3e.js";const P=()=>{const[s,c]=l.useState(null),[t,a]=l.useState(!0),[r,o]=l.useState(null),[x,u]=l.useState(null),[n,g]=l.useState(0),[S,N]=l.useState(!1),d=l.useCallback(async(m=!1)=>{try{m?N(!0):a(!0),o(null),console.log("🔄 Fetching live working capital data from MCP server...");const p=await fetch("/api/working-capital"),i=await p.json();if(!p.ok||!i.success){const f={type:i.error||"API Error",message:i.message||"Failed to fetch working capital data",userAction:i.userAction||"Please try again",retryIn:i.retryIn,timestamp:i.timestamp,httpStatus:p.status};console.error("❌ Working capital API error:",f),o(f),c(null),u(null),m&&(g(A=>A+1),console.log(`🔄 Retry attempt ${n+1} failed`))}else console.log("✅ Live working capital data fetched successfully from MCP server"),c(i.data),u(i.metadata),o(null),g(0)}catch(p){const i={type:"Network Error",message:"Unable to connect to the server. Check your internet connection.",userAction:"Please check your connection and try again",retryIn:"30 seconds",timestamp:new Date().toISOString(),originalError:p.message};console.error("❌ Network error fetching working capital data:",i),o(i),c(null),u(null),m&&g(f=>f+1)}finally{a(!1),N(!1)}},[n]),I=l.useCallback(()=>{console.log("🔄 Manual retry triggered by user"),d(!0)},[d]),v=l.useCallback(()=>{if(r&&r.type==="Network Error"&&n<3){const m=Math.min(1e3*Math.pow(2,n),3e4);console.log(`⏱️ Scheduling automatic retry in ${m}ms (attempt ${n+1}/3)`),setTimeout(()=>{d(!0)},m)}else n>=3&&console.warn("⚠️ Max retry attempts reached, stopping automatic retries")},[r,n,d]);return l.useEffect(()=>{d()},[d]),l.useEffect(()=>{if(!r&&s&&x&&x.dataSource==="live"){console.log("🔄 Setting up auto-refresh interval for live data (5 minutes)");const m=setInterval(()=>{console.log("🔄 Auto-refreshing live working capital data"),d()},300*1e3);return()=>{console.log("🛑 Clearing auto-refresh interval"),clearInterval(m)}}},[r,s,x,d]),l.useEffect(()=>{r&&r.type==="Network Error"&&n<3&&v()},[r,n,v]),{data:s,loading:t,error:r,metadata:x,isRetrying:S,retryCount:n,retryConnection:I,refresh:d}},X=()=>{var o,x,u,n;const{data:s,loading:c,error:t,metadata:a,retryConnection:r}=P();return c?e.jsxs("section",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Working Capital Overview"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading live financial data..."})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[1,2,3,4].map(g=>e.jsx(h,{className:"animate-pulse",children:e.jsxs(j,{className:"space-y-2 p-5",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/3"})]})},g))})]}):t?e.jsxs("section",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Working Capital Overview"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unable to load financial data"})]}),e.jsxs(h,{className:"border-red-200 bg-red-50",children:[e.jsx(w,{children:e.jsxs(k,{className:"text-red-800 flex items-center gap-2",children:["🔴 ",t.type]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsx("p",{className:"text-red-700",children:t.message}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-red-600",children:[e.jsx("strong",{children:"Action required:"})," ",t.userAction]}),t.retryIn&&e.jsxs("p",{className:"text-sm text-red-600",children:[e.jsx("strong",{children:"Retry in:"})," ",t.retryIn]}),e.jsxs("p",{className:"text-xs text-red-500",children:["Error occurred at: ",new Date(t.timestamp).toLocaleString()]})]}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Retry Connection"})]})]})]}):e.jsxs("section",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Working Capital Overview"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Live financial data from Xero"})]}),e.jsx(h,{className:"border-green-200 bg-green-50",children:e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-800 font-medium",children:"Live Data Connected"})]}),a&&e.jsxs("div",{className:"text-right text-sm text-green-700",children:[e.jsxs("p",{children:["Last updated: ",new Date(a.lastUpdated).toLocaleString()]}),e.jsxs("p",{children:["Response time: ",a.responseTime]})]})]}),a&&a.services&&e.jsxs("div",{className:"mt-2 flex gap-4 text-xs text-green-600",children:[e.jsxs("span",{children:["🟢 MCP Server: ",((o=a.services.mcpServer)==null?void 0:o.status)||"unknown"]}),e.jsxs("span",{children:["🟢 Xero API: ",((x=a.services.xero)==null?void 0:x.status)||"unknown"]})]})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsx(y,{label:"Working Capital",value:b(s.workingCapital),helper:"Assets − Liabilities",tone:"primary",dataSource:"Xero API"}),e.jsx(y,{label:"Current Ratio",value:((u=s.currentRatio)==null?void 0:u.toFixed(2))||"N/A",helper:"Target ≥ 2.0",tone:"success",dataSource:"Xero API"}),e.jsx(y,{label:"Quick Ratio",value:((n=s.quickRatio)==null?void 0:n.toFixed(2))||"N/A",helper:"Target ≥ 1.5",tone:"success",dataSource:"Xero API"}),e.jsx(y,{label:"Cash Available",value:b(s.cash),helper:"Immediate liquidity",tone:"warning",dataSource:"Xero API"})]}),e.jsxs(h,{children:[e.jsx(w,{children:e.jsx(k,{children:"Balance Summary (Live from Xero)"})}),e.jsxs(j,{className:"grid gap-3 md:grid-cols-2",children:[e.jsx(C,{label:"Receivables",value:b(s.receivables),dataSource:"Xero API"}),e.jsx(C,{label:"Payables",value:b(s.payables),dataSource:"Xero API"})]})]})]})},y=({label:s,value:c,helper:t,tone:a,dataSource:r})=>{const o=a==="primary"?"bg-blue-50 text-blue-900":a==="success"?"bg-emerald-50 text-emerald-900":"bg-amber-50 text-amber-900";return e.jsx(h,{className:o,children:e.jsxs(j,{className:"space-y-2 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium opacity-80",children:s}),e.jsxs("span",{className:"text-xs opacity-60 bg-white/50 px-2 py-1 rounded",children:["📊 ",r]})]}),e.jsx("p",{className:"text-2xl font-semibold",children:c}),e.jsx("p",{className:"text-xs opacity-70",children:t})]})})},C=({label:s,value:c,dataSource:t})=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsxs("span",{className:"text-xs text-muted-foreground/70",children:["📊 ",t]})]}),e.jsx("p",{className:"text-lg font-semibold",children:c})]}),b=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s);export{X as default};
