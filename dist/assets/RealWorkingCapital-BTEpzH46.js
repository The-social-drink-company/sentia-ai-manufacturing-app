import{C as p,d as h,a as w,b as k}from"./index-IkkkT-X8.js";import{r,ab as e}from"./vendor-if_euMW7.js";import"./data-layer-BNrHGTjD.js";import"./radix-DXWB-ErX.js";import"./router-D3j4TwQA.js";const P=()=>{const[s,c]=r.useState(null),[t,n]=r.useState(!0),[a,o]=r.useState(null),[x,u]=r.useState(null),[i,b]=r.useState(0),[S,N]=r.useState(!1),d=r.useCallback(async(m=!1)=>{try{m?N(!0):n(!0),o(null),console.log("🔄 Fetching live working capital data from MCP server...");const g=await fetch("/api/working-capital"),l=await g.json();if(!g.ok||!l.success){const j={type:l.error||"API Error",message:l.message||"Failed to fetch working capital data",userAction:l.userAction||"Please try again",retryIn:l.retryIn,timestamp:l.timestamp,httpStatus:g.status};console.error("❌ Working capital API error:",j),o(j),c(null),u(null),m&&(b(A=>A+1),console.log(`🔄 Retry attempt ${i+1} failed`))}else console.log("✅ Live working capital data fetched successfully from MCP server"),c(l.data),u(l.metadata),o(null),b(0)}catch(g){const l={type:"Network Error",message:"Unable to connect to the server. Check your internet connection.",userAction:"Please check your connection and try again",retryIn:"30 seconds",timestamp:new Date().toISOString(),originalError:g.message};console.error("❌ Network error fetching working capital data:",l),o(l),c(null),u(null),m&&b(j=>j+1)}finally{n(!1),N(!1)}},[i]),I=r.useCallback(()=>{console.log("🔄 Manual retry triggered by user"),d(!0)},[d]),v=r.useCallback(()=>{if(a&&a.type==="Network Error"&&i<3){const m=Math.min(1e3*Math.pow(2,i),3e4);console.log(`⏱️ Scheduling automatic retry in ${m}ms (attempt ${i+1}/3)`),setTimeout(()=>{d(!0)},m)}else i>=3&&console.warn("⚠️ Max retry attempts reached, stopping automatic retries")},[a,i,d]);return r.useEffect(()=>{d()},[d]),r.useEffect(()=>{if(!a&&s&&x&&x.dataSource==="live"){console.log("🔄 Setting up auto-refresh interval for live data (5 minutes)");const m=setInterval(()=>{console.log("🔄 Auto-refreshing live working capital data"),d()},5*60*1e3);return()=>{console.log("🛑 Clearing auto-refresh interval"),clearInterval(m)}}},[a,s,x,d]),r.useEffect(()=>{a&&a.type==="Network Error"&&i<3&&v()},[a,i,v]),{data:s,loading:t,error:a,metadata:x,isRetrying:S,retryCount:i,retryConnection:I,refresh:d}},X=()=>{var o,x;const{data:s,loading:c,error:t,metadata:n,retryConnection:a}=P();return c?e.jsxs("section",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Working Capital Overview"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading live financial data..."})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[1,2,3,4].map(u=>e.jsx(p,{className:"animate-pulse",children:e.jsxs(h,{className:"space-y-2 p-5",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/3"})]})},u))})]}):t?e.jsxs("section",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Working Capital Overview"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unable to load financial data"})]}),e.jsxs(p,{className:"border-red-200 bg-red-50",children:[e.jsx(w,{children:e.jsxs(k,{className:"text-red-800 flex items-center gap-2",children:["🔴 ",t.type]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsx("p",{className:"text-red-700",children:t.message}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-red-600",children:[e.jsx("strong",{children:"Action required:"})," ",t.userAction]}),t.retryIn&&e.jsxs("p",{className:"text-sm text-red-600",children:[e.jsx("strong",{children:"Retry in:"})," ",t.retryIn]}),e.jsxs("p",{className:"text-xs text-red-500",children:["Error occurred at: ",new Date(t.timestamp).toLocaleString()]})]}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Retry Connection"})]})]})]}):e.jsxs("section",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Working Capital Overview"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Live financial data from Xero"})]}),e.jsx(p,{className:"border-green-200 bg-green-50",children:e.jsxs(h,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-green-800 font-medium",children:"Live Data Connected"})]}),e.jsxs("div",{className:"text-right text-sm text-green-700",children:[e.jsxs("p",{children:["Last updated: ",new Date(n.lastUpdated).toLocaleString()]}),e.jsxs("p",{children:["Response time: ",n.responseTime]})]})]}),e.jsxs("div",{className:"mt-2 flex gap-4 text-xs text-green-600",children:[e.jsxs("span",{children:["🟢 MCP Server: ",n.services.mcpServer.status]}),e.jsxs("span",{children:["🟢 Xero API: ",n.services.xero.status]})]})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsx(f,{label:"Working Capital",value:y(s.workingCapital),helper:"Assets − Liabilities",tone:"primary",dataSource:"Xero API"}),e.jsx(f,{label:"Current Ratio",value:((o=s.currentRatio)==null?void 0:o.toFixed(2))||"N/A",helper:"Target ≥ 2.0",tone:"success",dataSource:"Xero API"}),e.jsx(f,{label:"Quick Ratio",value:((x=s.quickRatio)==null?void 0:x.toFixed(2))||"N/A",helper:"Target ≥ 1.5",tone:"success",dataSource:"Xero API"}),e.jsx(f,{label:"Cash Available",value:y(s.cash),helper:"Immediate liquidity",tone:"warning",dataSource:"Xero API"})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(k,{children:"Balance Summary (Live from Xero)"})}),e.jsxs(h,{className:"grid gap-3 md:grid-cols-2",children:[e.jsx(C,{label:"Receivables",value:y(s.receivables),dataSource:"Xero API"}),e.jsx(C,{label:"Payables",value:y(s.payables),dataSource:"Xero API"})]})]})]})},f=({label:s,value:c,helper:t,tone:n,dataSource:a})=>{const o=n==="primary"?"bg-blue-50 text-blue-900":n==="success"?"bg-emerald-50 text-emerald-900":"bg-amber-50 text-amber-900";return e.jsx(p,{className:o,children:e.jsxs(h,{className:"space-y-2 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium opacity-80",children:s}),e.jsxs("span",{className:"text-xs opacity-60 bg-white/50 px-2 py-1 rounded",children:["📊 ",a]})]}),e.jsx("p",{className:"text-2xl font-semibold",children:c}),e.jsx("p",{className:"text-xs opacity-70",children:t})]})})},C=({label:s,value:c,dataSource:t})=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsxs("span",{className:"text-xs text-muted-foreground/70",children:["📊 ",t]})]}),e.jsx("p",{className:"text-lg font-semibold",children:c})]}),y=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(s);export{X as default};
