import{r as e,j as t,Z as a,b2 as r,b3 as s}from"./react-core-DlJGLw67.js";import{u as i,a as n}from"./RealtimeProvider-8EHvQ19R.js";import{u as l}from"./Button-BrRB7_v3.js";import"./auth-BIfipbc6.js";import"./vendor-TZ9aDXZU.js";import"./charts-C-BUlHpY.js";import"./vendor-utils-W0IPh-on.js";import"./index-DuY1VrEM.js";import"./router-BgNYfmsc.js";import"./animation-Cxa7csYq.js";import"./utils-CawmYOGx.js";import"./forms-CKrR-uQz.js";const o=({className:o="",equipmentFilter:c=null,maintenanceHorizon:d=30,predictionThreshold:m=.7,...p})=>{const{aiServices:u,performAIAnalysis:x,isLoading:h}=i(),{dataStreams:g,subscribe:b,STREAM_TYPES:y}=n(),{resolvedTheme:v}=l(),[j,N]=e.useState([]),[f,w]=e.useState([]),[S,k]=e.useState([]),[$,D]=e.useState([]),[M,H]=e.useState(null),[C,E]=e.useState("overview"),[P,R]=e.useState(!1),I={label:"Excellent",color:"text-green-600",bg:"bg-green-100 dark:bg-green-900/30"},L={label:"Good",color:"text-blue-600",bg:"bg-blue-100 dark:bg-blue-900/30"},A={label:"Fair",color:"text-yellow-600",bg:"bg-yellow-100 dark:bg-yellow-900/30"},T={label:"Poor",color:"text-orange-600",bg:"bg-orange-100 dark:bg-orange-900/30"},q={label:"Critical",color:"text-red-600",bg:"bg-red-100 dark:bg-red-900/30"};e.useEffect(()=>{N([{id:"cnc-001",name:"CNC Milling Machine #1",type:"CNC_MACHINE",location:"Production Line A",installDate:"2020-03-15",lastMaintenance:"2024-08-15",operatingHours:8750,healthScore:.85,vibrationLevel:2.3,temperature:68.5,powerConsumption:12.4,efficiency:.92,predictedFailureRisk:.15},{id:"conv-001",name:"Conveyor Belt System #1",type:"CONVEYOR",location:"Assembly Line B",installDate:"2019-11-20",lastMaintenance:"2024-09-01",operatingHours:12200,healthScore:.78,vibrationLevel:1.8,temperature:45.2,powerConsumption:5.7,efficiency:.89,predictedFailureRisk:.35},{id:"pump-001",name:"Hydraulic Pump #1",type:"PUMP",location:"Utility Room",installDate:"2021-01-10",lastMaintenance:"2024-08-20",operatingHours:6800,healthScore:.91,vibrationLevel:1.2,temperature:72.1,powerConsumption:8.9,efficiency:.95,predictedFailureRisk:.08},{id:"press-001",name:"Hydraulic Press #1",type:"PRESS",location:"Production Line C",installDate:"2018-07-22",lastMaintenance:"2024-07-10",operatingHours:15600,healthScore:.68,vibrationLevel:3.1,temperature:85.3,powerConsumption:18.2,efficiency:.82,predictedFailureRisk:.52}])},[]),e.useEffect(()=>{const e=[b(y.VIBRATION_SENSORS,e=>{U(e,"vibrationLevel")}),b(y.TEMPERATURE_SENSORS,e=>{U(e,"temperature")}),b(y.EQUIPMENT_STATUS,e=>{F(e)})];return()=>{e.forEach(e=>e())}},[b,y]);const U=(e,t)=>{N(a=>a.map(a=>e.equipmentId===a.id?{...a,[t]:e.value,lastUpdate:Date.now()}:a))},F=e=>{N(t=>t.map(t=>e.equipmentId===t.id?{...t,...e,lastUpdate:Date.now()}:t))},O=e=>{const t=e.filter(e=>e.failureRisk>m).map(e=>{const t=_(e.equipmentId),a=Math.max(1,Math.floor(.8*e.timeToFailure));return{id:`maint-${e.equipmentId}-${Date.now()}`,equipmentId:e.equipmentId,equipmentName:t?.name||"Unknown Equipment",type:e.recommendedAction||"Preventive Maintenance",scheduledDate:new Date(Date.now()+24*a*60*60*1e3),priority:e.failureRisk>.8?"HIGH":"MEDIUM",estimatedDuration:e.estimatedRepairTime||4,description:e.description||"Preventive maintenance based on predictive analysis"}});D(t)},_=e=>j.find(t=>t.id===e),B=e=>{let t=1;const a=(Date.now()-new Date(e.installDate).getTime())/31536e6;t-=Math.min(.3,.05*a);const r=2e3*a,s=e.operatingHours/r;return t-=Math.min(.2,.5*Math.max(0,s-1)),e.vibrationLevel>3&&(t-=.1),e.temperature>80&&(t-=.1),e.efficiency<.85&&(t-=.1),Math.max(0,Math.min(1,t))},z=e.useMemo(()=>{let e=j;return c&&(e=e.filter(e=>e.type===c)),e.map(e=>{return{...e,calculatedHealthScore:B(e),healthState:(t=B(e),t>=.9?I:t>=.8?L:t>=.7?A:t>=.6?T:q)};var t})},[j,c]),G=e.useMemo(()=>$.filter(e=>new Date(e.scheduledDate)<=new Date(Date.now()+6048e5)).sort((e,t)=>new Date(e.scheduledDate)-new Date(t.scheduledDate)),[$]),V=`\n    rounded-lg border shadow-sm\n    ${"dark"===v?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}\n  `,Y="dark"===v?"text-gray-100":"text-gray-900",Q="dark"===v?"text-gray-300":"text-gray-600",Z="dark"===v?"text-gray-400":"text-gray-500";return t.jsxs("div",{className:`space-y-6 ${o}`,...p,children:[t.jsx("div",{className:V,children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(a,{className:"w-6 h-6 mr-3 text-blue-600"}),t.jsx("h2",{className:`text-xl font-semibold ${Y}`,children:"Predictive Maintenance System"})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsx("button",{onClick:async()=>{if(u.maintenancePrediction){R(!0);try{const e=j.map(e=>({equipmentId:e.id,type:e.type,operatingHours:e.operatingHours,vibrationLevel:e.vibrationLevel,temperature:e.temperature,powerConsumption:e.powerConsumption,efficiency:e.efficiency,lastMaintenanceDate:e.lastMaintenance,installDate:e.installDate})),t=await x("maintenancePrediction",{equipment:e,horizon:d,threshold:m});w(t.predictions||[]),k(t.anomalies||[]),O(t.predictions||[])}catch(e){}finally{R(!1)}}},disabled:P||h,className:`\n                  px-4 py-2 rounded-lg font-medium transition-colors\n                  ${P||h?"bg-gray-200 text-gray-500 cursor-not-allowed dark:bg-gray-700":"bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600"}\n                `,children:P?"Analyzing...":"Run AI Analysis"})})]}),t.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:["overview","predictions","schedule","analytics"].map(e=>t.jsx("button",{onClick:()=>E(e),className:`\n                  px-4 py-2 rounded-md text-sm font-medium transition-colors\n                  ${C===e?"bg-white shadow text-blue-600 dark:bg-gray-800 dark:text-blue-400":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"}\n                `,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})}),"overview"===C&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:`lg:col-span-2 ${V}`,children:t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:`text-lg font-semibold mb-4 ${Y}`,children:"Equipment Health Status"}),t.jsx("div",{className:"space-y-4",children:z.map(e=>t.jsxs("div",{className:`\n                      p-4 rounded-lg border cursor-pointer transition-colors\n                      ${M?.id===e.id?"ring-2 ring-blue-500 border-blue-300 dark:border-blue-600":"border-gray-200 hover:border-gray-300 dark:border-gray-600 dark:hover:border-gray-500"}\n                      ${"dark"===v?"bg-slate-700":"bg-gray-50"}\n                    `,onClick:()=>H(e),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`\n                          w-3 h-3 rounded-full\n                          ${e.healthState.color.includes("green")?"bg-green-500":e.healthState.color.includes("blue")?"bg-blue-500":e.healthState.color.includes("yellow")?"bg-yellow-500":e.healthState.color.includes("orange")?"bg-orange-500":"bg-red-500"}\n                        `}),t.jsxs("div",{children:[t.jsx("h4",{className:`font-medium ${Y}`,children:e.name}),t.jsx("p",{className:`text-sm ${Z}`,children:e.location})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:`\n                          px-2 py-1 rounded-full text-xs font-medium\n                          ${e.healthState.bg} ${e.healthState.color}\n                        `,children:e.healthState.label}),t.jsxs("p",{className:`text-sm mt-1 ${Z}`,children:[Math.round(100*e.calculatedHealthScore),"% Health"]})]})]}),t.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs ${Z}`,children:"Vibration"}),t.jsxs("p",{className:`font-medium ${Q}`,children:[e.vibrationLevel,"mm/s"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs ${Z}`,children:"Temp"}),t.jsxs("p",{className:`font-medium ${Q}`,children:[e.temperature,"Â°C"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs ${Z}`,children:"Efficiency"}),t.jsxs("p",{className:`font-medium ${Q}`,children:[Math.round(100*e.efficiency),"%"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs ${Z}`,children:"Hours"}),t.jsx("p",{className:`font-medium ${Q}`,children:e.operatingHours.toLocaleString()})]})]})]},e.id))})]})}),t.jsx("div",{className:V,children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx(r,{className:"w-5 h-5 mr-2 text-orange-600"}),t.jsx("h3",{className:`text-lg font-semibold ${Y}`,children:"Pending Maintenance"})]}),G.length>0?t.jsx("div",{className:"space-y-3",children:G.slice(0,5).map(e=>t.jsxs("div",{className:"border-l-4 border-orange-500 pl-3",children:[t.jsx("h4",{className:`font-medium ${Y}`,children:e.equipmentName}),t.jsx("p",{className:`text-sm ${Q}`,children:e.type}),t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("span",{className:`text-xs ${Z}`,children:new Date(e.scheduledDate).toLocaleDateString()}),t.jsx("span",{className:`\n                          text-xs px-2 py-1 rounded\n                          ${"HIGH"===e.priority?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"}\n                        `,children:e.priority})]})]},e.id))}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(s,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),t.jsx("p",{className:Q,children:"No pending maintenance"})]})]})})]})]})};export{o as PredictiveMaintenanceSystem,o as default};
