import{j as e}from"./query-ChsViXKH.js";import{a as t}from"./vendor-CoorQe56.js";import{L as a,S as s}from"./index-DHg92Bk0.js";import{k as r,n as i,g as n,p as o,b as c,r as l}from"./index-OKp0riWf.js";import{m as d}from"./EnterpriseEnhancedDashboard-B3er-hgC.js";import{F as m}from"./ExclamationTriangleIcon-bY6NOTqX.js";import"./auth-DSi5b8Vw.js";import"./charts-BUC9_Lyc.js";import"./utils-BeLtu-UY.js";import"./bar-chart-3-LHUe3x3R.js";import"./target-DPt77ZEH.js";var h={};const x=new class{constructor(){this.mcpBaseUrl=h.MCP_SERVER_URL||"https://sentia-mcp-server.railway.app",this.cache=new Map,this.cacheTimeout=3e5}async generateDashboardInsights(e,t={}){try{const a=`insights_${JSON.stringify(e).substring(0,50)}`,s=this.getCached(a);if(s)return s;const[r,i,n]=await Promise.all([d.openaiAnalyzeData(e,"dashboard_metrics"),d.anthropicGenerateInsights({data:e,context:t}),this.analyzeFinancialMetrics(e)]),o=this.mergeInsights({openAI:r,anthropic:i,xero:n}),c=this.categorizeInsights(o);return this.setCache(a,c),c}catch(a){return r.error("Failed to generate dashboard insights:",a),this.getFallbackInsights(e)}}async predictTrends(e,t={}){const{horizon:a=30,confidence:s=.95,includeSeasonality:i=!0,includeExternalFactors:n=!0}=t;try{const t=await d.openaiAnalyzeData({historical:e,task:"time_series_forecast",parameters:{horizon:a,confidence:s,seasonality:i,external_factors:n}},"forecasting"),r=await d.anthropicAnalyzeManufacturing({prediction:t,historical:e,businessContext:await this.getBusinessContext()},"trend_analysis");return{forecast:t.forecast,confidence:t.confidence,insights:r.insights,risks:r.risks,opportunities:r.opportunities,visualization:this.generateVisualizationConfig(t)}}catch(o){return r.error("Failed to predict trends:",o),null}}async detectAnomalies(e,t="medium"){try{const a=await d.openaiAnalyzeData({data:e,task:"anomaly_detection",sensitivity:t,method:"isolation_forest"},"anomaly_detection");if(a&&a.detected&&a.detected.length>0){const t=await d.anthropicGenerateInsights({anomalies:a.detected,metrics:e,context:"anomaly_explanation"});return{detected:a.detected,severity:this.calculateSeverity(a.detected),explanations:t.insights,recommendations:await this.generateAnomalyRecommendations(a.detected),alerts:this.generateAlerts(a.detected)}}return{detected:[],severity:"none"}}catch(a){return r.error("Failed to detect anomalies:",a),{detected:[],severity:"error"}}}async generateOptimizations(e,t={}){try{const a=await Promise.all([this.optimizeProduction(e),this.optimizeInventory(e),this.optimizeCosts(e),this.optimizeQuality(e)]),s=this.mergeOptimizations(a),r=this.prioritizeByImpact(s,t);return{recommendations:r,expectedImpact:this.calculateExpectedImpact(r),implementation:this.generateImplementationPlan(r),timeline:this.estimateTimeline(r)}}catch(a){return r.error("Failed to generate optimizations:",a),{recommendations:[]}}}async processNaturalQuery(e,t={}){try{const a=await d.anthropicGenerateInsights({query:e,context:t,task:"intent_recognition"}),s=await this.fetchDataForIntent(a);return{answer:(await d.openaiGenerateText(`Answer the following query based on the provided data: "${e}"\n         Data: ${JSON.stringify(s)}\n         Context: ${JSON.stringify(t)}`,{temperature:.7,max_tokens:500})).text,data:s,visualizations:this.suggestVisualizations(s),followUp:this.generateFollowUpQuestions(a,s)}}catch(a){return r.error("Failed to process natural query:",a),{answer:"I couldn't process that query. Please try rephrasing or be more specific.",error:!0}}}async generateExecutiveSummary(e){try{const t=await d.anthropicGenerateInsights({data:e,format:"executive_summary",maxLength:500,focusAreas:["performance","risks","opportunities","recommendations"]});return{summary:t.summary,keyMetrics:t.metrics,criticalIssues:t.issues,recommendations:t.recommendations,nextSteps:t.nextSteps}}catch(t){return r.error("Failed to generate executive summary:",t),null}}async predictMaintenance(e,t){try{const a=await d.openaiAnalyzeData({equipment:e,history:t,task:"predictive_maintenance"},"maintenance_prediction"),s=await this.generateMaintenanceSchedule(a),r=await this.estimateMaintenanceCosts(a);return{predictions:a.predictions,riskScore:a.riskScore,schedule:s,costs:r,preventiveActions:a.preventiveActions}}catch(a){return r.error("Failed to predict maintenance:",a),null}}async analyzeQuality(e,t){try{const a=await d.anthropicAnalyzeManufacturing({quality:e,production:t},"quality_analysis"),s=await d.openaiAnalyzeData({data:e,task:"defect_prediction"},"quality_control");return{currentQuality:a.score,trends:a.trends,defectProbability:s.probability,rootCauses:a.rootCauses,improvements:a.recommendations,costImpact:this.calculateQualityCosts(a)}}catch(a){return r.error("Failed to analyze quality:",a),null}}mergeInsights(e){const t=[];return e.openAI?.insights&&t.push(...e.openAI.insights),e.anthropic?.insights&&t.push(...e.anthropic.insights),e.xero&&t.push(...e.xero),this.deduplicateInsights(t)}categorizeInsights(e){return{critical:e.filter(e=>"critical"===e.priority||"high"===e.severity),opportunities:e.filter(e=>"opportunity"===e.type),risks:e.filter(e=>"risk"===e.type),performance:e.filter(e=>"performance"===e.category),recommendations:e.filter(e=>"recommendation"===e.type),general:e.filter(e=>!["critical","opportunity","risk","performance","recommendation"].includes(e.type))}}calculateSeverity(e){if(!e||0===e.length)return"none";const t=e.map(e=>e.severity||e.score||0),a=Math.max(...t);return a>.8?"critical":a>.6?"high":a>.4?"medium":"low"}async generateAnomalyRecommendations(e){const t=[];for(const a of e){const e=await this.generateSingleAnomalyRecommendation(a);e&&t.push(e)}return t}generateAlerts(e){return e.filter(e=>(e.severity||e.score||0)>.6).map(e=>({type:"anomaly",severity:this.calculateSeverity([e]),message:e.message||`Anomaly detected in ${e.metric||"system"}`,timestamp:(new Date).toISOString(),data:e}))}getCached(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.data:null}setCache(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}async getBusinessContext(){return{date:(new Date).toISOString(),season:this.getCurrentSeason(),marketConditions:await this.getMarketConditions(),operationalStatus:await this.getOperationalStatus()}}getCurrentSeason(){const e=(new Date).getMonth();return e>=2&&e<=4?"spring":e>=5&&e<=7?"summer":e>=8&&e<=10?"autumn":"winter"}async getMarketConditions(){return{trend:"stable",demand:"moderate"}}async getOperationalStatus(){return{capacity:.75,efficiency:.85}}deduplicateInsights(e){const t=new Set;return e.filter(e=>{const a=JSON.stringify(e.message||e.text||e);return!t.has(a)&&(t.add(a),!0)})}generateVisualizationConfig(e){return{type:"line",showConfidenceInterval:!0,colors:["#3B82F6","#10B981","#F59E0B"],annotations:e.keyPoints||[]}}async analyzeFinancialMetrics(e){return[]}getFallbackInsights(e){return{critical:[],opportunities:[],risks:[],performance:[],recommendations:[{type:"info",message:"AI insights temporarily unavailable. Showing basic metrics.",priority:"low"}]}}async optimizeProduction(e){return{type:"production",recommendations:[]}}async optimizeInventory(e){return{type:"inventory",recommendations:[]}}async optimizeCosts(e){return{type:"costs",recommendations:[]}}async optimizeQuality(e){return{type:"quality",recommendations:[]}}mergeOptimizations(e){return e.flatMap(e=>e.recommendations||[])}prioritizeByImpact(e,t){return e.sort((e,t)=>(t.impact||0)-(e.impact||0))}calculateExpectedImpact(e){return e.reduce((e,t)=>e+(t.impact||0),0)}generateImplementationPlan(e){return e.map((e,t)=>({step:t+1,action:e.action,timeline:e.timeline||"1 week",resources:e.resources||[]}))}estimateTimeline(e){const t=e.reduce((e,t)=>e+(t.days||7),0);return`${Math.ceil(t/7)} weeks`}async fetchDataForIntent(e){return{}}suggestVisualizations(e){return["line","bar","pie"]}generateFollowUpQuestions(e,t){return["Would you like to see the trend over a different time period?","Should I compare this with industry benchmarks?","Would you like to export this data?"]}async generateSingleAnomalyRecommendation(e){return{action:`Investigate ${e.metric||"anomaly"}`,priority:this.calculateSeverity([e]),estimated_impact:"medium"}}async generateMaintenanceSchedule(e){return e.schedule||[]}async estimateMaintenanceCosts(e){return e.costs||{total:0,breakdown:[]}}calculateQualityCosts(e){return e.costImpact||{defects:0,rework:0,prevention:0}}},p=({data:r=[],metrics:d=[],timeRange:h=30,refreshInterval:p=6e4})=>{const[g,u]=t.useState({}),[y,b]=t.useState([]),[f,j]=t.useState([]),[v,k]=t.useState([]),[N,w]=t.useState(d[0]||"production"),[I,A]=t.useState(!1),[C,z]=t.useState(.95),[S,D]=t.useState("predictions");t.useEffect(()=>{F();const e=setInterval(F,p);return()=>clearInterval(e)},[r,N,h,C]);const F=async()=>{if(!I&&r.length){A(!0);try{const[e,t,a,s]=await Promise.all([x.predictTrends(r,{horizon:h,confidence:C,includeSeasonality:!0}),x.detectAnomalies(r,"high"),x.generateOptimizations({metrics:r,currentMetric:N}),x.generateDashboardInsights(r,{metric:N})]);u(e||{}),j(t?.detected||[]),k(a?.recommendations||[]),b([...s?.critical||[],...s?.opportunities||[]].slice(0,5))}catch(e){i("Predictive analysis failed",e,{component:"PredictiveAnalyticsDashboard"})}finally{A(!1)}}},M={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!1}}},_=[{id:"predictions",label:"Predictions",icon:c},{id:"anomalies",label:"Anomalies",icon:m},{id:"optimizations",label:"Optimizations",icon:l},{id:"insights",label:"AI Insights",icon:o}];return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(n,{className:"h-7 w-7 mr-2 text-blue-600"}),"Predictive Analytics Dashboard"]}),I&&e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx(o,{className:"h-5 w-5 animate-pulse mr-2"}),e.jsx("span",{className:"text-sm",children:"Analyzing..."})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsx("select",{value:N,onChange:e=>w(e.target.value),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:d.map(t=>e.jsx("option",{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))}),e.jsxs("select",{value:h,onChange:e=>setTimeRange(Number(e.target.value)),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:7,children:"7 Days"}),e.jsx("option",{value:14,children:"14 Days"}),e.jsx("option",{value:30,children:"30 Days"}),e.jsx("option",{value:90,children:"90 Days"})]}),e.jsxs("select",{value:C,onChange:e=>z(Number(e.target.value)),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:.9,children:"90% Confidence"}),e.jsx("option",{value:.95,children:"95% Confidence"}),e.jsx("option",{value:.99,children:"99% Confidence"})]}),e.jsx("button",{onClick:F,disabled:I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Refresh Analysis"})]}),e.jsx("div",{className:"flex space-x-1 border-b dark:border-gray-700",children:_.map(t=>{const a=t.icon;return e.jsxs("button",{onClick:()=>D(t.id),className:"flex items-center px-4 py-2 font-medium text-sm transition-colors "+(S===t.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"),children:[e.jsx(a,{className:"h-4 w-4 mr-2"}),t.label]},t.id)})})]}),e.jsxs("div",{className:"mt-6",children:["predictions"===S&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:[h,"-Day Forecast"]}),g.confidence&&e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Confidence: ",(100*g.confidence).toFixed(1),"%"]}),e.jsxs("span",{children:["Model: ",g.model||"Time Series ARIMA"]})]})]}),e.jsx("div",{className:"h-80",children:e.jsx(a,{data:(()=>{const e=r.map(e=>e.date||e.timestamp),t=r.map(e=>e[N]||e.value),a=[],s=new Date;for(let r=1;r<=h;r++){const e=new Date(s);e.setDate(s.getDate()+r),a.push(e.toLocaleDateString())}const i=g.forecast||[],n=g.upperBound||i.map(e=>1.1*e),o=g.lowerBound||i.map(e=>.9*e);return{labels:[...e,...a],datasets:[{label:"Historical",data:[...t,...Array(a.length).fill(null)],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4},{label:"Forecast",data:[...Array(e.length-1).fill(null),t[t.length-1],...i],borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderDash:[5,5],tension:.4},{label:"Upper Bound",data:[...Array(e.length-1).fill(null),t[t.length-1],...n],borderColor:"rgba(16, 185, 129, 0.3)",backgroundColor:"rgba(16, 185, 129, 0.05)",borderDash:[2,2],fill:!1,tension:.4},{label:"Lower Bound",data:[...Array(e.length-1).fill(null),t[t.length-1],...o],borderColor:"rgba(16, 185, 129, 0.3)",backgroundColor:"rgba(16, 185, 129, 0.05)",borderDash:[2,2],fill:"-1",tension:.4}]}})(),options:M})}),g.insights&&g.insights.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Prediction Insights"}),e.jsx("div",{className:"space-y-2",children:g.insights.map((t,a)=>e.jsxs("div",{className:"flex items-start p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(l,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:t})]},a))})]})]}),"anomalies"===S&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Anomaly Detection"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[f.length," anomalies detected in the data"]})]}),f.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-80",children:e.jsx(s,{data:(()=>{const e=r.map((e,t)=>({x:t,y:e[N]||e.value})),t=f.map(e=>({x:e.index||0,y:e.value||0,r:10*(e.severity||.5)}));return{datasets:[{label:"Normal Data",data:e,backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgb(59, 130, 246)"},{label:"Anomalies",data:t,backgroundColor:"rgba(239, 68, 68, 0.8)",borderColor:"rgb(239, 68, 68)",pointRadius:t.map(e=>e.r)}]}})(),options:M})}),e.jsx("div",{className:"mt-6 space-y-3",children:f.slice(0,5).map((t,a)=>e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(m,{className:"h-5 w-5 text-red-600 dark:text-red-400 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:t.message||`Anomaly in ${N}`}),e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:["Severity: ",(100*(t.severity||.5)).toFixed(0),"% | Time: ",t.timestamp||"Recent"]})]})]})},a))})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(m,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No anomalies detected in current data"})]})]}),"optimizations"===S&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"AI-Powered Optimization Recommendations"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[v.length," optimization opportunities identified"]})]}),v.length>0?e.jsx("div",{className:"space-y-4",children:v.map((t,a)=>e.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-10 w-10 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-green-800 dark:text-green-200 font-semibold",children:a+1})})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.title||t.action||"Optimization Opportunity"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t.description||t.recommendation}),e.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs",children:[t.impact&&e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Impact: ",t.impact,"%"]}),t.effort&&e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["Effort: ",t.effort]}),t.timeline&&e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Timeline: ",t.timeline]})]})]})]})},a))}):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(l,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Analyzing for optimization opportunities..."})]})]}),"insights"===S&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"AI-Generated Insights"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Real-time intelligence powered by OpenAI and Anthropic"})]}),y.length>0?e.jsx("div",{className:"grid gap-4",children:y.map((t,a)=>e.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(o,{className:"h-5 w-5 text-purple-600 dark:text-purple-400 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:t.message||t.text||t}),t.data&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Object.entries(t.data).slice(0,3).map(([t,a])=>e.jsxs("span",{className:"text-xs bg-white dark:bg-gray-800 px-2 py-1 rounded",children:[t,": ",a]},t))})]})]})},a))}):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(o,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Generating insights from your data..."})]})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:g.forecast?g.forecast[g.forecast.length-1]?.toFixed(0):"-"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Predicted Value"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.length}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Anomalies"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:v.length}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Optimizations"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[(100*C).toFixed(0),"%"]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Confidence"})]})]})})]})};export{p as default};
