{
  "build": {
    "builder": "nixpacks",
    "buildCommand": "npm run build:railway"
  },
  "deploy": {
    "startCommand": "node server.js",
    "comment": "FIXED DEPLOYMENT - 2025-09-10 - Using server.js directly, cache mount conflicts resolved",
    "healthcheckPath": "/api/health",
    "healthcheckTimeout": 300,
    "restartPolicyType": "on_failure",
    "restartPolicyMaxRetries": 3
  },
  "environments": {
    "development": {
      "variables": {
        "NODE_ENV": "development",
        "RAILWAY_ENVIRONMENT": "development",
        "PORT": "$PORT",
        "DATABASE_URL": "postgresql://neondb_owner:npg_2wXVD9gdintm@ep-aged-dust-abpyip0r-pooler.eu-west-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require",
        "VITE_CLERK_PUBLISHABLE_KEY": "$VITE_CLERK_PUBLISHABLE_KEY",
        "CLERK_SECRET_KEY": "$CLERK_SECRET_KEY",
        "CORS_ORIGINS": "https://sentia-manufacturing-dashboard-development.up.railway.app,http://localhost:3000,http://localhost:3001,http://localhost:3002",
        "OPENAI_API_KEY": "$OPENAI_API_KEY",
        "XERO_CLIENT_ID": "$XERO_CLIENT_ID",
        "XERO_CLIENT_SECRET": "$XERO_CLIENT_SECRET",
        "XERO_REDIRECT_URI": "https://sentia-manufacturing-dashboard-development.up.railway.app/api/xero/callback"
      },
      "domains": [
        "sentia-manufacturing-dashboard-development.up.railway.app"
      ],
      "serviceSettings": {
        "autoscaling": false,
        "instanceCount": 1,
        "memoryLimit": "512MB",
        "cpuLimit": "500m"
      }
    },
    "testing": {
      "variables": {
        "NODE_ENV": "test",
        "RAILWAY_ENVIRONMENT": "testing",
        "PORT": "$PORT",
        "DATABASE_URL": "postgresql://neondb_owner:npg_2wXVD9gdintm@ep-broad-resonance-ablmx6yo-pooler.eu-west-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require",
        "VITE_CLERK_PUBLISHABLE_KEY": "$VITE_CLERK_PUBLISHABLE_KEY",
        "CLERK_SECRET_KEY": "$CLERK_SECRET_KEY",
        "CORS_ORIGINS": "https://sentiatest.financeflo.ai,http://localhost:3000,http://localhost:3001,http://localhost:3002",
        "OPENAI_API_KEY": "$OPENAI_API_KEY",
        "XERO_CLIENT_ID": "$XERO_CLIENT_ID",
        "XERO_CLIENT_SECRET": "$XERO_CLIENT_SECRET",
        "XERO_REDIRECT_URI": "https://sentiatest.financeflo.ai/api/xero/callback"
      },
      "domains": [
        "sentiatest.financeflo.ai"
      ],
      "serviceSettings": {
        "autoscaling": false,
        "instanceCount": 1,
        "memoryLimit": "512MB",
        "cpuLimit": "500m"
      }
    },
    "production": {
      "variables": {
        "NODE_ENV": "production",
        "RAILWAY_ENVIRONMENT": "production",
        "PORT": "$PORT",
        "DATABASE_URL": "postgresql://neondb_owner:npg_2wXVD9gdintm@ep-broad-resonance-ablmx6yo-pooler.eu-west-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require",
        "VITE_CLERK_PUBLISHABLE_KEY": "$VITE_CLERK_PUBLISHABLE_KEY",
        "CLERK_SECRET_KEY": "$CLERK_SECRET_KEY",
        "CORS_ORIGINS": "https://sentiaprod.financeflo.ai,https://sentia-manufacturing-dashboard-production.up.railway.app,http://localhost:3000,http://localhost:3001,http://localhost:3002",
        "OPENAI_API_KEY": "$OPENAI_API_KEY",
        "XERO_CLIENT_ID": "$XERO_CLIENT_ID",
        "XERO_CLIENT_SECRET": "$XERO_CLIENT_SECRET",
        "XERO_REDIRECT_URI": "https://sentia-manufacturing-dashboard-production.up.railway.app/api/xero/callback"
      },
      "domains": [
        "sentia-manufacturing-dashboard-production.up.railway.app",
        "sentiaprod.financeflo.ai"
      ],
      "serviceSettings": {
        "autoscaling": true,
        "instanceCount": {
          "min": 2,
          "max": 5
        },
        "memoryLimit": "1GB",
        "cpuLimit": "1000m"
      }
    }
  }
}