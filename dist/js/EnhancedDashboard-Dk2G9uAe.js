import{Y as e,bP as t,as as a,j as s,a2 as r,t as i,k as n,W as l,ar as d,i as c,F as o,aq as m,ah as x,am as g,aD as u,l as h,by as y,c2 as p,ag as b,q as j,b4 as v,aG as f,b7 as N,u as w,r as k,c3 as S,bj as C,z as R,ap as M,b_ as T,al as P,bQ as A,Q as L,c4 as F}from"./chunk-CXAPUP0Z.js";import{W as I,a as q,b as W,M as $,D}from"./chunk-CsbWhfNL.js";import O from"./WorkingCapitalWidget-BtkII1xv.js";import z from"./SupplyChainWidget-DdTvwC4m.js";import E from"./AIAnalyticsDashboard-BeTtHZUD.js";import{u as Q}from"./chunk-Bngtdnrv.js";import"./chunk-CwR8AQSU.js";import"./chunk--CRELh3m.js";import"./chunk-VeJKilaK.js";import"./chunk-DELSdgG9.js";import"./chunk-l5C0fGLm.js";import"./chunk-Kk1dlRB6.js";import"./chunk-DJCy_cXY.js";import"./chunk-Dozjk7Op.js";import"./index-VRpNwfdG.js";const B=M.WidthProvider(M.Responsive),J=[{id:"production-metrics",name:"Production Metrics",component:()=>{const{getToken:c}=e(),o=t(),{data:m,isLoading:x,error:g,refetch:u,isRefetching:h}=a({queryKey:["production-metrics"],queryFn:async()=>{const e=await c(),t=await fetch("https://your-production-domain.up.railway.app/api/api/production/metrics",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return y();throw new Error(`Failed to fetch production metrics: ${t.statusText}`)}return t.json()},refetchInterval:3e4,retry:2,retryDelay:1e3}),y=()=>({current:{unitsProduced:1547,targetUnits:2e3,efficiency:87.3,quality:98.5,oee:76.2,downtime:23,cycleTime:4.2},trend:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],production:[1420,1380,1520,1490,1547,1510,1480],target:[2e3,2e3,2e3,2e3,2e3,1500,1500]},shifts:[{name:"Morning",units:520,efficiency:89},{name:"Afternoon",units:480,efficiency:85},{name:"Night",units:547,efficiency:87}],products:[{name:"Product A",units:650,percentage:42},{name:"Product B",units:497,percentage:32},{name:"Product C",units:400,percentage:26}]});if(x&&!m)return s.jsx(I,{title:"Production Metrics",height:"400px"});if(g&&!m)return s.jsx(q,{error:g,onRetry:u,title:"Production Metrics"});const p=m||y(),b={labels:p.trend?.labels||[],datasets:[{label:"Actual Production",data:p.trend?.production||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4},{label:"Target",data:p.trend?.target||[],borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderDash:[5,5],tension:.4}]},j=(p.current?.unitsProduced||0)/(p.current?.targetUnits||1)*100;return s.jsxs(W,{title:"Production Metrics",onRefresh:()=>{o.invalidateQueries(["production-metrics"]),u()},isRefreshing:h,className:"col-span-2",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsx($,{label:"Units Produced",value:p.current?.unitsProduced?.toLocaleString()||"0",unit:"units",trend:{direction:"up",value:5.2},icon:r}),s.jsx($,{label:"Efficiency",value:p.current?.efficiency||0,unit:"%",trend:{direction:p.current?.efficiency>85?"up":"down",value:2.1},icon:i}),s.jsx($,{label:"OEE",value:p.current?.oee||0,unit:"%",trend:{direction:"neutral",value:.5},icon:n}),s.jsx($,{label:"Quality Rate",value:p.current?.quality||0,unit:"%",trend:{direction:"up",value:1.2},icon:l})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[s.jsx("span",{children:"Daily Target Progress"}),s.jsxs("span",{children:[Math.round(j),"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:s.jsx("div",{className:"h-3 rounded-full transition-all duration-500 "+(j>=100?"bg-green-500":j>=75?"bg-blue-500":"bg-yellow-500"),style:{width:`${Math.min(j,100)}%`}})})]}),s.jsx("div",{className:"mb-6",style:{height:"200px"},children:s.jsx(d,{data:b,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(156, 163, 175, 0.1)"}},x:{grid:{color:"rgba(156, 163, 175, 0.1)"}}}}})}),s.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:p.shifts?.map(e=>s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.name}),s.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[e.units," units"]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.efficiency,"% efficient"]})]},e.name))}),s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Product Mix"}),s.jsx("div",{className:"space-y-2",children:p.products?.map(e=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.name}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-32 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${e.percentage}%`}})}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.units})]})]},e.name))})]}),s.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:3,minH:3},category:"Operations"},{id:"inventory-levels",name:"Inventory Levels",component:()=>{const{getToken:r}=e(),i=t(),{data:n,isLoading:l,error:d,refetch:u,isRefetching:h}=a({queryKey:["inventory-levels"],queryFn:async()=>{const e=await r(),t=await fetch("https://your-production-domain.up.railway.app/api/api/inventory/levels",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return y();throw new Error(`Failed to fetch inventory levels: ${t.statusText}`)}return t.json()},refetchInterval:6e4,retry:2,retryDelay:1e3}),y=()=>({summary:{totalSKUs:245,totalValue:1547280,averageTurnover:8.3,stockoutRisk:12,overstockItems:18,reorderRequired:23},categories:[{name:"Raw Materials",value:45e4,items:89,status:"optimal"},{name:"Work in Progress",value:32e4,items:45,status:"high"},{name:"Finished Goods",value:777280,items:111,status:"optimal"}],criticalItems:[{sku:"RM-001",name:"Steel Sheet 2mm",current:150,min:200,status:"critical",daysSupply:2},{sku:"RM-045",name:"Aluminum Bars",current:320,min:500,status:"low",daysSupply:5},{sku:"FG-112",name:"Product A",current:45,min:100,status:"critical",daysSupply:1},{sku:"WP-023",name:"Sub-Assembly B",current:180,min:250,status:"low",daysSupply:4}],topMovers:[{sku:"FG-001",name:"Product X",movement:1200,trend:"up",changePercent:15},{sku:"FG-002",name:"Product Y",movement:980,trend:"up",changePercent:8},{sku:"FG-003",name:"Product Z",movement:750,trend:"down",changePercent:-5}],warehouseCapacity:{used:72,available:28,locations:[{name:"Main Warehouse",used:85,capacity:100},{name:"Overflow Storage",used:45,capacity:100},{name:"Cold Storage",used:90,capacity:100}]}});if(l&&!n)return s.jsx(I,{title:"Inventory Levels",height:"400px"});if(d&&!n)return s.jsx(q,{error:d,onRetry:u,title:"Inventory Levels"});const p=n||y(),b={labels:p.categories?.map(e=>e.name)||[],datasets:[{label:"Inventory Value ($)",data:p.categories?.map(e=>e.value)||[],backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(245, 158, 11)"],borderWidth:1}]},j=[{key:"sku",label:"SKU"},{key:"name",label:"Item"},{key:"current",label:"Current",render:(e,t)=>s.jsx("span",{className:"critical"===t.status?"text-red-600 font-semibold":"",children:e})},{key:"min",label:"Min Level"},{key:"daysSupply",label:"Days Supply",render:e=>s.jsxs("span",{className:e<=2?"text-red-600":e<=5?"text-yellow-600":"text-green-600",children:[e," days"]})}];return s.jsxs(W,{title:"Inventory Levels",onRefresh:()=>{i.invalidateQueries(["inventory-levels"]),u()},isRefreshing:h,className:"col-span-2",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsx($,{label:"Total SKUs",value:p.summary?.totalSKUs||0,icon:c}),s.jsx($,{label:"Total Value",value:`$${((p.summary?.totalValue||0)/1e6).toFixed(2)}M`,trend:{direction:"up",value:3.5}}),s.jsx($,{label:"Reorder Required",value:p.summary?.reorderRequired||0,icon:o}),s.jsx($,{label:"Turnover Rate",value:p.summary?.averageTurnover||0,unit:"x",trend:{direction:"up",value:.5}})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Warehouse Capacity"}),s.jsx("div",{className:"space-y-2",children:p.warehouseCapacity?.locations?.map(e=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-1",children:[s.jsx("span",{children:e.name}),s.jsxs("span",{children:[e.used,"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:"h-2 rounded-full "+(e.used>=90?"bg-red-500":e.used>=70?"bg-yellow-500":"bg-green-500"),style:{width:`${e.used}%`}})})]},e.name))})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Inventory by Category"}),s.jsx("div",{style:{height:"200px"},children:s.jsx(m,{data:b,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"k"}}}}}})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Critical Items"}),s.jsxs("span",{className:"text-xs text-red-600 bg-red-100 dark:bg-red-900/20 px-2 py-1 rounded",children:[p.criticalItems?.filter(e=>"critical"===e.status).length||0," Critical"]})]}),s.jsx(D,{columns:j,data:p.criticalItems||[]})]}),s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Top Moving Items"}),s.jsx("div",{className:"space-y-2",children:p.topMovers?.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"p-1 rounded "+("up"===e.trend?"bg-green-100 dark:bg-green-900/20":"bg-red-100 dark:bg-red-900/20"),children:"up"===e.trend?s.jsx(x,{className:"h-4 w-4 text-green-600"}):s.jsx(g,{className:"h-4 w-4 text-red-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.sku})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[e.movement," units"]}),s.jsxs("p",{className:"text-xs "+(e.changePercent>0?"text-green-600":"text-red-600"),children:[e.changePercent>0?"+":"",e.changePercent,"%"]})]})]},e.sku))})]}),s.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:3,minH:3},category:"Operations"},{id:"quality-control",name:"Quality Control",component:()=>{const{getToken:r}=e(),i=t(),{data:n,isLoading:c,error:o,refetch:m,isRefetching:x}=a({queryKey:["quality-control"],queryFn:async()=>{const e=await r(),t=await fetch("https://your-production-domain.up.railway.app/api/api/quality/metrics",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return g();throw new Error(`Failed to fetch quality metrics: ${t.statusText}`)}return t.json()},refetchInterval:45e3,retry:2,retryDelay:1e3}),g=()=>({summary:{passRate:98.7,defectRate:1.3,totalInspections:1247,totalDefects:16,reworkRate:.8,scrapRate:.5},distribution:{passed:1231,failed:16,rework:10,scrap:6},defectTypes:[{type:"Dimensional",count:6,percentage:37.5},{type:"Surface Finish",count:4,percentage:25},{type:"Assembly",count:3,percentage:18.75},{type:"Material",count:2,percentage:12.5},{type:"Other",count:1,percentage:6.25}],trend:{labels:["6am","8am","10am","12pm","2pm","4pm","6pm"],passRates:[99.2,98.8,99,98.5,98.7,98.9,98.7],inspections:[150,180,195,210,178,185,149]},recentIssues:[{id:1,time:"2:45 PM",product:"Product A",issue:"Dimensional variance",severity:"medium"},{id:2,time:"11:30 AM",product:"Product C",issue:"Surface scratch",severity:"low"},{id:3,time:"9:15 AM",product:"Product B",issue:"Assembly misalignment",severity:"high"}],qualityMetrics:{cpk:1.67,dpmo:233,sigmaLevel:4.8,firstPassYield:97.2}});if(c&&!n)return s.jsx(I,{title:"Quality Control",height:"400px"});if(o&&!n)return s.jsx(q,{error:o,onRetry:m,title:"Quality Control"});const b=n||g(),j={labels:["Passed","Failed","Rework"],datasets:[{data:[b.distribution?.passed||0,b.distribution?.failed||0,b.distribution?.rework||0],backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(239, 68, 68, 0.8)","rgba(245, 158, 11, 0.8)"],borderColor:["rgb(16, 185, 129)","rgb(239, 68, 68)","rgb(245, 158, 11)"],borderWidth:1}]},v={labels:b.trend?.labels||[],datasets:[{label:"Pass Rate (%)",data:b.trend?.passRates||[],borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4,yAxisID:"y"},{label:"Inspections",data:b.trend?.inspections||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,yAxisID:"y1"}]},f=e=>{switch(e){case"high":return"text-red-600 bg-red-100 dark:bg-red-900/20";case"medium":return"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20";case"low":return"text-green-600 bg-green-100 dark:bg-green-900/20";default:return"text-gray-600 bg-gray-100 dark:bg-gray-700"}};return s.jsxs(W,{title:"Quality Control",onRefresh:()=>{i.invalidateQueries(["quality-control"]),m()},isRefreshing:x,className:"col-span-2",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsx($,{label:"Pass Rate",value:b.summary?.passRate||0,unit:"%",trend:{direction:b.summary?.passRate>98?"up":"down",value:.3},icon:l}),s.jsx($,{label:"Defect Rate",value:b.summary?.defectRate||0,unit:"%",trend:{direction:"down",value:.2},icon:u}),s.jsx($,{label:"Inspections",value:b.summary?.totalInspections||0,icon:h}),s.jsx($,{label:"Total Defects",value:b.summary?.totalDefects||0,trend:{direction:"down",value:5},icon:y})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Quality Distribution"}),s.jsx("div",{style:{height:"200px"},children:s.jsx(p,{data:j,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Six Sigma Metrics"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Process Capability (Cpk)"}),s.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:b.qualityMetrics?.cpk||0})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"DPMO"}),s.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:b.qualityMetrics?.dpmo||0})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sigma Level"}),s.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[b.qualityMetrics?.sigmaLevel||0,"σ"]})]}),s.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"First Pass Yield"}),s.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[b.qualityMetrics?.firstPassYield||0,"%"]})]})]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Pass Rate Trend"}),s.jsx("div",{style:{height:"200px"},children:s.jsx(d,{data:v,options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top"}},scales:{y:{type:"linear",display:!0,position:"left",min:95,max:100},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1}}}}})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Defect Types"}),s.jsx("div",{className:"space-y-2",children:b.defectTypes?.map(e=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.type}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-32 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${e.percentage}%`}})}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white w-12 text-right",children:e.count})]})]},e.type))})]}),s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Recent Issues"}),s.jsx("div",{className:"space-y-2",children:b.recentIssues?.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.time}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.product}),s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.issue})]})]}),s.jsx("span",{className:`text-xs px-2 py-1 rounded ${f(e.severity)}`,children:e.severity})]},e.id))})]}),s.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:3,minH:3},category:"Quality"},{id:"financial-overview",name:"Financial Overview",component:()=>{const{getToken:r}=e(),n=t(),{data:l,isLoading:c,error:o,refetch:x,isRefetching:g}=a({queryKey:["financial-overview"],queryFn:async()=>{const e=await r(),t=await fetch("https://your-production-domain.up.railway.app/api/api/financial/overview",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return u();throw new Error(`Failed to fetch financial overview: ${t.statusText}`)}return t.json()},refetchInterval:6e4,retry:2,retryDelay:1e3}),u=()=>({summary:{revenue:2456780,expenses:1890450,profit:566330,profitMargin:23.1,cashFlow:423500,workingCapital:789200,currentRatio:1.85,quickRatio:1.42},revenueBreakdown:[{source:"Product Sales",amount:1845e3,percentage:75.1},{source:"Services",amount:456780,percentage:18.6},{source:"Licensing",amount:155e3,percentage:6.3}],expenseBreakdown:[{category:"Raw Materials",amount:756e3,percentage:40},{category:"Labor",amount:567135,percentage:30},{category:"Operations",amount:378090,percentage:20},{category:"Marketing",amount:189225,percentage:10}],cashFlowTrend:{labels:["Jan","Feb","Mar","Apr","May","Jun"],operating:[38e4,395e3,41e4,423500,438e3,445e3],investing:[-12e4,-85e3,-95e3,-11e4,-75e3,-9e4],financing:[-5e4,-45e3,-55e3,-48e3,-52e3,-47e3]},profitTrend:{labels:["Q1 2024","Q2 2024","Q3 2024","Q4 2024"],revenue:[21e5,225e4,238e4,2456780],profit:[483e3,517500,548e3,566330],margin:[23,23,23,23.1]},keyRatios:{grossMargin:42.5,operatingMargin:28.3,netMargin:23.1,roe:18.7,roa:12.4,debtToEquity:.45},budgetComparison:{revenue:{actual:2456780,budget:24e5,variance:2.4},expenses:{actual:1890450,budget:195e4,variance:-3.1},profit:{actual:566330,budget:45e4,variance:25.8}}});if(c&&!l)return s.jsx(I,{title:"Financial Overview",height:"400px"});if(o&&!l)return s.jsx(q,{error:o,onRetry:x,title:"Financial Overview"});const h=l||u(),y={labels:h.cashFlowTrend?.labels||[],datasets:[{label:"Operating",data:h.cashFlowTrend?.operating||[],borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4},{label:"Investing",data:h.cashFlowTrend?.investing||[],borderColor:"rgb(245, 158, 11)",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.4},{label:"Financing",data:h.cashFlowTrend?.financing||[],borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",tension:.4}]},p={labels:h.profitTrend?.labels||[],datasets:[{type:"bar",label:"Revenue",data:h.profitTrend?.revenue||[],backgroundColor:"rgba(59, 130, 246, 0.8)",borderColor:"rgb(59, 130, 246)",borderWidth:1,yAxisID:"y"},{type:"bar",label:"Profit",data:h.profitTrend?.profit||[],backgroundColor:"rgba(16, 185, 129, 0.8)",borderColor:"rgb(16, 185, 129)",borderWidth:1,yAxisID:"y"},{type:"line",label:"Margin %",data:h.profitTrend?.margin||[],borderColor:"rgb(245, 158, 11)",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.4,yAxisID:"y1"}]},v=e=>e>=1e6?`$${(e/1e6).toFixed(2)}M`:`$${(e/1e3).toFixed(0)}k`;return s.jsxs(W,{title:"Financial Overview",onRefresh:()=>{n.invalidateQueries(["financial-overview"]),x()},isRefreshing:g,className:"col-span-2",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsx($,{label:"Revenue",value:v(h.summary?.revenue||0),trend:{direction:"up",value:5.2},icon:b}),s.jsx($,{label:"Profit",value:v(h.summary?.profit||0),trend:{direction:"up",value:8.3},icon:j}),s.jsx($,{label:"Profit Margin",value:h.summary?.profitMargin||0,unit:"%",trend:{direction:"neutral",value:.1},icon:i}),s.jsx($,{label:"Working Capital",value:v(h.summary?.workingCapital||0),trend:{direction:"up",value:3.5}})]}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Budget vs Actual"}),s.jsx("div",{className:"space-y-3",children:Object.entries(h.budgetComparison||{}).map(([e,t])=>{return s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 capitalize",children:e}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:v(t.actual)}),s.jsxs("span",{className:"text-xs text-gray-500",children:["vs ",v(t.budget)]}),s.jsxs("span",{className:"text-sm font-medium "+(a=t.variance,a>0?"text-green-600":a<0?"text-red-600":"text-gray-600"),children:[t.variance>0?"+":"",t.variance,"%"]})]})]},e);var a})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Cash Flow Trend"}),s.jsx("div",{style:{height:"200px"},children:s.jsx(d,{data:y,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"k"}}}}}})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Key Ratios"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Current Ratio"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:h.summary?.currentRatio||0})]}),s.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Quick Ratio"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:h.summary?.quickRatio||0})]}),s.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Gross Margin"}),s.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[h.keyRatios?.grossMargin||0,"%"]})]}),s.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ROE"}),s.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[h.keyRatios?.roe||0,"%"]})]})]})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Revenue & Profit Trend"}),s.jsx("div",{style:{height:"200px"},children:s.jsx(m,{data:p,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{type:"linear",display:!0,position:"left",ticks:{callback:function(e){return"$"+(e/1e6).toFixed(1)+"M"}}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},ticks:{callback:function(e){return e+"%"}}}}}})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Revenue Sources"}),s.jsx("div",{className:"space-y-2",children:h.revenueBreakdown?.map(e=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.source}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${e.percentage}%`}})}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white w-20 text-right",children:v(e.amount)})]})]},e.source))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Expense Categories"}),s.jsx("div",{className:"space-y-2",children:h.expenseBreakdown?.map(e=>s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.category}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:s.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${e.percentage}%`}})}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white w-20 text-right",children:v(e.amount)})]})]},e.category))})]})]}),s.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:4,minH:3},category:"Finance"},{id:"working-capital",name:"Working Capital",component:O,defaultSize:{w:6,h:5},minSize:{minW:4,minH:4},category:"Finance"},{id:"supply-chain",name:"Supply Chain",component:z,defaultSize:{w:6,h:4},minSize:{minW:4,minH:3},category:"Supply Chain"},{id:"maintenance-schedule",name:"Maintenance Schedule",component:()=>{const{getToken:i}=e(),n=t(),{data:c,isLoading:m,error:x,refetch:g,isRefetching:u}=a({queryKey:["maintenance-schedule"],queryFn:async()=>{const e=await i(),t=await fetch("https://your-production-domain.up.railway.app/api/api/maintenance/schedule",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return h();throw new Error(`Failed to fetch maintenance schedule: ${t.statusText}`)}return t.json()},refetchInterval:6e4,retry:2,retryDelay:1e3}),h=()=>({summary:{totalEquipment:125,scheduledMaintenance:18,completedThisMonth:24,overdue:3,upcomingWeek:7,availability:94.2,mtbf:720,mttr:2.5},equipment:[{id:"EQ-001",name:"CNC Machine A",type:"Production",status:"operational",lastMaintenance:"2024-01-10",nextMaintenance:"2024-02-10",hoursRun:1250,healthScore:92,criticality:"high"},{id:"EQ-002",name:"Assembly Line 1",type:"Assembly",status:"maintenance",lastMaintenance:"2024-01-05",nextMaintenance:"2024-01-17",hoursRun:2100,healthScore:78,criticality:"critical"},{id:"EQ-003",name:"Packaging Unit B",type:"Packaging",status:"operational",lastMaintenance:"2024-01-12",nextMaintenance:"2024-02-12",hoursRun:890,healthScore:95,criticality:"medium"},{id:"EQ-004",name:"Quality Test Station",type:"Quality",status:"warning",lastMaintenance:"2023-12-20",nextMaintenance:"2024-01-20",hoursRun:3200,healthScore:65,criticality:"high"}],maintenanceTypes:{preventive:65,corrective:20,predictive:10,emergency:5},upcomingSchedule:[{date:"2024-01-18",equipment:"CNC Machine B",type:"Preventive",duration:4,technician:"John Smith"},{date:"2024-01-19",equipment:"Assembly Line 2",type:"Preventive",duration:6,technician:"Mary Johnson"},{date:"2024-01-20",equipment:"Quality Test Station",type:"Corrective",duration:3,technician:"Bob Wilson"},{date:"2024-01-22",equipment:"Conveyor System",type:"Preventive",duration:2,technician:"Alice Brown"},{date:"2024-01-23",equipment:"Welding Robot",type:"Predictive",duration:5,technician:"John Smith"}],costAnalysis:{labels:["Jan","Feb","Mar","Apr","May","Jun"],planned:[45e3,42e3,48e3,41e3,43e3,44e3],actual:[43e3,44e3,46e3,42e3,41e3,43e3],savings:[2e3,-2e3,2e3,-1e3,2e3,1e3]},performanceMetrics:{labels:["Week 1","Week 2","Week 3","Week 4"],availability:[93.5,94.2,93.8,94.5],reliability:[96.2,95.8,96.5,97],oee:[85.3,86.1,85.8,86.5]},spareParts:[{part:"Bearing Type A",stock:45,minimum:20,usage:"High",leadTime:7},{part:"Motor Belt XL",stock:12,minimum:15,usage:"Medium",leadTime:14},{part:"Filter Element",stock:8,minimum:10,usage:"Low",leadTime:5},{part:"Control Board",stock:3,minimum:2,usage:"Low",leadTime:30}]});if(m&&!c)return s.jsx(I,{title:"Maintenance Schedule",height:"400px"});if(x&&!c)return s.jsx(q,{error:x,onRetry:g,title:"Maintenance Schedule"});const y=c||h(),b={labels:["Preventive","Corrective","Predictive","Emergency"],datasets:[{data:[y.maintenanceTypes?.preventive||0,y.maintenanceTypes?.corrective||0,y.maintenanceTypes?.predictive||0,y.maintenanceTypes?.emergency||0],backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(59, 130, 246, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(16, 185, 129)","rgb(245, 158, 11)","rgb(59, 130, 246)","rgb(239, 68, 68)"],borderWidth:1}]},j={labels:y.costAnalysis?.labels||[],datasets:[{label:"Planned Cost",data:y.costAnalysis?.planned||[],borderColor:"rgb(107, 114, 128)",backgroundColor:"rgba(107, 114, 128, 0.1)",borderDash:[5,5],tension:.4},{label:"Actual Cost",data:y.costAnalysis?.actual||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},w=[{key:"name",label:"Equipment"},{key:"type",label:"Type"},{key:"status",label:"Status",render:e=>{const t={operational:{color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:l},maintenance:{color:"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20",icon:N},warning:{color:"text-orange-600 bg-orange-100 dark:bg-orange-900/20",icon:o}}[e]||{color:"text-gray-600 bg-gray-100",icon:r},a=t.icon;return s.jsxs("span",{className:`text-xs px-2 py-1 rounded inline-flex items-center ${t.color}`,children:[s.jsx(a,{className:"h-3 w-3 mr-1"}),e]})}},{key:"nextMaintenance",label:"Next Service"},{key:"healthScore",label:"Health",render:e=>{const t=e>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600";return s.jsxs("span",{className:`font-semibold ${t}`,children:[e,"%"]})}}],k=[{key:"part",label:"Part Name"},{key:"stock",label:"Stock",render:(e,t)=>{const a=e<t.minimum;return s.jsx("span",{className:a?"text-red-600 font-semibold":"",children:e})}},{key:"minimum",label:"Min Level"},{key:"usage",label:"Usage Rate"},{key:"leadTime",label:"Lead Time",render:e=>`${e} days`}];return s.jsxs(W,{title:"Maintenance Schedule",onRefresh:()=>{n.invalidateQueries(["maintenance-schedule"]),g()},isRefreshing:u,className:"col-span-2",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsx($,{label:"Equipment Availability",value:y.summary?.availability||0,unit:"%",trend:{direction:y.summary?.availability>95?"up":"down",value:1.2},icon:l}),s.jsx($,{label:"Scheduled Tasks",value:y.summary?.scheduledMaintenance||0,icon:v}),s.jsx($,{label:"Overdue Tasks",value:y.summary?.overdue||0,trend:{direction:y.summary?.overdue>0?"down":"neutral",value:y.summary?.overdue},icon:o}),s.jsx($,{label:"MTBF",value:y.summary?.mtbf||0,unit:"hrs",icon:f})]}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Reliability Metrics"}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[y.summary?.mtbf||0,"h"]}),s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Mean Time Between Failures"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[y.summary?.mttr||0,"h"]}),s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Mean Time To Repair"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:y.summary?.completedThisMonth||0}),s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Completed This Month"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Maintenance Types"}),s.jsx("div",{style:{height:"200px"},children:s.jsx(p,{data:b,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{boxWidth:12}}}}})})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Cost Analysis"}),s.jsx("div",{style:{height:"200px"},children:s.jsx(d,{data:j,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!1,ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"k"}}}}}})})]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Equipment Status"}),s.jsx(D,{columns:w,data:y.equipment||[]})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Upcoming Maintenance"}),s.jsxs("span",{className:"text-xs text-blue-600 bg-blue-100 dark:bg-blue-900/20 px-2 py-1 rounded",children:["Next 7 days: ",y.summary?.upcomingWeek||0," tasks"]})]}),s.jsx(D,{columns:[{key:"date",label:"Date"},{key:"equipment",label:"Equipment"},{key:"type",label:"Type"},{key:"duration",label:"Duration",render:e=>`${e}h`},{key:"technician",label:"Technician"}],data:y.upcomingSchedule||[]})]}),s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Critical Spare Parts"}),y.spareParts?.filter(e=>e.stock<e.minimum).length>0&&s.jsxs("span",{className:"text-xs text-red-600 bg-red-100 dark:bg-red-900/20 px-2 py-1 rounded",children:[y.spareParts.filter(e=>e.stock<e.minimum).length," below minimum"]})]}),s.jsx(D,{columns:k,data:y.spareParts||[]})]}),s.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:4,minH:3},category:"Maintenance"}],K={admin:{lg:[{i:"production-metrics",x:0,y:0,w:6,h:4},{i:"financial-overview",x:6,y:0,w:6,h:4},{i:"inventory-levels",x:0,y:4,w:6,h:4},{i:"quality-control",x:6,y:4,w:6,h:4},{i:"working-capital",x:0,y:8,w:6,h:5},{i:"supply-chain",x:6,y:8,w:6,h:5}]},manager:{lg:[{i:"production-metrics",x:0,y:0,w:6,h:4},{i:"quality-control",x:6,y:0,w:6,h:4},{i:"inventory-levels",x:0,y:4,w:6,h:4},{i:"supply-chain",x:6,y:4,w:6,h:4}]},operator:{lg:[{i:"production-metrics",x:0,y:0,w:12,h:4},{i:"quality-control",x:0,y:4,w:6,h:4},{i:"maintenance-schedule",x:6,y:4,w:6,h:4}]},viewer:{lg:[{i:"production-metrics",x:0,y:0,w:6,h:4},{i:"financial-overview",x:6,y:0,w:6,h:4}]}},_=({userRole:e="viewer"})=>{const{user:t}=w(),[a,r]=k.useState({}),[i,n]=k.useState([]),[d,c]=k.useState(!1),[o,m]=k.useState(!1),[x,g]=k.useState(null),[u,h]=k.useState(e);k.useEffect(()=>{(async()=>{if(t?.id)try{const e=await fetch("/api/user/dashboard-layout",{headers:{Authorization:`Bearer ${await t.getToken()}`}});if(e.ok){const a=await e.json();if(a.layouts&&a.widgets)return r(a.layouts),n(a.widgets),localStorage.setItem(`dashboardLayout_${t.id}`,JSON.stringify(a.layouts)),void localStorage.setItem(`dashboardWidgets_${t.id}`,JSON.stringify(a.widgets))}}catch(i){}const a=localStorage.getItem(`dashboardLayout_${t?.id}`),s=localStorage.getItem(`dashboardWidgets_${t?.id}`);a&&s?(r(JSON.parse(a)),n(JSON.parse(s))):y(e)})()},[t,e]);const y=e=>{const t=K[e]||K.viewer,a=t.lg.map(e=>e.i);r({lg:t.lg,md:t.lg,sm:t.lg,xs:t.lg}),n(a),h(e)},p=e=>{const l=J.find(t=>t.id===e);if(!l)return null;const d=l.component;return s.jsxs("div",{className:"dashboard-widget-container h-full",children:[o&&s.jsxs("div",{className:"widget-header absolute top-0 left-0 right-0 bg-gray-100 dark:bg-gray-700 p-2 flex justify-between items-center cursor-move z-10",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l.name}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>(e=>{g(x===e?null:e)})(e),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",title:"Toggle fullscreen",children:x===e?s.jsx(S,{className:"h-4 w-4"}):s.jsx(P,{className:"h-4 w-4"})}),s.jsx("button",{onClick:()=>(e=>{const s=i.filter(t=>t!==e);n(s);const l={lg:(a.lg||[]).filter(t=>t.i!==e),md:(a.md||[]).filter(t=>t.i!==e),sm:(a.sm||[]).filter(t=>t.i!==e),xs:(a.xs||[]).filter(t=>t.i!==e)};r(l),t?.id&&(localStorage.setItem(`dashboardWidgets_${t.id}`,JSON.stringify(s)),localStorage.setItem(`dashboardLayout_${t.id}`,JSON.stringify(l)))})(e),className:"p-1 hover:bg-red-100 dark:hover:bg-red-900 rounded text-red-600",title:"Remove widget",children:s.jsx(A,{className:"h-4 w-4"})})]})]}),s.jsx("div",{className:`h-full ${o?"pt-10":""} overflow-auto`,children:s.jsx(d,{})})]},e)};if(x){const e=J.find(e=>e.id===x),t=e?.component;return s.jsxs("div",{className:"fixed inset-0 bg-white dark:bg-gray-900 z-50 overflow-auto",children:[s.jsx("div",{className:"absolute top-4 right-4 z-10",children:s.jsx("button",{onClick:()=>g(null),className:"p-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg",children:s.jsx(S,{className:"h-6 w-6"})})}),s.jsx("div",{className:"p-4 h-full",children:t&&s.jsx(t,{})})]})}return s.jsxs("div",{className:"dashboard-grid-container",children:[s.jsx("div",{className:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("button",{onClick:()=>c(!d),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center",children:[s.jsx(C,{className:"h-4 w-4 mr-2"}),"Add Widget"]}),s.jsxs("button",{onClick:()=>m(!o),className:"px-4 py-2 rounded flex items-center "+(o?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:[s.jsx(R,{className:"h-4 w-4 mr-2"}),o?"Done Editing":"Edit Layout"]})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("select",{value:u,onChange:e=>y(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700",children:[s.jsx("option",{value:"",children:"Load Preset"}),s.jsx("option",{value:"admin",children:"Admin Layout"}),s.jsx("option",{value:"manager",children:"Manager Layout"}),s.jsx("option",{value:"operator",children:"Operator Layout"}),s.jsx("option",{value:"viewer",children:"Viewer Layout"})]}),s.jsx("button",{onClick:()=>{t?.id&&(localStorage.removeItem(`dashboardLayout_${t.id}`),localStorage.removeItem(`dashboardWidgets_${t.id}`)),y(e)},className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"Reset Layout"}),s.jsx("button",{onClick:async()=>{if(t?.id)try{const e=await t.getToken(),s=await fetch("/api/user/dashboard-layout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({layouts:a,widgets:i})});if(s.ok){await s.json();const e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent="Dashboard layout saved successfully!",document.body.appendChild(e),setTimeout(()=>e.remove(),3e3)}else{await s.json()}}catch(e){}},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Save to Profile"})]})]})}),d&&s.jsxs("div",{className:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:[s.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Widget Catalog"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:J.map(e=>s.jsx("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors "+(i.includes(e.id)?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"),onClick:()=>!i.includes(e.id)&&(e=>{if(i.includes(e))return;const s=J.find(t=>t.id===e);if(!s)return;const l=[...i,e];n(l);const d={i:e,x:0,y:0,...s.defaultSize,...s.minSize},c={lg:[...a.lg||[],d],md:[...a.md||[],d],sm:[...a.sm||[],d],xs:[...a.xs||[],d]};r(c),t?.id&&(localStorage.setItem(`dashboardWidgets_${t.id}`,JSON.stringify(l)),localStorage.setItem(`dashboardLayout_${t.id}`,JSON.stringify(c)))})(e.id),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-sm",children:e.name}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.category})]}),i.includes(e.id)&&s.jsx(l,{className:"h-5 w-5 text-green-500"})]})},e.id))})]}),s.jsx(B,{className:"layout",layouts:a,onLayoutChange:(e,a)=>{r(a),t?.id&&localStorage.setItem(`dashboardLayout_${t.id}`,JSON.stringify(a))},breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},rowHeight:100,isDraggable:o,isResizable:o,draggableHandle:".widget-header",compactType:"vertical",margin:[16,16],children:i.map(e=>p(e))}),0===i.length&&s.jsxs("div",{className:"flex flex-col items-center justify-center h-96 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[s.jsx(T,{className:"h-16 w-16 text-gray-400 mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Widgets Added"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:'Click "Add Widget" to start building your dashboard'}),s.jsx("button",{onClick:()=>c(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add Your First Widget"})]})]})};function H(){L();const{user:e}=w(),[t,r]=k.useState(!0),[i,n]=k.useState(null),[l,d]=k.useState("grid"),[c,o]=k.useState("viewer");return Q("/api/kpis/realtime"),a({queryKey:["dashboard-data",l],queryFn:async()=>{const e=await fetch("/api/dashboard/overview");return e.ok?e.json():mockDashboardData},refetchInterval:15e3}),k.useEffect(()=>{const e=setTimeout(()=>{r(!1)},1200);return()=>clearTimeout(e)},[]),k.useEffect(()=>{o(e?.publicMetadata?.role||e?.unsafeMetadata?.role||"viewer")},[e]),t?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-gray-600",children:"Initializing Sentia Enterprise Platform..."}),s.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading AI Analytics & MCP Integration"})]})}):i?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md",children:[s.jsx("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Dashboard Error"}),s.jsx("p",{className:"text-gray-600 mb-4",children:i}),s.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Retry"})]})}):"ai-analytics"===l?s.jsx(E,{}):s.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[s.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:s.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-4",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sentia Manufacturing Dashboard"}),s.jsxs("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:["Welcome back, ",e?.firstName||"User"," • Role: ",s.jsx("span",{className:"font-medium capitalize",children:c})]})]}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[s.jsxs("button",{onClick:()=>d("grid"),className:"px-3 py-1 rounded flex items-center space-x-2 "+("grid"===l?"bg-white dark:bg-gray-600 shadow-sm text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"),children:[s.jsx(T,{className:"h-4 w-4"}),s.jsx("span",{className:"text-sm",children:"Grid View"})]}),s.jsxs("button",{onClick:()=>d("classic"),className:"px-3 py-1 rounded flex items-center space-x-2 "+("classic"===l?"bg-white dark:bg-gray-600 shadow-sm text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"),children:[s.jsx(F,{className:"h-4 w-4"}),s.jsx("span",{className:"text-sm",children:"Classic View"})]})]}),s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"● Live Data"}),s.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:(new Date).toLocaleTimeString()})]})]})})}),"grid"===l?s.jsx("div",{className:"p-4 lg:p-6",children:s.jsx(_,{userRole:c})}):s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"max-w-7xl mx-auto",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Production Output"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"1,234"}),s.jsx("p",{className:"text-sm text-green-600",children:"↗ +12% from yesterday"})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx("div",{className:"w-6 h-6 bg-green-600 rounded"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Efficiency Rate"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"94.2%"}),s.jsx("p",{className:"text-sm text-green-600",children:"↗ +2.1% from last week"})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:s.jsx("div",{className:"w-6 h-6 bg-yellow-600 rounded"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Quality Score"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"98.7%"}),s.jsx("p",{className:"text-sm text-yellow-600",children:"→ Stable"})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:s.jsx("div",{className:"w-6 h-6 bg-purple-600 rounded"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Active Orders"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"87"}),s.jsx("p",{className:"text-sm text-blue-600",children:"24 urgent priority"})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Production Lines Status"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:"Line A - Assembly"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Running at 98% capacity"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-medium text-green-600",children:"Running"}),s.jsx("p",{className:"text-xs text-gray-500",children:"234 units/hr"})]})]}),s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:"Line B - Packaging"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Running at 95% capacity"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-medium text-green-600",children:"Running"}),s.jsx("p",{className:"text-xs text-gray-500",children:"187 units/hr"})]})]}),s.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:"Line C - Quality Check"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Scheduled maintenance"})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Maintenance"}),s.jsx("p",{className:"text-xs text-gray-500",children:"Resumes at 2:00 PM"})]})]})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{className:"w-full text-left p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors",children:[s.jsx("p",{className:"font-medium text-blue-900",children:"Working Capital Analysis"}),s.jsx("p",{className:"text-sm text-blue-600",children:"Review financial metrics"})]}),s.jsxs("button",{className:"w-full text-left p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[s.jsx("p",{className:"font-medium text-green-900",children:"What-If Scenarios"}),s.jsx("p",{className:"text-sm text-green-600",children:"Model production changes"})]}),s.jsxs("button",{className:"w-full text-left p-3 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors",children:[s.jsx("p",{className:"font-medium text-purple-900",children:"Admin Panel"}),s.jsx("p",{className:"text-sm text-purple-600",children:"System configuration"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Alerts"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 rounded-lg",children:[s.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-green-800",children:"Order #12345 completed"}),s.jsx("p",{className:"text-xs text-green-600",children:"2 minutes ago"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg",children:[s.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-yellow-800",children:"Maintenance scheduled"}),s.jsx("p",{className:"text-xs text-yellow-600",children:"10 minutes ago"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg",children:[s.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"text-sm text-blue-800",children:"Quality check passed"}),s.jsx("p",{className:"text-xs text-blue-600",children:"15 minutes ago"})]})]})]})]})]})]}),s.jsxs("div",{className:"mt-8 bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Financial Overview"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"£1.2M"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Current Cash Flow"}),s.jsx("p",{className:"text-xs text-green-600 mt-1",children:"↗ +5.2% this month"})]}),s.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[s.jsx("p",{className:"text-2xl font-bold text-green-600",children:"£890K"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Accounts Receivable"}),s.jsx("p",{className:"text-xs text-green-600 mt-1",children:"↗ +2.1% this month"})]}),s.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[s.jsx("p",{className:"text-2xl font-bold text-orange-600",children:"£450K"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Inventory Value"}),s.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"→ Stable"})]}),s.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"89 days"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Cash Conversion Cycle"}),s.jsx("p",{className:"text-xs text-green-600 mt-1",children:"↘ -3 days improvement"})]})]})]})]})})]})}export{H as default};
