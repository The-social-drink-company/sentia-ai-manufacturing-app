import{a as e,j as s,bx as a,aG as t,aL as l,ar as r,aX as c,aK as i}from"./chunk-dQ8ZuPJ5.js";import{d}from"./index-B85l1krK.js";import"./chunk-CVC8ZTrn.js";import"./chunk-CZm8CRZW.js";import"./chunk-BYhzkSrP.js";import"./chunk-BmDXyJMe.js";import"./chunk-CULnPDSP.js";import"./chunk-BqFGoBxF.js";import"./chunk-Dozjk7Op.js";const n=()=>{const[n,x]=e.useState(1),[o,m]=e.useState(null),[p,h]=e.useState([]),[u,j]=e.useState(null),[b,g]=e.useState(!0),[N,y]=e.useState(null),[f,v]=e.useState(null);e.useEffect(()=>{w(),S();const e=setInterval(S,1e4);return()=>clearInterval(e)},[]);const w=async()=>{try{const e=await fetch("/api/import/jobs?pageSize=20"),s=await e.json();s.success&&h(s.jobs)}catch(e){d.error("Failed to fetch import history:",e)}finally{g(!1)}},S=async()=>{try{const e=await fetch("/api/queue/stats"),s=await e.json();s.success&&j(s.stats)}catch(e){d.error("Failed to fetch queue stats:",e)}},k=e=>{switch(e){case"completed":return s.jsx(l,{className:"h-4 w-4 text-green-500"});case"completed_with_errors":return s.jsx(i,{className:"h-4 w-4 text-yellow-500"});case"failed":return s.jsx(i,{className:"h-4 w-4 text-red-500"});case"processing":case"validating":return s.jsx(c,{className:"h-4 w-4 text-blue-500"});default:return s.jsx(c,{className:"h-4 w-4 text-gray-500"})}},I=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"completed_with_errors":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"processing":case"validating":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return s.jsxs("div",{className:"space-y-6 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Data Import Dashboard"}),s.jsx("p",{className:"text-gray-600 mt-1",children:"Upload, validate, and import data into the manufacturing system"})]}),s.jsxs("button",{onClick:()=>{x(1),m(null),y(null),v(null),w()},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2",children:[s.jsx(a,{className:"h-4 w-4"}),"New Import"]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[s.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[o&&s.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Import Progress"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"p-2 rounded "+(n>=1?"bg-blue-100":"bg-gray-100"),children:"Step 1: Upload"}),s.jsx("div",{className:"p-2 rounded "+(n>=2?"bg-blue-100":"bg-gray-100"),children:"Step 2: Preview & Map"}),s.jsx("div",{className:"p-2 rounded "+(n>=3?"bg-blue-100":"bg-gray-100"),children:"Step 3: Validate"}),s.jsx("div",{className:"p-2 rounded "+(n>=4?"bg-blue-100":"bg-gray-100"),children:"Step 4: Process"}),s.jsx("div",{className:"p-2 rounded "+(n>=5?"bg-blue-100":"bg-gray-100"),children:"Step 5: Results"})]})]}),u&&s.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[s.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[s.jsx(t,{className:"h-5 w-5"}),"Queue Status"]}),s.jsx("div",{className:"space-y-3",children:u.available?s.jsx(s.Fragment,{children:Object.entries(u.queues||{}).map(([e,a])=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-sm font-medium capitalize",children:e.replace("-"," ")}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[s.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-center",children:[s.jsx("div",{className:"font-semibold",children:a.waiting}),s.jsx("div",{className:"text-yellow-600",children:"Waiting"})]}),s.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[s.jsx("div",{className:"font-semibold",children:a.active}),s.jsx("div",{className:"text-blue-600",children:"Active"})]})]})]},e))}):s.jsx("div",{className:"text-sm text-gray-500",children:"Queue service unavailable - processing synchronously"})})]})]}),s.jsx("div",{className:"lg:col-span-3",children:s.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[1===n&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(a,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Upload Data File"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Select a CSV or Excel file to import"}),s.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{var s;e.target.files?.[0]&&(s={importJobId:Date.now().toString(),filename:e.target.files[0].name},m({id:s.importJobId,filename:s.filename,status:"uploaded"}),x(2),w())},className:"hidden",id:"file-upload"}),s.jsx("label",{htmlFor:"file-upload",className:"bg-blue-600 text-white px-6 py-3 rounded cursor-pointer hover:bg-blue-700",children:"Choose File"})]}),n>1&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(l,{className:"h-12 w-12 mx-auto mb-4 text-green-500"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:5===n?"Import Complete":"Processing..."}),s.jsx("p",{className:"text-gray-600",children:o?.filename||"Processing your import"})]})]})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow",children:[s.jsx("div",{className:"p-6 border-b",children:s.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[s.jsx(r,{className:"h-5 w-5"}),"Recent Imports"]})}),s.jsx("div",{className:"p-6",children:b?s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{children:"Loading import history..."})]}):0===p.length?s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(a,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),s.jsx("p",{children:"No imports yet"}),s.jsx("p",{className:"text-sm",children:"Upload your first data file to get started"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b",children:[s.jsx("th",{className:"px-4 py-2 text-left",children:"File"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Type"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Status"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Rows"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Uploaded"}),s.jsx("th",{className:"px-4 py-2 text-left",children:"Actions"})]})}),s.jsx("tbody",{children:p.map(e=>s.jsxs("tr",{className:"border-b",children:[s.jsx("td",{className:"px-4 py-2 font-medium",children:e.filename}),s.jsx("td",{className:"px-4 py-2",children:s.jsx("span",{className:"px-2 py-1 text-xs border rounded",children:e.dataType?.replace("_"," ").toUpperCase()})}),s.jsx("td",{className:"px-4 py-2",children:s.jsxs("div",{className:"flex items-center gap-2",children:[k(e.status),s.jsx("span",{className:`px-2 py-1 text-xs rounded ${I(e.status)}`,children:e.status.replace("_"," ")})]})}),s.jsx("td",{className:"px-4 py-2",children:e.totalRows>0&&s.jsxs("span",{className:"text-sm",children:[e.processedRows||0," / ",e.totalRows,e.errorRows>0&&s.jsxs("span",{className:"text-red-600 ml-1",children:["(",e.errorRows," errors)"]})]})}),s.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:new Date(e.uploadedAt).toLocaleDateString()}),s.jsx("td",{className:"px-4 py-2",children:s.jsx("button",{onClick:()=>{m(e),x("completed"===e.status||"failed"===e.status?5:4)},className:"text-blue-600 hover:text-blue-800",children:"View"})})]},e.id))})]})})})]})]})};export{n as default};
