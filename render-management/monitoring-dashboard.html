<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentia Render Infrastructure Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-healthy {
            background-color: #10b981;
        }

        .status-warning {
            background-color: #f59e0b;
        }

        .status-critical {
            background-color: #ef4444;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 255, 255, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
            }
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }

        .logs-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .log-entry {
            padding: 3px 0;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .log-error {
            color: #fca5a5;
        }

        .log-warning {
            color: #fcd34d;
        }

        .log-info {
            color: #93c5fd;
        }

        .refresh-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #10b981;
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            background: #059669;
            transform: scale(1.05);
        }

        .timestamp {
            text-align: center;
            opacity: 0.7;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .alert-banner {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-banner.active {
            display: block;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Sentia Render Infrastructure Dashboard</h1>
        <div class="timestamp" id="timestamp">Last Updated: Loading...</div>

        <div class="alert-banner" id="alertBanner">
            ‚ö†Ô∏è <span id="alertMessage">System Alert</span>
        </div>

        <div class="dashboard-grid">
            <!-- Production Service -->
            <div class="card">
                <h2>
                    <span class="status-indicator status-healthy" id="prodStatus"></span>
                    Production Service
                </h2>
                <div class="metric">
                    <span class="metric-label">Status</span>
                    <span class="metric-value" id="prodStatusText">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Response Time</span>
                    <span class="metric-value" id="prodResponseTime">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Uptime</span>
                    <span class="metric-value" id="prodUptime">99.9%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">URL</span>
                    <span class="metric-value" style="font-size: 0.8rem;">
                        <a href="https://sentia-manufacturing-production.onrender.com" target="_blank" style="color: inherit;">View Site</a>
                    </span>
                </div>
            </div>

            <!-- Testing Service -->
            <div class="card">
                <h2>
                    <span class="status-indicator status-healthy" id="testStatus"></span>
                    Testing Service
                </h2>
                <div class="metric">
                    <span class="metric-label">Status</span>
                    <span class="metric-value" id="testStatusText">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Response Time</span>
                    <span class="metric-value" id="testResponseTime">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Last Deploy</span>
                    <span class="metric-value" id="testLastDeploy">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">URL</span>
                    <span class="metric-value" style="font-size: 0.8rem;">
                        <a href="https://sentia-manufacturing-testing.onrender.com" target="_blank" style="color: inherit;">View Site</a>
                    </span>
                </div>
            </div>

            <!-- Development Service -->
            <div class="card">
                <h2>
                    <span class="status-indicator status-healthy" id="devStatus"></span>
                    Development Service
                </h2>
                <div class="metric">
                    <span class="metric-label">Status</span>
                    <span class="metric-value" id="devStatusText">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Response Time</span>
                    <span class="metric-value" id="devResponseTime">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Commits Today</span>
                    <span class="metric-value" id="devCommits">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">URL</span>
                    <span class="metric-value" style="font-size: 0.8rem;">
                        <a href="https://sentia-manufacturing-development.onrender.com" target="_blank" style="color: inherit;">View Site</a>
                    </span>
                </div>
            </div>

            <!-- MCP AI Server -->
            <div class="card">
                <h2>
                    <span class="status-indicator status-healthy" id="mcpStatus"></span>
                    MCP AI Server
                </h2>
                <div class="metric">
                    <span class="metric-label">Status</span>
                    <span class="metric-value" id="mcpStatusText">Checking...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Version</span>
                    <span class="metric-value" id="mcpVersion">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Uptime</span>
                    <span class="metric-value" id="mcpUptime">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">URL</span>
                    <span class="metric-value" style="font-size: 0.8rem;">
                        <a href="https://mcp-server-tkyu.onrender.com" target="_blank" style="color: inherit;">View API</a>
                    </span>
                </div>
            </div>

            <!-- Database Status -->
            <div class="card">
                <h2>
                    <span class="status-indicator status-healthy" id="dbStatus"></span>
                    Database Cluster
                </h2>
                <div class="metric">
                    <span class="metric-label">Production DB</span>
                    <span class="metric-value" id="prodDb">PostgreSQL</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Connections</span>
                    <span class="metric-value" id="dbConnections">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Storage Used</span>
                    <span class="metric-value" id="dbStorage">-</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="dbStorageBar" style="width: 45%">45%</div>
                </div>
            </div>

            <!-- System Metrics -->
            <div class="card">
                <h2>
                    <span class="status-indicator status-healthy" id="sysStatus"></span>
                    System Metrics
                </h2>
                <div class="metric">
                    <span class="metric-label">Total Uptime</span>
                    <span class="metric-value" id="totalUptime">99.95%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Active Incidents</span>
                    <span class="metric-value" id="incidents">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Error Rate</span>
                    <span class="metric-value" id="errorRate">0.1%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Avg Response</span>
                    <span class="metric-value" id="avgResponse">-</span>
                </div>
            </div>
        </div>

        <!-- Recent Activity Log -->
        <div class="card" style="grid-column: 1 / -1;">
            <h2>üìã Recent Activity</h2>
            <div class="logs-container" id="logsContainer">
                <div class="log-entry log-info">[INFO] Dashboard initialized</div>
            </div>
        </div>

        <button class="refresh-button" onclick="refreshDashboard()">üîÑ Refresh</button>
    </div>

    <script>
        // Configuration
        const services = {
            production: 'https://sentia-manufacturing-production.onrender.com/health',
            testing: 'https://sentia-manufacturing-testing.onrender.com/health',
            development: 'https://sentia-manufacturing-development.onrender.com/health',
            mcp: 'https://mcp-server-tkyu.onrender.com/health'
        };

        let refreshInterval;
        let activityLog = [];

        // Initialize dashboard
        function initDashboard() {
            updateTimestamp();
            checkAllServices();

            // Auto-refresh every 30 seconds
            refreshInterval = setInterval(() => {
                checkAllServices();
            }, 30000);

            addLog('info', 'Dashboard initialized - Auto-refresh every 30 seconds');
        }

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('timestamp').textContent = `Last Updated: ${now.toLocaleString()}`;
        }

        // Check all services
        async function checkAllServices() {
            updateTimestamp();

            // Check Production
            checkService('production', services.production, 'prod');

            // Check Testing
            checkService('testing', services.testing, 'test');

            // Check Development
            checkService('development', services.development, 'dev');

            // Check MCP Server
            checkService('MCP', services.mcp, 'mcp');

            // Update system metrics
            updateSystemMetrics();
        }

        // Check individual service
        async function checkService(name, url, prefix) {
            const startTime = performance.now();

            try {
                // Simulate API call (in real implementation, use fetch with CORS proxy)
                const mockResponse = await simulateHealthCheck(url);
                const endTime = performance.now();
                const responseTime = Math.round(endTime - startTime);

                updateServiceStatus(prefix, 'healthy', 'Online', responseTime + 'ms');

                if (prefix === 'mcp' && mockResponse.version) {
                    document.getElementById('mcpVersion').textContent = mockResponse.version;
                    document.getElementById('mcpUptime').textContent = mockResponse.uptime || '-';
                }

                addLog('info', `${name} health check: OK (${responseTime}ms)`);

            } catch (error) {
                updateServiceStatus(prefix, 'critical', 'Offline', '-');
                addLog('error', `${name} health check failed: ${error.message}`);
                showAlert(`${name} service is not responding`);
            }
        }

        // Simulate health check (replace with actual API calls)
        function simulateHealthCheck(url) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Simulate random success/failure for demo
                    if (Math.random() > 0.05) { // 95% success rate
                        resolve({
                            status: 'healthy',
                            version: '2.0.0',
                            uptime: '14 days'
                        });
                    } else {
                        reject(new Error('Service unavailable'));
                    }
                }, Math.random() * 500 + 200); // Random delay 200-700ms
            });
        }

        // Update service status in UI
        function updateServiceStatus(prefix, status, statusText, responseTime) {
            const statusIndicator = document.getElementById(prefix + 'Status');
            const statusTextElement = document.getElementById(prefix + 'StatusText');
            const responseTimeElement = document.getElementById(prefix + 'ResponseTime');

            // Update status indicator
            statusIndicator.className = 'status-indicator status-' + status;

            // Update text
            statusTextElement.textContent = statusText;
            if (responseTimeElement) {
                responseTimeElement.textContent = responseTime;
            }
        }

        // Update system metrics
        function updateSystemMetrics() {
            // Calculate average response time from all services
            const responseTimes = [
                document.getElementById('prodResponseTime').textContent,
                document.getElementById('testResponseTime').textContent,
                document.getElementById('devResponseTime').textContent
            ].filter(t => t !== '-').map(t => parseInt(t));

            if (responseTimes.length > 0) {
                const avg = Math.round(responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length);
                document.getElementById('avgResponse').textContent = avg + 'ms';
            }

            // Update other metrics (simulated)
            document.getElementById('dbConnections').textContent = Math.floor(Math.random() * 20 + 10);
            document.getElementById('dbStorage').textContent = '4.5 GB / 10 GB';
            document.getElementById('devCommits').textContent = Math.floor(Math.random() * 10 + 1);
            document.getElementById('testLastDeploy').textContent = '2 hours ago';
        }

        // Add log entry
        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;

            activityLog.unshift({ type, message: logEntry });

            // Keep only last 50 entries
            if (activityLog.length > 50) {
                activityLog.pop();
            }

            updateLogDisplay();
        }

        // Update log display
        function updateLogDisplay() {
            const container = document.getElementById('logsContainer');
            container.innerHTML = activityLog
                .slice(0, 10) // Show last 10 entries
                .map(log => `<div class="log-entry log-${log.type}">${log.message}</div>`)
                .join('');
        }

        // Show alert banner
        function showAlert(message) {
            const banner = document.getElementById('alertBanner');
            const messageElement = document.getElementById('alertMessage');

            messageElement.textContent = message;
            banner.classList.add('active');

            // Hide after 5 seconds
            setTimeout(() => {
                banner.classList.remove('active');
            }, 5000);
        }

        // Manual refresh
        function refreshDashboard() {
            addLog('info', 'Manual refresh triggered');
            checkAllServices();
        }

        // Initialize on load
        window.onload = initDashboard;

        // Cleanup on unload
        window.onbeforeunload = () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        };
    </script>
</body>
</html>