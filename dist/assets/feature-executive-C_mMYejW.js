import{l as L,m as A,p as D,j as t,F as O,n as M,r as h,o as I,q as U,t as _,v as P,w as E,x as S,y as w}from"./react-vendor-CbFVVgBZ.js";import{u as $}from"./clerk-3Oyg3_c8.js";import{A as T}from"./utils-Pe79r9Ua.js";import{c as v}from"./vendor-BHPHB5s9.js";import{L as q,C as W,a as G,b as J,P as z,c as B,p as H,d as Q,e as V,i as K}from"./charts-Dbk9-C0f.js";const Z={},l={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4},X=()=>{switch("production"){case"production":return l.WARN;case"test":case"testing":return l.ERROR;case"development":default:return l.DEBUG}},Y=X(),ee=(r,a,e)=>{const s=new Date().toISOString(),o=Object.keys(l).find(i=>l[i]===r);return{timestamp:s,level:o,message:a,...e&&{context:e},environment:"production"}},te=r=>{typeof window<"u"&&window.sentryCapture&&window.sentryCapture(r),Z?.VITE_LOGGING_ENDPOINT&&fetch(void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(()=>{})},N=(r,a,e)=>{if(r<Y)return;const s=ee(r,a,e);if(r>=l.WARN){const o=r===l.ERROR?"error":r===l.WARN?"warn":r===l.DEBUG?"debug":"log";console[o](s.message)}r>=l.WARN&&te(s)},R=(r,a)=>{N(l.INFO,r,a)},ge=(r,a)=>{N(l.WARN,r,a)},f=(r,a)=>{let e=a;a instanceof Error&&(e={error:a.message,stack:a.stack,name:a.name,...a.cause&&{cause:a.cause}}),N(l.ERROR,r,e)},pe={log:(...r)=>{},warn:(...r)=>{},error:(...r)=>{},table:(...r)=>{},time:r=>{},timeEnd:r=>{}},se=L(A(D((r,a)=>({metrics:{},trends:{financial:[],operational:[]},alerts:[],preferences:{layout:"default",kpiSelection:[]},loading:!1,error:null,lastUpdated:null,fetchExecutiveMetrics:async()=>{r({loading:!0,error:null});try{const e=await T.get("/api/executive/metrics");return r({metrics:e.data.metrics,trends:e.data.trends,alerts:e.data.alerts,lastUpdated:new Date().toISOString(),loading:!1}),e.data}catch(e){throw r({error:e.message,loading:!1}),e}},updateMetric:e=>{r(s=>({metrics:{...s.metrics,[e.id]:e},lastUpdated:new Date().toISOString()}))},addAlert:e=>{r(s=>({alerts:[...s.alerts,{...e,id:Date.now(),timestamp:new Date().toISOString()}]}))},dismissAlert:e=>{r(s=>({alerts:s.alerts.filter(o=>o.id!==e)}))},updatePreferences:e=>{r(s=>({preferences:{...s.preferences,...e}}))},calculateCurrentRatio:()=>{const{metrics:e}=a();if(!e.currentAssets||!e.currentLiabilities)return null;const s=e.currentAssets.value/e.currentLiabilities.value;return r(o=>({metrics:{...o.metrics,currentRatio:{value:s,target:2,trend:o.metrics.currentRatio?.trend||0}}})),s},calculateQuickRatio:()=>{const{metrics:e}=a();if(!e.currentAssets||!e.inventory||!e.currentLiabilities)return null;const s=(e.currentAssets.value-e.inventory.value)/e.currentLiabilities.value;return r(o=>({metrics:{...o.metrics,quickRatio:{value:s,target:1,trend:o.metrics.quickRatio?.trend||0}}})),s},calculateCashUnlock:()=>{const{metrics:e}=a();if(!e.daysInventory||!e.daysReceivables||!e.daysPayables)return null;const s=e.daysInventory.value+e.daysReceivables.value-e.daysPayables.value,o=e.revenue?.value/365,i=s*o;return r(n=>({metrics:{...n.metrics,cashUnlock:{value:i,target:0,trend:n.metrics.cashUnlock?.trend||0}}})),i},generateMockData:()=>{r({metrics:{revenue:{value:125e5,target:15e6,trend:8.5},cashFlow:{value:28e5,target:3e6,trend:-2.3},currentRatio:{value:2.1,target:2,trend:5.2},quickRatio:{value:1.3,target:1,trend:3.8},oee:{value:87,target:85,trend:2.1},throughput:{value:45e3,target:5e4,trend:-1.5},marketShare:{value:23.5,target:25,trend:1.2},customerSatisfaction:{value:92,target:90,trend:3.4},currentAssets:{value:5e6,target:0,trend:0},currentLiabilities:{value:238e4,target:0,trend:0},inventory:{value:12e5,target:0,trend:0},daysInventory:{value:45,target:30,trend:-3.2},daysReceivables:{value:38,target:35,trend:-2.1},daysPayables:{value:52,target:45,trend:4.5}},alerts:[{id:1,severity:"critical",type:"risk",title:"Cash Flow Below Target",description:"Cash flow is 93% of target. Review receivables collection."},{id:2,severity:"warning",type:"opportunity",title:"OEE Above Target",description:"Production efficiency exceeds target by 2%. Consider capacity expansion."},{id:3,severity:"info",type:"opportunity",title:"Customer Satisfaction High",description:"92% satisfaction rate presents upselling opportunities."}],trends:{financial:[{month:"Jan",revenue:10.2,cashFlow:2.1,margin:18.5},{month:"Feb",revenue:10.8,cashFlow:2.3,margin:19.2},{month:"Mar",revenue:11.5,cashFlow:2.5,margin:19.8},{month:"Apr",revenue:11.9,cashFlow:2.6,margin:20.1},{month:"May",revenue:12.2,cashFlow:2.7,margin:20.5},{month:"Jun",revenue:12.5,cashFlow:2.8,margin:21}],operational:[{month:"Jan",oee:82,throughput:43,quality:96.5},{month:"Feb",oee:83,throughput:44,quality:96.8},{month:"Mar",oee:84,throughput:44.5,quality:97},{month:"Apr",oee:85,throughput:45,quality:97.2},{month:"May",oee:86,throughput:45,quality:97.5},{month:"Jun",oee:87,throughput:45,quality:97.8}]},lastUpdated:new Date().toISOString()})}}),{name:"executive-dashboard-storage",partialize:r=>({preferences:r.preferences})}),{name:"ExecutiveStore"})),re=({id:r,title:a,value:e,target:s,trend:o,icon:i,formatter:n=u=>u,color:d="blue",onClick:p})=>{const u=o>0,m=e>=s,b={blue:"bg-blue-50 text-blue-700 border-blue-200",green:"bg-green-50 text-green-700 border-green-200",purple:"bg-purple-50 text-purple-700 border-purple-200",indigo:"bg-indigo-50 text-indigo-700 border-indigo-200",yellow:"bg-yellow-50 text-yellow-700 border-yellow-200",teal:"bg-teal-50 text-teal-700 border-teal-200",pink:"bg-pink-50 text-pink-700 border-pink-200",orange:"bg-orange-50 text-orange-700 border-orange-200"},c={blue:"text-blue-600",green:"text-green-600",purple:"text-purple-600",indigo:"text-indigo-600",yellow:"text-yellow-600",teal:"text-teal-600",pink:"text-pink-600",orange:"text-orange-600"};return t.jsxs("div",{onClick:p,className:v("relative p-6 rounded-lg border-2 cursor-pointer transition-all hover:shadow-lg",b[d],"hover:scale-105"),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx(i,{className:v("h-8 w-8",c[d])}),t.jsxs("div",{className:v("flex items-center space-x-1 text-sm font-medium",u?"text-green-600":"text-red-600"),children:[u?t.jsx(O,{className:"h-4 w-4"}):t.jsx(M,{className:"h-4 w-4"}),t.jsxs("span",{children:[Math.abs(o),"%"]})]})]}),t.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-1",children:a}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:n(e)}),t.jsxs("div",{className:"mt-2 flex items-center space-x-2",children:[t.jsx("span",{className:"text-xs text-gray-500",children:"Target:"}),t.jsx("span",{className:v("text-xs font-medium",m?"text-green-600":"text-amber-600"),children:n(s)}),m?t.jsx("span",{className:"text-xs text-green-600",children:"✓ Met"}):t.jsxs("span",{className:"text-xs text-amber-600",children:[(e/s*100).toFixed(0),"% of target"]})]}),t.jsx("div",{className:"mt-3 w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:v("h-2 rounded-full transition-all duration-500",m?"bg-green-500":"bg-amber-500"),style:{width:`${Math.min(e/s*100,100)}%`}})})]})};W.register(G,J,z,B,H,Q,V,K);const k=({data:r,categories:a})=>{const e=h.useRef(null),s={labels:r.map(i=>i.month),datasets:a.map((i,n)=>{const d=[{border:"rgb(59, 130, 246)",bg:"rgba(59, 130, 246, 0.1)"},{border:"rgb(34, 197, 94)",bg:"rgba(34, 197, 94, 0.1)"},{border:"rgb(251, 146, 60)",bg:"rgba(251, 146, 60, 0.1)"}],p=d[n%d.length],u=i.toLowerCase().replace(/\s+/g,"");return{label:i,data:r.map(m=>m[u]||0),borderColor:p.border,backgroundColor:p.bg,tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}})},o={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15}},tooltip:{mode:"index",intersect:!1,callbacks:{label:function(i){let n=i.dataset.label||"";return n&&(n+=": "),i.parsed.y!==null&&(n.includes("%")||n.includes("Rate")?n+=i.parsed.y.toFixed(1)+"%":n.includes("$")||n.toLowerCase().includes("revenue")||n.toLowerCase().includes("cash")?n+="$"+i.parsed.y.toFixed(1)+"M":n+=i.parsed.y.toFixed(1)),n}}}},scales:{x:{grid:{display:!1},ticks:{font:{size:12}}},y:{beginAtZero:!1,grid:{color:"rgba(0, 0, 0, 0.05)"},ticks:{font:{size:12},callback:function(i){return this.chart.data.datasets[0].label.includes("%")?i+"%":this.chart.data.datasets[0].label.toLowerCase().includes("revenue")||this.chart.data.datasets[0].label.toLowerCase().includes("cash")?"$"+i+"M":i}}}},interaction:{mode:"nearest",axis:"x",intersect:!1}};return t.jsx("div",{style:{height:"300px"},children:t.jsx(q,{ref:e,data:s,options:o})})},ae=({alerts:r,className:a})=>{const[e,s]=h.useState(new Set),o=n=>{s(d=>new Set(d).add(alertId))},i=r.filter(n=>!e.has(n.id));return i.length===0?null:t.jsx("div",{className:v("rounded-lg border-2 p-4",a||"border-red-500 bg-red-50"),children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx(I,{className:"h-6 w-6 text-red-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"text-lg font-semibold text-red-900",children:["Critical Alerts (",i.length,")"]}),t.jsx("div",{className:"mt-3 space-y-2",children:i.map(n=>t.jsxs("div",{className:"flex items-start justify-between p-3 bg-white rounded-lg border border-red-200",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium text-gray-900",children:n.title}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:n.description}),n.action&&t.jsxs("button",{className:"mt-2 text-sm font-medium text-red-600 hover:text-red-700",children:[n.action," →"]})]}),t.jsx("button",{onClick:()=>o(),className:"ml-4 p-1 rounded-lg hover:bg-red-100 transition-colors","aria-label":"Dismiss alert",children:t.jsx(U,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})})]},n.id))})]})]})})},ne="https://sentia-manufacturing-production.onrender.com/api".replace("/api","/events")||"http://localhost:5000/events";class ie{constructor(){this.eventSource=null,this.listeners=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.isConnected=!1}connect(){if(!(this.eventSource&&this.eventSource.readyState!==EventSource.CLOSED))try{this.eventSource=new EventSource(ne,{withCredentials:!0}),this.eventSource.onopen=()=>{R("SSE connection established"),this.isConnected=!0,this.reconnectAttempts=0,this.notifyListeners("connection",{status:"connected"})},this.eventSource.onerror=a=>{f("SSE connection error",a),this.isConnected=!1,this.notifyListeners("connection",{status:"error",error:a}),this.eventSource.readyState===EventSource.CLOSED&&this.reconnect()},this.eventSource.onmessage=a=>{try{const e=JSON.parse(a.data);this.notifyListeners("message",e)}catch(e){f("Error parsing SSE message",e)}},this.registerEventTypes()}catch(a){f("Failed to create SSE connection",a),this.reconnect()}}registerEventTypes(){["metrics-update","alert","production-status","inventory-change","order-update","system-status","forecast-update","cash-flow-update"].forEach(e=>{this.eventSource.addEventListener(e,s=>{try{const o=JSON.parse(s.data);this.notifyListeners(e,o)}catch(o){f("Error parsing event",{type:e,error:o})}})})}reconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){f("Max reconnection attempts reached"),this.notifyListeners("connection",{status:"failed"});return}this.reconnectAttempts++;const a=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);R("Reconnecting SSE",{delay:`${a}ms`,attempt:this.reconnectAttempts}),setTimeout(()=>{this.connect()},a)}subscribe(a,e){return this.listeners.has(a)||this.listeners.set(a,new Set),this.listeners.get(a).add(e),()=>{const s=this.listeners.get(a);s&&s.delete(e)}}notifyListeners(a,e){const s=this.listeners.get(a);s&&s.forEach(i=>{try{i(e)}catch(n){f("Error in SSE listener callback",n)}});const o=this.listeners.get("*");o&&o.forEach(i=>{try{i({type:a,data:e})}catch(n){f("Error in wildcard SSE listener",n)}})}disconnect(){this.eventSource&&(this.eventSource.close(),this.eventSource=null,this.isConnected=!1,this.notifyListeners("connection",{status:"disconnected"}))}getConnectionStatus(){return{isConnected:this.isConnected,readyState:this.eventSource?.readyState,reconnectAttempts:this.reconnectAttempts}}}const x=new ie;function oe(r=[],a={}){const[e,s]=h.useState({}),[o,i]=h.useState(!1),[n,d]=h.useState(null);h.useEffect(()=>{x.isConnected||x.connect();const m=x.subscribe("connection",c=>{i(c.status==="connected")}),b=r.map(c=>x.subscribe(c,g=>{s(y=>({...y,[c]:g})),d(new Date),a.onEvent&&a.onEvent(c,g)}));return i(x.isConnected),()=>{m(),b.forEach(c=>c()),a.disconnectOnUnmount&&x.disconnect()}},[r.join(","),a.disconnectOnUnmount]);const p=h.useCallback(()=>{x.connect()},[]),u=h.useCallback(()=>{x.disconnect()},[]);return{data:e,isConnected:o,lastUpdate:n,reconnect:p,disconnect:u}}const C=(r,a="USD",e=0)=>new Intl.NumberFormat("en-US",{style:"currency",currency:a,minimumFractionDigits:e,maximumFractionDigits:e}).format(r),j=(r,a=1)=>`${r.toFixed(a)}%`,ce=()=>{const{user:r}=$(),[a,e]=h.useState(!0),{metrics:s,alerts:o,trends:i,fetchExecutiveMetrics:n,updateMetric:d,addAlert:p}=se(),{isConnected:u,lastUpdate:m}=oe(["executive-metrics","executive-alerts","system-status"],{onEvent:(c,g)=>{switch(c){case"executive-metrics":g.metrics&&Object.entries(g.metrics).forEach(([y,F])=>{d({name:y,data:F})});break;case"executive-alerts":g.alert&&p(g.alert);break}}});h.useEffect(()=>{const c=async()=>{e(!0);try{await n()}catch(y){f("Failed to load executive metrics",y)}finally{e(!1)}};c();const g=setInterval(c,3e4);return()=>clearInterval(g)},[n]);const b=[{id:"revenue",title:"Revenue",value:s?.revenue?.value||0,target:s?.revenue?.target||0,trend:s?.revenue?.trend||0,icon:E,formatter:C,color:"blue"},{id:"cash-flow",title:"Cash Flow",value:s?.cashFlow?.value||0,target:s?.cashFlow?.target||0,trend:s?.cashFlow?.trend||0,icon:E,formatter:C,color:"green"},{id:"current-ratio",title:"Current Ratio",value:s?.currentRatio?.value||0,target:s?.currentRatio?.target||2,trend:s?.currentRatio?.trend||0,icon:S,formatter:c=>c.toFixed(2),color:"purple"},{id:"quick-ratio",title:"Quick Ratio",value:s?.quickRatio?.value||0,target:s?.quickRatio?.target||1,trend:s?.quickRatio?.trend||0,icon:S,formatter:c=>c.toFixed(2),color:"indigo"},{id:"oee",title:"OEE",value:s?.oee?.value||0,target:s?.oee?.target||85,trend:s?.oee?.trend||0,icon:w,formatter:j,color:"yellow"},{id:"throughput",title:"Throughput",value:s?.throughput?.value||0,target:s?.throughput?.target||0,trend:s?.throughput?.trend||0,icon:S,formatter:c=>`${c.toLocaleString()} units`,color:"teal"},{id:"market-share",title:"Market Share",value:s?.marketShare?.value||0,target:s?.marketShare?.target||0,trend:s?.marketShare?.trend||0,icon:w,formatter:j,color:"pink"},{id:"customer-satisfaction",title:"Customer Satisfaction",value:s?.customerSatisfaction?.value||0,target:s?.customerSatisfaction?.target||90,trend:s?.customerSatisfaction?.trend||0,icon:w,formatter:j,color:"orange"}];return a?t.jsx("div",{className:"flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),t.jsx("p",{className:"mt-4 text-gray-600",children:"Loading executive metrics..."})]})}):t.jsxs("div",{className:"space-y-6 p-6",children:[t.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 text-white",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Executive Dashboard"}),t.jsxs("p",{className:"text-blue-100",children:["Welcome back, ",r?.firstName||"Executive",". Here's your strategic overview."]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"flex items-center space-x-2",children:u?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"h-5 w-5 text-green-300"}),t.jsx("span",{className:"text-xs text-blue-100",children:"Live"})]}):t.jsxs(t.Fragment,{children:[t.jsx(P,{className:"h-5 w-5 text-red-300"}),t.jsx("span",{className:"text-xs text-blue-100",children:"Offline"})]})}),m&&t.jsxs("div",{className:"text-xs text-blue-200",children:["Updated: ",new Date(m).toLocaleTimeString()]})]})]})}),o?.filter(c=>c.severity==="critical").length>0&&t.jsx(ae,{alerts:o.filter(c=>c.severity==="critical"),className:"border-red-500 bg-red-50"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:b.map(c=>t.jsx(re,{...c,onClick:()=>{window.location.href=`/reports/${c.id}`}},c.id))}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Financial Trends"}),t.jsx(k,{data:i?.financial||[],categories:["Revenue","Cash Flow","Profit Margin"]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Operational Trends"}),t.jsx(k,{data:i?.operational||[],categories:["OEE","Throughput","Quality Rate"]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Strategic Opportunities"}),t.jsx("div",{className:"space-y-3",children:o?.filter(c=>c.type==="opportunity").map(c=>t.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-green-50 rounded-lg",children:[t.jsx(w,{className:"h-5 w-5 text-green-600 mt-0.5"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:c.title}),t.jsx("p",{className:"text-sm text-gray-600",children:c.description})]})]},c.id))})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>window.print(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Export to PDF"})})]})},xe=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"}));export{xe as E,ge as a,R as b,pe as d,f as l};
