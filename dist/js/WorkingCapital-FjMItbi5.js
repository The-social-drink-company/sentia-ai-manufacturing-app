const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/react-core-DlJGLw67.js","js/auth-BIfipbc6.js","js/vendor-TZ9aDXZU.js","js/charts-C-BUlHpY.js","js/vendor-utils-W0IPh-on.js","css/react-core-C9-ySRfk.css"])))=>i.map(i=>d[i]);
import{r as e,j as s,_ as a,aZ as t,aO as n,o as i,T as r,v as l,a_ as c,aa as d,a$ as o,q as m,ay as h,ae as x,Z as u}from"./react-core-DlJGLw67.js";import{ci as j}from"./vendor-TZ9aDXZU.js";import{f as g,g as v}from"./index-DuY1VrEM.js";import{C as p}from"./CashConversionCycleEngine-B3-p6Glr.js";import{E as y}from"./EnhancedWorkingCapitalService-SQol0ZRc.js";import"./auth-BIfipbc6.js";import"./vendor-utils-W0IPh-on.js";import"./charts-C-BUlHpY.js";import"./router-BgNYfmsc.js";import"./animation-Cxa7csYq.js";import"./DateContextEngine-uchP7ITA.js";function N(){const[t,n]=e.useState(null),[i,r]=e.useState(!1),[l,c]=e.useState(null),[d,o]=e.useState(12),[m]=e.useState(()=>new p),h=async()=>{try{r(!0),c(null);try{const e={Authorization:`Bearer ${await(async()=>{const{getToken:e}=await a(async()=>{const{getToken:e}=await import("./react-core-DlJGLw67.js").then(e=>e.cm);return{getToken:e}},__vite__mapDeps([0,1,2,3,4,5]));return e()})()}`},s=await j.get(`/api/working-capital/kpis/trends?months=${d}`,{headers:e});return void n(s.data.data)}catch(e){}const s=m.calculateCashConversionCycle({annualRevenue:4e7,annualCOGS:26e6}),t=[],i=new Date;for(let e=d-1;e>=0;e--){const a=new Date(i);a.setMonth(a.getMonth()-e);const n=.05;t.push({createdAt:a.toISOString(),ccc:Math.round(10*(s.cashConversionCycle+s.cashConversionCycle*n))/10,dso:Math.round(10*(s.components.dso+s.components.dso*n))/10,dpo:Math.round(10*(s.components.dpo+s.components.dpo*n))/10,dio:Math.round(10*(s.components.dio+s.components.dio*n))/10,inv_turnover:Math.round(10*(365/s.components.dio+365/s.components.dio*n))/10,wc_turnover:Math.round(10*(4e7/(s.balanceSheetItems.receivables+s.balanceSheetItems.inventory-s.balanceSheetItems.payables)+n))/10,facility_utilization:Math.max(.1,Math.min(.9,.8))})}n({trends:t,summary:{currentCCC:s.cashConversionCycle,targetCCC:s.benchmarks.targetCCC,performance:s.performance,recommendations:s.recommendations}})}catch(s){g("KPI fetch error",s,{component:"KPIDashboard",timeframe:d}),c(s.message)}finally{r(!1)}};e.useEffect(()=>{h()},[d]);const x=(e,s)=>{const a={ccc:{excellent:45,good:55,threshold:65},dso:{excellent:30,good:35,threshold:45},dpo:{excellent:30,good:25,threshold:20},dio:{excellent:40,good:45,threshold:55},inv_turnover:{excellent:8,good:6,threshold:4},wc_turnover:{excellent:6.5,good:5,threshold:3.5},facility_utilization:{excellent:.3,good:.6,threshold:.8}}[e];return a&&null!=s?["ccc","dso","dio","facility_utilization"].includes(e)?s<=a.excellent?"excellent":s<=a.good?"good":s<=a.threshold?"warning":"critical":["dpo","inv_turnover","wc_turnover"].includes(e)?s>=a.excellent?"excellent":s>=a.good?"good":s>=a.threshold?"warning":"critical":"unknown":"unknown"},u=(e,s)=>null==s?"N/A":"facility_utilization"===e?`${Math.round(100*s)}%`:["inv_turnover","wc_turnover"].includes(e)?`${s.toFixed(1)}x`:`${Math.round(s)} days`,v=t?.trends&&0!==t.trends.length?t.trends[t.trends.length-1]:null;return s.jsxs("div",{className:"sentia-kpi-container",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"KPI Analysis"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-form-grid",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Time Period"}),s.jsxs("select",{className:"sentia-select",value:d,onChange:e=>o(parseInt(e.target.value)),children:[s.jsx("option",{value:3,children:"Last 3 Months"}),s.jsx("option",{value:6,children:"Last 6 Months"}),s.jsx("option",{value:12,children:"Last 12 Months"}),s.jsx("option",{value:24,children:"Last 24 Months"})]})]}),s.jsx("div",{className:"sentia-form-group",children:s.jsx("button",{className:"sentia-btn sentia-btn-primary",onClick:h,disabled:i,children:i?"Loading...":"Refresh KPIs"})})]})})]}),l&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"KPI Loading Error"}),s.jsx("p",{children:l}),s.jsx("button",{onClick:h,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),i&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-loading",children:[s.jsx("div",{className:"sentia-spinner"}),s.jsx("p",{children:"Loading KPI trends..."})]})})}),v&&!i&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"sentia-grid sentia-grid-4",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Cash Conversion Cycle"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${x("ccc",v.ccc)}`,children:x("ccc",v.ccc)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:u("ccc",v.ccc)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: <55 days"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Days Sales Outstanding"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${x("dso",v.dso)}`,children:x("dso",v.dso)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:u("dso",v.dso)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: <35 days"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Days Payable Outstanding"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${x("dpo",v.dpo)}`,children:x("dpo",v.dpo)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:u("dpo",v.dpo)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: >25 days"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Days Inventory Outstanding"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${x("dio",v.dio)}`,children:x("dio",v.dio)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:u("dio",v.dio)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: <45 days"})]})})]})]}),s.jsxs("div",{className:"sentia-grid sentia-grid-3",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Inventory Turnover"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${x("inv_turnover",v.inv_turnover)}`,children:x("inv_turnover",v.inv_turnover)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:u("inv_turnover",v.inv_turnover)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: >8x annually"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"WC Turnover"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${x("wc_turnover",v.wc_turnover)}`,children:x("wc_turnover",v.wc_turnover)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:u("wc_turnover",v.wc_turnover)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: >6.5x annually"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Credit Utilization"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${x("facility_utilization",v.facility_utilization)}`,children:x("facility_utilization",v.facility_utilization)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:u("facility_utilization",v.facility_utilization)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: <60%"})]})})]})]}),t.trends.length>1&&s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"KPI Trends"}),s.jsxs("div",{className:"sentia-card-badge",children:[t.trends.length," data points"]})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Date"}),s.jsx("th",{children:"CCC"}),s.jsx("th",{children:"DSO"}),s.jsx("th",{children:"DPO"}),s.jsx("th",{children:"DIO"}),s.jsx("th",{children:"Inv Turnover"}),s.jsx("th",{children:"WC Turnover"}),s.jsx("th",{children:"Credit Util"})]})}),s.jsx("tbody",{children:t.trends.slice(-10).reverse().map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{children:new Date(e.createdAt).toLocaleDateString("en-GB")}),s.jsx("td",{className:`sentia-kpi-cell sentia-${x("ccc",e.ccc)}`,children:u("ccc",e.ccc)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${x("dso",e.dso)}`,children:u("dso",e.dso)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${x("dpo",e.dpo)}`,children:u("dpo",e.dpo)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${x("dio",e.dio)}`,children:u("dio",e.dio)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${x("inv_turnover",e.inv_turnover)}`,children:u("inv_turnover",e.inv_turnover)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${x("wc_turnover",e.wc_turnover)}`,children:u("wc_turnover",e.wc_turnover)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${x("facility_utilization",e.facility_utilization)}`,children:u("facility_utilization",e.facility_utilization)})]},a))})]})})})]})]}),!t&&!i&&!l&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No KPI data available"}),s.jsx("small",{children:"Historical KPI data will appear here once working capital projections are generated"})]})})})]})}function b(){const[a]=e.useState(()=>new y),[t,n]=e.useState(null),[i,r]=e.useState(!1),[l,c]=e.useState(null),[d,o]=e.useState({horizonMonths:12,currency:"GBP",scenarios:["baseline"]}),m=async()=>{try{r(!0),c(null);const e=await a.calculateWorkingCapitalRequirements({period:d.horizonMonths,currency:d.currency,includeForecasts:!0}),s=e.forecasts?.map(e=>({id:e.date,month:e.date.substring(0,7),openingCash:e.workingCapital-e.cashFlow,cash_in:Math.max(0,e.cashFlow),cash_out:Math.max(0,-e.cashFlow),net_change:e.cashFlow,ending_cash:e.workingCapital,workingCapital:e.workingCapital,accountsReceivable:e.accountsReceivable,inventory:e.inventory,accountsPayable:e.accountsPayable,revenue:e.revenue}))||[],t={scenarios:{baseline:{projections:s,summary:{totalCashIn:s.reduce((e,s)=>e+Math.max(0,s.cash_in),0),totalCashOut:s.reduce((e,s)=>e+Math.max(0,-s.cash_out),0),netCashFlow:s.reduce((e,s)=>e+s.net_change,0),minCash:Math.min(...s.map(e=>e.ending_cash)),breachMonths:s.filter(e=>e.ending_cash<5e5).length,avgWorkingCapital:s.reduce((e,s)=>e+s.workingCapital,0)/s.length}}},workingCapitalContext:{currentRatio:e.ratios?.current||0,quickRatio:e.ratios?.quick||0,cashConversionCycle:e.cashConversionCycle?.total||0,performanceScore:e.performanceScore||0,riskLevel:e.riskAssessment?.overall||"unknown"}};n(t)}catch(e){g("Projection error",e,{component:"CashFlowProjections"}),c(e.message)}finally{r(!1)}};e.useEffect(()=>{m()},[]);const h=(e,s)=>{o(a=>({...a,[e]:s}))};return s.jsxs("div",{className:"sentia-projections-container",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Projection Parameters"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-form-grid",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Horizon (Months)"}),s.jsxs("select",{className:"sentia-select",value:d.horizonMonths,onChange:e=>h("horizonMonths",parseInt(e.target.value)),children:[s.jsx("option",{value:3,children:"3 Months"}),s.jsx("option",{value:6,children:"6 Months"}),s.jsx("option",{value:12,children:"12 Months"}),s.jsx("option",{value:24,children:"24 Months"})]})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Currency"}),s.jsxs("select",{className:"sentia-select",value:d.currency,onChange:e=>h("currency",e.target.value),children:[s.jsx("option",{value:"GBP",children:"GBP (£)"}),s.jsx("option",{value:"EUR",children:"EUR (€)"}),s.jsx("option",{value:"USD",children:"USD ($)"})]})]}),s.jsx("div",{className:"sentia-form-group",children:s.jsx("button",{className:"sentia-btn sentia-btn-primary",onClick:m,disabled:i,children:i?"Generating...":"Generate Projection"})})]})})]}),l&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"Projection Error"}),s.jsx("p",{children:l}),s.jsx("button",{onClick:m,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),i&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-loading",children:[s.jsx("div",{className:"sentia-spinner"}),s.jsx("p",{children:"Generating cash flow projections..."})]})})}),t&&!i&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"sentia-grid sentia-grid-3",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h4",{className:"sentia-card-title",children:"Total Cash In"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsxs("span",{className:"sentia-metric-value",children:["£",t.scenarios.baseline.summary.totalCashIn.toLocaleString()]}),s.jsxs("span",{className:"sentia-metric-label",children:["Over ",d.horizonMonths," months"]})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h4",{className:"sentia-card-title",children:"Total Cash Out"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsxs("span",{className:"sentia-metric-value",children:["£",t.scenarios.baseline.summary.totalCashOut.toLocaleString()]}),s.jsxs("span",{className:"sentia-metric-label",children:["Over ",d.horizonMonths," months"]})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h4",{className:"sentia-card-title",children:"Net Cash Flow"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsxs("span",{className:"sentia-metric-value "+(t.scenarios.baseline.summary.netCashFlow>=0?"sentia-positive":"sentia-negative"),children:["£",t.scenarios.baseline.summary.netCashFlow.toLocaleString()]}),s.jsxs("span",{className:"sentia-metric-label",children:["Net over ",d.horizonMonths," months"]})]})})]})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Monthly Cash Flow Projections"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Month"}),s.jsx("th",{children:"Opening Cash"}),s.jsx("th",{children:"Cash In"}),s.jsx("th",{children:"Cash Out"}),s.jsx("th",{children:"Net Change"}),s.jsx("th",{children:"Ending Cash"}),s.jsx("th",{children:"Status"})]})}),s.jsx("tbody",{children:t.scenarios.baseline.projections.map((e,a)=>{const t=new Date(e.month).toLocaleDateString("en-GB",{month:"short",year:"numeric"}),n=e.ending_cash<5e4;return s.jsxs("tr",{children:[s.jsx("td",{children:t}),s.jsxs("td",{children:["£",e.openingCash?e.openingCash.toLocaleString():"0"]}),s.jsxs("td",{className:"sentia-positive",children:["£",e.cash_in.toLocaleString()]}),s.jsxs("td",{className:"sentia-negative",children:["£",e.cash_out.toLocaleString()]}),s.jsxs("td",{className:e.net_change>=0?"sentia-positive":"sentia-negative",children:["£",e.net_change.toLocaleString()]}),s.jsxs("td",{className:n?"sentia-negative":"sentia-positive",children:["£",e.ending_cash.toLocaleString()]}),s.jsxs("td",{children:[n&&s.jsx("span",{className:"sentia-status sentia-status-error",children:"Low Cash"}),!n&&e.net_change>=0&&s.jsx("span",{className:"sentia-status sentia-status-success",children:"Healthy"}),!n&&e.net_change<0&&s.jsx("span",{className:"sentia-status sentia-status-warning",children:"Declining"})]})]},e.id)})})]})})})]}),t.scenarios.baseline.summary.breachMonths>0&&s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Risk Analysis"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-alert sentia-alert-warning",children:s.jsxs("div",{className:"sentia-alert-content",children:[s.jsxs("div",{className:"sentia-alert-message",children:["WARNING: Cash falls below minimum buffer in ",t.scenarios.baseline.summary.breachMonths," months"]}),s.jsxs("div",{className:"sentia-alert-details",children:["Minimum cash level: £",t.scenarios.baseline.summary.minCash.toLocaleString()]})]})})})]})]}),!t&&!i&&!l&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No projection data available"}),s.jsx("small",{children:'Click "Generate Projection" to create cash flow projections'})]})})})]})}function k(){const[a,t]=e.useState(null),[n,i]=e.useState(!1),[r,l]=e.useState(null),[c,d]=e.useState({horizonMonths:12,currency:"GBP"}),[o,m]=e.useState([{name:"Optimistic",description:"Growth acceleration scenario",parameters:{demandAdjustment:.15,priceAdjustment:.05,arTermsAdjustment:-.1}},{name:"Pessimistic",description:"Economic downturn scenario",parameters:{demandAdjustment:-.2,cogsAdjustment:.1,arTermsAdjustment:.15}}]),h=async()=>{try{i(!0),l(null);const e={Authorization:`Bearer ${await(async()=>null)()}`},s=await j.post("/api/working-capital/scenarios",{baselineParams:{...c,startMonth:new Date},overrides:o},{headers:e});t(s.data.data)}catch(e){g("Scenario analysis error",e,{component:"ScenarioAnalysis"}),l(e.response?.data?.error||e.message)}finally{i(!1)}},x=(e,s,a)=>{const t=[...o];if(s.includes(".")){const[n,i]=s.split(".");t[e][n][i]=parseFloat(a)||0}else t[e][s]=a;m(t)};return s.jsxs("div",{className:"sentia-scenario-container",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Scenario Configuration"})}),s.jsxs("div",{className:"sentia-card-content",children:[s.jsxs("div",{className:"sentia-form-section",children:[s.jsx("h4",{children:"Baseline Parameters"}),s.jsxs("div",{className:"sentia-form-grid",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Horizon (Months)"}),s.jsxs("select",{className:"sentia-select",value:c.horizonMonths,onChange:e=>d({...c,horizonMonths:parseInt(e.target.value)}),children:[s.jsx("option",{value:6,children:"6 Months"}),s.jsx("option",{value:12,children:"12 Months"}),s.jsx("option",{value:24,children:"24 Months"})]})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Currency"}),s.jsxs("select",{className:"sentia-select",value:c.currency,onChange:e=>d({...c,currency:e.target.value}),children:[s.jsx("option",{value:"GBP",children:"GBP (£)"}),s.jsx("option",{value:"EUR",children:"EUR (€)"}),s.jsx("option",{value:"USD",children:"USD ($)"})]})]})]})]}),s.jsxs("div",{className:"sentia-form-section",children:[s.jsxs("div",{className:"sentia-section-header",children:[s.jsx("h4",{children:"Scenarios"}),s.jsx("button",{className:"sentia-btn sentia-btn-ghost",onClick:()=>{m([...o,{name:`Custom ${o.length+1}`,description:"Custom scenario",parameters:{demandAdjustment:0,priceAdjustment:0,cogsAdjustment:0,arTermsAdjustment:0}}])},children:"Add Custom Scenario"})]}),o.map((e,a)=>s.jsxs("div",{className:"sentia-scenario-form",children:[s.jsxs("div",{className:"sentia-scenario-header",children:[s.jsx("input",{type:"text",className:"sentia-input",value:e.name,onChange:e=>x(a,"name",e.target.value),placeholder:"Scenario name"}),s.jsx("button",{className:"sentia-btn sentia-btn-ghost sentia-btn-sm",onClick:()=>(e=>{m(o.filter((s,a)=>a!==e))})(a),children:"Remove"})]}),s.jsx("input",{type:"text",className:"sentia-input",value:e.description,onChange:e=>x(a,"description",e.target.value),placeholder:"Scenario description"}),s.jsxs("div",{className:"sentia-scenario-params",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Demand Change (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*e.parameters.demandAdjustment).toFixed(1),onChange:e=>x(a,"parameters.demandAdjustment",e.target.value/100),step:"0.1",placeholder:"0.0"})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Price Change (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*e.parameters.priceAdjustment).toFixed(1),onChange:e=>x(a,"parameters.priceAdjustment",e.target.value/100),step:"0.1",placeholder:"0.0"})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"COGS Change (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*(e.parameters.cogsAdjustment||0)).toFixed(1),onChange:e=>x(a,"parameters.cogsAdjustment",e.target.value/100),step:"0.1",placeholder:"0.0"})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Collection Terms (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*(e.parameters.arTermsAdjustment||0)).toFixed(1),onChange:e=>x(a,"parameters.arTermsAdjustment",e.target.value/100),step:"0.1",placeholder:"0.0"})]})]})]},a))]}),s.jsx("div",{className:"sentia-form-actions",children:s.jsx("button",{className:"sentia-btn sentia-btn-primary",onClick:h,disabled:n||0===o.length,children:n?"Analyzing...":"Run Scenario Analysis"})})]})]}),r&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"Scenario Analysis Error"}),s.jsx("p",{children:r}),s.jsx("button",{onClick:h,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),n&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-loading",children:[s.jsx("div",{className:"sentia-spinner"}),s.jsx("p",{children:"Running scenario analysis..."})]})})}),a&&!n&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Scenario Comparison"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Scenario"}),s.jsx("th",{children:"Net Cash Flow"}),s.jsx("th",{children:"Variance"}),s.jsx("th",{children:"Min Cash"}),s.jsx("th",{children:"Risk Score"}),s.jsx("th",{children:"CCC"}),s.jsx("th",{children:"CCC Change"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{className:"sentia-baseline-row",children:[s.jsx("td",{children:s.jsx("strong",{children:"Baseline"})}),s.jsxs("td",{children:["£",a.baseline?.scenarios?.baseline?.summary?.netCashFlow?.toLocaleString()||"N/A"]}),s.jsx("td",{children:"-"}),s.jsxs("td",{children:["£",a.baseline?.scenarios?.baseline?.summary?.minCash?.toLocaleString()||"N/A"]}),s.jsx("td",{children:a.baseline?.summary?.riskScore||"N/A"}),s.jsxs("td",{children:[a.baseline?.summary?.ccc?.toFixed(1)||"N/A"," days"]}),s.jsx("td",{children:"-"})]}),a.scenarios?.map((e,t)=>{const n=a.baseline?.scenarios?.baseline?.summary?.netCashFlow||0,i=e.results?.scenarios?.baseline?.summary?.netCashFlow||0,r=(c=i,(l=n)&&c?((c-l)/l*100).toFixed(1)+"%":"N/A");var l,c;const d=a.baseline?.summary?.ccc&&e.results?.summary?.ccc?(e.results.summary.ccc-a.baseline.summary.ccc).toFixed(1):"N/A";return s.jsxs("tr",{children:[s.jsxs("td",{children:[s.jsx("strong",{children:e.name}),s.jsx("br",{}),s.jsx("small",{children:e.description})]}),s.jsxs("td",{className:i>=n?"sentia-positive":"sentia-negative",children:["£",i.toLocaleString()]}),s.jsx("td",{className:r.startsWith("+")?"sentia-positive":"sentia-negative",children:r}),s.jsxs("td",{children:["£",e.results?.scenarios?.baseline?.summary?.minCash?.toLocaleString()||"N/A"]}),s.jsx("td",{children:e.results?.summary?.riskScore||"N/A"}),s.jsxs("td",{children:[e.results?.summary?.ccc?.toFixed(1)||"N/A"," days"]}),s.jsx("td",{className:parseFloat(d)<=0?"sentia-positive":"sentia-negative",children:"N/A"!==d?(parseFloat(d)>=0?"+"+d:d)+" days":"N/A"})]},t)})]})]})})})]}),a.comparison?.recommendations&&a.comparison.recommendations.length>0&&s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Scenario Recommendations"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-recommendations",children:a.comparison.recommendations.map((e,a)=>s.jsx("div",{className:`sentia-alert sentia-alert-${e.type}`,children:s.jsxs("div",{className:"sentia-alert-content",children:[s.jsxs("div",{className:"sentia-alert-header",children:[s.jsx("strong",{children:e.scenario})," - ",e.metric]}),s.jsx("div",{className:"sentia-alert-message",children:e.description}),s.jsxs("div",{className:"sentia-alert-impact",children:["Impact: £",e.impact?.toLocaleString()||"N/A"]})]})},a))})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Risk Analysis Summary"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-grid sentia-grid-3",children:[s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Best Case"}),s.jsx("div",{className:"sentia-metric-value sentia-positive",children:a.scenarios&&a.scenarios.length>0?Math.max(...a.scenarios.map(e=>e.results?.scenarios?.baseline?.summary?.netCashFlow||0)).toLocaleString():"N/A"})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Worst Case"}),s.jsx("div",{className:"sentia-metric-value sentia-negative",children:a.scenarios&&a.scenarios.length>0?Math.min(...a.scenarios.map(e=>e.results?.scenarios?.baseline?.summary?.netCashFlow||0)).toLocaleString():"N/A"})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Risk Range"}),s.jsx("div",{className:"sentia-metric-value",children:a.scenarios&&a.scenarios.length>0?(Math.max(...a.scenarios.map(e=>e.results?.scenarios?.baseline?.summary?.netCashFlow||0))-Math.min(...a.scenarios.map(e=>e.results?.scenarios?.baseline?.summary?.netCashFlow||0))).toLocaleString():"N/A"})]})]})})]})]}),!a&&!n&&!r&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No scenario analysis results"}),s.jsx("small",{children:'Configure scenarios above and click "Run Scenario Analysis" to compare different business scenarios'})]})})})]})}function f({hasManagementAccess:a=!1}){const t=async()=>null,[n,i]=e.useState([]),[r,l]=e.useState([]),[c,d]=e.useState(!1),[o,m]=e.useState(null),[h,x]=e.useState("ar"),[u,p]=e.useState(null);e.useEffect(()=>{y()},[]);const y=async()=>{try{d(!0),m(null);const e={Authorization:`Bearer ${await t()}`},[s,a]=await Promise.all([j.get("/api/working-capital/policies/ar",{headers:e}),j.get("/api/working-capital/policies/ap",{headers:e})]);i(s.data.data||[]),l(a.data.data||[])}catch(e){g("Policy fetch error",e,{component:"PolicyManagement"}),m(e.response?.data?.error||e.message)}finally{d(!1)}},N=e=>{try{return JSON.parse(e).map(e=>`${e.days} days (${(100*e.pct).toFixed(0)}%)`).join(", ")}catch{return"Invalid terms format"}},b=e=>(100*e).toFixed(2)+"%";return s.jsxs("div",{className:"sentia-policy-container",children:[s.jsx("div",{className:"sentia-tabs",children:s.jsxs("div",{className:"sentia-tab-list",children:[s.jsxs("button",{className:"sentia-tab "+("ar"===h?"sentia-tab-active":""),onClick:()=>x("ar"),children:[s.jsx("span",{className:"sentia-tab-icon",children:"📥"}),s.jsx("span",{className:"sentia-tab-label",children:"AR Policies"})]}),s.jsxs("button",{className:"sentia-tab "+("ap"===h?"sentia-tab-active":""),onClick:()=>x("ap"),children:[s.jsx("span",{className:"sentia-tab-icon",children:"📤"}),s.jsx("span",{className:"sentia-tab-label",children:"AP Policies"})]})]})}),o&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"Policy Management Error"}),s.jsx("p",{children:o}),s.jsx("button",{onClick:y,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),c&&!u&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-loading",children:[s.jsx("div",{className:"sentia-spinner"}),s.jsx("p",{children:"Loading policies..."})]})})}),"ar"===h&&!c&&s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Accounts Receivable Policies"}),s.jsx("div",{className:"sentia-card-badge",children:n.length})]}),s.jsx("div",{className:"sentia-card-content",children:n.length>0?s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Sales Channel"}),s.jsx("th",{children:"Channel Type"}),s.jsx("th",{children:"Market"}),s.jsx("th",{children:"Payment Terms"}),s.jsx("th",{children:"Bad Debt %"}),s.jsx("th",{children:"Fees %"}),s.jsx("th",{children:"Active From"}),a&&s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:n.map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:e.sales_channel?.name||"N/A"}),s.jsx("td",{children:s.jsx("span",{className:"sentia-badge",children:e.sales_channel?.channelType||"Unknown"})}),s.jsx("td",{children:e.sales_channel?.marketCode||"N/A"}),s.jsx("td",{children:N(e.terms)}),s.jsx("td",{children:b(e.bad_debt_pct)}),s.jsx("td",{children:b(e.fees_pct)}),s.jsx("td",{children:new Date(e.active_from).toLocaleDateString("en-GB")}),a&&s.jsx("td",{children:s.jsx("button",{className:"sentia-btn sentia-btn-ghost sentia-btn-sm",onClick:()=>p({...e,type:"ar"}),children:"Edit"})})]},e.id||t))})]})}):s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No AR policies configured"}),s.jsx("small",{children:"AR policies define payment terms and collection parameters for sales channels"})]})})]}),"ap"===h&&!c&&s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Accounts Payable Policies"}),s.jsx("div",{className:"sentia-card-badge",children:r.length})]}),s.jsx("div",{className:"sentia-card-content",children:r.length>0?s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Supplier ID"}),s.jsx("th",{children:"Term Days"}),s.jsx("th",{children:"Early Pay Discount"}),s.jsx("th",{children:"Early Pay Days"}),s.jsx("th",{children:"Strategy"}),s.jsx("th",{children:"Active From"}),a&&s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:r.map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:e.supplier_id||"N/A"}),s.jsxs("td",{children:[e.term_days," days"]}),s.jsx("td",{children:b(e.early_pay_discount_pct||0)}),s.jsxs("td",{children:[e.early_pay_days||"N/A"," days"]}),s.jsx("td",{children:s.jsx("span",{className:"sentia-badge",children:e.strategy||"Standard"})}),s.jsx("td",{children:new Date(e.active_from).toLocaleDateString("en-GB")}),a&&s.jsx("td",{children:s.jsx("button",{className:"sentia-btn sentia-btn-ghost sentia-btn-sm",onClick:()=>p({...e,type:"ap"}),children:"Edit"})})]},e.id||t))})]})}):s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No AP policies configured"}),s.jsx("small",{children:"AP policies define payment terms and discount strategies for suppliers"})]})})]}),u&&a&&s.jsx(w,{policy:u,onSave:"ar"===u.type?async e=>{try{d(!0);const s={Authorization:`Bearer ${await t()}`};await j.post("/api/working-capital/policies/ar",e,{headers:s});await y(),p(null),v("AR Policy updated successfully",{component:"PolicyManagement",policy:e})}catch(s){g("AR Policy update error",s,{component:"PolicyManagement",policy:e}),m(s.response?.data?.error||s.message)}finally{d(!1)}}:null,onCancel:()=>p(null),loading:c}),!a&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-alert sentia-alert-info",children:s.jsx("div",{className:"sentia-alert-content",children:s.jsx("div",{className:"sentia-alert-message",children:"You have read-only access to policy information. Contact your financial manager to modify policies."})})})})}),s.jsx("div",{className:"sentia-dashboard-actions",children:s.jsxs("button",{onClick:y,className:"sentia-btn sentia-btn-ghost",disabled:c,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Refresh Policies"]})})]})}function w({policy:a,onSave:t,onCancel:n,loading:i}){const[r,l]=e.useState({channel_id:a.channel_id||"",terms:a.terms?JSON.parse(a.terms):[{days:30,pct:1}],bad_debt_pct:a.bad_debt_pct||.025,fees_pct:a.fees_pct||.029,description:a.description||""}),c=e=>{e.preventDefault(),t&&t(r)},d=(e,s,a)=>{const t=[...r.terms];t[e][s]="days"===s?parseInt(a):parseFloat(a),l({...r,terms:t})};return s.jsx("div",{className:"sentia-modal-overlay",children:s.jsxs("div",{className:"sentia-modal",children:[s.jsxs("div",{className:"sentia-modal-header",children:[s.jsx("h3",{children:"Edit AR Policy"}),s.jsx("button",{className:"sentia-modal-close",onClick:n,children:"×"})]}),s.jsxs("form",{onSubmit:c,className:"sentia-modal-content",children:[s.jsxs("div",{className:"sentia-form-section",children:[s.jsx("h4",{children:"Payment Terms"}),r.terms.map((e,a)=>s.jsxs("div",{className:"sentia-term-row",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Days"}),s.jsx("input",{type:"number",className:"sentia-input",value:e.days,onChange:e=>d(a,"days",e.target.value),min:"0",required:!0})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Percentage"}),s.jsx("input",{type:"number",className:"sentia-input",value:e.pct,onChange:e=>d(a,"pct",e.target.value),min:"0",max:"1",step:"0.01",required:!0})]}),r.terms.length>1&&s.jsx("button",{type:"button",className:"sentia-btn sentia-btn-ghost sentia-btn-sm",onClick:()=>(e=>{if(r.terms.length>1){const s=r.terms.filter((s,a)=>a!==e);l({...r,terms:s})}})(a),children:"Remove"})]},a)),s.jsx("button",{type:"button",className:"sentia-btn sentia-btn-ghost",onClick:()=>{l({...r,terms:[...r.terms,{days:30,pct:0}]})},children:"Add Term"})]}),s.jsxs("div",{className:"sentia-form-grid",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Bad Debt Rate (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*r.bad_debt_pct).toFixed(2),onChange:e=>l({...r,bad_debt_pct:parseFloat(e.target.value)/100}),min:"0",max:"100",step:"0.01",required:!0})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Fees Rate (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*r.fees_pct).toFixed(2),onChange:e=>l({...r,fees_pct:parseFloat(e.target.value)/100}),min:"0",max:"100",step:"0.01",required:!0})]})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Description"}),s.jsx("textarea",{className:"sentia-input",value:r.description,onChange:e=>l({...r,description:e.target.value}),rows:"3",placeholder:"Policy description or notes"})]})]}),s.jsxs("div",{className:"sentia-modal-actions",children:[s.jsx("button",{type:"button",className:"sentia-btn sentia-btn-ghost",onClick:n,children:"Cancel"}),s.jsx("button",{type:"submit",className:"sentia-btn sentia-btn-primary",onClick:c,disabled:i,children:i?"Saving...":"Save Policy"})]})]})})}function C({dashboardData:a}){const[t,n]=e.useState(a),[i,r]=e.useState(!1),[l,c]=e.useState(null),[d,o]=e.useState(!1),m=async()=>{try{o(!0),c(null);const e={Authorization:`Bearer ${await(async()=>null)()}`},s=await j.get("/api/working-capital/diagnostics",{headers:e});n(s.data.data)}catch(e){g("Diagnostics refresh error",e,{component:"SystemDiagnostics"}),c(e.response?.data?.error||e.message)}finally{o(!1)}},h=e=>e>=80?"sentia-excellent":e>=60?"sentia-good":e>=40?"sentia-warning":"sentia-critical",x=e=>"healthy"===e||"excellent"===e||"optimal"===e?"sentia-status-success":"good"===e||"acceptable"===e?"sentia-status-warning":"sentia-status-error";return t||i?s.jsxs("div",{className:"sentia-diagnostics-container",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"System Health Overview"}),s.jsxs("div",{className:`sentia-card-badge ${h(t?.overallHealthScore||0)}`,children:[t?.overallHealthScore||0,"/100"]})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-health-grid",children:[s.jsxs("div",{className:"sentia-health-item",children:[s.jsx("div",{className:"sentia-health-icon",children:"💾"}),s.jsxs("div",{className:"sentia-health-content",children:[s.jsx("div",{className:"sentia-health-label",children:"Database"}),s.jsx("div",{className:`sentia-status ${x(t?.systemHealth?.overallStatus)}`,children:t?.systemHealth?.overallStatus||"unknown"}),s.jsx("div",{className:"sentia-health-detail",children:t?.systemHealth?.database?.message||"No status available"})]})]}),s.jsxs("div",{className:"sentia-health-item",children:[s.jsx("div",{className:"sentia-health-icon",children:"🧮"}),s.jsxs("div",{className:"sentia-health-content",children:[s.jsx("div",{className:"sentia-health-label",children:"Calculations"}),s.jsx("div",{className:`sentia-status ${x(t?.systemHealth?.calculations?.status)}`,children:t?.systemHealth?.calculations?.status||"unknown"}),s.jsx("div",{className:"sentia-health-detail",children:t?.systemHealth?.calculations?.message||"No status available"})]})]})]})})]}),s.jsxs("div",{className:"sentia-grid sentia-grid-2",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Data Quality"}),s.jsxs("div",{className:`sentia-card-badge ${h(t?.dataQuality?.overallScore||0)}`,children:[t?.dataQuality?.overallScore||0,"/100"]})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-data-quality-grid",children:[s.jsxs("div",{className:"sentia-quality-item",children:[s.jsx("div",{className:"sentia-quality-label",children:"Product Coverage"}),s.jsx("div",{className:`sentia-status ${x(t?.dataQuality?.productCoverage?.status)}`,children:t?.dataQuality?.productCoverage?.status||"unknown"}),s.jsxs("div",{className:"sentia-quality-detail",children:[t?.dataQuality?.productCoverage?.count||0," products"]})]}),s.jsxs("div",{className:"sentia-quality-item",children:[s.jsx("div",{className:"sentia-quality-label",children:"Sales Data"}),s.jsx("div",{className:`sentia-status ${x(t?.dataQuality?.salesDataFreshness?.status)}`,children:t?.dataQuality?.salesDataFreshness?.status||"unknown"}),s.jsxs("div",{className:"sentia-quality-detail",children:[t?.dataQuality?.salesDataFreshness?.recentSalesCount||0," recent sales"]})]}),s.jsxs("div",{className:"sentia-quality-item",children:[s.jsx("div",{className:"sentia-quality-label",children:"Forecasts"}),s.jsx("div",{className:`sentia-status ${x(t?.dataQuality?.forecastCoverage?.status)}`,children:t?.dataQuality?.forecastCoverage?.status||"unknown"}),s.jsxs("div",{className:"sentia-quality-detail",children:[t?.dataQuality?.forecastCoverage?.count||0," forecasts"]})]}),s.jsxs("div",{className:"sentia-quality-item",children:[s.jsx("div",{className:"sentia-quality-label",children:"Inventory Data"}),s.jsx("div",{className:`sentia-status ${x(t?.dataQuality?.inventoryDataFreshness?.status)}`,children:t?.dataQuality?.inventoryDataFreshness?.status||"unknown"}),s.jsxs("div",{className:"sentia-quality-detail",children:[t?.dataQuality?.inventoryDataFreshness?.recentInventoryCount||0," recent records"]})]})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Model Accuracy"}),s.jsx("div",{className:`sentia-card-badge ${x(t?.modelAccuracy?.overallAccuracy)}`,children:t?.modelAccuracy?.overallAccuracy||"unknown"})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-accuracy-grid",children:[s.jsxs("div",{className:"sentia-accuracy-item",children:[s.jsx("div",{className:"sentia-accuracy-label",children:"Forecast Accuracy"}),s.jsxs("div",{className:"sentia-accuracy-value",children:[t?.modelAccuracy?.forecastAccuracy?.mape||0,"% MAPE"]}),s.jsx("div",{className:`sentia-status ${x(t?.modelAccuracy?.forecastAccuracy?.status)}`,children:t?.modelAccuracy?.forecastAccuracy?.status||"unknown"})]}),s.jsxs("div",{className:"sentia-accuracy-item",children:[s.jsx("div",{className:"sentia-accuracy-label",children:"Cash Flow Accuracy"}),s.jsxs("div",{className:"sentia-accuracy-value",children:[t?.modelAccuracy?.cashFlowAccuracy?.variance||0,"% variance"]}),s.jsx("div",{className:`sentia-status ${x(t?.modelAccuracy?.cashFlowAccuracy?.status)}`,children:t?.modelAccuracy?.cashFlowAccuracy?.status||"unknown"})]}),s.jsxs("div",{className:"sentia-accuracy-detail",children:["Last validation: ",t?.modelAccuracy?.lastValidation?new Date(t.modelAccuracy.lastValidation).toLocaleDateString("en-GB"):"Never"]})]})})]})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Performance Metrics"}),s.jsx("div",{className:`sentia-card-badge ${x(t?.performanceMetrics?.status)}`,children:t?.performanceMetrics?.status||"unknown"})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-grid sentia-grid-4",children:[s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Avg Calculation Time"}),s.jsxs("div",{className:"sentia-metric-value",children:[t?.performanceMetrics?.averageCalculationTime||0,"s"]})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Cache Hit Rate"}),s.jsxs("div",{className:"sentia-metric-value",children:[(100*(t?.performanceMetrics?.cacheHitRate||0)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Memory Usage"}),s.jsxs("div",{className:"sentia-metric-value",children:[t?.performanceMetrics?.memoryUsage||0,"MB"]})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Concurrent Users"}),s.jsx("div",{className:"sentia-metric-value",children:t?.performanceMetrics?.concurrentUsers||0})]})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"System Alerts"}),s.jsx("div",{className:"sentia-card-badge",children:t?.alerts?.length||0})]}),s.jsx("div",{className:"sentia-card-content",children:t?.alerts&&t.alerts.length>0?s.jsx("div",{className:"sentia-alerts-list",children:t.alerts.map((e,a)=>s.jsx("div",{className:`sentia-alert sentia-alert-${e.level}`,children:s.jsxs("div",{className:"sentia-alert-content",children:[s.jsxs("div",{className:"sentia-alert-header",children:[s.jsx("span",{className:"sentia-alert-type",children:e.type}),s.jsx("span",{className:"sentia-alert-timestamp",children:new Date(e.timestamp).toLocaleString("en-GB")})]}),s.jsx("div",{className:"sentia-alert-message",children:e.message})]})},a))}):s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No active alerts"}),s.jsx("small",{children:"System is running normally with no issues detected"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"System Recommendations"}),s.jsx("div",{className:"sentia-card-badge",children:t?.recommendations?.length||0})]}),s.jsx("div",{className:"sentia-card-content",children:t?.recommendations&&t.recommendations.length>0?s.jsx("div",{className:"sentia-recommendations-list",children:t.recommendations.map((e,a)=>s.jsx("div",{className:`sentia-recommendation sentia-priority-${e.priority}`,children:s.jsxs("div",{className:"sentia-recommendation-content",children:[s.jsxs("div",{className:"sentia-recommendation-header",children:[s.jsx("span",{className:"sentia-recommendation-title",children:e.title}),s.jsxs("div",{className:"sentia-recommendation-badges",children:[s.jsx("span",{className:`sentia-badge sentia-priority-${e.priority}`,children:e.priority}),s.jsxs("span",{className:"sentia-badge sentia-effort-{rec.estimatedEffort}",children:[e.estimatedEffort," effort"]})]})]}),s.jsx("div",{className:"sentia-recommendation-description",children:e.description}),s.jsxs("div",{className:"sentia-recommendation-category",children:["Category: ",e.category]})]})},a))}):s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No system recommendations"}),s.jsx("small",{children:"System is optimally configured with no immediate actions required"})]})})]}),l&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"Diagnostics Error"}),s.jsx("p",{children:l}),s.jsx("button",{onClick:m,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),s.jsx("div",{className:"sentia-dashboard-actions",children:s.jsxs("button",{onClick:m,className:"sentia-btn sentia-btn-primary",disabled:d,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),d?"Refreshing...":"Refresh Diagnostics"]})})]}):s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No diagnostics data available"}),s.jsx("button",{onClick:m,className:"sentia-btn sentia-btn-primary",children:"Load Diagnostics"})]})})})}const S=()=>{const[a,h]=e.useState(!1),[x,u]=e.useState(null),[j,g]=e.useState(null),[v,p]=e.useState({annualRevenue:5e6,averageDebtorDays:45,averageCreditorDays:30,currentDebtors:616e3,currentCreditors:411e3,grossMargin:42.5,netMargin:23.1,currentCashOnHand:25e4,averageBankBalance:18e4,industry:"manufacturing",numberOfEmployees:50,inventoryTurnsPerYear:8,currentInventory:312500,expectedGrowthRate:15,debtorDaysReduction:5,creditorDaysExtension:5,monthlyFixedCosts:25e4,monthlyVariableCosts:15e4,seasonalityFactor:1}),y={manufacturing:{avgDebtorDays:48,avgCreditorDays:35,avgInventoryTurns:7.5,avgGrossMargin:38,avgNetMargin:18,revenuePerEmployee:12e4,cashConversionCycle:55},retail:{avgDebtorDays:15,avgCreditorDays:40,avgInventoryTurns:12,avgGrossMargin:45,avgNetMargin:15,revenuePerEmployee:18e4,cashConversionCycle:25},services:{avgDebtorDays:30,avgCreditorDays:25,avgInventoryTurns:0,avgGrossMargin:60,avgNetMargin:25,revenuePerEmployee:25e4,cashConversionCycle:30}},N=(e,s)=>{p(a=>({...a,[e]:parseFloat(s)||0}))},b=()=>{h(!0),g(null);try{const{annualRevenue:e,averageDebtorDays:s,averageCreditorDays:a,currentDebtors:t,currentCreditors:n,currentInventory:i,grossMargin:r,netMargin:l,currentCashOnHand:c,monthlyFixedCosts:d,monthlyVariableCosts:o,expectedGrowthRate:m,debtorDaysReduction:h,creditorDaysExtension:x,inventoryTurnsPerYear:j,numberOfEmployees:g}=v,p=e/365,N=y[v.industry],b=e=>{const t=(d+o)*(e/30),n=p*(e-s),i=t*(a/30),r=t-n+i,l=.15*r;return{totalExpenses:t,expectedInflows:n,expectedOutflows:i,netCashRequired:Math.max(0,r),recommendedCash:Math.max(0,r+l),currentSurplus:c-Math.max(0,r)}},k=t+i+c-n,f=.15*e,w=Math.max(0,f-k),C=()=>{const t=e*(1+m/100),n=t-e,i=n/365*s,l=n*(1-r/100)/j,c=n*(1-r/100)/365*a,h=i+l-c,x=3*(d+1.2*o);return{targetRevenue:t,revenueIncrease:n,additionalDebtors:i,additionalInventory:l,additionalCreditors:c,growthWorkingCapital:h,rampUpCosts:x,totalGrowthFunding:h+x}},S=()=>{const e=p*h,t=p*(1-r/100)*x,n=.1*i,l=e+t+n;return{debtorImprovement:e,creditorImprovement:t,inventoryReduction:n,totalCashUnlock:l,unlock90Days:.4*l,unlock180Days:.7*l,unlock365Days:l,cashConversionCycleCurrent:s+365/j-a,cashConversionCycleOptimized:s-h+365/j*.9-(a+x)}},D={debtorDaysVsBenchmark:s-N.avgDebtorDays,creditorDaysVsBenchmark:a-N.avgCreditorDays,marginVsBenchmark:l-N.avgNetMargin,revenuePerEmployee:e/g,revenuePerEmployeeVsBenchmark:e/g-N.revenuePerEmployee,performanceScore:Math.round(N.avgDebtorDays/s*25+a/N.avgCreditorDays*25+l/N.avgNetMargin*25+e/g/N.revenuePerEmployee*25)},M=[],A=S(),F=C();A.unlock90Days>5e4&&M.push({type:"opportunity",title:"Quick Win Cash Unlock",message:`Potential to unlock £${(A.unlock90Days/1e3).toFixed(0)}K in working capital within 90 days`,impact:A.unlock90Days}),A.unlock365Days>2e5&&M.push({type:"strategic",title:"12-Month Improvement Opportunity",message:`12-month cash flow improvement of £${(A.unlock365Days/1e3).toFixed(0)}K without new debt`,impact:A.unlock365Days}),D.debtorDaysVsBenchmark>5&&M.push({type:"improvement",title:"Collection Process Enhancement",message:`Debtor days ${Math.round(D.debtorDaysVsBenchmark)} days above industry average - opportunity to improve collections`,impact:p*D.debtorDaysVsBenchmark}),F.totalGrowthFunding>0&&M.push({type:"planning",title:"Growth Funding Requirement",message:`£${(F.totalGrowthFunding/1e3).toFixed(0)}K funding needed to support ${m}% growth target`,impact:F.totalGrowthFunding});const _={cashRequirements:{days30:b(30),days60:b(60),days90:b(90),days120:b(120),days180:b(180)},currentOperations:{currentWorkingCapital:k,optimalWorkingCapital:f,cashInjectionNeeded:w,workingCapitalRatio:(k/e*100).toFixed(1),liquidityStatus:c>w?"healthy":"needs_attention"},growthFunding:F,optimization:A,benchmarkAnalysis:D,talkingPoints:M,keyMetrics:{currentRatio:((t+i+c)/n).toFixed(2),quickRatio:((t+c)/n).toFixed(2),workingCapitalTurnover:(e/k).toFixed(2),daysWorkingCapital:(k/p).toFixed(0)}};u(_)}catch(e){g("Failed to calculate working capital metrics")}finally{h(!1)}};e.useEffect(()=>{b()},[]);const k=e=>e>=1e6?`£${(e/1e6).toFixed(2)}M`:e>=1e3?`£${(e/1e3).toFixed(0)}K`:`£${e.toFixed(0)}`;return s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-6 text-white",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-3xl font-bold flex items-center",children:[s.jsx(t,{className:"w-8 h-8 mr-3"}),"Working Capital & Cash Flow Expert"]}),s.jsx("p",{className:"mt-2 text-blue-100",children:"Answer your three core cash management questions with real-time data"})]}),s.jsxs("button",{onClick:b,className:"bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-blue-50 flex items-center",children:[s.jsx(n,{className:"w-5 h-5 mr-2"}),"Recalculate"]})]})}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Input Parameters"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Annual Revenue (£)"}),s.jsx("input",{type:"number",value:v.annualRevenue,onChange:e=>N("annualRevenue",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Debtor Days (DSO)"}),s.jsx("input",{type:"number",value:v.averageDebtorDays,onChange:e=>N("averageDebtorDays",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Creditor Days (DPO)"}),s.jsx("input",{type:"number",value:v.averageCreditorDays,onChange:e=>N("averageCreditorDays",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Current Debtors (£)"}),s.jsx("input",{type:"number",value:v.currentDebtors,onChange:e=>N("currentDebtors",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Current Creditors (£)"}),s.jsx("input",{type:"number",value:v.currentCreditors,onChange:e=>N("currentCreditors",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Gross Margin (%)"}),s.jsx("input",{type:"number",value:v.grossMargin,onChange:e=>N("grossMargin",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Net Margin (%)"}),s.jsx("input",{type:"number",value:v.netMargin,onChange:e=>N("netMargin",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Current Cash (£)"}),s.jsx("input",{type:"number",value:v.currentCashOnHand,onChange:e=>N("currentCashOnHand",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Industry"}),s.jsxs("select",{value:v.industry,onChange:e=>N("industry",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500",children:[s.jsx("option",{value:"manufacturing",children:"Manufacturing"}),s.jsx("option",{value:"retail",children:"Retail"}),s.jsx("option",{value:"services",children:"Services"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Growth Rate (%)"}),s.jsx("input",{type:"number",value:v.expectedGrowthRate,onChange:e=>N("expectedGrowthRate",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"})]})]})]}),x&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center",children:[s.jsx(i,{className:"w-6 h-6 mr-2 text-blue-600"}),"Core Question 1: How much cash do I need to cover expenses?"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:Object.entries(x.cashRequirements).map(([e,a])=>{const t=e.replace("days",""),n=a.currentSurplus>0;return s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[s.jsxs("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:[t," Days"]}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:k(a.recommendedCash)}),s.jsx("div",{className:"text-sm mt-2 flex items-center "+(n?"text-green-600":"text-red-600"),children:n?s.jsxs(s.Fragment,{children:[s.jsx(r,{className:"w-4 h-4 mr-1"}),"Surplus: ",k(a.currentSurplus)]}):s.jsxs(s.Fragment,{children:[s.jsx(l,{className:"w-4 h-4 mr-1"}),"Shortfall: ",k(Math.abs(a.currentSurplus))]})})]},e)})})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center",children:[s.jsx(c,{className:"w-6 h-6 mr-2 text-purple-600"}),"Core Question 2: Do I need cash injection for current operations?"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Current Working Capital"}),s.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:k(x.currentOperations.currentWorkingCapital)}),s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[x.currentOperations.workingCapitalRatio,"% of revenue"]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Optimal Working Capital"}),s.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:k(x.currentOperations.optimalWorkingCapital)}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"15% of annual revenue"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Cash Injection Needed"}),s.jsx("div",{className:"text-3xl font-bold "+(x.currentOperations.cashInjectionNeeded>0?"text-red-600":"text-green-600"),children:k(x.currentOperations.cashInjectionNeeded)}),s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Status: ","healthy"===x.currentOperations.liquidityStatus?"Healthy":"Needs Attention"]})]})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center",children:[s.jsx(d,{className:"w-6 h-6 mr-2 text-green-600"}),"Core Question 3: How much funding for ",v.expectedGrowthRate,"% growth?"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Target Revenue"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:k(x.growthFunding.targetRevenue)}),s.jsxs("div",{className:"text-sm text-green-600 mt-1",children:["+",k(x.growthFunding.revenueIncrease)]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Working Capital Need"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:k(x.growthFunding.growthWorkingCapital)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Ramp-up Costs"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:k(x.growthFunding.rampUpCosts)})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"Total Growth Funding"}),s.jsx("div",{className:"text-3xl font-bold text-purple-600",children:k(x.growthFunding.totalGrowthFunding)}),s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Investment required"})]})]})]}),s.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900 dark:to-blue-900 rounded-lg p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center",children:[s.jsx(o,{className:"w-6 h-6 mr-2 text-green-600"}),"Working Capital Optimization Levers"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-3",children:"Cash Unlock Timeline"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 rounded-lg p-3",children:[s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"90 Days"}),s.jsx("span",{className:"font-bold text-green-600",children:k(x.optimization.unlock90Days)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 rounded-lg p-3",children:[s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"180 Days"}),s.jsx("span",{className:"font-bold text-green-600",children:k(x.optimization.unlock180Days)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 rounded-lg p-3",children:[s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"365 Days"}),s.jsx("span",{className:"font-bold text-green-600",children:k(x.optimization.unlock365Days)})]})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-3",children:"Improvement Actions"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 rounded-lg p-3",children:[s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Reduce Debtor Days"}),s.jsx("span",{className:"font-bold text-blue-600",children:k(x.optimization.debtorImprovement)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 rounded-lg p-3",children:[s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Extend Creditor Days"}),s.jsx("span",{className:"font-bold text-blue-600",children:k(x.optimization.creditorImprovement)})]}),s.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 rounded-lg p-3",children:[s.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Optimize Inventory"}),s.jsx("span",{className:"font-bold text-blue-600",children:k(x.optimization.inventoryReduction)})]})]})]})]}),s.jsx("div",{className:"mt-4 bg-white dark:bg-gray-800 rounded-lg p-4",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cash Conversion Cycle"}),s.jsxs("div",{className:"font-bold text-gray-900 dark:text-white",children:["Current: ",Math.round(x.optimization.cashConversionCycleCurrent)," days"]})]}),s.jsx(d,{className:"w-8 h-8 text-green-500"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Optimized"}),s.jsxs("div",{className:"font-bold text-green-600",children:[Math.round(x.optimization.cashConversionCycleOptimized)," days"]})]})]})})]}),x.talkingPoints&&x.talkingPoints.length>0&&s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center",children:[s.jsx(m,{className:"w-6 h-6 mr-2 text-purple-600"}),"Board-Ready Talking Points"]}),s.jsx("div",{className:"space-y-3",children:x.talkingPoints.map((e,a)=>s.jsx("div",{className:"p-4 rounded-lg border-l-4 "+("opportunity"===e.type?"bg-green-50 border-green-500 dark:bg-green-900":"strategic"===e.type?"bg-blue-50 border-blue-500 dark:bg-blue-900":"improvement"===e.type?"bg-yellow-50 border-yellow-500 dark:bg-yellow-900":"bg-purple-50 border-purple-500 dark:bg-purple-900"),children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.title}),s.jsx("p",{className:"text-gray-700 dark:text-gray-300 mt-1",children:e.message})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Impact"}),s.jsx("div",{className:"font-bold text-gray-900 dark:text-white",children:k(e.impact)})]})]})},a))})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[s.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Key Performance Metrics"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Current Ratio"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:x.keyMetrics.currentRatio})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Quick Ratio"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:x.keyMetrics.quickRatio})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"WC Turnover"}),s.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[x.keyMetrics.workingCapitalTurnover,"x"]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Days WC"}),s.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:x.keyMetrics.daysWorkingCapital})]})]})]})]}),a&&s.jsx("div",{className:"flex justify-center items-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"})}),j&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(l,{className:"w-5 h-5 text-red-600 mr-2"}),s.jsx("p",{className:"text-red-800",children:j})]})})]})},D=()=>{const[a,t]=e.useState("overview"),[n,r]=e.useState(!0),[c,o]=e.useState(null);e.useEffect(()=>{(async()=>{try{r(!0);const e=await fetch("/api/working-capital/overview");if(e.ok){const s=await e.json();o(s)}else o(null)}catch(e){o(null)}finally{r(!1)}})()},[]);const j=[{id:"overview",label:"Overview",icon:m},{id:"expert",label:"Expert Calculator",icon:i},{id:"projections",label:"Cash Flow",icon:d},{id:"scenarios",label:"What-If Analysis",icon:x},{id:"policies",label:"Policies",icon:u},{id:"diagnostics",label:"Diagnostics",icon:l}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Working Capital Management"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Comprehensive financial analysis and optimization tools"})]}),s.jsx("div",{className:"flex items-center space-x-4",children:s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last updated"}),s.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[s.jsx(h,{className:"w-4 h-4 mr-1"}),c.lastUpdated]})]})})]}),n?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map((e,a)=>s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),s.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]})},a))}):c?s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:s.jsx(i,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Current Working Capital"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["£",((c.current||0)/1e6).toFixed(2),"M"]}),s.jsxs("div",{className:"flex items-center mt-1",children:[s.jsx(d,{className:"w-4 h-4 text-green-500 mr-1"}),s.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:c.trend||"N/A"})]})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:s.jsx(d,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Projected (30 days)"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["£",((c.projected||0)/1e6).toFixed(2),"M"]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:["+£",(((c.projected||0)-(c.current||0))/1e3).toFixed(0),"K improvement"]})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900 rounded-lg",children:s.jsx(m,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Optimization Potential"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[c.optimizationPct||"0","%"]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:["£",((c.current||0)*((c.optimizationPct||0)/100)/1e3).toFixed(0),"K available"]})]})]})})]}):s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Unable to load working capital data. Please check your API connection."})}),c?.alerts&&c.alerts.length>0&&s.jsx("div",{className:"space-y-3",children:c.alerts.map((e,a)=>s.jsx("div",{className:"p-4 rounded-lg border-l-4 "+("warning"===e.type?"bg-yellow-50 border-yellow-400 dark:bg-yellow-900/20 dark:border-yellow-600":"bg-blue-50 border-blue-400 dark:bg-blue-900/20 dark:border-blue-600"),children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(l,{className:"w-5 h-5 mr-3 "+("warning"===e.type?"text-yellow-600":"text-blue-600")}),s.jsx("p",{className:"text-sm "+("warning"===e.type?"text-yellow-800 dark:text-yellow-200":"text-blue-800 dark:text-blue-200"),children:e.message})]})},a))}),s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:j.map(e=>{const n=e.icon;return s.jsxs("button",{onClick:()=>t(e.id),className:"flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 "+(a===e.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[s.jsx(n,{className:"w-4 h-4 mr-2"}),e.label]},e.id)})})}),s.jsxs("div",{className:"mt-6",children:["overview"===a&&s.jsx(N,{data:c}),"expert"===a&&s.jsx(S,{}),"projections"===a&&s.jsx(b,{}),"scenarios"===a&&s.jsx(k,{}),"policies"===a&&s.jsx(f,{}),"diagnostics"===a&&s.jsx(C,{})]})]})};export{D as default};
