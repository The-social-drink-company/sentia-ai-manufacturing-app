import{r as p,z as K,B as z,C as M,j as e,R as Y,D as Z,E as ee,G as B,o as H,H as X,I as R,w as W,y as te,J as ae,K as re,N as se,L as V,M as Q,O as ne,Q as oe,S as ie,T as ce}from"./react-vendor-CbFVVgBZ.js";import{l as q,a as le,d as de}from"./feature-executive-C_mMYejW.js";const me=p.createContext(null);function ue(){const l=p.useContext(me);if(!l)throw new Error("useAuthContext must be used within an AuthProvider");return l}function J(){return ue()}const S={DATA_VIEW:"data_view",DATA_EXPORT:"data_export",DATA_REFRESH:"data_refresh",DASHBOARD_ACCESS:"dashboard_access",FORECAST_GENERATE:"forecast_generate",RISK_ASSESS:"risk_assess",RECOMMENDATION_VIEW:"recommendation_view",RECOMMENDATION_ACTION:"recommendation_action",SETTINGS_UPDATE:"settings_update",ERROR_OCCURRED:"error_occurred",PERFORMANCE_ISSUE:"performance_issue",API_FAILURE:"api_failure"},j={INFO:"info",WARNING:"warning",ERROR:"error",CRITICAL:"critical"},v={SOX:"sox",GDPR:"gdpr",ISO27001:"iso27001",INTERNAL:"internal"};class xe{constructor(){this.sessionId=this.generateSessionId(),this.userId=null,this.userRole=null,this.auditQueue=[],this.batchSize=10,this.flushInterval=3e4,this.maxRetries=3,this.startPeriodicFlush(),typeof window<"u"&&window.addEventListener("beforeunload",()=>{this.flush(!0)})}setUserContext(a){this.userId=a?.id||"anonymous",this.userRole=a?.role||"unknown",this.logEvent(S.DASHBOARD_ACCESS,{action:"session_start",userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",timestamp:new Date().toISOString()},j.INFO)}generateSessionId(){return`wc_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}logEvent(a,t={},r=j.INFO,s=[]){const o={id:this.generateAuditId(),sessionId:this.sessionId,userId:this.userId,userRole:this.userRole,eventType:a,severity:r,timestamp:new Date().toISOString(),ipAddress:this.getClientIP(),userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",url:typeof window<"u"?window.location.href:"unknown",details:this.sanitizeDetails(t),compliance:Array.isArray(s)?s:[s].filter(Boolean),moduleContext:"working_capital"};return this.auditQueue.push(o),this.auditQueue.length>=this.batchSize&&this.flush(),o.id}generateAuditId(){return`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getClientIP(){return"client_side_unknown"}sanitizeDetails(a){const t={...a};return["password","token","apiKey","secret","ssn","creditCard","bankAccount","personalData"].forEach(s=>{t[s]&&(t[s]="[REDACTED]")}),t.email&&typeof t.email=="string"&&(t.email=this.maskEmail(t.email)),Object.keys(t).forEach(s=>{typeof t[s]=="string"&&t[s].length>1e3&&(t[s]=t[s].substring(0,1e3)+"...[TRUNCATED]")}),t}maskEmail(a){const[t,r]=a.split("@");return!t||!r?"[MASKED_EMAIL]":`${t.length>2?t[0]+"*".repeat(t.length-2)+t[t.length-1]:"*".repeat(t.length)}@${r}`}async flush(a=!1){if(this.auditQueue.length===0)return;const t=[...this.auditQueue];this.auditQueue=[];try{const r={batch:t,batchId:this.generateAuditId(),timestamp:new Date().toISOString(),source:"working_capital_frontend"};a?typeof navigator<"u"&&navigator.sendBeacon&&navigator.sendBeacon("/api/audit/log",JSON.stringify(r)):await this.sendAuditBatch(r)}catch(r){q("Failed to flush audit logs",r),t.forEach(s=>{s.retryCount=(s.retryCount||0)+1,s.retryCount<=this.maxRetries&&this.auditQueue.unshift(s)})}}async sendAuditBatch(a){const t=await fetch("/api/audit/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)throw new Error(`Audit logging failed: ${t.status} ${t.statusText}`);return t.json()}startPeriodicFlush(){typeof window<"u"&&(this.flushTimer=setInterval(()=>{this.flush()},this.flushInterval))}stopPeriodicFlush(){this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null)}getAuditStats(){return{sessionId:this.sessionId,queueLength:this.auditQueue.length,userId:this.userId,userRole:this.userRole,batchSize:this.batchSize,flushInterval:this.flushInterval}}destroy(){this.stopPeriodicFlush(),this.flush(!0),typeof window<"u"&&window.removeEventListener("beforeunload",this.flush)}}const I=new xe,f={initialize(l){I.setUserContext(l)},logDashboardAccess(l={}){return I.logEvent(S.DASHBOARD_ACCESS,{...l,module:"working_capital"},j.INFO,[v.SOX,v.INTERNAL])},logDataExport(l,a={}){return I.logEvent(S.DATA_EXPORT,{format:l,...a,dataTypes:["financial_metrics","cash_flow","recommendations"],exportTimestamp:new Date().toISOString()},j.INFO,[v.SOX,v.GDPR,v.INTERNAL])},logForecastGeneration(l,a={}){return I.logEvent(S.FORECAST_GENERATE,{forecastType:l,periods:a.periods,scenarios:a.scenarios,confidence:a.confidence,methodology:a.methodology||"monte_carlo"},j.INFO,[v.SOX,v.INTERNAL])},logRecommendationAction(l,a,t={}){return I.logEvent(S.RECOMMENDATION_ACTION,{recommendationId:l,action:a,potentialImpact:t.potentialImpact,priority:t.priority,category:t.category,...t},j.INFO,[v.SOX,v.INTERNAL])},logSettingsUpdate(l,a,t,r={}){return I.logEvent(S.SETTINGS_UPDATE,{setting:l,oldValue:typeof a=="object"?"[OBJECT]":String(a),newValue:typeof t=="object"?"[OBJECT]":String(t),changeReason:r.reason,...r},j.WARNING,[v.SOX,v.ISO27001,v.INTERNAL])},logError(l,a={}){return I.logEvent(S.ERROR_OCCURRED,{errorMessage:l.message,errorStack:l.stack,errorType:l.constructor.name,context:a,timestamp:new Date().toISOString()},j.ERROR,[v.ISO27001,v.INTERNAL])},logAPIFailure(l,a,t,r={}){return I.logEvent(S.API_FAILURE,{endpoint:l,statusCode:a,errorMessage:t?.message,responseTime:r.responseTime,retryAttempt:r.retryAttempt,...r},a>=500?j.CRITICAL:j.ERROR,[v.ISO27001,v.INTERNAL])},logPerformanceIssue(l,a,t,r={}){return I.logEvent(S.PERFORMANCE_ISSUE,{metric:l,value:a,threshold:t,impact:a>t?"exceeded":"warning",...r},a>t*2?j.CRITICAL:j.WARNING,[v.INTERNAL])},logRiskAssessment(l,a,t={}){return I.logEvent(S.RISK_ASSESS,{riskLevel:l,totalRisks:a.length,criticalRisks:a.filter(r=>r.severity==="critical").length,riskTypes:a.map(r=>r.type),assessmentMethod:t.method||"automated",...t},l==="critical"?j.CRITICAL:j.INFO,[v.SOX,v.INTERNAL])},logDataRefresh(l,a={}){return I.logEvent(S.DATA_REFRESH,{source:l,refreshType:a.type||"manual",dataAge:a.dataAge,recordsUpdated:a.recordsUpdated,...a},j.INFO,[v.INTERNAL])},logEvent(l,a,t,r){return I.logEvent(l,a,t,r)},flush(){return I.flush()},getStats(){return I.getAuditStats()},destroy(){I.destroy()}};var G={};const A={baseURL:"https://api.xero.com/api.xro/2.0",authURL:"https://identity.xero.com/connect/authorize",tokenURL:"https://identity.xero.com/connect/token",clientId:G.VITE_XERO_CLIENT_ID,clientSecret:G.XERO_CLIENT_SECRET,redirectURI:`${window.location.origin}/auth/xero/callback`,scopes:["accounting.transactions","accounting.contacts","accounting.settings","accounting.reports.read"]};class he{constructor(){this.accessToken=localStorage.getItem("xero_access_token"),this.refreshToken=localStorage.getItem("xero_refresh_token"),this.tokenExpiry=localStorage.getItem("xero_token_expiry"),this.tenantId=localStorage.getItem("xero_tenant_id"),this.isConnected=!1,this.retryCount=0,this.maxRetries=3,this.checkConnectionStatus()}checkConnectionStatus(){const a=this.accessToken&&this.tokenExpiry&&new Date(this.tokenExpiry)>new Date;return this.isConnected=a&&this.tenantId,f.logEvent("xero_connection_check",{hasToken:!!this.accessToken,hasRefreshToken:!!this.refreshToken,hasValidExpiry:a,hasTenant:!!this.tenantId,isConnected:this.isConnected}),this.isConnected}getAuthorizationURL(a=null){const t=a||Math.random().toString(36).substring(2,15);localStorage.setItem("xero_oauth_state",t);const r=new URLSearchParams({response_type:"code",client_id:A.clientId,redirect_uri:A.redirectURI,scope:A.scopes.join(" "),state:t}),s=`${A.authURL}?${r.toString()}`;return f.logEvent("xero_auth_url_generated",{redirectURI:A.redirectURI,scopes:A.scopes,state:t}),s}async exchangeCodeForTokens(a,t){const r=localStorage.getItem("xero_oauth_state");if(t!==r)throw new Error("Invalid OAuth state parameter");try{const s={grant_type:"authorization_code",client_id:A.clientId,code:a,redirect_uri:A.redirectURI},o=await fetch(A.tokenURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${A.clientId}:${A.clientSecret}`)}`},body:new URLSearchParams(s)});if(!o.ok)throw new Error(`Token exchange failed: ${o.status}`);const i=await o.json();return this.storeTokens(i),await this.fetchConnections(),f.logEvent("xero_token_exchange_success",{hasAccessToken:!!i.access_token,hasRefreshToken:!!i.refresh_token,expiresIn:i.expires_in}),i}catch(s){throw f.logError(s,{action:"xero_token_exchange",code:a?.substring(0,10)+"..."}),s}}storeTokens(a){this.accessToken=a.access_token,this.refreshToken=a.refresh_token,this.tokenExpiry=new Date(Date.now()+a.expires_in*1e3).toISOString(),localStorage.setItem("xero_access_token",this.accessToken),localStorage.setItem("xero_refresh_token",this.refreshToken),localStorage.setItem("xero_token_expiry",this.tokenExpiry),this.isConnected=!0}async refreshAccessToken(){if(!this.refreshToken)throw new Error("No refresh token available");try{const a={grant_type:"refresh_token",refresh_token:this.refreshToken},t=await fetch(A.tokenURL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Basic ${btoa(`${A.clientId}:${A.clientSecret}`)}`},body:new URLSearchParams(a)});if(!t.ok)throw new Error(`Token refresh failed: ${t.status}`);const r=await t.json();return this.storeTokens(r),f.logEvent("xero_token_refresh_success",{newExpiresIn:r.expires_in}),r}catch(a){throw f.logError(a,{action:"xero_token_refresh"}),this.clearTokens(),a}}async fetchConnections(){try{const a=await this.makeAPIRequest("https://api.xero.com/connections","GET");return a.length>0&&(this.tenantId=a[0].tenantId,localStorage.setItem("xero_tenant_id",this.tenantId),localStorage.setItem("xero_tenant_name",a[0].tenantName),f.logEvent("xero_connections_fetched",{tenantCount:a.length,tenantId:this.tenantId,tenantName:a[0].tenantName})),a}catch(a){throw f.logError(a,{action:"xero_fetch_connections"}),a}}async makeAPIRequest(a,t="GET",r=null){if(!this.isConnected)throw new Error("Xero not connected. Please authenticate first.");new Date(this.tokenExpiry)<=new Date&&await this.refreshAccessToken();const s=a.startsWith("http")?a:`${A.baseURL}/${a}`,o={method:t,headers:{Authorization:`Bearer ${this.accessToken}`,"Xero-tenant-id":this.tenantId,Accept:"application/json","Content-Type":"application/json"}};r&&(t==="POST"||t==="PUT")&&(o.body=JSON.stringify(r));try{const i=performance.now(),u=await fetch(s,o),n=performance.now()-i;if(!u.ok){if(u.status===401&&this.retryCount<this.maxRetries)return this.retryCount++,f.logEvent("xero_401_retry_attempt",{retryCount:this.retryCount,endpoint:s}),await this.refreshAccessToken(),this.makeAPIRequest(a,t,r);const g=await u.text();throw new Error(`Xero API error: ${u.status} - ${g}`)}const h=await u.json();return this.retryCount=0,f.logEvent("xero_api_success",{endpoint:s,method:t,statusCode:u.status,responseTime:Math.round(n),dataSize:JSON.stringify(h).length}),h}catch(i){throw f.logError(i,{action:"xero_api_request",endpoint:s,method:t,retryCount:this.retryCount}),i}}clearTokens(){this.accessToken=null,this.refreshToken=null,this.tokenExpiry=null,this.tenantId=null,this.isConnected=!1,localStorage.removeItem("xero_access_token"),localStorage.removeItem("xero_refresh_token"),localStorage.removeItem("xero_token_expiry"),localStorage.removeItem("xero_tenant_id"),localStorage.removeItem("xero_tenant_name"),f.logEvent("xero_tokens_cleared",{reason:"user_logout_orerror"})}async getAccountsReceivable(a={}){try{const t=new URLSearchParams({where:'Status=="AUTHORISED"',order:"DueDateString DESC",...a.queryParams}),r=await this.makeAPIRequest(`Invoices?${t}`),s=this.processARData(r.Invoices||[]);return f.logEvent("xero_ar_data_fetched",{invoiceCount:r.Invoices?.length||0,totalOutstanding:s.total,overdueAmount:s.overdue}),s}catch(t){throw f.logError(t,{action:"fetch_accounts_receivable"}),t}}async getAccountsPayable(a={}){try{const t=new URLSearchParams({where:'Status=="AUTHORISED" AND Type=="ACCPAY"',order:"DueDateString DESC",...a.queryParams}),r=await this.makeAPIRequest(`Invoices?${t}`),s=this.processAPData(r.Invoices||[]);return f.logEvent("xero_ap_data_fetched",{billCount:r.Invoices?.length||0,totalOutstanding:s.total,discountsAvailable:s.discountsAvailable}),s}catch(t){throw f.logError(t,{action:"fetch_accounts_payable"}),t}}async getCashAccounts(){try{const a=await this.makeAPIRequest('Accounts?where=Type=="BANK"'),t={totalCash:0,accounts:[],lastUpdated:new Date().toISOString()};return a.Accounts&&(t.accounts=a.Accounts.map(r=>({id:r.AccountID,name:r.Name,balance:parseFloat(r.BankAccountNumber)||0,type:r.BankAccountType,currency:r.CurrencyCode})),t.totalCash=t.accounts.reduce((r,s)=>r+s.balance,0)),f.logEvent("xero_cash_data_fetched",{accountCount:t.accounts.length,totalCash:t.totalCash}),t}catch(a){throw f.logError(a,{action:"fetch_cash_accounts"}),a}}async getProfitLossReport(a=12){try{const t=new Date;t.setMonth(t.getMonth()-a);const r=new URLSearchParams({fromDate:t.toISOString().split("T")[0],toDate:new Date().toISOString().split("T")[0],periods:a,timeframe:"MONTH"}),s=await this.makeAPIRequest(`Reports/ProfitAndLoss?${r}`);return f.logEvent("xero_pl_report_fetched",{periods:a,reportDate:s.ReportDate,hasData:!!s.Reports?.[0]}),this.processPLReport(s)}catch(t){throw f.logError(t,{action:"fetch_profit_loss_report"}),t}}async getBalanceSheet(){try{const a=await this.makeAPIRequest("Reports/BalanceSheet");return f.logEvent("xero_balance_sheet_fetched",{reportDate:a.ReportDate,hasData:!!a.Reports?.[0]}),this.processBalanceSheet(a)}catch(a){throw f.logError(a,{action:"fetch_balance_sheet"}),a}}processARData(a){const t=new Date;let r=0,s=0;const o={current:0,"30days":0,"60days":0,"90days":0,"120plus":0},i=[];a.forEach(n=>{const h=parseFloat(n.AmountDue)||0,g=new Date(n.DueDateString),c=Math.floor((t-g)/(1e3*60*60*24));r+=h,c>0&&(s+=h),c<=0?o.current+=h:c<=30?o["30days"]+=h:c<=60?o["60days"]+=h:c<=90?o["90days"]+=h:o["120plus"]+=h,i.push({invoiceId:n.InvoiceID,invoiceNumber:n.InvoiceNumber,contactName:n.Contact?.Name,amount:h,dueDate:n.DueDateString,daysPastDue:c,status:n.Status})});const u=r>0?Math.round(r/(r/30)):0;return{total:Math.round(r*100)/100,overdue:Math.round(s*100)/100,dso:u,aging:o,receivables:i,count:a.length,lastUpdated:new Date().toISOString()}}processAPData(a){const t=new Date;let r=0,s=0;const o={current:0,"30days":0,"60days":0,"90days":0,"120plus":0},i=[];a.forEach(n=>{const h=parseFloat(n.AmountDue)||0,g=new Date(n.DueDateString),c=Math.floor((t-g)/(1e3*60*60*24));r+=h,c<-10&&(s+=h*.02),c<=0?o.current+=h:c<=30?o["30days"]+=h:c<=60?o["60days"]+=h:c<=90?o["90days"]+=h:o["120plus"]+=h,i.push({invoiceId:n.InvoiceID,invoiceNumber:n.InvoiceNumber,contactName:n.Contact?.Name,amount:h,dueDate:n.DueDateString,daysPastDue:c,status:n.Status})});const u=r>0?Math.round(r/(r/30)):0;return{total:Math.round(r*100)/100,discountsAvailable:Math.round(s*100)/100,dpo:u,aging:o,payables:i,count:a.length,lastUpdated:new Date().toISOString()}}processPLReport(a){const t=a.Reports?.[0];if(!t)return null;const r=t.Rows||[],s=this.extractSectionValue(r,"Revenue"),o=this.extractSectionValue(r,"Expenses"),i=s-o;return{revenue:s,expenses:o,netIncome:i,grossMargin:s>0?(s-o)/s*100:0,reportPeriod:t.ReportTitles?.[1]||"Current Period",lastUpdated:new Date().toISOString()}}processBalanceSheet(a){const t=a.Reports?.[0];if(!t)return null;const r=t.Rows||[],s=this.extractSectionValue(r,"Current Assets"),o=this.extractSectionValue(r,"Current Liabilities"),i=s-o;return{currentAssets:s,currentLiabilities:o,workingCapital:i,currentRatio:o>0?s/o:0,reportDate:t.ReportDate,lastUpdated:new Date().toISOString()}}extractSectionValue(a,t){const r=a.find(s=>s.Title?.includes(t));return!r||!r.Rows?0:r.Rows.reduce((s,o)=>{const i=o.Cells?.[1]?.Value;return s+(parseFloat(i)||0)},0)}getConnectionStatus(){return{isConnected:this.isConnected,tenantId:this.tenantId,tenantName:localStorage.getItem("xero_tenant_name"),tokenExpiry:this.tokenExpiry,lastCheck:new Date().toISOString()}}disconnect(){this.clearTokens(),f.logEvent("xero_disconnected",{reason:"user_initiated"})}}const E=new he,F=l=>{const{user:a}=J(),t=p.useRef(Date.now()),r=p.useRef([]);p.useEffect(()=>(a&&(f.initialize(a),f.logEvent(S.DATA_VIEW,{component:componentName,accessTime:new Date().toISOString(),userRole:a.role},j.INFO,[v.INTERNAL])),()=>{const d=Date.now()-t.current;f.logEvent(S.DATA_VIEW,{component:componentName,action:"component_unmount",sessionDuration:Math.round(d/1e3),totalActions:r.current.length,actionsPerformed:r.current},j.INFO,[v.INTERNAL])}),[a,componentName]);const s=p.useCallback((d,m={})=>{const y=f.logEvent(d,{component:componentName,timestamp:new Date().toISOString(),...m},j.INFO,[v.INTERNAL]);return r.current.push({action:d,timestamp:new Date().toISOString(),details:m}),y},[componentName]),o=p.useCallback((d,m={})=>f.logEvent(S.DATA_VIEW,{component:componentName,dataType:d,accessMethod:m.method||"user_initiated",filters:m.filters,period:m.period,...m},j.INFO,[v.SOX,v.INTERNAL]),[componentName]),i=p.useCallback((d,m={})=>f.logDataExport(d,{component:componentName,includeForecasts:m.includeForecasts,includeRecommendations:m.includeRecommendations,dateRange:m.dateRange,recordCount:m.recordCount,fileSize:m.fileSize,...m}),[componentName]),u=p.useCallback((d,m,y,k="")=>f.logSettingsUpdate(d,m,y,{component:componentName,reason:k,userInitiated:!0}),[componentName]),n=p.useCallback((d,m={})=>f.logError(d,{component:componentName,userAction:m.action,inputData:m.inputData,timestamp:new Date().toISOString(),...m}),[componentName]),h=p.useCallback((d,m,y,k={})=>f.logPerformanceIssue(d,m,y,{component:componentName,measurement:k.measurement||"milliseconds",userAction:k.action,...k}),[componentName]),g=p.useCallback((d,m={})=>f.logForecastGeneration(d,{component:componentName,userInitiated:!0,...m}),[componentName]),c=p.useCallback((d,m,y={})=>f.logRecommendationAction(d,m,{component:componentName,userInitiated:!0,timestamp:new Date().toISOString(),...y}),[componentName]),N=p.useCallback((d,m,y,k={})=>{const C=y>=400?S.API_FAILURE:S.DATA_VIEW,T=y>=500?j.CRITICAL:y>=400?j.ERROR:j.INFO;return f.logEvent(C,{component:componentName,endpoint:d,method:m,statusCode:y,responseTime:k.responseTime,requestSize:k.requestSize,responseSize:k.responseSize,...k},T,[v.ISO27001,v.INTERNAL])},[componentName]),w=p.useCallback(d=>{const m=`batch_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return d.forEach((y,k)=>{f.logEvent(y.eventType,{component:componentName,batchId:m,batchIndex:k,batchSize:d.length,...y.details},y.severity||j.INFO,y.compliance||[v.INTERNAL])}),m},[componentName]),x=p.useCallback(()=>({component:componentName,sessionDuration:Date.now()-t.current,totalActions:r.current.length,lastAction:r.current[r.current.length-1],...f.getStats()}),[componentName]);return{trackAction:s,logDataAccess:o,logExport:i,logConfigChange:u,logError:n,logPerformance:h,logForecastGeneration:g,logRecommendationAction:c,logAPICall:N,logBatch:w,getAuditStats:x,flush:f.flush}},ge=()=>{const l=F(),a=p.useCallback((i,u)=>l.logPerformance("dashboard_load_time",i,3e3,{action:"dashboard_load",dataPoints,measurement:"milliseconds"}),[l]),t=p.useCallback((i,u)=>l.logConfigChange("reporting_period",i,newPeriod,"user_selection"),[l]),r=p.useCallback((i,u)=>l.logConfigChange("display_currency",i,newCurrency,"user_selection"),[l]),s=p.useCallback((i,u)=>f.logDataRefresh(i,{component:"WorkingCapitalDashboard",type:"manual",recordsUpdated,timestamp:new Date().toISOString()}),[]),o=p.useCallback((i,u)=>l.trackAction(S.RECOMMENDATION_VIEW,{alertId:i,alertAction:u,severity:"user_interaction"}),[l]);return{...l,logDashboardLoad:a,logPeriodChange:t,logCurrencyChange:r,logMetricRefresh:s,logAlertInteraction:o}},$=()=>{const[l,a]=p.useState(E.getConnectionStatus()),[t,r]=p.useState(!1),s=K(),o=F(),i=p.useRef(null);p.useEffect(()=>{const c=()=>{const N=E.getConnectionStatus();a(N),o.logDataAccess("xero_connection_status",{isConnected:N.isConnected})};return c(),i.current=setInterval(c,300*1e3),()=>{i.current&&clearInterval(i.current)}},[o]);const u=z({mutationFn:async({code:c,state:N})=>{r(!0),o.trackAction("xero_authentication_attempt",{hasCode:!!c});try{const w=await E.exchangeCodeForTokens(c,N),x=E.getConnectionStatus();return a(x),o.trackAction("xero_authentication_success",{tenantId:x.tenantId,tenantName:x.tenantName}),s.invalidateQueries({queryKey:["working-capital"]}),s.invalidateQueries({queryKey:["xero"]}),w}finally{r(!1)}},onError:c=>{r(!1),o.logError(c,{action:"xero_authentication"})}}),n=z({mutationFn:async()=>{o.trackAction("xero_disconnect_attempt"),E.disconnect();const c=E.getConnectionStatus();a(c),s.removeQueries({queryKey:["xero"]}),s.invalidateQueries({queryKey:["working-capital"]}),o.trackAction("xero_disconnect_success")},onError:c=>{o.logError(c,{action:"xero_disconnect"})}}),h=p.useCallback(()=>{const c=E.getAuthorizationURL();return o.trackAction("xero_auth_url_generated",{url:c}),c},[o]),g=p.useCallback(()=>{const c=h();window.location.href=c},[h]);return{connectionStatus:l,isConnected:l.isConnected,isAuthenticating:t,authenticate:u.mutate,disconnect:n.mutate,getAuthUrl:h,startAuthFlow:g,isLoading:u.isPending||n.isPending}},pe=(l={})=>{const{isConnected:a}=$(),t=F();return M({queryKey:["xero","accounts-receivable",l],queryFn:async()=>{t.logDataAccess("accounts_receivable",{source:"xero_api"});const r=performance.now();try{const s=await E.getAccountsReceivable(l),o=performance.now()-r;return t.logPerformance("ar_data_fetch",o,5e3,{recordCount:s.count,totalAmount:s.total}),s}catch(s){throw t.logError(s,{action:"fetch_ar_data"}),s}},enabled:a,staleTime:300*1e3,cacheTime:900*1e3,retry:(r,s)=>s.message?.includes("401")?!1:r<2,onError:r=>{t.logError(r,{query:"accounts_receivable"})}})},ye=(l={})=>{const{isConnected:a}=$(),t=F();return M({queryKey:["xero","accounts-payable",l],queryFn:async()=>{t.logDataAccess("accounts_payable",{source:"xero_api"});const r=performance.now();try{const s=await E.getAccountsPayable(l),o=performance.now()-r;return t.logPerformance("ap_data_fetch",o,5e3,{recordCount:s.count,totalAmount:s.total}),s}catch(s){throw t.logError(s,{action:"fetch_ap_data"}),s}},enabled:a,staleTime:300*1e3,cacheTime:900*1e3,retry:(r,s)=>s.message?.includes("401")?!1:r<2,onError:r=>{t.logError(r,{query:"accounts_payable"})}})},fe=()=>{const{isConnected:l}=$(),a=F();return M({queryKey:["xero","cash-accounts"],queryFn:async()=>{a.logDataAccess("cash_accounts",{source:"xero_api"});const t=performance.now();try{const r=await E.getCashAccounts(),s=performance.now()-t;return a.logPerformance("cash_data_fetch",s,3e3,{accountCount:r.accounts?.length||0,totalCash:r.totalCash}),r}catch(r){throw a.logError(r,{action:"fetch_cash_data"}),r}},enabled:l,staleTime:600*1e3,cacheTime:1800*1e3,onError:t=>{a.logError(t,{query:"cash_accounts"})}})},be=()=>{const{isConnected:l}=$(),a=F();return M({queryKey:["xero","balance-sheet"],queryFn:async()=>{a.logDataAccess("balance_sheet",{source:"xero_api"});const t=performance.now();try{const r=await E.getBalanceSheet(),s=performance.now()-t;return a.logPerformance("balance_sheet_fetch",s,1e4,{hasData:!!r,workingCapital:r?.workingCapital||0}),r}catch(r){throw a.logError(r,{action:"fetch_balance_sheet"}),r}},enabled:l,staleTime:900*1e3,cacheTime:3600*1e3,onError:t=>{a.logError(t,{query:"balance_sheet"})}})},we=(l=12)=>{const{isConnected:a}=$(),t=F();return M({queryKey:["xero","profit-loss",l],queryFn:async()=>{t.logDataAccess("profit_loss",{source:"xero_api",periods:l});const r=performance.now();try{const s=await E.getProfitLossReport(l),o=performance.now()-r;return t.logPerformance("pl_report_fetch",o,15e3,{hasData:!!s,periods:l,revenue:s?.revenue||0}),s}catch(s){throw t.logError(s,{action:"fetch_profit_loss"}),s}},enabled:a,staleTime:1800*1e3,cacheTime:7200*1e3,onError:r=>{t.logError(r,{query:"profit_loss"})}})},ke=()=>{const{isConnected:l,connectionStatus:a}=$(),t=F(),r=pe(),s=ye(),o=fe(),i=be(),u=we(),n={isConnected:l,connectionStatus:a,isLoading:r.isLoading||s.isLoading||i.isLoading,isError:r.isError||s.isError||i.isError,error:r.error||s.error||i.error,accountsReceivable:r.data,accountsPayable:s.data,cashAccounts:o.data,balanceSheet:i.data,profitLoss:u.data,summary:null,receivables:null,payables:null,inventory:null,cashFlow:null};p.useEffect(()=>{if(r.data&&s.data&&i.data){const g={workingCapital:i.data.workingCapital,workingCapitalChange:0,currentRatio:i.data.currentRatio,currentRatioChange:0,quickRatio:i.data.currentRatio*.8,quickRatioChange:0,cashConversionCycle:r.data.dso+(s.data.dpo||30)-(s.data.dpo||30),cccChange:0};n.summary=g,n.receivables=r.data,n.payables=s.data,t.logDataAccess("working_capital_combined",{hasAR:!!r.data,hasAP:!!s.data,hasBalanceSheet:!!i.data,workingCapital:g.workingCapital})}},[r.data,s.data,i.data,t]);const h=p.useCallback(async()=>{t.trackAction("xero_data_refresh",{userInitiated:!0});const g=[r.refetch(),s.refetch(),i.refetch(),o.refetch(),u.refetch()];try{await Promise.all(g),t.trackAction("xero_data_refresh_success")}catch(c){throw t.logError(c,{action:"xero_data_refresh"}),c}},[r,s,i,o,u,t]);return{...n,refetch:h,lastUpdated:new Date().toISOString()}};function Ne(l="current"){const[a,t]=p.useState(null),[r,s]=p.useState(!0),[o,i]=p.useState(null),u=ke(),n=p.useCallback(()=>({summary:{workingCapital:45e4+Math.random()*1e5,workingCapitalChange:(Math.random()-.5)*20,cashConversionCycle:45+Math.random()*10,cccChange:(Math.random()-.5)*10,currentRatio:2.1+Math.random()*.5,currentRatioChange:(Math.random()-.5)*5,quickRatio:1.6+Math.random()*.3,quickRatioChange:(Math.random()-.5)*5},receivables:{total:285e3+Math.random()*5e4,dso:42+Math.random()*8,overdue:45e3+Math.random()*2e4,aging:{"0-30":18e4+Math.random()*3e4,"31-60":65e3+Math.random()*15e3,"61-90":25e3+Math.random()*1e4,"90+":15e3+Math.random()*8e3}},payables:{total:22e4+Math.random()*4e4,dpo:28+Math.random()*6,discountsAvailable:8500+Math.random()*3e3,aging:{"0-30":14e4+Math.random()*25e3,"31-60":5e4+Math.random()*12e3,"61-90":2e4+Math.random()*8e3,"90+":1e4+Math.random()*5e3}},inventory:{total:38e4+Math.random()*7e4,dio:32+Math.random()*8,turnoverRatio:11.2+Math.random()*2},cashFlow:{current:15e4+Math.random()*5e4,projected30:175e3+Math.random()*3e4,projected60:185e3+Math.random()*4e4,projected90:195e3+Math.random()*5e4,forecast:h()},recommendations:[{id:1,type:"receivables",priority:"high",title:"Accelerate Collections",description:"Reduce DSO by 5 days to unlock cash",impact:"$42,000",effort:"medium",timeframe:"2-3 weeks"},{id:2,type:"payables",priority:"medium",title:"Optimize Payment Terms",description:"Extend DPO by 3 days while capturing discounts",impact:"$18,500",effort:"low",timeframe:"1-2 weeks"},{id:3,type:"inventory",priority:"high",title:"Reduce Excess Stock",description:"Clear slow-moving inventory to improve turnover",impact:"$65,000",effort:"high",timeframe:"4-6 weeks"}],alerts:g(),cccHistory:[{month:"Jan",ccc:52},{month:"Feb",ccc:48},{month:"Mar",ccc:50},{month:"Apr",ccc:47},{month:"May",ccc:49},{month:"Jun",ccc:45+Math.random()*5}]}),[l]);function h(){const d=[],m=new Date;for(let y=0;y<90;y++){const k=new Date(m);k.setDate(k.getDate()+y);const C=12e3+Math.random()*8e3,T=9e3+Math.random()*6e3,O=k.getDay(),D=k.getDate();let b=C,_=T;(O===0||O===6)&&(b*=.3,_*=.2),D>=28&&(_*=1.5,b*=.8),D<=5&&(b*=1.3),d.push({date:k.toISOString().split("T")[0],inflow:Math.round(b),outflow:Math.round(_),netFlow:Math.round(b-_)})}return d}function g(){const d=[],m=42+Math.random()*8;return m>45&&d.push({id:1,severity:"warning",title:"High Days Sales Outstanding",description:`DSO is ${Math.round(m)} days, above target of 40 days`,action:"Review collections process"}),Math.random()>.7&&d.push({id:2,severity:"critical",title:"Cash Flow Projection Alert",description:"Projected cash shortfall in 45 days",action:"Accelerate collections or delay payments"}),Math.random()>.5&&d.push({id:3,severity:"info",title:"Early Payment Discounts Available",description:"$8,500 in potential savings from supplier discounts",action:"Review payment schedule"}),d}const c=p.useCallback(async()=>{s(!0),i(null);try{if(u.isConnected&&u.summary){const m={...u,alerts:g(),recommendations:[{id:1,type:"receivables",priority:"high",title:"Accelerate Collections",description:`DSO is ${u.receivables?.dso||0} days - consider early payment incentives`,impact:`$${Math.round((u.receivables?.overdue||0)*.1).toLocaleString()}`,effort:"medium",timeframe:"2-3 weeks"},{id:2,type:"payables",priority:"medium",title:"Optimize Payment Terms",description:`DPO is ${u.payables?.dpo||0} days - negotiate extended terms`,impact:`$${Math.round((u.payables?.discountsAvailable||0)*1.5).toLocaleString()}`,effort:"low",timeframe:"1-2 weeks"}],cccHistory:[{month:"Jan",ccc:52},{month:"Feb",ccc:48},{month:"Mar",ccc:50},{month:"Apr",ccc:47},{month:"May",ccc:49},{month:"Jun",ccc:u.summary?.cashConversionCycle||45}]};t(m),s(!1);return}if(await new Promise(m=>setTimeout(m,800+Math.random()*500)),Math.random()<.05)throw new Error("Failed to fetch working capital data");const d=n();t(d),s(!1)}catch(d){i(d),s(!1)}},[n,u]),N=p.useCallback(async()=>{if(u.isConnected&&u.refetch)try{await u.refetch()}catch(d){le("Failed to refresh Xero data",d)}await c()},[c,u]),w=p.useCallback(async d=>{if(!a)return;const m={timestamp:new Date().toISOString(),period:l,format:d,data:a};try{switch(await new Promise(y=>setTimeout(y,1e3)),d){case"pdf":const y=new Blob([JSON.stringify(m,null,2)],{type:"application/pdf"}),k=URL.createObjectURL(y),C=document.createElement("a");C.href=k,C.download=`working-capital-report-${l}.pdf`,C.click();break;case"excel":const T=new Blob([JSON.stringify(m,null,2)],{type:"application/vnd.ms-excel"}),O=URL.createObjectURL(T),D=document.createElement("a");D.href=O,D.download=`working-capital-report-${l}.xlsx`,D.click();break;case"csv":const b=x(a),_=new Blob([b],{type:"text/csv"}),P=URL.createObjectURL(_),U=document.createElement("a");U.href=P,U.download=`working-capital-report-${l}.csv`,U.click();break;default:throw new Error(`Unsupported export format: ${d}`)}}catch(y){throw new Error(`Export failed: ${y.message}`)}},[a,l]),x=d=>{const m=["Metric","Value","Change","Status"],y=[["Working Capital",`$${d.summary.workingCapital.toLocaleString()}`,`${d.summary.workingCapitalChange?.toFixed(1)}%`,"Current"],["Cash Conversion Cycle",`${d.summary.cashConversionCycle} days`,`${d.summary.cccChange?.toFixed(1)}%`,"Current"],["Current Ratio",d.summary.currentRatio?.toFixed(2),`${d.summary.currentRatioChange?.toFixed(1)}%`,"Current"],["Quick Ratio",d.summary.quickRatio?.toFixed(2),`${d.summary.quickRatioChange?.toFixed(1)}%`,"Current"],["DSO",`${d.receivables.dso} days`,"","Current"],["DPO",`${d.payables.dpo} days`,"","Current"],["DIO",`${d.inventory.dio} days`,"","Current"]];return[m.join(","),...y.map(C=>C.join(","))].join(`
`)};return p.useEffect(()=>{c()},[c]),{data:a,loading:r,error:o,refetch:N,exportData:w,isXeroConnected:u.isConnected,xeroStatus:u.connectionStatus,isUsingRealData:u.isConnected&&!!u.summary}}function L({title:l,value:a,change:t,format:r="number",icon:s,color:o="blue",target:i,currency:u="USD"}){const n=x=>{if(x==null)return"--";switch(r){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:u,minimumFractionDigits:0,maximumFractionDigits:0}).format(x);case"days":return`${Math.round(x)} days`;case"ratio":return x.toFixed(2);case"percentage":return`${(x*100).toFixed(1)}%`;default:return x.toLocaleString()}},h=t&&t>0,g=h?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",c=h?Z:ee,N={blue:"bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400",green:"bg-green-50 text-green-600 dark:bg-green-900/20 dark:text-green-400",purple:"bg-purple-50 text-purple-600 dark:bg-purple-900/20 dark:text-purple-400",orange:"bg-orange-50 text-orange-600 dark:bg-orange-900/20 dark:text-orange-400",red:"bg-red-50 text-red-600 dark:bg-red-900/20 dark:text-red-400",yellow:"bg-yellow-50 text-yellow-600 dark:bg-yellow-900/20 dark:text-yellow-400"},w=i?a/i*100:null;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`rounded-lg p-3 ${N[o]||N.blue}`,children:e.jsx(s,{className:"h-6 w-6"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:l}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n(a)})]})]}),t!==void 0&&e.jsxs("div",{className:`flex items-center ${g}`,children:[Y.createElement(c,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{className:"text-sm font-medium",children:[Math.abs(t).toFixed(1),"%"]})]})]}),i&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[e.jsxs("span",{children:["Target: ",n(i)]}),e.jsxs("span",{children:[w?.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${w>=100?"bg-green-500 dark:bg-green-600":w>=75?"bg-yellow-500 dark:bg-yellow-600":"bg-red-500 dark:bg-red-600"}`,style:{width:`${Math.min(w||0,100)}%`}})})]})]})}function ve({receivables:l,payables:a,title:t}){const r={receivables:{"0-30":45e3,"31-60":28e3,"61-90":12e3,"90+":8e3},payables:{"0-30":35e3,"31-60":2e4,"61-90":8e3,"90+":3e3}},s=l||r.receivables,o=a||r.payables,i=c=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(c),u=["0-30","31-60","61-90","90+"],n=Object.values(s).reduce((c,N)=>c+val,0),h=Object.values(o).reduce((c,N)=>c+val,0),g=(c,N)=>({receivables:{"0-30":"bg-green-500","31-60":"bg-yellow-500","61-90":"bg-orange-500","90+":"bg-red-500"},payables:{"0-30":"bg-blue-500","31-60":"bg-indigo-500","61-90":"bg-purple-500","90+":"bg-pink-500"}})[type][c]||"bg-gray-500";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:t||"AR/AP Aging Analysis"}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"flex space-x-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded mr-2"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Receivables"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded mr-2"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Payables"})]})]})}),e.jsx("div",{className:"space-y-6",children:u.map(c=>{const N=s[c]||0,w=o[c]||0,x=n>0?N/n*100:0,d=h>0?w/h*100:0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[c," days"]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["AR: ",i(N)," | AP: ",i(w)]})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Receivables (",x.toFixed(1),"%)"]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${g(c)}`,style:{width:`${x}%`}})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:["Payables (",d.toFixed(1),"%)"]}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${g(c)}`,style:{width:`${d}%`}})})]})]},c)})}),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Receivables"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i(n)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Payables"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i(h)})]})]})})]})}function je({dso:l,dio:a,dpo:t,historical:r}){const s=l||45,o=a||30,i=t||25,u=s+o-i,n=r||[{month:"Jan",ccc:55,dso:48,dio:32,dpo:25},{month:"Feb",ccc:52,dso:46,dio:31,dpo:25},{month:"Mar",ccc:48,dso:44,dio:29,dpo:25},{month:"Apr",ccc:50,dso:45,dio:30,dpo:25},{month:"May",ccc:50,dso:45,dio:30,dpo:25},{month:"Jun",ccc:u,dso:s,dio:o,dpo:i}],h=n.length>1?(u-n[n.length-2].ccc)/n[n.length-2].ccc*100:0,g=h<0,c=(w,x)=>{const m={dso:{optimal:30,good:45,warning:60},dio:{optimal:20,good:35,warning:50},dpo:{optimal:35,good:25,warning:15},ccc:{optimal:30,good:50,warning:70}}[x];return m?x==="dpo"?w>=m.optimal?"optimal":w>=m.good?"good":"warning":w<=m.optimal?"optimal":w<=m.good?"good":"warning":"good"},N=w=>{switch(status){case"optimal":return"text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20";case"good":return"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20";case"warning":return"text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20";default:return"text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/20"}};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Cash Conversion Cycle"}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-center space-x-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[e.jsxs("div",{className:`text-center p-3 rounded-lg ${N()}`,children:[e.jsx("div",{className:"text-sm font-medium",children:"DSO"}),e.jsx("div",{className:"text-lg font-bold",children:s}),e.jsx("div",{className:"text-xs",children:"days"})]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:e.jsx("span",{className:"text-lg font-bold",children:"+"})}),e.jsxs("div",{className:`text-center p-3 rounded-lg ${N()}`,children:[e.jsx("div",{className:"text-sm font-medium",children:"DIO"}),e.jsx("div",{className:"text-lg font-bold",children:o}),e.jsx("div",{className:"text-xs",children:"days"})]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:e.jsx("span",{className:"text-lg font-bold",children:"-"})}),e.jsxs("div",{className:`text-center p-3 rounded-lg ${N()}`,children:[e.jsx("div",{className:"text-sm font-medium",children:"DPO"}),e.jsx("div",{className:"text-lg font-bold",children:i}),e.jsx("div",{className:"text-xs",children:"days"})]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:e.jsx("span",{className:"text-lg font-bold",children:"="})}),e.jsxs("div",{className:`text-center p-4 rounded-lg border-2 border-dashed ${c(u,"ccc")==="optimal"?"border-green-500":c(u,"ccc")==="good"?"border-blue-500":"border-orange-500"}`,children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"CCC"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"days"})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Trend vs Previous Period"}),e.jsxs("div",{className:`flex items-center text-sm font-medium ${g?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[e.jsxs("span",{children:[g?"↓":"↑"," ",Math.abs(h).toFixed(1),"%"]}),e.jsx("span",{className:"ml-1",children:g?"Improving":"Worsening"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"6-Month Trend"}),e.jsx("div",{className:"relative h-24 bg-gray-50 dark:bg-gray-900 rounded-lg p-2",children:e.jsx("div",{className:"flex h-full items-end justify-between",children:n.map((w,x)=>{const d=Math.max(...n.map(y=>y.ccc)),m=w.ccc/d*100;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-6 rounded-t transition-all duration-300 ${x===n.length-1?"bg-blue-600 dark:bg-blue-500":"bg-gray-400 dark:bg-gray-600"}`,style:{height:`${m}%`}}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:w.month})]},w.month)})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Performance Analysis"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"DSO Status"}),e.jsx("div",{className:`font-medium ${c(s,"dso")==="optimal"?"text-green-600":c(s,"dso")==="good"?"text-blue-600":"text-orange-600"}`,children:c(s,"dso").toUpperCase()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"DIO Status"}),e.jsx("div",{className:`font-medium ${c(o,"dio")==="optimal"?"text-green-600":c(o,"dio")==="good"?"text-blue-600":"text-orange-600"}`,children:c(o,"dio").toUpperCase()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"DPO Status"}),e.jsx("div",{className:`font-medium ${c(i,"dpo")==="optimal"?"text-green-600":c(i,"dpo")==="good"?"text-blue-600":"text-orange-600"}`,children:c(i,"dpo").toUpperCase()})]})]}),u>50&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"Optimization Opportunity:"})," Your CCC of ",u," days is above the recommended range. Consider accelerating collections or optimizing inventory levels."]})})]})]})}function Ce({data:l,period:a="current"}){const[t,r]=p.useState("30"),o=l||(x=>{const d=new Date,m=[];let y=15e4;for(let k=0;k<parseInt(days);k++){const C=new Date(d);C.setDate(C.getDate()+k);const T=C.getDate(),O=Math.floor(k/7)%2===0,D=T>=28;let b=8e3+Math.random()*4e3,_=6e3+Math.random()*2e3;O&&(_+=15e3),D&&(_+=2e4),T<=5&&(b+=25e3),y=y+b-_,m.push({date:C.toISOString().split("T")[0],dateFormatted:C.toLocaleDateString(),inflow:Math.round(b),outflow:Math.round(_),netFlow:Math.round(b-_),runningBalance:Math.round(y),dayOfWeek:C.toLocaleDateString("en",{weekday:"short"})})}return m})(),i=x=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.abs(x)),u=o.reduce((x,d)=>x+d.inflow,0),n=o.reduce((x,d)=>x+d.outflow,0),h=u-n,g=Math.min(...o.map(x=>x.runningBalance));Math.max(...o.map(x=>x.runningBalance));const c=o.filter(x=>x.runningBalance<5e4),N=x=>x<25e3?"text-red-600 dark:text-red-400":x<75e3?"text-yellow-600 dark:text-yellow-400":"text-green-600 dark:text-green-400",w=x=>x<25e3?"bg-red-50 dark:bg-red-900/20":x<75e3?"bg-yellow-50 dark:bg-yellow-900/20":"bg-green-50 dark:bg-green-900/20";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Cash Flow Forecast"}),e.jsxs("select",{value:t,onChange:x=>r(x.target.value),className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"30",children:"30 Days"}),e.jsx("option",{value:"60",children:"60 Days"}),e.jsx("option",{value:"90",children:"90 Days"}),e.jsx("option",{value:"180",children:"180 Days"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Total Inflow"}),e.jsx("p",{className:"text-lg font-bold text-blue-900 dark:text-blue-100",children:i(u)})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Total Outflow"}),e.jsxs("p",{className:"text-lg font-bold text-red-900 dark:text-red-100",children:["-",i(n)]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${h>=0?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:[e.jsx("p",{className:`text-sm ${h>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:"Net Cash Flow"}),e.jsxs("p",{className:`text-lg font-bold ${h>=0?"text-green-900 dark:text-green-100":"text-red-900 dark:text-red-100"}`,children:[h>=0?"+":"",i(h)]})]}),e.jsxs("div",{className:`rounded-lg p-4 ${w(g)}`,children:[e.jsx("p",{className:`text-sm ${N(g)}`,children:"Min Balance"}),e.jsx("p",{className:`text-lg font-bold ${N(g)}`,children:i(g)})]})]}),c.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-2",children:"Cash Flow Alert"}),e.jsxs("p",{className:"text-sm text-red-600 dark:text-red-400",children:["Projected cash balance will fall below $50,000 on ",c.length," day(s). Consider accelerating collections or delaying non-critical payments."]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Inflow"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Outflow"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Net Flow"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Balance"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:o.slice(0,30).map((x,d)=>e.jsxs("tr",{className:`${x.runningBalance<5e4?"bg-red-50 dark:bg-red-900/10":""}`,children:[e.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:x.dateFormatted}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:x.dayOfWeek})]}),e.jsxs("td",{className:"px-3 py-2 whitespace-nowrap text-right text-sm text-green-600 dark:text-green-400",children:["+",i(x.inflow)]}),e.jsxs("td",{className:"px-3 py-2 whitespace-nowrap text-right text-sm text-red-600 dark:text-red-400",children:["-",i(x.outflow)]}),e.jsxs("td",{className:`px-3 py-2 whitespace-nowrap text-right text-sm font-medium ${x.netFlow>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[x.netFlow>=0?"+":"",i(x.netFlow)]}),e.jsx("td",{className:`px-3 py-2 whitespace-nowrap text-right text-sm font-bold ${N(x.runningBalance)}`,children:i(x.runningBalance)})]},x.date))})]})})}),o.length>30&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("button",{className:"text-sm text-blue-600 dark:text-blue-400 hover:underline",children:["View All ",o.length," Days →"]})})]})}function _e({recommendations:l,onActionClick:a}){const t=l||[{id:1,type:"receivables",priority:"high",title:"Accelerate Invoice Collections",description:"Current DSO is 45 days, target is 35 days. Focus on invoices over 30 days.",impact:"Unlock $85,000 in cash",effort:"medium",timeframe:"2-4 weeks",actions:["Send follow-up emails to customers with overdue invoices","Offer early payment discounts of 2% for payments within 10 days","Implement automated reminder system"],roi:15.2,status:"pending"},{id:2,type:"payables",priority:"medium",title:"Optimize Payment Terms",description:"Extend DPO from 25 to 30 days while capturing early payment discounts.",impact:"Improve cash position by $45,000",effort:"low",timeframe:"1-2 weeks",actions:["Negotiate extended payment terms with top 5 suppliers","Analyze discount opportunities vs. extended terms","Update payment scheduling system"],roi:8.7,status:"pending"},{id:3,type:"inventory",priority:"high",title:"Reduce Inventory Holding",description:"DIO is 30 days, target is 25 days. Reduce slow-moving stock.",impact:"Free up $120,000 in working capital",effort:"high",timeframe:"4-8 weeks",actions:["Identify slow-moving inventory items","Implement just-in-time ordering for high-turnover items","Clear excess inventory through promotions"],roi:22.5,status:"in_progress"},{id:4,type:"cash",priority:"low",title:"Optimize Cash Investment",description:"Excess cash earning 0.5% in checking account. Consider short-term investments.",impact:"Generate additional $8,000 annually",effort:"low",timeframe:"1 week",actions:["Move excess cash to high-yield money market account","Consider 30-day treasury bills for temporary surplus","Set up automated cash sweeping"],roi:4.2,status:"pending"}],r=n=>{switch(n){case"high":return"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";case"medium":return"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800";case"low":return"text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";default:return"text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-900/20 border-gray-200 dark:border-gray-800"}},s=n=>{switch(n){case"completed":return e.jsx(R,{className:"h-5 w-5 text-green-600 dark:text-green-400"});case"in_progress":return e.jsx(X,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"});case"pending":return e.jsx(H,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"});default:return e.jsx(B,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}},o=n=>{switch(type){case"receivables":return e.jsx(te,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"});case"payables":return e.jsx(X,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"});case"inventory":return e.jsx(W,{className:"h-5 w-5 text-green-600 dark:text-green-400"});case"cash":return e.jsx(W,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"});default:return e.jsx(B,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"})}},i=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),u=[...t].sort((n,h)=>{const g={high:3,medium:2,low:1};return g[n.priority]!==g[h.priority]?g[h.priority]-g[n.priority]:h.roi-n.roi});return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-6 w-6 text-blue-600 dark:text-blue-400 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Optimization Recommendations"})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[u.filter(n=>n.status==="pending").length," pending actions"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Potential Cash Impact"}),e.jsx("p",{className:"text-lg font-bold text-blue-900 dark:text-blue-100",children:i(_sortedRecommendations.reduce((n,h)=>{const g=h.impact.match(/\$([0-9,]+)/);return g?n+parseInt(g[1].replace(/,/g,"")):n},0))})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Average ROI"}),e.jsxs("p",{className:"text-lg font-bold text-green-900 dark:text-green-100",children:[(u.reduce((n,h)=>n+h.roi,0)/u.length).toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"High Priority Items"}),e.jsx("p",{className:"text-lg font-bold text-purple-900 dark:text-purple-100",children:u.filter(n=>n.priority==="high").length})]})]}),e.jsx("div",{className:"space-y-4",children:u.map(n=>e.jsxs("div",{className:`border rounded-lg p-4 ${r(n.priority)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:o()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mr-2",children:n.title}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${n.priority==="high"?"bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100":n.priority==="medium"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100":"bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100"}`,children:n.priority.toUpperCase()})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:n.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s(n.status),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 capitalize",children:n.status.replace(""," ")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Impact"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n.impact})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"ROI"}),e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[n.roi,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Timeframe"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:n.timeframe})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Action Items:"}),e.jsx("ul",{className:"space-y-1",children:n.actions.map((h,g)=>e.jsxs("li",{className:"flex items-start text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400 dark:text-gray-500 mr-2",children:"•"}),e.jsx("span",{children:h})]},g))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full mr-2 ${n.effort==="high"?"bg-red-500":n.effort==="medium"?"bg-yellow-500":"bg-green-500"}`}),n.effort.charAt(0).toUpperCase()+n.effort.slice(1)," effort"]}),e.jsxs("div",{className:"flex space-x-2",children:[n.status==="pending"&&e.jsx("button",{onClick:()=>a&&a(n),className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"Start Implementation"}),e.jsx("button",{className:"px-3 py-1 text-xs border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"View Details"})]})]})]},n.id))})]})}function Se({onConnectionChange:l}){const{connectionStatus:a,isConnected:t,isAuthenticating:r,isLoading:s,authenticate:o,disconnect:i,startAuthFlow:u}=$(),[n,h]=p.useState(!1);p.useEffect(()=>{l&&l(t,a)},[t,a,l]),p.useEffect(()=>{const w=new URLSearchParams(window.location.search),x=w.get("code"),d=w.get("state"),m=w.get("error");if(m){q("Xero OAuth error",m);return}if(x&&d&&!t&&!r){o({code:x,state:d});const y=window.location.pathname;window.history.replaceState({},document.title,y)}},[o,t,r]);const g=()=>{u()},c=()=>{window.confirm("Are you sure you want to disconnect from Xero? This will switch back to sample data.")&&i()},N=w=>{if(!expiry)return"Unknown";const x=new Date(expiry),m=Math.round((x-new Date)/(1e3*60*60));return m<=0?"Expired":m<24?`Expires in ${m} hours`:`Expires in ${Math.round(m/24)} days`};return s||r?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(ae,{className:"h-6 w-6 text-blue-600 animate-spin mr-3"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:r?"Connecting to Xero...":"Loading connection status..."})]})}):e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:t?e.jsx(R,{className:"h-8 w-8 text-green-600"}):e.jsx(H,{className:"h-8 w-8 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Xero Integration"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t?`Connected to ${a.tenantName||"Xero organization"}`:"Connect to Xero for real financial data"})]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:t?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>h(!n),className:"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white border border-gray-300 dark:border-gray-600 rounded-md hover:border-gray-400 dark:hover:border-gray-500 transition",children:n?"Hide Details":"Show Details"}),e.jsx("button",{onClick:c,className:"px-4 py-2 text-sm text-red-600 hover:text-red-700 border border-red-300 rounded-md hover:border-red-400 transition",children:"Disconnect"})]}):e.jsxs("button",{onClick:g,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Connect to Xero"]})})]}),n&&t&&e.jsx("div",{className:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Connection Details"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Organization:"}),e.jsx("span",{className:"font-medium",children:a.tenantName||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tenant ID:"}),e.jsxs("span",{className:"font-mono text-xs",children:[a.tenantId?.substring(0,8)||"Unknown","..."]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Token Status:"}),e.jsx("span",{className:"font-medium",children:N()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last Check:"}),e.jsx("span",{className:"font-medium",children:new Date(a.lastCheck).toLocaleTimeString()})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Data Access"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-600 dark:text-green-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Accounts Receivable"})]}),e.jsxs("div",{className:"flex items-center text-sm text-green-600 dark:text-green-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Accounts Payable"})]}),e.jsxs("div",{className:"flex items-center text-sm text-green-600 dark:text-green-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Cash Accounts"})]}),e.jsxs("div",{className:"flex items-center text-sm text-green-600 dark:text-green-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Financial Reports"})]})]})]})]})}),!t&&e.jsxs("div",{className:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Benefits of connecting to Xero:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"Real-time financial data"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"Accurate AR/AP aging"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"Automated calculations"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"Cash flow insights"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"Working capital optimization"})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-green-600"}),e.jsx("span",{children:"Personalized recommendations"})]})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("strong",{children:"Secure Connection:"})," We use OAuth 2.0 for secure authentication. Your Xero credentials are never stored on our servers."]})})]})]}),e.jsx("div",{className:`px-6 py-3 border-t border-gray-200 dark:border-gray-700 ${t?"bg-green-50 dark:bg-green-900/20":"bg-yellow-50 dark:bg-yellow-900/20"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${t?"bg-green-600":"bg-yellow-600"}`}),e.jsx("span",{className:`text-sm font-medium ${t?"text-green-700 dark:text-green-300":"text-yellow-700 dark:text-yellow-300"}`,children:t?"Using Live Data":"Using Sample Data"})]}),t&&e.jsxs("span",{className:"text-xs text-green-600 dark:text-green-400",children:["Last synced: ",new Date().toLocaleTimeString()]})]})})]})}function Ie(){const{user:l}=J(),[a,t]=p.useState("current"),[r,s]=p.useState("USD"),{data:o,loading:i,error:u,refetch:n,exportData:h,isUsingRealData:g}=Ne(a),c=ge();if(p.useEffect(()=>{const b=performance.now();if(o&&!i){const _=performance.now()-b,P=Object.keys(o).length;c.logDashboardLoad(_,P)}},[o,i,c]),l?.role==="viewer")return e.jsx(se,{to:"/dashboard",replace:!0});if(p.useEffect(()=>{const b=setInterval(()=>{c.logMetricRefresh("auto_refresh","periodic"),n()},9e5);return()=>clearInterval(b)},[n,c]),i&&!o)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Loading working capital metrics..."})]})});if(u)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-8",children:e.jsx("div",{className:"mx-auto max-w-7xl",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-6 w-6 text-red-600 dark:text-red-400 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800 dark:text-red-200",children:"Error Loading Data"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mt-1",children:u.message}),e.jsx("button",{_onClick:()=>{c.logError(u,{action:"retry_data_load",userInitiated:!0}),n()},className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Retry"})]})]})})})});const N=async b=>{const _=performance.now();try{c.logExport(format,{includeForecasts:!0,includeRecommendations:!0,dateRange:a}),await h(format);const P=performance.now()-_;c.trackAction("export_success",{format,duration:Math.round(P),period:a})}catch(P){c.logError(P,{action:"data_export",format,period:a,duration:performance.now()-_}),q("Export failed",P)}},w=b=>{c.logPeriodChange(a,newPeriod),t(newPeriod)},x=b=>{c.logCurrencyChange(r,newCurrency),s(newCurrency)},d=()=>{c.logMetricRefresh("manual_refresh","user_initiated"),n()},{summary:m,receivables:y,payables:k,inventory:C,cashFlow:T,recommendations:O,alerts:D}=o||{};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[e.jsx(Q,{className:"h-8 w-8 mr-3 text-blue-600"}),"Working Capital Management"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Optimize cash flow and improve financial efficiency"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:r,onChange:b=>x(),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-sm",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"EUR",children:"EUR"})]}),e.jsxs("select",{value:a,onChange:b=>w(),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-sm",children:[e.jsx("option",{value:"current",children:"Current"}),e.jsx("option",{value:"mtd",children:"Month to Date"}),e.jsx("option",{value:"qtd",children:"Quarter to Date"}),e.jsx("option",{value:"ytd",children:"Year to Date"})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition flex items-center",children:[e.jsx(ne,{className:"h-5 w-5 mr-2"}),"Export"]}),e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10",children:[e.jsx("button",{onClick:()=>N(),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Export as PDF"}),e.jsx("button",{onClick:()=>N(),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Export as Excel"}),e.jsx("button",{onClick:()=>N(),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Export as CSV"})]})]}),e.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Refresh"})]})]})})}),e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx(Se,{onConnectionChange:(b,_)=>{c.trackAction("xero_connection_changed",{connected:b,tenantName:status?.tenantName,isUsingRealData:b&&!!o})}})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${g?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200":"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${g?"bg-green-600":"bg-yellow-600"}`}),g?"Live Data from Xero":"Sample Data"]})}),D&&D.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Active Alerts"}),e.jsx("div",{className:"space-y-3",children:D.map((b,_)=>e.jsxs("div",{className:`p-4 rounded-lg border flex items-start ${b.severity==="critical"?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":b.severity==="warning"?"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,children:[e.jsx(V,{className:`h-5 w-5 mt-0.5 mr-3 flex-shrink-0 ${b.severity==="critical"?"text-red-600 dark:text-red-400":b.severity==="warning"?"text-yellow-600 dark:text-yellow-400":"text-blue-600 dark:text-blue-400"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:b.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:b.description}),b.action&&e.jsx("button",{className:"text-sm font-medium text-blue-600 dark:text-blue-400 mt-2 hover:underline",children:b.action})]})]},_))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(L,{title:"Working Capital",value:m?.workingCapital||0,change:m?.workingCapitalChange,format:"currency",icon:Q,color:"blue"}),e.jsx(L,{title:"Cash Conversion Cycle",value:m?.cashConversionCycle||0,change:m?.cccChange,format:"days",icon:oe,color:"green",target:30}),e.jsx(L,{title:"Current Ratio",value:m?.currentRatio||0,change:m?.currentRatioChange,format:"ratio",icon:ie,color:"purple",target:2}),e.jsx(L,{title:"Quick Ratio",value:m?.quickRatio||0,change:m?.quickRatioChange,format:"ratio",icon:ce,color:"orange",target:1.5})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Accounts Receivable"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Outstanding"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:["$",(y?.total||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"DSO"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[y?.dso||0," days"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Overdue"}),e.jsxs("span",{className:"font-semibold text-red-600 dark:text-red-400",children:["$",(y?.overdue||0).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Accounts Payable"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Outstanding"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:["$",(k?.total||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"DPO"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[k?.dpo||0," days"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Discounts Available"}),e.jsxs("span",{className:"font-semibold text-green-600 dark:text-green-400",children:["$",(k?.discountsAvailable||0).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Inventory"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Value"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:["$",(C?.total||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"DIO"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[C?.dio||0," days"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Turnover Ratio"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[C?.turnoverRatio||0,"x"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(ve,{receivables:y?.aging,payables:k?.aging,title:"AR/AP Aging Analysis"}),e.jsx(je,{dso:y?.dso||0,dio:C?.dio||0,dpo:k?.dpo||0,historical:o?.cccHistory})]}),e.jsx("div",{className:"mb-8",children:e.jsx(Ce,{data:T,period:a})}),e.jsx(_e,{recommendations:O,onActionClick:b=>de.log("Action clicked:",b)})]})]})}const Re=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{Re as W,ue as u};
