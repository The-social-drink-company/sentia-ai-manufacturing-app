# Claude Git Agent - Quick Reference Rules

## ü§ñ AUTONOMOUS GIT BEHAVIOR - ACTIVE

This file contains the rules I (Claude) follow for autonomous git operations.

---

## PRIMARY RULE: Task-Completion Commits

**AFTER EVERY TodoWrite TOOL USE:**

```javascript
IF (any todo marked "completed") THEN
    1. Check git status
    2. Stage relevant changed files
    3. Generate commit message from todo content
    4. Create commit
    5. Increment mental commit counter
    6. Check if push needed (every 5 commits OR 1 hour)
END IF
```

### Commit Message Template:
```
<type>: <todo content>

<detailed changes>

Completed task: <todo content>
Files changed: <count>

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

---

## COMMIT TYPE DETECTION

Map todo content to conventional commit type:

- `feat:` - Implement, add, create, build (new features)
- `fix:` - Fix, resolve, correct, repair (bug fixes)
- `refactor:` - Refactor, restructure, reorganize (code changes)
- `docs:` - Document, write, update docs (documentation)
- `test:` - Test, add tests, testing (test additions)
- `chore:` - Update, upgrade, configure (maintenance)
- `style:` - Format, style, lint (formatting)
- `perf:` - Optimize, improve performance (performance)

---

## SECONDARY RULE: Change-Based Commits

**AFTER EVERY Edit/Write TOOL USE:**

Track cumulative changes:
- Files changed count
- Lines changed estimate

```javascript
IF (changes meet threshold) AND (last commit > 10 min ago) THEN
    1. Analyze all changed files
    2. Generate descriptive commit message
    3. Create commit
    4. Reset change counter
END IF

Thresholds:
- 5+ files modified
- 150+ lines changed
- 3+ new files created
- Critical files (package.json, schema.prisma, server.js)
```

---

## TERTIARY RULE: Safety Net Commits

**PERIODIC CHECK (every ~10-15 interactions):**

```javascript
IF (uncommitted changes exist) AND (last commit > 30 min ago) THEN
    Create WIP safety checkpoint:
    "WIP: Development checkpoint - <timestamp>

    Uncommitted changes:
    - <file list with change summary>

    This is an automatic safety checkpoint."
END IF
```

---

## AUTO-PUSH RULES

**Push to origin/development when:**
- Every 5 commits (cumulative counter)
- OR every 1 hour (if unpushed commits exist)
- OR before creating a PR
- OR explicitly requested by user

**Before pushing:**
1. ‚úÖ Verify on `development` branch
2. ‚úÖ Run `git pull --rebase origin development`
3. ‚úÖ Resolve conflicts (notify user if can't auto-resolve)
4. ‚úÖ Push with `git push origin development`

---

## PR CREATION RULES

**SEMI-AUTONOMOUS - Always Ask First:**

```javascript
IF (significant milestone reached) THEN
    Suggest PR to user:
    "ü§î I've completed [X] tasks with [Y] commits. Ready to create PR to development?"

    IF (user approves) THEN
        1. Ensure all commits pushed
        2. Generate comprehensive PR description
        3. Create PR using gh pr create
        4. Return PR URL to user
    END IF
END IF

Milestone triggers:
- All todos in epic completed
- 10+ commits accumulated
- User says "create PR" or "ready to merge"
- Significant feature complete
```

---

## SAFETY CONSTRAINTS

### CRITICAL - NEVER VIOLATE:

1. ‚ùå **NEVER commit/push to `test` or `production` branches** unless explicitly told
2. ‚ùå **NEVER create PR without asking first**
3. ‚ùå **NEVER push if merge conflicts exist** (notify user)
4. ‚ùå **NEVER commit if current branch ‚â† development**

### Safety Checks:
```bash
# Before any git operation:
CURRENT_BRANCH=$(git branch --show-current)
if [ "$CURRENT_BRANCH" != "development" ]; then
    HALT and notify user
fi
```

---

## USER NOTIFICATIONS

Keep user informed with brief, clear notifications:

```
‚úÖ Auto-commit: "feat: Add inventory calculations" (3 files, +87 lines)
‚è∞ Auto-push: Pushed 5 commits to origin/development
ü§î PR Ready: 12 tasks complete, 15 commits. Create PR to development?
‚ö†Ô∏è Safety commit: WIP checkpoint created (30 min threshold)
üö® Conflict detected: Manual resolution needed for src/services/apiService.js
```

---

## COMMIT COUNTER TRACKING

Maintain mental state across interaction:

```javascript
SESSION_STATE = {
    commitsThisSession: 0,
    lastCommitTime: null,
    lastPushTime: null,
    changesSinceLastCommit: {
        files: [],
        linesAdded: 0,
        linesRemoved: 0
    }
}

// Update after each commit
SESSION_STATE.commitsThisSession++
SESSION_STATE.lastCommitTime = now()

// Reset after push
if (pushed) {
    SESSION_STATE.commitsThisSession = 0
    SESSION_STATE.lastPushTime = now()
}
```

---

## EDGE CASE HANDLING

### Merge Conflicts
```
1. Attempt: git pull --rebase
2. If conflicts:
   - List conflicted files
   - Notify user: "üö® Merge conflicts in: <files>. Need manual resolution."
   - DO NOT push
   - Offer to help resolve
```

### Build Failures
```
(Optional - not enabled by default)
IF (config.requireCleanBuild) THEN
    Run build before commit
    IF (build fails) THEN
        Notify user: "‚ö†Ô∏è Build failed, commit deferred until fixed"
        DO NOT commit
    END IF
END IF
```

### Interrupted Work
```
IF (user says "stop", "pause", "break") THEN
    Check for uncommitted changes
    Offer: "Would you like me to create a safety commit before stopping?"
END IF
```

---

## IMPLEMENTATION STATUS

- [x] Task-completion commits - **ACTIVE**
- [x] Change-based commits - **ACTIVE**
- [x] Time-based safety net - **ACTIVE**
- [x] Auto-push logic - **ACTIVE**
- [x] PR creation (ask first) - **ACTIVE**
- [x] Safety constraints - **ACTIVE**

---

## SESSION STATISTICS

Track and report at end of session:

```
üìä Git Activity Summary:
- Commits created: 15
- Changes pushed: 3 pushes (15 commits)
- PRs created: 1
- Time saved: ~30 minutes
- No work lost: 2 WIP safety checkpoints
```

---

## EXAMPLES

### Example 1: Simple Task Completion
```
User: "Fix the login button styling"

Claude:
- Creates todo: "Fix the login button styling"
- Marks as in_progress
- Edits LoginButton.jsx
- Marks as completed
- ü§ñ AUTO: git add src/components/LoginButton.jsx
- ü§ñ AUTO: git commit -m "fix: Fix the login button styling..."
- ‚úÖ Notification: "Auto-commit: 'fix: Fix the login button styling' (1 file, +12 lines)"
```

### Example 2: Multiple Files, Threshold Trigger
```
Claude working on feature:
- Edits InventoryService.js
- Edits InventoryComponent.jsx
- Creates inventoryUtils.js
- Edits apiService.js
- Creates inventoryTypes.ts
[5 files changed - threshold met]
- ü§ñ AUTO: Analyze changes
- ü§ñ AUTO: git add .
- ü§ñ AUTO: git commit -m "feat: Add inventory management service..."
- ‚úÖ Notification: "Auto-commit: 'feat: Add inventory management service' (5 files, +234 lines)"
```

### Example 3: Auto-Push After 5 Commits
```
[Commit #1] fix: Update auth service
[Commit #2] feat: Add dashboard widget
[Commit #3] refactor: Clean up API calls
[Commit #4] docs: Update README
[Commit #5] test: Add unit tests for widgets
[Trigger: 5 commits reached]
- ü§ñ AUTO: git pull --rebase origin development
- ü§ñ AUTO: git push origin development
- ‚è∞ Notification: "Auto-push: Pushed 5 commits to origin/development"
[Reset counter to 0]
```

---

## ACTIVATION

‚úÖ **SYSTEM ACTIVE** - Following all rules starting immediately

**Current session:**
- Start time: 2025-10-17 (user session start)
- Commits this session: 0
- Last push: N/A
- Branch: development (verified)

**Next actions:**
- Monitor for completed todos
- Track file changes
- Commit at appropriate triggers
- Push every 5 commits or 1 hour
- Suggest PR when milestones reached

---

**Last Updated**: 2025-10-17
**Status**: Active ‚úÖ
**Priority**: High üî•
