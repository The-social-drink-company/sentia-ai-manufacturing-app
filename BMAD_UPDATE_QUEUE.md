# BMAD Update Queue

| Path                                                                   | Identified Gap                                                                                                                         | Evidence                                                                                                  | Suggested Action                                                                                           |
| ---------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ |
| server/routes/api.js                                                   | /api namespace still serves 410 "Legacy API" responses across all handlers.                                                            | Select-String -Path server/routes/api.js -Pattern '410' shows every route returning                       |
| es.status(410).                                                        | Replace the stub router with the active BMAD endpoints (financial, inventory, SSE) or retire /api completely.                          |
| server/api/dashboard.js                                                | Returns synthetic KPI/chart data with TODO comments to replace with real services.                                                     | Select-String -Path server/api/dashboard.js -Pattern 'TODO' highlights the inline mock generators.        | Wire the handler into Prisma/forecast services so dashboards consume live data (covered by BMAD-MOCK-010). |
| server/api/business-intelligence.js                                    | Ships hard-coded "AI insights" for Claude/GPT instead of calling actual model endpoints.                                               | Comments state "In production this would integrate with Claude 3 Sonnet and GPT-4".                       | Hook this route into the ML orchestration stack or deprecate it (BMAD-MOCK-010 follow-up).                 |
| src/features/ai-analytics/components/AIInsights.jsx                    | Component depends on missing `useAIMetrics` hook and references undefined `timestamp`, crashing AI Insights panel in development. **(Resolved 2025-10-20 by BMAD-DEV-001)**      | File import points to `../hooks/useAIMetrics`; repository has no such hook; `getTimeAgo` uses `timestamp` symbol that is never defined. | Implemented deterministic hook with graceful fallback and corrected timestamp handling. |
| src/services/FinancialAlgorithms.js                                    | `getReceivablesData`/`getPayablesData` fetch `/financial/working-capital` expecting `{ success: true }`, but API returns `{ data }`, causing thrown errors even in dev mode. **(Resolved 2025-10-20 by BMAD-DEV-001)** | Compare service implementation with `server/api/real-api.js` response shape.                                           | Normalised API base, updated parsers, and added labelled development fallbacks to stop runtime failures.             |
| server/services/finance/\*.js                                          | Finance services (ApprovalEngine, CashConversionCycle, ScenarioModeler, etc.) still use                                                |
| equire(...) and expect a CommonJS logger at ../../utils/logger.        | Get-Content server/services/finance/ApprovalEngine.js -Head 5 shows legacy imports.                                                    | Convert services to ESM or provide shim; add JSDoc/TypeScript coverage (BMAD-ARCH-012).                   |
| ests/unit/services/admin/\*                                            | Vitest fails to resolve ../../../../server/lib/prisma.js.                                                                              | pnpm vitest run --reporter=verbose (2025-10-19 11:25) shows import-resolution errors.                     | Create ESM-compatible Prisma shim or update Vitest alias (BMAD-QA-003).                                    |
| est-server.js                                                          | Only defines a /health endpoint; legacy tests expect inventory/optimization routes that are no longer hosted.                          | Get-Content test-server.js shows minimal harness.                                                         | Expand this harness so integration tests run against deployed API surface.                                 |
| nalysis/ROADMAP.md, nalysis/SYNTHESIS_REPORT.md                        | Both files are zero-length, leaving the BMAD roadmap undocumented.                                                                     | Get-ChildItem analysis                                                                                    | Format-Table Name,Length reports length 0.                                                                 | Populate with the current BMAD roadmap and synthesis summary or remove them from source control. |
| sentia-financial-lakehouse/                                            | Entire subproject excluded from linting and unreferenced elsewhere.                                                                    |
| g 'sentia-financial-lakehouse' only finds ESLint ignore entry.         | Decide whether to archive externally or integrate; otherwise remains unmanaged.                                                        |
| ests/unit/landing/_, ests/unit/services/_                              | Unit tests run, but coverage tooling missing (@vitest/coverage-v8).                                                                    | Coverage run fails: MISSING DEPENDENCY '@vitest/coverage-v8'.                                             | Add coverage dependency and rerun workflow (BMAD-QA-001).                                                  |
| ests/e2e                                                               | Playwright suite cannot execute (@playwright/test missing).                                                                            | pnpm playwright test → "Command not found".                                                               | Install Playwright package/browsers (BMAD-QA-002).                                                         |
| src/**/\*.js, services/**/\*.js                                        | 80+ Math.random() usages drive mock data in production paths.                                                                          | grep count identifies ~80 files generating synthetic metrics.                                             | Replace with deterministic/live data (BMAD-MOCK-010).                                                      |
| src/services/APIIntegration.js, src/components/EnterpriseAIChatbot.jsx | Synthetic fallbacks instead of graceful degradation.                                                                                   | Financial metrics and chatbot fabricate deltas.                                                           | Implement real data fallbacks/user messaging (BMAD-MOCK-010).                                              |
| ✅ mad/bmm/workflows/testarch/automate/workflow.yaml                   | **RESOLVED**: Workflow installed for automated testing & architecture validation.                                                      | Module registered in BMAD manifests; workflow executes 8-step process.                                    | **COMPLETE** - use via mad workflow testarch-automate.                                                     |
| tests/unit/services/admin/\*                                           | Vitest suites failing after upgrading Vitest/Prisma shim. Expectations need updating for new Prisma-returned objects and URL encoding. | pnpm vitest run --reporter=verbose (2025-10-19) shows FeatureFlagService/MfaService assertion mismatches. | Update mocks/assertions to reflect Prisma client output and otpauth encoding.                              |
| tests/e2e/\*                                                           | Playwright command now executes but 140+ specs fail (auth redirects, selector drift).                                                  | pnpm exec playwright test timeout log (2025-10-19) with failing auth/dashboard specs.                     | Update Playwright fixtures/selectors, ensure authenticated context before navigation checks.               |
| tests/unit/services/admin/QueueMonitorService.test.js | ✅ QueueMonitorService vitest suite passing after aligning BullMQ/prisma mocks with lastCheckedAt + new return shapes | ./node_modules/.bin/vitest run tests/unit/services/admin/QueueMonitorService.test.js --reporter=verbose (2025-03-14 18:26) all green | Share updated test harness with other admin suites before rerunning full automation |
| tests/e2e/auth.spec.js, tests/e2e/dashboard-navigation.spec.js | 128 Playwright assertions failing across auth and navigation flows (selectors missing, redirects incorrect) | ./node_modules/.bin/playwright test (2025-03-14) timeout log with 128 fails | Realign UI/routes with auth expectations or update E2E selectors and seeded data before rerun |
| server/**/*.js using new PrismaClient() | Multiple services instantiate PrismaClient directly instead of singleton, risking connection exhaustion under load | grep -R "new PrismaClient" server services (2025-03-14) lists 40+ modules bypassing server/lib/prisma.js | Refactor modules to import shared Prisma instance and add pooling guard |
| src/**, services/** | Randomized metrics remain in production paths despite mock-data ban (Math.random usage >180 hits) | grep -R "Math.random" src services server (2025-03-14) enumerates production components/services | Replace random generators with real data or deterministic placeholders gated to non-production |
