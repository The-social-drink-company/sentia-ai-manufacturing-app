import{j as e}from"./query-CJR12TOn.js";import{k as s,l as a}from"./index-ByKMFRwQ.js";import{a as t}from"./vendor-BPOA5ME_.js";import{T as l}from"./trending-up-CDD6Cm5v.js";import{C as r}from"./check-circle-Dp4l2GnW.js";import{B as c}from"./bar-chart-3-CK_SDpCq.js";import{A as i}from"./alert-circle-Bl17Ci5-.js";import"./auth-CYYSn4IJ.js";const d=s("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),n=s("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),o=()=>{const[s,o]=t.useState(1),[x,m]=t.useState(null),[p,h]=t.useState([]),[u,j]=t.useState(null),[g,b]=t.useState(!0),[N,y]=t.useState(null),[f,v]=t.useState(null);t.useEffect(()=>{w(),S();const e=setInterval(S,1e4);return()=>clearInterval(e)},[]);const w=async()=>{try{const e=await fetch("/api/import/jobs?pageSize=20"),s=await e.json();s.success&&h(s.jobs)}catch(e){a.error("Failed to fetch import history:",e)}finally{b(!1)}},S=async()=>{try{const e=await fetch("/api/queue/stats"),s=await e.json();s.success&&j(s.stats)}catch(e){a.error("Failed to fetch queue stats:",e)}},k=s=>{switch(s){case"completed":return e.jsx(r,{className:"h-4 w-4 text-green-500"});case"completed_with_errors":return e.jsx(i,{className:"h-4 w-4 text-yellow-500"});case"failed":return e.jsx(i,{className:"h-4 w-4 text-red-500"});case"processing":case"validating":return e.jsx(d,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(d,{className:"h-4 w-4 text-gray-500"})}},I=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"completed_with_errors":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";case"processing":case"validating":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Data Import Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Upload, validate, and import data into the manufacturing system"})]}),e.jsxs("button",{onClick:()=>{o(1),m(null),y(null),v(null),w()},className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(n,{className:"h-4 w-4"}),"New Import"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[x&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Import Progress"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"p-2 rounded "+(s>=1?"bg-blue-100":"bg-gray-100"),children:"Step 1: Upload"}),e.jsx("div",{className:"p-2 rounded "+(s>=2?"bg-blue-100":"bg-gray-100"),children:"Step 2: Preview & Map"}),e.jsx("div",{className:"p-2 rounded "+(s>=3?"bg-blue-100":"bg-gray-100"),children:"Step 3: Validate"}),e.jsx("div",{className:"p-2 rounded "+(s>=4?"bg-blue-100":"bg-gray-100"),children:"Step 4: Process"}),e.jsx("div",{className:"p-2 rounded "+(s>=5?"bg-blue-100":"bg-gray-100"),children:"Step 5: Results"})]})]}),u&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsxs("h3",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(l,{className:"h-5 w-5"}),"Queue Status"]}),e.jsx("div",{className:"space-y-3",children:u.available?e.jsx(e.Fragment,{children:Object.entries(u.queues||{}).map(([s,a])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium capitalize",children:s.replace("-"," ")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-yellow-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold",children:a.waiting}),e.jsx("div",{className:"text-yellow-600",children:"Waiting"})]}),e.jsxs("div",{className:"bg-blue-50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-semibold",children:a.active}),e.jsx("div",{className:"text-blue-600",children:"Active"})]})]})]},s))}):e.jsx("div",{className:"text-sm text-gray-500",children:"Queue service unavailable - processing synchronously"})})]})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[1===s&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(n,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Upload Data File"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Select a CSV or Excel file to import"}),e.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:e=>{var s;e.target.files?.[0]&&(s={importJobId:Date.now().toString(),filename:e.target.files[0].name},m({id:s.importJobId,filename:s.filename,status:"uploaded"}),o(2),w())},className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"bg-blue-600 text-white px-6 py-3 rounded cursor-pointer hover:bg-blue-700",children:"Choose File"})]}),s>1&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(r,{className:"h-12 w-12 mx-auto mb-4 text-green-500"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:5===s?"Import Complete":"Processing..."}),e.jsx("p",{className:"text-gray-600",children:x?.filename||"Processing your import"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("h3",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(c,{className:"h-5 w-5"}),"Recent Imports"]})}),e.jsx("div",{className:"p-6",children:g?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Loading import history..."})]}):0===p.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(n,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No imports yet"}),e.jsx("p",{className:"text-sm",children:"Upload your first data file to get started"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"File"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Type"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Rows"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Uploaded"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:p.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-4 py-2 font-medium",children:s.filename}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:"px-2 py-1 text-xs border rounded",children:s.dataType?.replace("_"," ").toUpperCase()})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[k(s.status),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${I(s.status)}`,children:s.status.replace("_"," ")})]})}),e.jsx("td",{className:"px-4 py-2",children:s.totalRows>0&&e.jsxs("span",{className:"text-sm",children:[s.processedRows||0," / ",s.totalRows,s.errorRows>0&&e.jsxs("span",{className:"text-red-600 ml-1",children:["(",s.errorRows," errors)"]})]})}),e.jsx("td",{className:"px-4 py-2 text-sm text-gray-500",children:new Date(s.uploadedAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{onClick:()=>{m(s),o("completed"===s.status||"failed"===s.status?5:4)},className:"text-blue-600 hover:text-blue-800",children:"View"})})]},s.id))})]})})})]})]})};export{o as default};
