import{r as e,u as s,j as t,ac as a}from"./react-core-DkFbty9o.js";import{s as r,o as c,F as n,b as i,d as l,a9 as d,e as x,a as m,q as o,r as h}from"./ui-components-J4-_vVnI.js";import"./vendor-CHbOot_X.js";import"./charts-DxLx1lqX.js";import"./vendor-utils-BvmCeSbq.js";const j=()=>{const[j,y]=e.useState("overview"),[g,u]=e.useState(!0),{data:b,isLoading:N,refetch:v}=s({queryKey:["mcp-status"],queryFn:async()=>{const e=await fetch("/api/mcp/status");if(!e.ok)throw new Error("Failed to fetch MCP status");return e.json()},refetchInterval:!!g&&1e4,retry:2}),{data:f,refetch:p}=s({queryKey:["websocket-stats"],queryFn:async()=>{const e=await fetch("/api/mcp/websocket/stats");if(!e.ok)throw new Error("Failed to fetch WebSocket stats");return e.json()},refetchInterval:!!g&&5e3}),{data:w,refetch:S}=s({queryKey:["sync-status"],queryFn:async()=>{const e=await fetch("/api/mcp/sync/status");if(!e.ok)throw new Error("Failed to fetch sync status");return e.json()},refetchInterval:!!g&&3e4}),k=e=>{switch(e){case"connected":case"success":case"healthy":return"text-green-500";case"syncing":case"connecting":return"text-yellow-500";case"disconnected":case"failed":case"error":return"text-red-500";default:return"text-gray-500"}},C=e=>{switch(e){case"connected":case"success":case"healthy":return t.jsx(h,{className:"w-5 h-5 text-green-500"});case"syncing":case"connecting":return t.jsx(r,{className:"w-5 h-5 text-yellow-500 animate-spin"});case"disconnected":case"failed":case"error":return t.jsx(o,{className:"w-5 h-5 text-red-500"});default:return t.jsx(m,{className:"w-5 h-5 text-gray-500"})}};return N?t.jsx("div",{className:"flex items-center justify-center h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx(r,{className:"w-12 h-12 text-blue-500 animate-spin mx-auto"}),t.jsx("p",{className:"mt-2 text-gray-600",children:"Loading MCP monitoring data..."})]})}):t.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"MCP Integration Monitor"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time monitoring of MCP Server, WebSocket connections, and API synchronization"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("button",{onClick:()=>{v(),p(),S(),a.success("Data refreshed")},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2",children:[t.jsx(r,{className:"w-4 h-4"}),"Refresh"]}),t.jsxs("button",{onClick:()=>u(!g),className:"px-4 py-2 rounded-lg transition-colors flex items-center gap-2 "+(g?"bg-green-500 text-white hover:bg-green-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:[t.jsx(c,{className:"w-4 h-4"}),"Auto-refresh: ",g?"ON":"OFF"]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"MCP Server"}),t.jsx("p",{className:`text-lg font-semibold ${k(b?.mcp?.status)}`,children:b?.mcp?.status||"Unknown"})]}),t.jsx(n,{className:"w-8 h-8 text-gray-400"})]}),t.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Service ID: ",b?.mcp?.serviceId?.substring(0,8),"..."]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"WebSocket"}),t.jsx("p",{className:`text-lg font-semibold ${k(f?.currentStatus)}`,children:f?.currentStatus||"Unknown"})]}),t.jsx(i,{className:"w-8 h-8 text-gray-400"})]}),t.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Uptime: ",f?.uptimeFormatted||"0s"]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Database"}),t.jsx("p",{className:"text-lg font-semibold text-green-500",children:b?.neonBranch||"Unknown"})]}),t.jsx(l,{className:"w-8 h-8 text-gray-400"})]}),t.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"Neon PostgreSQL"})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Auto-Sync"}),t.jsx("p",{className:"text-lg font-semibold "+(w?.enabled?"text-green-500":"text-gray-500"),children:w?.enabled?"Enabled":"Disabled"})]}),t.jsx(d,{className:"w-8 h-8 text-gray-400"})]}),t.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[w?.activeJobs?.length||0," active jobs"]})]})]}),t.jsx("div",{className:"border-b border-gray-200 mb-6",children:t.jsxs("nav",{className:"-mb-px flex space-x-8",children:[t.jsx("button",{onClick:()=>y("overview"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("overview"===j?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Overview"}),t.jsx("button",{onClick:()=>y("websocket"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("websocket"===j?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"WebSocket"}),t.jsx("button",{onClick:()=>y("sync"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("sync"===j?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Synchronization"}),t.jsx("button",{onClick:()=>y("apis"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("apis"===j?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"API Status"})]})}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:["overview"===j&&t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"System Overview"}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"MCP Server Information"}),t.jsxs("dl",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"URL:"}),t.jsx("dd",{className:"text-sm font-mono text-gray-900",children:b?.mcp?.url||"Not configured"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Environment:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:b?.environment})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Service ID:"}),t.jsx("dd",{className:"text-sm font-mono text-gray-900",children:b?.mcp?.serviceId})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"System Metrics"}),t.jsxs("dl",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Messages Received:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.messagesReceived||0})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Success Rate:"}),t.jsxs("dd",{className:"text-sm text-gray-900",children:[f?.successRate||0,"%"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Errors:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.errors||0})]})]})]})]})]}),"websocket"===j&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"WebSocket Connection"}),t.jsx("button",{onClick:async()=>{try{(await fetch("/api/mcp/websocket/reconnect",{method:"POST"})).ok&&(a.success("WebSocket reconnection initiated"),setTimeout(()=>p(),2e3))}catch(e){a.error("Failed to reconnect WebSocket")}},className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:"Reconnect"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Connection Stats"}),t.jsxs("dl",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Status:"}),t.jsxs("dd",{className:"flex items-center gap-2",children:[C(f?.currentStatus),t.jsx("span",{className:`text-sm font-medium ${k(f?.currentStatus)}`,children:f?.currentStatus})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Connection Attempts:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.connectionAttempts||0})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Successful:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.successfulConnections||0})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Failed:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.failedConnections||0})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Message Stats"}),t.jsxs("dl",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Messages Received:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.messagesReceived||0})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Messages Sent:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.messagesSent||0})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Avg Messages/Min:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.averageMessagesPerMinute||0})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("dt",{className:"text-sm text-gray-500",children:"Uptime:"}),t.jsx("dd",{className:"text-sm text-gray-900",children:f?.uptimeFormatted||"0s"})]})]})]})]})]}),"sync"===j&&t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"API Synchronization"}),t.jsxs("button",{onClick:()=>(async e=>{try{const s=e?"/api/mcp/sync/enable":"/api/mcp/sync/disable";(await fetch(s,{method:"POST"})).ok&&(a.success("Auto-sync "+(e?"enabled":"disabled")),setTimeout(()=>S(),1e3))}catch(s){a.error(`Failed to ${e?"enable":"disable"} auto-sync`)}})(!w?.enabled),className:"px-3 py-1 rounded text-sm "+(w?.enabled?"bg-red-500 text-white hover:bg-red-600":"bg-green-500 text-white hover:bg-green-600"),children:[w?.enabled?"Disable":"Enable"," Auto-Sync"]})]}),t.jsx("div",{className:"space-y-4",children:Object.entries(w?.syncStatus||{}).map(([e,s])=>t.jsxs("div",{className:"border rounded-lg p-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[C(s.status),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium capitalize",children:e}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Last sync: ",s.lastSync?new Date(s.lastSync).toLocaleString():"Never"]})]})]}),t.jsx("button",{onClick:()=>(async e=>{try{(await fetch(`/api/mcp/sync/trigger/${e}`,{method:"POST"})).ok&&(a.success(`${e} sync triggered`),setTimeout(()=>S(),2e3))}catch(s){a.error(`Failed to trigger ${e} sync`)}})(e),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:"Sync Now"})]}),s.errors>0&&t.jsxs("div",{className:"mt-2 text-sm text-red-600",children:[s.errors," error(s) occurred"]})]},e))})]}),"apis"===j&&t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"External API Status"}),t.jsx("div",{className:"grid grid-cols-2 gap-4",children:["xero","shopify","amazon","unleashed"].map(e=>{const s=w?.syncStatus?.[e];return t.jsxs("div",{className:"border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium capitalize",children:e}),t.jsx("p",{className:`text-sm mt-1 ${k(s?.status)}`,children:s?.status||"Not configured"})]}),t.jsx(x,{className:"w-6 h-6 text-gray-400"})]}),t.jsxs("div",{className:"mt-3 space-y-1",children:[t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-gray-500",children:"Last Sync:"}),t.jsx("span",{className:"text-gray-700",children:s?.lastSync?new Date(s.lastSync).toLocaleTimeString():"Never"})]}),t.jsxs("div",{className:"flex justify-between text-xs",children:[t.jsx("span",{className:"text-gray-500",children:"Errors:"}),t.jsx("span",{className:"text-gray-700",children:s?.errors||0})]})]})]},e)})})]})]})]})};export{j as default};
