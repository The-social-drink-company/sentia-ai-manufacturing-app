import{bP as e,r as t,as as a,j as r,ai as s,bj as d,aC as i,ak as n,c0 as o,bm as l,bn as c,aE as m,bQ as x,aG as g,F as u,W as y}from"./chunk-CXAPUP0Z.js";import{a as p,c as b,e as h,b as k}from"./index-DlLdO_QQ.js";import"./chunk-CwR8AQSU.js";import"./chunk--CRELh3m.js";import"./chunk-VeJKilaK.js";import"./chunk-DELSdgG9.js";import"./chunk-l5C0fGLm.js";import"./chunk-Kk1dlRB6.js";import"./chunk-DJCy_cXY.js";import"./chunk-Dozjk7Op.js";const v=({status:e,lastUsed:t})=>{const a=(()=>{if("revoked"===e)return{color:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",icon:x,text:"Revoked"};if(!t)return{color:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",icon:g,text:"Never Used"};const a=Math.floor((new Date-new Date(t))/864e5);return a>90?{color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",icon:u,text:"Inactive"}:a>30?{color:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",icon:g,text:"Low Usage"}:{color:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",icon:y,text:"Active"}})(),s=a.icon;return r.jsxs("span",{className:b("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",a.color),children:[r.jsx(s,{className:"w-3 h-3 mr-1"}),a.text]})},j=({apiKey:e,isOpen:a,onClose:s,onSave:d,mode:i="create"})=>{const[n,o]=t.useState(e||{name:"",description:"",scopes:[],expiresAt:null,rateLimitPerHour:1e3,environment:"development"});return a?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[r.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"create"===i?"Create API Key":"Edit API Key"})}),r.jsxs("form",{onSubmit:e=>{e.preventDefault(),d(n)},className:"px-6 py-4 space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Name"}),r.jsx("input",{type:"text",value:n.name,onChange:e=>o({...n,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"My API Key",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Environment"}),r.jsxs("select",{value:n.environment,onChange:e=>o({...n,environment:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[r.jsx("option",{value:"development",children:"Development"}),r.jsx("option",{value:"testing",children:"Testing"}),r.jsx("option",{value:"production",children:"Production"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rate Limit (per hour)"}),r.jsx("input",{type:"number",value:n.rateLimitPerHour,onChange:e=>o({...n,rateLimitPerHour:parseInt(e.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:"1",max:"10000"})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),r.jsx("textarea",{value:n.description,onChange:e=>o({...n,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"What is this API key used for?"})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Expiration (optional)"}),r.jsx("input",{type:"date",value:n.expiresAt?n.expiresAt.split("T")[0]:"",onChange:e=>o({...n,expiresAt:e.target.value?`${e.target.value}T23:59:59Z`:null}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",min:(new Date).toISOString().split("T")[0]})]}),r.jsxs("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Permissions"}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{id:"read",name:"Read Access",description:"View data and reports"},{id:"write",name:"Write Access",description:"Create and update resources"},{id:"delete",name:"Delete Access",description:"Remove resources"},{id:"admin",name:"Admin Access",description:"Full system administration"},{id:"analytics",name:"Analytics",description:"Access to analytics and reports"},{id:"integrations",name:"Integrations",description:"Manage external integrations"}].map(e=>r.jsxs("label",{className:"flex items-start space-x-3",children:[r.jsx("input",{type:"checkbox",checked:n.scopes.includes(e.id),onChange:()=>{return t=e.id,void o(e=>({...e,scopes:e.scopes.includes(t)?e.scopes.filter(e=>e!==t):[...e.scopes,t]}));var t},className:"w-4 h-4 mt-0.5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.description})]})]},e.id))})]})]}),r.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700",children:"Cancel"}),r.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:"create"===i?"Create API Key":"Update API Key"})]})]})]})}):null},f=()=>{const{hasPermission:x}=p(),g=e(),[u,y]=t.useState(null),[f,N]=t.useState("create"),[w,A]=t.useState(!1),[P,C]=t.useState(new Set),[I,T]=t.useState(""),{data:L,isLoading:S}=a({queryKey:["admin","api-keys",I],queryFn:async()=>(await new Promise(e=>setTimeout(e,800)),[{id:1,name:"Production Analytics API",key:"sentia_prod_ak_1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7q8r9s0t",description:"Used by analytics dashboard for real-time data",scopes:["read","analytics"],environment:"production",rateLimitPerHour:5e3,createdAt:"2025-01-01T00:00:00Z",lastUsed:"2025-09-08T12:30:00Z",usageCount:45623,status:"active",expiresAt:null},{id:2,name:"Development Testing Key",key:"sentia_dev_ak_9z8y7x6w5v4u3t2s1r0q9p8o7n6m5l4k3j2i1h0g",description:"Testing API integration during development",scopes:["read","write"],environment:"development",rateLimitPerHour:1e3,createdAt:"2025-08-15T00:00:00Z",lastUsed:"2025-09-07T16:45:00Z",usageCount:1234,status:"active",expiresAt:null},{id:3,name:"Legacy Integration Key",key:"sentia_leg_ak_f9e8d7c6b5a4938271605948372615048372610593",description:"Legacy system integration - scheduled for deprecation",scopes:["read"],environment:"production",rateLimitPerHour:100,createdAt:"2024-06-01T00:00:00Z",lastUsed:"2024-12-15T10:20:00Z",usageCount:8456,status:"active",expiresAt:"2025-12-31T23:59:59Z"},{id:4,name:"Revoked Admin Key",key:"sentia_rev_ak_0000000000000000000000000000000000000000",description:"Former admin key - revoked for security reasons",scopes:["admin"],environment:"production",rateLimitPerHour:0,createdAt:"2024-03-01T00:00:00Z",lastUsed:"2024-03-15T09:30:00Z",usageCount:234,status:"revoked",expiresAt:null}]),refetchInterval:3e4}),K=L?.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())||e.description.toLowerCase().includes(I.toLowerCase())||e.environment.toLowerCase().includes(I.toLowerCase()))||[];return x("admin.api.manage")?S?r.jsx("div",{className:"p-6 space-y-6",children:r.jsxs("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-6"}),r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[...Array(4)].map((e,t)=>r.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"}),r.jsx("div",{className:"h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]})})},t))})]})}):r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"API Keys & Tokens"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage API keys, authentication tokens, and external service credentials"})]}),x("admin.api.create")&&r.jsxs("button",{onClick:()=>{y(null),N("create"),A(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[r.jsx(d,{className:"w-5 h-5"}),r.jsx("span",{children:"Create API Key"})]})]}),r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:r.jsx("input",{type:"text",placeholder:"Search API keys...",value:I,onChange:e=>T(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})}),r.jsxs("div",{className:"space-y-4",children:[K.map(e=>{const t=P.has(e.id),a=`${e.key.substring(0,20)}${"â€¢".repeat(20)}${e.key.substring(e.key.length-8)}`;return r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:e.name}),r.jsx(v,{status:e.status,lastUsed:e.lastUsed}),r.jsx("span",{className:b("px-2 py-1 text-xs font-medium rounded-full","production"===e.environment?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"testing"===e.environment?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"),children:e.environment})]}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:e.description}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-3 mb-3",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("code",{className:"text-sm font-mono text-gray-800 dark:text-gray-200",children:t?e.key:a}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>{return t=e.id,void C(e=>{const a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a});var t},className:"p-1 text-gray-500 hover:text-gray-700",title:t?"Hide":"Show",children:t?r.jsx(i,{className:"w-4 h-4"}):r.jsx(n,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{return t=e.key,void navigator.clipboard.writeText(t);var t},className:"p-1 text-gray-500 hover:text-gray-700",title:"Copy to clipboard",children:r.jsx(o,{className:"w-4 h-4"})})]})]})}),r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Scopes:"}),r.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.scopes.map(e=>r.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-700 rounded dark:bg-gray-700 dark:text-gray-300",children:e},e))})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Rate Limit:"}),r.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[e.rateLimitPerHour,"/hour"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Usage:"}),r.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[(s=e.usageCount,s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(1)}K`:s.toString())," requests"]})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Expires:"}),r.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.expiresAt?new Date(e.expiresAt).toLocaleDateString():"Never"})]})]})]}),r.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[x("admin.api.edit")&&"revoked"!==e.status&&r.jsx("button",{onClick:()=>(y(e),N("edit"),void A(!0)),className:"p-2 text-blue-500 hover:text-blue-700",title:"Edit API Key",children:r.jsx(l,{className:"w-4 h-4"})}),x("admin.api.delete")&&"revoked"!==e.status&&r.jsx("button",{onClick:()=>(async e=>{if(confirm("This will immediately revoke the API key. This action cannot be undone. Continue?"))try{await new Promise(e=>setTimeout(e,500)),g.invalidateQueries(["admin","api-keys"]),h("API key revoked",{component:"AdminAPI",keyId:e})}catch(t){k("Error revoking API key",t,{component:"AdminAPI",keyId:e})}})(e.id),className:"p-2 text-red-500 hover:text-red-700",title:"Revoke API Key",children:r.jsx(c,{className:"w-4 h-4"})})]})]})},e.id);var s}),0===K.length&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(m,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No API keys found"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:I?"Try adjusting your search terms":"Create your first API key to get started"})]})]}),r.jsx(j,{apiKey:u,isOpen:w,onClose:()=>A(!1),onSave:async e=>{try{await new Promise(e=>setTimeout(e,1e3)),g.invalidateQueries(["admin","api-keys"]),A(!1),h("API key saved",{component:"AdminAPI",keyData:e})}catch(t){k("Error saving API key",t,{component:"AdminAPI"})}},mode:f})]}):r.jsxs("div",{className:"p-6 text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(s,{className:"w-8 h-8 text-red-600"})}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Access Denied"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to manage API keys."})]})};export{f as default};
