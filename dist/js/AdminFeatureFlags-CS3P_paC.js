import{bP as e,a,as as t,bo as r,j as s,ai as d,bj as n,E as l,B as i,C as o,bm as c,bx as g}from"./chunk-F7gpAtKD.js";import{a as x,c as m,e as u,b}from"./index-DEDs369m.js";import"./chunk-B9jrG6yD.js";import"./chunk-D9wpZLT8.js";import"./chunk-DY4mEHZe.js";import"./chunk-DV2nQ5Q7.js";import"./chunk-Chgu22X3.js";import"./chunk-GXuKHzD9.js";import"./chunk-Dozjk7Op.js";const y=({enabled:e,onToggle:a,disabled:t=!1})=>s.jsx("button",{onClick:a,disabled:t,className:m("relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",e?"bg-blue-600":"bg-gray-200 dark:bg-gray-600",t&&"opacity-50 cursor-not-allowed"),children:s.jsx("span",{className:m("inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200 ease-in-out",e?"translate-x-6":"translate-x-1")})}),h=({percentage:e,onChange:a,disabled:t=!1})=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("input",{type:"range",min:"0",max:"100",value:e,onChange:e=>a(parseInt(e.target.value)),disabled:t,className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"}),s.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white w-10",children:[e,"%"]})]}),p=({roles:e,onChange:a,disabled:t=!1})=>s.jsx("div",{className:"flex flex-wrap gap-2",children:["admin","manager","operator","viewer"].map(r=>s.jsx("button",{onClick:()=>(r=>{if(t)return;const s=e.includes(r)?e.filter(e=>e!==r):[...e,r];a(s)})(r),disabled:t,className:m("px-2 py-1 text-xs font-medium rounded-full border transition-colors",e.includes(r)?"bg-blue-100 text-blue-800 border-blue-300 dark:bg-blue-900 dark:text-blue-200 dark:border-blue-700":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-400 dark:border-gray-600 dark:hover:bg-gray-600",t&&"opacity-50 cursor-not-allowed"),children:r},r))}),f=({flag:e,isOpen:t,onClose:r,onSave:d,mode:n="create"})=>{const[l,i]=a.useState(e||{flagKey:"",name:"",description:"",isEnabled:!1,rolloutPercentage:100,targetRoles:[],environment:"production"});return t?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"create"===n?"Create Feature Flag":"Edit Feature Flag"})}),s.jsxs("form",{onSubmit:e=>{e.preventDefault(),d(l)},className:"px-6 py-4 space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Flag Key"}),s.jsx("input",{type:"text",value:l.flagKey,onChange:e=>i({...l,flagKey:e.target.value}),placeholder:"e.g., feature_new_dashboard",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0,disabled:"edit"===n}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Unique identifier for this feature flag (cannot be changed after creation)"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Display Name"}),s.jsx("input",{type:"text",value:l.name,onChange:e=>i({...l,name:e.target.value}),placeholder:"e.g., New Dashboard Interface",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),s.jsx("textarea",{value:l.description,onChange:e=>i({...l,description:e.target.value}),rows:3,placeholder:"Describe what this feature flag controls...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Initial State"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(y,{enabled:l.isEnabled,onToggle:()=>i({...l,isEnabled:!l.isEnabled})}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:l.isEnabled?"Enabled":"Disabled"})]})]}),l.isEnabled&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Rollout Percentage"}),s.jsx(h,{percentage:l.rolloutPercentage,onChange:e=>i({...l,rolloutPercentage:e})}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"What percentage of users should see this feature"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Target Roles (optional)"}),s.jsx(p,{roles:l.targetRoles,onChange:e=>i({...l,targetRoles:e})}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Leave empty to target all roles, or select specific roles"})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 dark:hover:bg-gray-700",children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:"create"===n?"Create Flag":"Save Changes"})]})]})]})}):null},j=()=>{const{hasPermission:p}=x(),j=e(),[v,k]=a.useState(""),[N,w]=a.useState("all"),[C,E]=a.useState("all"),[F,S]=a.useState(null),[T,A]=a.useState("create"),[_,P]=a.useState(!1),[D,R]=a.useState(new Set),{data:B,isLoading:I}=t({queryKey:["admin","feature-flags",v,N,C],queryFn:async()=>(await new Promise(e=>setTimeout(e,800)),[{id:1,flagKey:"feature_enhanced_dashboard",name:"Enhanced Dashboard Interface",description:"New dashboard with improved widgets and real-time data visualization",isEnabled:!0,rolloutPercentage:100,targetRoles:["admin","manager"],environment:"production",createdBy:"john.admin@company.com",updatedBy:"sarah.manager@company.com",createdAt:"2024-12-01T00:00:00Z",updatedAt:"2025-01-15T10:30:00Z",usageCount:245},{id:2,flagKey:"feature_working_capital_optimizer",name:"Working Capital Optimizer",description:"Advanced working capital optimization algorithms and recommendations",isEnabled:!1,rolloutPercentage:0,targetRoles:[],environment:"development",createdBy:"mike.dev@company.com",updatedBy:"mike.dev@company.com",createdAt:"2025-01-10T00:00:00Z",updatedAt:"2025-01-10T00:00:00Z",usageCount:0},{id:3,flagKey:"feature_forecast_beta",name:"Forecasting Beta Features",description:"Beta testing for new forecasting algorithms and UI improvements",isEnabled:!0,rolloutPercentage:25,targetRoles:["admin"],environment:"test",createdBy:"sarah.manager@company.com",updatedBy:"sarah.manager@company.com",createdAt:"2025-01-05T00:00:00Z",updatedAt:"2025-01-14T16:20:00Z",usageCount:67},{id:4,flagKey:"feature_mobile_responsive",name:"Mobile Responsive Layout",description:"Mobile-optimized layouts for all dashboard pages",isEnabled:!0,rolloutPercentage:50,targetRoles:[],environment:"test",createdBy:"emma.designer@company.com",updatedBy:"emma.designer@company.com",createdAt:"2024-11-20T00:00:00Z",updatedAt:"2025-01-12T14:15:00Z",usageCount:123}]),refetchInterval:3e4}),K=B?.filter(e=>{const a=""===v||e.name.toLowerCase().includes(v.toLowerCase())||e.flagKey.toLowerCase().includes(v.toLowerCase())||e.description.toLowerCase().includes(v.toLowerCase()),t="all"===N||e.environment===N,r="all"===C||"enabled"===C&&e.isEnabled||"disabled"===C&&!e.isEnabled;return a&&t&&r})||[],L=r({mutationFn:async({flagId:e,enabled:a})=>(await new Promise(e=>setTimeout(e,500)),u("Toggling feature flag",{component:"AdminFeatureFlags",flagId:e,enabled:a}),{success:!0}),onSuccess:()=>{j.invalidateQueries(["admin","feature-flags"])}}),Z=r({mutationFn:async({flagId:e,percentage:a})=>(await new Promise(e=>setTimeout(e,500)),u("Updating rollout percentage",{component:"AdminFeatureFlags",flagId:e,percentage:a}),{success:!0}),onSuccess:()=>{j.invalidateQueries(["admin","feature-flags"])}}),z=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return p("admin.feature_flags.view")?I?s.jsx("div",{className:"p-6 space-y-6",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/4 mb-6"}),s.jsx("div",{className:"space-y-4",children:[...Array(4)].map((e,a)=>s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/3"}),s.jsx("div",{className:"h-6 w-11 bg-gray-200 dark:bg-gray-700 rounded-full"})]}),s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-2"}),s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]},a))})]})}):s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Feature Flags"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Control feature rollouts and experiment with new functionality"})]}),p("admin.feature_flags.create")&&s.jsxs("button",{onClick:()=>{S(null),A("create"),P(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[s.jsx(n,{className:"w-5 h-5"}),s.jsx("span",{children:"Create Flag"})]})]}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:s.jsxs("div",{className:"flex flex-wrap gap-4",children:[s.jsx("div",{className:"flex-1 min-w-64",children:s.jsxs("div",{className:"relative",children:[s.jsx(l,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search feature flags...",value:v,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]})}),s.jsxs("select",{value:N,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[s.jsx("option",{value:"all",children:"All Environments"}),s.jsx("option",{value:"development",children:"Development"}),s.jsx("option",{value:"test",children:"Test"}),s.jsx("option",{value:"production",children:"Production"})]}),s.jsxs("select",{value:C,onChange:e=>E(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"enabled",children:"Enabled"}),s.jsx("option",{value:"disabled",children:"Disabled"})]})]})}),s.jsx("div",{className:"space-y-4",children:K.map(e=>{const a=D.has(e.id);return s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx("button",{onClick:()=>{return a=e.id,void R(e=>{const t=new Set(e);return t.has(a)?t.delete(a):t.add(a),t});var a},className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:a?s.jsx(i,{className:"w-5 h-5"}):s.jsx(o,{className:"w-5 h-5"})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:e.name}),s.jsx("span",{className:m("px-2 py-1 text-xs font-medium rounded-full","production"===e.environment?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"test"===e.environment?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"),children:e.environment})]}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:e.description}),s.jsxs("div",{className:"flex items-center space-x-6",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status:"}),s.jsx(y,{enabled:e.isEnabled,onToggle:()=>(e=>{p("admin.feature_flags.edit")&&L.mutate({flagId:e.id,enabled:!e.isEnabled})})(e),disabled:!p("admin.feature_flags.edit")}),s.jsx("span",{className:m("text-sm font-medium",e.isEnabled?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:e.isEnabled?"Enabled":"Disabled"})]}),e.isEnabled&&s.jsxs("div",{className:"flex items-center space-x-2 min-w-48",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Rollout:"}),s.jsx(h,{percentage:e.rolloutPercentage,onChange:a=>((e,a)=>{p("admin.feature_flags.edit")&&Z.mutate({flagId:e.id,percentage:a})})(e,a),disabled:!p("admin.feature_flags.edit")})]})]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:p("admin.feature_flags.edit")&&s.jsx("button",{onClick:()=>(e=>{S(e),A("edit"),P(!0)})(e),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",title:"Edit Flag",children:s.jsx(c,{className:"w-4 h-4"})})})]}),a&&s.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Configuration"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Flag Key:"}),s.jsx("span",{className:"font-mono text-gray-900 dark:text-white",children:e.flagKey})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Environment:"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:e.environment})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Usage Count:"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:e.usageCount})]}),e.targetRoles.length>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Target Roles:"}),s.jsx("div",{className:"flex space-x-1",children:e.targetRoles.map(e=>s.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded dark:bg-blue-900 dark:text-blue-200",children:e},e))})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Audit Trail"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Created by:"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:e.createdBy})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Created:"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:z(e.createdAt)})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Last updated by:"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:e.updatedBy})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Last updated:"}),s.jsx("span",{className:"text-gray-900 dark:text-white",children:z(e.updatedAt)})]})]})]})]})})]},e.id)})}),0===K.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(g,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No feature flags found"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:v?"Try adjusting your search or filters":"Get started by creating your first feature flag"})]}),s.jsx(f,{flag:F,isOpen:_,onClose:()=>P(!1),onSave:async e=>{try{await new Promise(e=>setTimeout(e,1e3)),j.invalidateQueries(["admin","feature-flags"]),P(!1),u("Feature flag saved",{component:"AdminFeatureFlags",flagData:e})}catch(a){b("Error saving feature flag",a,{component:"AdminFeatureFlags"})}},mode:T})]}):s.jsxs("div",{className:"p-6 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(d,{className:"w-8 h-8 text-red-600"})}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Access Denied"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to view feature flags."})]})};export{j as default};
