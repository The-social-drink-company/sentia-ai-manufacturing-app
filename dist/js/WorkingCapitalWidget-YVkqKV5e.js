import{a6 as e,u as t,j as a,a8 as r,a5 as s}from"./react-core-DkFbty9o.js";import{useAuth as i}from"./auth-M1VfQxmO.js";import{W as n,a as o,b as l,M as d,D as c}from"./WidgetComponents-Dzf-eyWG.js";import{T as x,W as g}from"./ui-components-J4-_vVnI.js";import"./vendor-CHbOot_X.js";import"./charts-DxLx1lqX.js";import"./vendor-utils-BvmCeSbq.js";import"./animation-CTJwy-Vh.js";const m=()=>{const{getToken:m}=i(),h=e(),{data:p,isLoading:b,error:y,refetch:u,isRefetching:v}=t({queryKey:["working-capital"],queryFn:async()=>{const e=await m(),t=await fetch("https://sentia-manufacturing-production.onrender.com/api/api/financial/working-capital",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return j();throw new Error(`Failed to fetch working capital data: ${t.statusText}`)}return t.json()},refetchInterval:6e4,retry:2,retryDelay:1e3}),j=()=>({summary:{workingCapital:789200,currentAssets:2345600,currentLiabilities:1556400,cashConversionCycle:45,operatingCashFlow:423500,freeCashFlow:312400,liquidityRatio:1.51,quickRatio:1.18},components:{cash:456e3,accountsReceivable:892300,inventory:997300,accountsPayable:645200,shortTermDebt:32e4,otherCurrentLiabilities:591200},trends:{labels:["Jan","Feb","Mar","Apr","May","Jun"],workingCapital:[72e4,745e3,76e4,775e3,78e4,789200],currentRatio:[1.42,1.44,1.47,1.49,1.5,1.51],cashFlow:[38e4,395e3,41e4,415e3,42e4,423500]},receivables:{total:892300,current:65e4,overdue30:15e4,overdue60:75e3,overdue90:17300,dso:42},payables:{total:645200,current:52e4,due30:95e3,due60:30200,dpo:38},inventory:{rawMaterials:35e4,wip:247300,finishedGoods:4e5,turnoverRatio:8.5,dio:43},cashManagement:{operatingActivities:423500,investingActivities:-111100,financingActivities:-85e3,netChange:227400,beginningCash:228600,endingCash:456e3},forecast:{nextMonth:{workingCapital:805e3,change:15800,percentChange:2},nextQuarter:{workingCapital:845e3,change:55800,percentChange:7.1}}});if(b&&!p)return a.jsx(n,{title:"Working Capital Management",height:"400px"});if(y&&!p)return a.jsx(o,{error:y,onRetry:u,title:"Working Capital Management"});const k=p||j(),C={labels:["Cash","A/R","Inventory","A/P","Short-Term Debt","Other Liabilities"],datasets:[{data:[k.components?.cash||0,k.components?.accountsReceivable||0,k.components?.inventory||0,k.components?.accountsPayable||0,k.components?.shortTermDebt||0,k.components?.otherCurrentLiabilities||0],backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(59, 130, 246, 0.8)","rgba(245, 158, 11, 0.8)","rgba(239, 68, 68, 0.8)","rgba(168, 85, 247, 0.8)","rgba(107, 114, 128, 0.8)"],borderColor:["rgb(16, 185, 129)","rgb(59, 130, 246)","rgb(245, 158, 11)","rgb(239, 68, 68)","rgb(168, 85, 247)","rgb(107, 114, 128)"],borderWidth:1}]},f={labels:k.trends?.labels||[],datasets:[{label:"Working Capital",data:k.trends?.workingCapital||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,yAxisID:"y"},{label:"Operating Cash Flow",data:k.trends?.cashFlow||[],borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4,yAxisID:"y"}]},N=e=>e>=1e6?`$${(e/1e6).toFixed(2)}M`:`$${(e/1e3).toFixed(0)}k`,w=[{key:"aging",label:"Aging"},{key:"amount",label:"Amount",render:e=>N(e)},{key:"percentage",label:"%",render:e=>`${e}%`}],R=[{aging:"Current",amount:k.receivables?.current||0,percentage:((k.receivables?.current||0)/(k.receivables?.total||1)*100).toFixed(1)},{aging:"30 Days",amount:k.receivables?.overdue30||0,percentage:((k.receivables?.overdue30||0)/(k.receivables?.total||1)*100).toFixed(1)},{aging:"60 Days",amount:k.receivables?.overdue60||0,percentage:((k.receivables?.overdue60||0)/(k.receivables?.total||1)*100).toFixed(1)},{aging:"90+ Days",amount:k.receivables?.overdue90||0,percentage:((k.receivables?.overdue90||0)/(k.receivables?.total||1)*100).toFixed(1)}];return a.jsxs(l,{title:"Working Capital Management",onRefresh:()=>{h.invalidateQueries(["working-capital"]),u()},isRefreshing:v,className:"col-span-2",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[a.jsx(d,{label:"Working Capital",value:N(k.summary?.workingCapital||0),trend:{direction:k.summary?.workingCapital>75e4?"up":"down",value:3.5},icon:x}),a.jsx(d,{label:"Current Ratio",value:k.summary?.liquidityRatio||0,trend:{direction:k.summary?.liquidityRatio>1.5?"up":"down",value:2.1}}),a.jsx(d,{label:"Cash Conversion",value:k.summary?.cashConversionCycle||0,unit:"days",icon:g}),a.jsx(d,{label:"Operating Cash",value:N(k.summary?.operatingCashFlow||0),trend:{direction:"up",value:5.2}})]}),a.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Cash Conversion Cycle Components"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-2xl font-bold text-blue-600",children:k.receivables?.dso||0}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Days Sales Outstanding"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:k.inventory?.dio||0}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Days Inventory Outstanding"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-2xl font-bold text-green-600",children:k.payables?.dpo||0}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Days Payables Outstanding"})]})]}),a.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600 text-center",children:[a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Net Cash Conversion Cycle"}),a.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:[(k.receivables?.dso||0)+(k.inventory?.dio||0)-(k.payables?.dpo||0)," days"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Working Capital Components"}),a.jsx("div",{style:{height:"250px"},children:a.jsx(r,{data:C,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{boxWidth:12}}}}})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Working Capital Trend"}),a.jsx("div",{style:{height:"250px"},children:a.jsx(s,{data:f,options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top"}},scales:{y:{type:"linear",display:!0,position:"left",ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"k"}}}}}})})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Accounts Receivable Aging"}),a.jsx(c,{columns:w,data:R}),a.jsxs("div",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Total Receivables: ",N(k.receivables?.total||0)]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Inventory Analysis"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Raw Materials"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:N(k.inventory?.rawMaterials||0)})]}),a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Work in Progress"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:N(k.inventory?.wip||0)})]}),a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Finished Goods"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:N(k.inventory?.finishedGoods||0)})]})]}),a.jsxs("div",{className:"mt-2 flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[a.jsxs("span",{children:["Turnover Ratio: ",k.inventory?.turnoverRatio||0,"x"]}),a.jsxs("span",{children:["Total: ",N((k.inventory?.rawMaterials||0)+(k.inventory?.wip||0)+(k.inventory?.finishedGoods||0))]})]})]}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Working Capital Forecast"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Next Month"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:N(k.forecast?.nextMonth?.workingCapital||0)}),a.jsxs("p",{className:"text-sm "+(k.forecast?.nextMonth?.percentChange>0?"text-green-600":"text-red-600"),children:[k.forecast?.nextMonth?.percentChange>0?"+":"",k.forecast?.nextMonth?.percentChange,"%"]})]}),a.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Next Quarter"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:N(k.forecast?.nextQuarter?.workingCapital||0)}),a.jsxs("p",{className:"text-sm "+(k.forecast?.nextQuarter?.percentChange>0?"text-green-600":"text-red-600"),children:[k.forecast?.nextQuarter?.percentChange>0?"+":"",k.forecast?.nextQuarter?.percentChange,"%"]})]})]})]}),a.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})};export{m as default};
