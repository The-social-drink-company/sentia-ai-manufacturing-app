import{j as e}from"./query-CJR12TOn.js";import{l as a}from"./index-CfL-Lj38.js";import{a as t}from"./vendor-BPOA5ME_.js";import{c as i,u as s}from"./auth-CYYSn4IJ.js";import{a as n}from"./axios-3c2ZL6GZ.js";function r(){const{getToken:r,isLoaded:l}=i(),{user:d,isLoaded:o}=s(),[c,h]=t.useState([]),[m,p]=t.useState([]),[u,j]=t.useState(!0),[v,x]=t.useState(null),[g,b]=t.useState(""),[f,N]=t.useState("user"),[y,_]=t.useState(!1);t.useEffect(()=>{l&&o&&d&&(A(),$())},[l,o,d]);const A=async()=>{try{const e=await r();if(!e)return void x("Authentication token not available");const a="https://sentiaprod.financeflo.ai/api",t=await n.get(`${a}/admin/users`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});h(t.data.users||[]),x(null)}catch(e){a.error("Error fetching users:",e),x(e.response?.data?.message||"Failed to fetch users")}},$=async()=>{try{const e=await r();if(!e)return void a.warn("No token available for fetching invitations");const t="https://sentiaprod.financeflo.ai/api",i=await n.get(`${t}/admin/invitations`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});p(i.data.invitations||[])}catch(e){a.error("Error fetching invitations:",e),404!==e.response?.status&&x(e.response?.data?.message||"Failed to fetch invitations")}finally{j(!1)}};return l&&o?d?"admin"!==d?.publicMetadata?.role&&"super_admin"!==d?.publicMetadata?.role?e.jsxs("div",{className:"admin-error",children:[e.jsx("h2",{children:"Access Denied"}),e.jsx("p",{children:"You do not have administrator privileges to access this panel."})]}):u?e.jsx("div",{className:"admin-loading",children:e.jsx("div",{className:"spinner",children:"Loading admin panel..."})}):e.jsxs("div",{className:"admin-panel",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"Admin Panel"}),e.jsx("p",{children:"Manage users and access permissions for the Sentia Manufacturing Dashboard"})]}),v&&e.jsx("div",{className:"admin-error",children:e.jsx("p",{children:v})}),e.jsxs("div",{className:"admin-section",children:[e.jsx("h2",{children:"Send Invitation"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),g.trim())try{_(!0);const e=await r();if(!e)return void alert("Authentication token not available");const a="https://sentiaprod.financeflo.ai/api";await n.post(`${a}/admin/invite`,{email:g.trim(),role:f,invitedBy:d.id},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),b(""),N("user"),$(),alert("Invitation sent successfully!")}catch(t){a.error("Error sending invitation:",t),alert("Failed to send invitation: "+(t.response?.data?.error||t.message))}finally{_(!1)}},className:"invite-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"inviteEmail",children:"Email Address:"}),e.jsx("input",{type:"email",id:"inviteEmail",value:g,onChange:e=>b(e.target.value),placeholder:"user@company.com",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"inviteRole",children:"Role:"}),e.jsxs("select",{id:"inviteRole",value:f,onChange:e=>N(e.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:y,children:y?"Sending...":"Send Invitation"})]})]}),e.jsxs("div",{className:"admin-section",children:[e.jsxs("h2",{children:["Pending Invitations (",m.length,")"]}),m.length>0?e.jsx("div",{className:"invitations-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Invited By"}),e.jsx("th",{children:"Date Sent"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:m.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.email}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${t.role}`,children:t.role})}),e.jsx("td",{children:t.invited_by_email}),e.jsx("td",{children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${t.status}`,children:t.status})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>(async e=>{try{const a=await r();if(!a)return void alert("Authentication token not available");const t="https://sentiaprod.financeflo.ai/api";await n.delete(`${t}/admin/invitations/${e}`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),$(),alert("Invitation deleted successfully!")}catch(t){a.error("Error deleting invitation:",t),alert("Failed to delete invitation: "+(t.response?.data?.error||t.message))}})(t.id),className:"btn btn-danger btn-sm",children:"Delete"})})]},t.id))})]})}):e.jsx("p",{className:"no-data",children:"No pending invitations"})]}),e.jsxs("div",{className:"admin-section",children:[e.jsxs("h2",{children:["User Management (",c.length,")"]}),c.length>0?e.jsx("div",{className:"users-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Last Sign In"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:c.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.username||"N/A"}),e.jsx("td",{children:t.email_addresses?.[0]?.email_address||"N/A"}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${t.public_metadata?.role||"user"}`,children:t.public_metadata?.role||"user"})}),e.jsx("td",{children:e.jsx("span",{className:"status-badge "+(t.public_metadata?.approved?"approved":"pending"),children:t.public_metadata?.approved?"Approved":"Pending"})}),e.jsx("td",{children:t.last_sign_in_at?new Date(t.last_sign_in_at).toLocaleDateString():"Never"}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[!t.public_metadata?.approved&&"admin"!==t.public_metadata?.role&&e.jsx("button",{onClick:()=>(async e=>{try{const a=await r();if(!a)return void alert("Authentication token not available");const t="https://sentiaprod.financeflo.ai/api";await n.post(`${t}/admin/users/${e}/approve`,{},{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),A(),alert("User approved successfully!")}catch(t){a.error("Error approving user:",t),alert("Failed to approve user: "+(t.response?.data?.error||t.message))}})(t.id),className:"btn btn-success btn-sm",children:"Approve"}),t.public_metadata?.approved&&"admin"!==t.public_metadata?.role&&e.jsx("button",{onClick:()=>(async e=>{try{const a=await r();if(!a)return void alert("Authentication token not available");const t="https://sentiaprod.financeflo.ai/api";await n.post(`${t}/admin/users/${e}/revoke`,{},{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),A(),alert("User access revoked successfully!")}catch(t){a.error("Error revoking user:",t),alert("Failed to revoke user: "+(t.response?.data?.error||t.message))}})(t.id),className:"btn btn-warning btn-sm",children:"Revoke"}),"admin"===t.public_metadata?.role&&e.jsx("span",{className:"admin-indicator",children:"Admin User"})]})})]},t.id))})]})}):e.jsx("p",{className:"no-data",children:"No users found"})]})]}):e.jsxs("div",{className:"admin-error",children:[e.jsx("h2",{children:"Authentication Required"}),e.jsx("p",{children:"Please sign in to access the admin panel."})]}):e.jsx("div",{className:"admin-loading",children:e.jsx("div",{className:"spinner",children:"Loading authentication..."})})}export{r as default};
