<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CapLiquify Platform - Emergency Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@clerk/clerk-js@5/dist/clerk.browser.js"></script>
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        .progress-bar {
            animation: progress 10s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Loading Screen -->
    <div id="loading-screen" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full mx-4">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    üè≠ CapLiquify Platform
                </h1>
                <p class="text-gray-600">
                    Enterprise Manufacturing Intelligence Platform
                </p>
            </div>
            
            <!-- Progressive Loading Indicator -->
            <div class="mb-6">
                <div class="flex items-center justify-center mb-4">
                    <div class="spinner rounded-full h-10 w-10 border-b-2 border-blue-600"></div>
                </div>
                <div class="text-center">
                    <p class="text-sm text-gray-700 mb-3 font-medium" id="loading-text">
                        Stage 1: Initializing Clerk Authentication...
                    </p>
                    <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                        <div class="bg-blue-600 h-3 rounded-full transition-all duration-500 ease-out" id="progress-bar" style="width: 10%"></div>
                    </div>
                    <p class="text-xs text-gray-500" id="stage-info">
                        1 of 10 stages ‚Ä¢ 10% complete
                    </p>
                </div>
            </div>
            
            <!-- Loading stages checklist -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="font-semibold text-gray-800 mb-3 text-sm">System Initialization:</h3>
                <div class="space-y-2" id="stages-list">
                    <!-- Stages will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication Screen -->
    <div id="auth-screen" class="min-h-screen bg-gradient-to-br from-blue-600 to-indigo-700 flex items-center justify-center" style="display: none;">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    üè≠ CapLiquify Platform
                </h1>
                <p class="text-gray-600 mb-6">
                    Enterprise Manufacturing Intelligence Platform
                </p>
                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center">
                        <div class="text-green-600 mr-3">‚úÖ</div>
                        <div class="text-left">
                            <p class="text-green-800 font-semibold text-sm">All Systems Ready</p>
                            <p class="text-green-700 text-xs">10-stage initialization complete</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Clerk Authentication Container -->
            <div id="clerk-auth-container">
                <!-- Clerk will mount here -->
            </div>
            
            <!-- Manual Sign-In Button (fallback) -->
            <div id="manual-auth" style="display: none;">
                <button onclick="proceedToDashboard()" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors shadow-lg">
                    Sign In to Dashboard
                </button>
                <p class="text-xs text-gray-500 text-center mt-2">
                    Emergency access - Clerk authentication unavailable
                </p>
            </div>
            
            <!-- Enterprise Features Preview -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-semibold text-gray-800 mb-3 text-sm">Enterprise Features:</h3>
                <div class="grid grid-cols-2 gap-2 text-xs text-gray-600">
                    <div class="flex items-center">
                        <span class="text-blue-600 mr-2">üìä</span>
                        Production Monitoring
                    </div>
                    <div class="flex items-center">
                        <span class="text-blue-600 mr-2">üî¨</span>
                        Quality Control
                    </div>
                    <div class="flex items-center">
                        <span class="text-blue-600 mr-2">üì¶</span>
                        Inventory Management
                    </div>
                    <div class="flex items-center">
                        <span class="text-blue-600 mr-2">ü§ñ</span>
                        AI Analytics
                    </div>
                    <div class="flex items-center">
                        <span class="text-blue-600 mr-2">üîß</span>
                        Digital Twin
                    </div>
                    <div class="flex items-center">
                        <span class="text-blue-600 mr-2">‚ö°</span>
                        Automation
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard-screen" class="min-h-screen bg-gray-50" style="display: none;">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-gray-900">
                            üè≠ CapLiquify Platform Enterprise
                        </h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600">Welcome back!</span>
                        <button onclick="signOut()" class="bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded text-sm">
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Dashboard Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Success Message -->
            <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-8">
                <div class="flex items-center">
                    <div class="text-green-600 text-2xl mr-4">üéâ</div>
                    <div>
                        <h2 class="text-green-800 font-bold text-lg">Enterprise Dashboard Operational!</h2>
                        <p class="text-green-700">
                            Authentication successful. All 10 enterprise systems initialized and ready.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <div class="text-sm font-medium text-gray-600">Production Efficiency</div>
                    <div class="text-2xl font-bold text-gray-900 mt-1">94.2%</div>
                    <div class="text-sm text-green-600 mt-1">‚Üó +2.1% from last week</div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <div class="text-sm font-medium text-gray-600">Quality Score</div>
                    <div class="text-2xl font-bold text-gray-900 mt-1">98.7%</div>
                    <div class="text-sm text-green-600 mt-1">‚Üó +0.3% from last week</div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <div class="text-sm font-medium text-gray-600">Active Lines</div>
                    <div class="text-2xl font-bold text-gray-900 mt-1">12/14</div>
                    <div class="text-sm text-yellow-600 mt-1">2 in maintenance</div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                    <div class="text-sm font-medium text-gray-600">Inventory Turnover</div>
                    <div class="text-2xl font-bold text-gray-900 mt-1">8.3x</div>
                    <div class="text-sm text-green-600 mt-1">‚Üó +0.7x from last month</div>
                </div>
            </div>

            <!-- Enterprise Features Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="text-3xl mb-3">üìä</div>
                    <h3 class="font-semibold text-gray-900 mb-2">Production Monitoring</h3>
                    <p class="text-gray-600 text-sm">Real-time production line tracking and optimization</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="text-3xl mb-3">üî¨</div>
                    <h3 class="font-semibold text-gray-900 mb-2">Quality Control</h3>
                    <p class="text-gray-600 text-sm">Comprehensive quality assurance and compliance</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="text-3xl mb-3">üì¶</div>
                    <h3 class="font-semibold text-gray-900 mb-2">Inventory Management</h3>
                    <p class="text-gray-600 text-sm">Advanced supply chain and demand forecasting</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="text-3xl mb-3">ü§ñ</div>
                    <h3 class="font-semibold text-gray-900 mb-2">AI Analytics</h3>
                    <p class="text-gray-600 text-sm">Machine learning insights and predictive maintenance</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="text-3xl mb-3">üîß</div>
                    <h3 class="font-semibold text-gray-900 mb-2">Digital Twin</h3>
                    <p class="text-gray-600 text-sm">Virtual factory modeling and simulation</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="text-3xl mb-3">‚ö°</div>
                    <h3 class="font-semibold text-gray-900 mb-2">Workflow Automation</h3>
                    <p class="text-gray-600 text-sm">Smart scheduling and integrated control systems</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        console.log('üöÄ CapLiquify Platform - Emergency Dashboard Loading');
        
        // 10-stage loading system
        const loadingStages = [
            { stage: 1, text: "Initializing Clerk Authentication...", progress: 10, duration: 800 },
            { stage: 2, text: "Loading Core React Components...", progress: 20, duration: 1000 },
            { stage: 3, text: "Connecting to PostgreSQL Database...", progress: 30, duration: 1200 },
            { stage: 4, text: "Setting up Production Monitoring...", progress: 40, duration: 1000 },
            { stage: 5, text: "Initializing Quality Control Systems...", progress: 50, duration: 1100 },
            { stage: 6, text: "Loading Inventory Management...", progress: 60, duration: 900 },
            { stage: 7, text: "Starting Analytics Engine...", progress: 70, duration: 1300 },
            { stage: 8, text: "Activating Digital Twin System...", progress: 80, duration: 1000 },
            { stage: 9, text: "Enabling Workflow Automation...", progress: 90, duration: 800 },
            { stage: 10, text: "Finalizing Dashboard Interface...", progress: 100, duration: 600 }
        ];

        let currentStage = 0;

        // Initialize stages list
        function initializeStagesList() {
            const stagesList = document.getElementById('stages-list');
            loadingStages.forEach((stage, index) => {
                const stageElement = document.createElement('div');
                stageElement.className = 'flex items-center justify-between text-xs';
                stageElement.innerHTML = `
                    <span class="text-gray-500" id="stage-${index}-text">
                        ${stage.stage}. ${stage.text.replace('...', '')}
                    </span>
                    <span class="text-gray-300" id="stage-${index}-indicator">‚óã</span>
                `;
                stagesList.appendChild(stageElement);
            });
        }

        // Update loading stage
        function updateLoadingStage() {
            if (currentStage < loadingStages.length) {
                const stage = loadingStages[currentStage];
                
                // Update main loading text
                document.getElementById('loading-text').textContent = `Stage ${stage.stage}: ${stage.text}`;
                
                // Update progress bar
                document.getElementById('progress-bar').style.width = `${stage.progress}%`;
                
                // Update stage info
                document.getElementById('stage-info').textContent = `${stage.stage} of 10 stages ‚Ä¢ ${stage.progress}% complete`;
                
                // Update stage indicator
                const stageText = document.getElementById(`stage-${currentStage}-text`);
                const stageIndicator = document.getElementById(`stage-${currentStage}-indicator`);
                
                if (stageText) stageText.className = 'text-gray-900';
                if (stageIndicator) {
                    stageIndicator.className = 'text-blue-600';
                    stageIndicator.textContent = '‚óè';
                }
                
                currentStage++;
                
                // Continue to next stage
                setTimeout(updateLoadingStage, stage.duration);
            } else {
                // All stages complete - show authentication
                setTimeout(showAuthentication, 500);
            }
        }

        // Show authentication screen
        function showAuthentication() {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('auth-screen').style.display = 'flex';
            
            console.log('‚úÖ 10-stage loading complete - showing authentication');
            
            // Try to initialize Clerk
            initializeClerk();
        }

        // Initialize Clerk authentication
        function initializeClerk() {
            const clerkPublishableKey = 'pk_test_cm9idXN0LXNuYWtlLTUwLmNsZXJrLmFjY291bnRzLmRldiQ';
            
            if (window.Clerk && clerkPublishableKey) {
                console.log('üîê Initializing Clerk authentication...');
                
                window.Clerk.load({
                    publishableKey: clerkPublishableKey,
                    appearance: {
                        baseTheme: undefined,
                        variables: {
                            colorPrimary: '#3b82f6',
                            colorBackground: '#ffffff',
                            borderRadius: '8px'
                        }
                    }
                }).then(() => {
                    console.log('‚úÖ Clerk loaded successfully');
                    
                    // Mount Clerk authentication
                    const authContainer = document.getElementById('clerk-auth-container');
                    
                    if (window.Clerk.user) {
                        // User is already signed in
                        proceedToDashboard();
                    } else {
                        // Show sign-in
                        window.Clerk.mountSignIn(authContainer, {
                            afterSignInUrl: window.location.href,
                            afterSignUpUrl: window.location.href
                        });
                        
                        // Listen for sign-in
                        window.Clerk.addListener('user', (user) => {
                            if (user) {
                                proceedToDashboard();
                            }
                        });
                    }
                }).catch((error) => {
                    console.error('‚ùå Clerk initialization failed:', error);
                    // Show manual authentication fallback
                    document.getElementById('manual-auth').style.display = 'block';
                });
            } else {
                console.warn('‚ö†Ô∏è Clerk not available - showing manual authentication');
                document.getElementById('manual-auth').style.display = 'block';
            }
        }

        // Proceed to dashboard
        function proceedToDashboard() {
            console.log('üéâ Authentication successful - showing dashboard');
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('dashboard-screen').style.display = 'block';
        }

        // Sign out function
        function signOut() {
            if (window.Clerk && window.Clerk.user) {
                window.Clerk.signOut().then(() => {
                    location.reload();
                });
            } else {
                location.reload();
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üì± Emergency dashboard initialized');
            initializeStagesList();
            setTimeout(updateLoadingStage, 100);
        });
    </script>
</body>
</html>

