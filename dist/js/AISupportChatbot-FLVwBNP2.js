import{r as e,aj as s,j as t,bQ as a,bx as i,bR as n,q as r,L as l,aO as o}from"./react-core-DlJGLw67.js";import"./auth-BIfipbc6.js";import"./vendor-TZ9aDXZU.js";import"./charts-C-BUlHpY.js";import"./vendor-utils-W0IPh-on.js";const c=()=>{const[c,d]=e.useState(!1),[u,m]=e.useState([{id:1,type:"bot",content:"ðŸ¤– Hello! I'm your **Sentia Manufacturing AI Copilot**. I have deep access to your business data and can help you:\n\nðŸ“Š **Analyze** your performance metrics and KPIs\nðŸ“ˆ **Explore** inventory levels and forecasting data\nðŸ’° **Review** financial performance and working capital\nðŸ” **Investigate** production issues and quality metrics\nðŸ’¡ **Recommend** optimization strategies\nðŸ“‹ **Generate** custom reports and insights\n\nWhat would you like to explore today? Ask me about any aspect of your business!",timestamp:new Date,enhanced:!0}]),[p,h]=e.useState(""),[x,y]=e.useState(!1),[g,b]=e.useState(null),[f,v]=e.useState([]),w=e.useRef(null),j=e.useRef(null),{data:N,refetch:k}=s({queryKey:["business-overview"],queryFn:async()=>{try{const e=await fetch("/api/dashboard/overview");if(!e.ok)throw new Error("Failed to fetch business data");return await e.json()}catch(e){return null}},staleTime:3e5,refetchOnWindowFocus:!1});e.useEffect(()=>{w.current?.scrollIntoView({behavior:"smooth"})},[u]),e.useEffect(()=>{if(N&&1===u.length){const e=I(N);v(e)}},[N,u.length]);const I=e=>{const s=[];return e?.workingCapital?.currentRatio<2&&s.push("Why is my current ratio low and how can I improve it?"),e?.inventory?.totalValue>1e5&&s.push("How can I optimize my inventory levels to free up cash?"),e?.sales?.growth<0&&s.push("What's causing my sales decline and what should I do?"),e?.production?.efficiency<85&&s.push("How can I improve my production efficiency?"),s.push("Show me my key performance indicators for this month","What are my biggest risks and opportunities right now?","Generate a financial health report","What should I focus on to improve profitability?"),s.slice(0,4)},C=async(e=p,s=!1)=>{const t=e.trim();if(!t||x)return;const a={id:Date.now(),type:"user",content:t,timestamp:new Date};m(e=>[...e,a]),s||h(""),y(!0),b("Analyzing your request...");try{const e=await fetch("/api/mcp/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,context:"sentia_copilot",business_data:N,conversation_history:u.slice(-10),request_type:"business_analysis",capabilities_needed:["data-analysis","business-intelligence","recommendations"]})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();b("Processing insights...");const a=await S(s,t),i={id:Date.now()+1,type:"bot",content:a.content,timestamp:new Date,enhanced:!0,analysis:a.analysis,recommendations:a.recommendations,visualizations:a.visualizations};m(e=>[...e,i]),a.suggestedFollowUp&&v(a.suggestedFollowUp)}catch(i){const e={id:Date.now()+1,type:"bot",content:"ðŸš¨ I'm experiencing technical difficulties accessing the AI analysis engine. Please try again in a moment. In the meantime, you can:\n\nâ€¢ Check your dashboard directly\nâ€¢ Use the navigation menu to access specific reports\nâ€¢ Contact support if this issue persists",timestamp:new Date,enhanced:!0};m(s=>[...s,e])}finally{y(!1),b(null)}},S=async(e,s)=>{const t=R(s);let a=e.response||"I apologize, but I couldn't process your request properly.",i=null,n=[],r=[],l=[];try{t.includes("financial")&&N&&(i=A(N),n.push(...D(N))),t.includes("inventory")&&N&&(i=T(N),n.push(..._(N))),t.includes("production")&&N&&(i=z(N),n.push(...F(N))),l=q(t,N),r=L(t)}catch(o){}return{content:a,analysis:i,recommendations:n,visualizations:r,suggestedFollowUp:l}},R=e=>{const s=e.toLowerCase(),t=[];return(s.includes("financial")||s.includes("cash")||s.includes("revenue")||s.includes("profit"))&&t.push("financial"),(s.includes("inventory")||s.includes("stock")||s.includes("SKU"))&&t.push("inventory"),(s.includes("production")||s.includes("manufacturing")||s.includes("efficiency"))&&t.push("production"),(s.includes("sales")||s.includes("demand")||s.includes("forecast"))&&t.push("sales"),(s.includes("quality")||s.includes("defect")||s.includes("compliance"))&&t.push("quality"),t},A=e=>e?.financial?{type:"financial_analysis",metrics:{currentRatio:e.financial.currentRatio||0,workingCapital:e.financial.workingCapital||0,cashFlow:e.financial.cashFlow||0,profitMargin:e.financial.profitMargin||0},trends:{revenueGrowth:e.financial.revenueGrowth||0,costTrend:e.financial.costTrend||0}}:null,D=e=>{const s=[];return e?.financial?.currentRatio<2&&s.push({priority:"high",category:"liquidity",action:"Improve current ratio by reducing current liabilities or increasing current assets",impact:"Better financial stability and creditworthiness"}),e?.financial?.workingCapital<0&&s.push({priority:"critical",category:"cash_flow",action:"Address negative working capital immediately - accelerate collections and delay payments where possible",impact:"Prevent potential cash flow crisis"}),s},T=e=>e?.inventory?{type:"inventory_analysis",metrics:{totalValue:e.inventory.totalValue||0,turnoverRate:e.inventory.turnoverRate||0,stockoutRisk:e.inventory.stockoutRisk||"low",excessStock:e.inventory.excessStock||0}}:null,_=e=>{const s=[];return e?.inventory?.turnoverRate<4&&s.push({priority:"medium",category:"inventory_optimization",action:"Improve inventory turnover by identifying slow-moving items and implementing better demand forecasting",impact:"Free up working capital and reduce storage costs"}),s},z=e=>e?.production?{type:"production_analysis",metrics:{efficiency:e.production.efficiency||0,oee:e.production.oee||0,defectRate:e.production.defectRate||0,downtime:e.production.downtime||0}}:null,F=e=>{const s=[];return e?.production?.efficiency<85&&s.push({priority:"high",category:"efficiency",action:"Analyze bottlenecks and implement lean manufacturing principles to improve efficiency",impact:"Increase output and reduce unit costs"}),s},q=(e,s)=>{const t=[];return e.includes("financial")&&(t.push("How can I improve my cash flow cycle?"),t.push("Show me a detailed working capital analysis")),e.includes("inventory")&&(t.push("Which items should I reorder first?"),t.push("What is my optimal stock level for top products?")),e.includes("production")&&(t.push("Where are my biggest production bottlenecks?"),t.push("How can I reduce manufacturing costs?")),t.slice(0,3)},L=e=>{const s=[];return e.includes("financial")&&s.push({type:"chart",title:"Cash Flow Trend",description:"Monthly cash flow analysis with projections"}),s},W=()=>{d(!c),c||(setTimeout(()=>j.current?.focus(),100),k())};return t.jsxs("div",{className:"fixed bottom-4 right-4 z-50",children:[!c&&t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:W,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-full p-4 shadow-xl transition-all duration-300 flex items-center space-x-3 group","aria-label":"Open AI Business Copilot",children:[t.jsxs("div",{className:"relative",children:[t.jsx(a,{className:"h-6 w-6"}),N&&t.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"})]}),t.jsxs("div",{className:"hidden sm:block",children:[t.jsx("span",{className:"text-sm font-semibold",children:"AI Copilot"}),t.jsx("div",{className:"text-xs opacity-90",children:"Business Intelligence"})]})]}),N&&t.jsx("div",{className:"absolute -top-2 -left-2 bg-green-500 text-white rounded-full px-2 py-1 text-xs font-bold shadow-lg",children:"LIVE"})]}),c&&t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 w-80 sm:w-96 h-[32rem] flex flex-col",children:[t.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-t-xl flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"w-10 h-10 bg-blue-500/80 rounded-full flex items-center justify-center relative",children:[t.jsx("span",{className:"text-sm font-bold",children:"ðŸ§ "}),N&&t.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-green-400 rounded-full border-2 border-white"})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-sm",children:"AI Business Copilot"}),t.jsx("p",{className:"text-xs text-blue-100",children:N?"Connected to Live Data":"Ready to Assist"})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[g&&t.jsx("div",{className:"text-xs bg-blue-500/50 px-2 py-1 rounded-full animate-pulse",children:"Analyzing..."}),t.jsx("button",{onClick:W,className:"hover:bg-blue-500/50 rounded-full p-1 transition-colors","aria-label":"Close chat",children:t.jsx(i,{className:"h-5 w-5"})})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[u.map(e=>{const s="bot"===e.type;return t.jsx("div",{className:`flex ${s?"justify-start":"justify-end"} mb-4`,children:t.jsxs("div",{className:`max-w-xs sm:max-w-sm ${s?"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white":"bg-blue-600 text-white"} px-4 py-3 rounded-lg shadow-sm`,children:[t.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",children:e.content.split("**").map((e,s)=>s%2==1?t.jsx("strong",{children:e},s):e)}),s&&e.enhanced&&t.jsxs(t.Fragment,{children:[e.analysis&&t.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-2 border-blue-400",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(r,{className:"h-4 w-4 text-blue-600 mr-2"}),t.jsx("span",{className:"text-xs font-semibold text-blue-700 dark:text-blue-300",children:"DATA ANALYSIS"})]}),t.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-300",children:["financial_analysis"===e.analysis.type&&t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:["Current Ratio: ",t.jsx("span",{className:"font-mono",children:e.analysis.metrics.currentRatio})]}),t.jsxs("div",{children:["Working Capital: ",t.jsxs("span",{className:"font-mono",children:["$",e.analysis.metrics.workingCapital.toLocaleString()]})]})]}),"inventory_analysis"===e.analysis.type&&t.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[t.jsxs("div",{children:["Total Value: ",t.jsxs("span",{className:"font-mono",children:["$",e.analysis.metrics.totalValue.toLocaleString()]})]}),t.jsxs("div",{children:["Turnover Rate: ",t.jsxs("span",{className:"font-mono",children:[e.analysis.metrics.turnoverRate,"x"]})]})]})]})]}),e.recommendations&&e.recommendations.length>0&&t.jsxs("div",{className:"mt-3 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border-l-2 border-amber-400",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx(l,{className:"h-4 w-4 text-amber-600 mr-2"}),t.jsx("span",{className:"text-xs font-semibold text-amber-700 dark:text-amber-300",children:"RECOMMENDATIONS"})]}),t.jsx("div",{className:"space-y-2",children:e.recommendations.slice(0,2).map((e,s)=>t.jsxs("div",{className:"text-xs",children:[t.jsx("div",{className:"inline-block px-2 py-1 rounded text-white text-xs mb-1 "+("critical"===e.priority?"bg-red-500":"high"===e.priority?"bg-orange-500":"medium"===e.priority?"bg-yellow-500":"bg-blue-500"),children:e.priority.toUpperCase()}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:e.action})]},s))})]})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs opacity-70",children:[t.jsx("span",{children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),s&&N&&t.jsxs("span",{className:"flex items-center",children:[t.jsx(o,{className:"h-3 w-3 mr-1"}),"Live Data"]})]})]})},e.id)}),x&&t.jsx("div",{className:"flex justify-start mb-4",children:t.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 px-4 py-3 rounded-lg shadow-sm max-w-xs",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce"}),t.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),t.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),g&&t.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:g})]})})}),t.jsx("div",{ref:w})]}),f.length>0&&t.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-3",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Suggested Questions:"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:f.slice(0,2).map((e,s)=>t.jsx("button",{onClick:()=>(e=>{C(e,!0)})(e),disabled:x,className:"text-xs bg-blue-100 dark:bg-blue-900/50 hover:bg-blue-200 dark:hover:bg-blue-900/70 text-blue-700 dark:text-blue-300 px-2 py-1 rounded-full transition-colors disabled:opacity-50",children:e.length>30?e.substring(0,30)+"...":e},s))})]}),t.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4",children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("input",{ref:j,type:"text",value:p,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),C())},placeholder:"Ask me anything about your business...",disabled:x,className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white text-sm disabled:opacity-50"}),t.jsx("button",{onClick:()=>C(),disabled:!p.trim()||x,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-400 text-white rounded-lg p-2 transition-all duration-200 disabled:cursor-not-allowed shadow-lg","aria-label":"Send message",children:t.jsx(n,{className:"h-4 w-4"})})]}),t.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[t.jsx("span",{children:"ðŸš€ Powered by AI Central Nervous System"}),N&&t.jsxs("span",{className:"flex items-center text-green-600",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"}),"Live Data"]})]})]})]})]})};export{c as default};
