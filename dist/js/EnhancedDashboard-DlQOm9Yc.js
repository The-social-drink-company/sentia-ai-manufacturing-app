import{a6 as e,u as t,j as a,a5 as s,a7 as r,a8 as i,r as n,aB as l}from"./react-core-DkFbty9o.js";import{useAuth as d,useUser as c}from"./auth-M1VfQxmO.js";import{W as o,a as m,b as x,M as g,D as u}from"./WidgetComponents-Dzf-eyWG.js";import{l as h,p as y,V as p,r as b,aq as j,a as v,K as f,ac as N,q as w,I as k,a1 as S,Q as C,T as R,am as M,c as T,n as P,aH as A,L,y as I,as as F,ao as q,u as W,aI as $}from"./ui-components-J4-_vVnI.js";import D from"./WorkingCapitalWidget-YVkqKV5e.js";import E from"./SupplyChainWidget-rKeE1Q9e.js";import O from"./AIAnalyticsDashboard-BxRkAjYQ.js";import{u as z}from"./AIInsights-ClfCycae.js";import{a as Q}from"./router-C0m1gglZ.js";import"./vendor-CHbOot_X.js";import"./charts-DxLx1lqX.js";import"./vendor-utils-BvmCeSbq.js";import"./animation-CTJwy-Vh.js";import"./index-C8migC5L.js";import"./forms-CtqjxpzJ.js";const B=l.WidthProvider(l.Responsive),J=[{id:"production-metrics",name:"Production Metrics",component:()=>{const{getToken:r}=d(),i=e(),{data:n,isLoading:l,error:c,refetch:u,isRefetching:j}=t({queryKey:["production-metrics"],queryFn:async()=>{const e=await r(),t=await fetch("https://sentia-manufacturing-production.onrender.com/api/api/production/metrics",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return v();throw new Error(`Failed to fetch production metrics: ${t.statusText}`)}return t.json()},refetchInterval:3e4,retry:2,retryDelay:1e3}),v=()=>({current:{unitsProduced:1547,targetUnits:2e3,efficiency:87.3,quality:98.5,oee:76.2,downtime:23,cycleTime:4.2},trend:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],production:[1420,1380,1520,1490,1547,1510,1480],target:[2e3,2e3,2e3,2e3,2e3,1500,1500]},shifts:[{name:"Morning",units:520,efficiency:89},{name:"Afternoon",units:480,efficiency:85},{name:"Night",units:547,efficiency:87}],products:[{name:"Product A",units:650,percentage:42},{name:"Product B",units:497,percentage:32},{name:"Product C",units:400,percentage:26}]});if(l&&!n)return a.jsx(o,{title:"Production Metrics",height:"400px"});if(c&&!n)return a.jsx(m,{error:c,onRetry:u,title:"Production Metrics"});const f=n||v(),N={labels:f.trend?.labels||[],datasets:[{label:"Actual Production",data:f.trend?.production||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4},{label:"Target",data:f.trend?.target||[],borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",borderDash:[5,5],tension:.4}]},w=(f.current?.unitsProduced||0)/(f.current?.targetUnits||1)*100;return a.jsxs(x,{title:"Production Metrics",onRefresh:()=>{i.invalidateQueries(["production-metrics"]),u()},isRefreshing:j,className:"col-span-2",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[a.jsx(g,{label:"Units Produced",value:f.current?.unitsProduced?.toLocaleString()||"0",unit:"units",trend:{direction:"up",value:5.2},icon:h}),a.jsx(g,{label:"Efficiency",value:f.current?.efficiency||0,unit:"%",trend:{direction:f.current?.efficiency>85?"up":"down",value:2.1},icon:y}),a.jsx(g,{label:"OEE",value:f.current?.oee||0,unit:"%",trend:{direction:"neutral",value:.5},icon:p}),a.jsx(g,{label:"Quality Rate",value:f.current?.quality||0,unit:"%",trend:{direction:"up",value:1.2},icon:b})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2",children:[a.jsx("span",{children:"Daily Target Progress"}),a.jsxs("span",{children:[Math.round(w),"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:a.jsx("div",{className:"h-3 rounded-full transition-all duration-500 "+(w>=100?"bg-green-500":w>=75?"bg-blue-500":"bg-yellow-500"),style:{width:`${Math.min(w,100)}%`}})})]}),a.jsx("div",{className:"mb-6",style:{height:"200px"},children:a.jsx(s,{data:N,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(156, 163, 175, 0.1)"}},x:{grid:{color:"rgba(156, 163, 175, 0.1)"}}}}})}),a.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:f.shifts?.map(e=>a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.name}),a.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[e.units," units"]}),a.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.efficiency,"% efficient"]})]},e.name))}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Product Mix"}),a.jsx("div",{className:"space-y-2",children:f.products?.map(e=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.name}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-32 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${e.percentage}%`}})}),a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.units})]})]},e.name))})]}),a.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:3,minH:3},category:"Operations"},{id:"inventory-levels",name:"Inventory Levels",component:()=>{const{getToken:s}=d(),i=e(),{data:n,isLoading:l,error:c,refetch:h,isRefetching:y}=t({queryKey:["inventory-levels"],queryFn:async()=>{const e=await s(),t=await fetch("https://sentia-manufacturing-production.onrender.com/api/api/inventory/levels",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return p();throw new Error(`Failed to fetch inventory levels: ${t.statusText}`)}return t.json()},refetchInterval:6e4,retry:2,retryDelay:1e3}),p=()=>({summary:{totalSKUs:245,totalValue:1547280,averageTurnover:8.3,stockoutRisk:12,overstockItems:18,reorderRequired:23},categories:[{name:"Raw Materials",value:45e4,items:89,status:"optimal"},{name:"Work in Progress",value:32e4,items:45,status:"high"},{name:"Finished Goods",value:777280,items:111,status:"optimal"}],criticalItems:[{sku:"RM-001",name:"Steel Sheet 2mm",current:150,min:200,status:"critical",daysSupply:2},{sku:"RM-045",name:"Aluminum Bars",current:320,min:500,status:"low",daysSupply:5},{sku:"FG-112",name:"Product A",current:45,min:100,status:"critical",daysSupply:1},{sku:"WP-023",name:"Sub-Assembly B",current:180,min:250,status:"low",daysSupply:4}],topMovers:[{sku:"FG-001",name:"Product X",movement:1200,trend:"up",changePercent:15},{sku:"FG-002",name:"Product Y",movement:980,trend:"up",changePercent:8},{sku:"FG-003",name:"Product Z",movement:750,trend:"down",changePercent:-5}],warehouseCapacity:{used:72,available:28,locations:[{name:"Main Warehouse",used:85,capacity:100},{name:"Overflow Storage",used:45,capacity:100},{name:"Cold Storage",used:90,capacity:100}]}});if(l&&!n)return a.jsx(o,{title:"Inventory Levels",height:"400px"});if(c&&!n)return a.jsx(m,{error:c,onRetry:h,title:"Inventory Levels"});const b=n||p(),w={labels:b.categories?.map(e=>e.name)||[],datasets:[{label:"Inventory Value ($)",data:b.categories?.map(e=>e.value)||[],backgroundColor:["rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(245, 158, 11)"],borderWidth:1}]},k=[{key:"sku",label:"SKU"},{key:"name",label:"Item"},{key:"current",label:"Current",render:(e,t)=>a.jsx("span",{className:"critical"===t.status?"text-red-600 font-semibold":"",children:e})},{key:"min",label:"Min Level"},{key:"daysSupply",label:"Days Supply",render:e=>a.jsxs("span",{className:e<=2?"text-red-600":e<=5?"text-yellow-600":"text-green-600",children:[e," days"]})}];return a.jsxs(x,{title:"Inventory Levels",onRefresh:()=>{i.invalidateQueries(["inventory-levels"]),h()},isRefreshing:y,className:"col-span-2",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[a.jsx(g,{label:"Total SKUs",value:b.summary?.totalSKUs||0,icon:j}),a.jsx(g,{label:"Total Value",value:`$${((b.summary?.totalValue||0)/1e6).toFixed(2)}M`,trend:{direction:"up",value:3.5}}),a.jsx(g,{label:"Reorder Required",value:b.summary?.reorderRequired||0,icon:v}),a.jsx(g,{label:"Turnover Rate",value:b.summary?.averageTurnover||0,unit:"x",trend:{direction:"up",value:.5}})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Warehouse Capacity"}),a.jsx("div",{className:"space-y-2",children:b.warehouseCapacity?.locations?.map(e=>a.jsxs("div",{children:[a.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-1",children:[a.jsx("span",{children:e.name}),a.jsxs("span",{children:[e.used,"%"]})]}),a.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"h-2 rounded-full "+(e.used>=90?"bg-red-500":e.used>=70?"bg-yellow-500":"bg-green-500"),style:{width:`${e.used}%`}})})]},e.name))})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Inventory by Category"}),a.jsx("div",{style:{height:"200px"},children:a.jsx(r,{data:w,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"k"}}}}}})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Critical Items"}),a.jsxs("span",{className:"text-xs text-red-600 bg-red-100 dark:bg-red-900/20 px-2 py-1 rounded",children:[b.criticalItems?.filter(e=>"critical"===e.status).length||0," Critical"]})]}),a.jsx(u,{columns:k,data:b.criticalItems||[]})]}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Top Moving Items"}),a.jsx("div",{className:"space-y-2",children:b.topMovers?.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-1 rounded "+("up"===e.trend?"bg-green-100 dark:bg-green-900/20":"bg-red-100 dark:bg-red-900/20"),children:"up"===e.trend?a.jsx(f,{className:"h-4 w-4 text-green-600"}):a.jsx(N,{className:"h-4 w-4 text-red-600"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.sku})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[e.movement," units"]}),a.jsxs("p",{className:"text-xs "+(e.changePercent>0?"text-green-600":"text-red-600"),children:[e.changePercent>0?"+":"",e.changePercent,"%"]})]})]},e.sku))})]}),a.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:3,minH:3},category:"Operations"},{id:"quality-control",name:"Quality Control",component:()=>{const{getToken:r}=d(),n=e(),{data:l,isLoading:c,error:u,refetch:h,isRefetching:y}=t({queryKey:["quality-control"],queryFn:async()=>{const e=await r(),t=await fetch("https://sentia-manufacturing-production.onrender.com/api/api/quality/metrics",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return p();throw new Error(`Failed to fetch quality metrics: ${t.statusText}`)}return t.json()},refetchInterval:45e3,retry:2,retryDelay:1e3}),p=()=>({summary:{passRate:98.7,defectRate:1.3,totalInspections:1247,totalDefects:16,reworkRate:.8,scrapRate:.5},distribution:{passed:1231,failed:16,rework:10,scrap:6},defectTypes:[{type:"Dimensional",count:6,percentage:37.5},{type:"Surface Finish",count:4,percentage:25},{type:"Assembly",count:3,percentage:18.75},{type:"Material",count:2,percentage:12.5},{type:"Other",count:1,percentage:6.25}],trend:{labels:["6am","8am","10am","12pm","2pm","4pm","6pm"],passRates:[99.2,98.8,99,98.5,98.7,98.9,98.7],inspections:[150,180,195,210,178,185,149]},recentIssues:[{id:1,time:"2:45 PM",product:"Product A",issue:"Dimensional variance",severity:"medium"},{id:2,time:"11:30 AM",product:"Product C",issue:"Surface scratch",severity:"low"},{id:3,time:"9:15 AM",product:"Product B",issue:"Assembly misalignment",severity:"high"}],qualityMetrics:{cpk:1.67,dpmo:233,sigmaLevel:4.8,firstPassYield:97.2}});if(c&&!l)return a.jsx(o,{title:"Quality Control",height:"400px"});if(u&&!l)return a.jsx(m,{error:u,onRetry:h,title:"Quality Control"});const j=l||p(),v={labels:["Passed","Failed","Rework"],datasets:[{data:[j.distribution?.passed||0,j.distribution?.failed||0,j.distribution?.rework||0],backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(239, 68, 68, 0.8)","rgba(245, 158, 11, 0.8)"],borderColor:["rgb(16, 185, 129)","rgb(239, 68, 68)","rgb(245, 158, 11)"],borderWidth:1}]},f={labels:j.trend?.labels||[],datasets:[{label:"Pass Rate (%)",data:j.trend?.passRates||[],borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4,yAxisID:"y"},{label:"Inspections",data:j.trend?.inspections||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,yAxisID:"y1"}]},N=e=>{switch(e){case"high":return"text-red-600 bg-red-100 dark:bg-red-900/20";case"medium":return"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20";case"low":return"text-green-600 bg-green-100 dark:bg-green-900/20";default:return"text-gray-600 bg-gray-100 dark:bg-gray-700"}};return a.jsxs(x,{title:"Quality Control",onRefresh:()=>{n.invalidateQueries(["quality-control"]),h()},isRefreshing:y,className:"col-span-2",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[a.jsx(g,{label:"Pass Rate",value:j.summary?.passRate||0,unit:"%",trend:{direction:j.summary?.passRate>98?"up":"down",value:.3},icon:b}),a.jsx(g,{label:"Defect Rate",value:j.summary?.defectRate||0,unit:"%",trend:{direction:"down",value:.2},icon:w}),a.jsx(g,{label:"Inspections",value:j.summary?.totalInspections||0,icon:k}),a.jsx(g,{label:"Total Defects",value:j.summary?.totalDefects||0,trend:{direction:"down",value:5},icon:S})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Quality Distribution"}),a.jsx("div",{style:{height:"200px"},children:a.jsx(i,{data:v,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Six Sigma Metrics"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Process Capability (Cpk)"}),a.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:j.qualityMetrics?.cpk||0})]}),a.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"DPMO"}),a.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:j.qualityMetrics?.dpmo||0})]}),a.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sigma Level"}),a.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[j.qualityMetrics?.sigmaLevel||0,"σ"]})]}),a.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"First Pass Yield"}),a.jsxs("span",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:[j.qualityMetrics?.firstPassYield||0,"%"]})]})]})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Pass Rate Trend"}),a.jsx("div",{style:{height:"200px"},children:a.jsx(s,{data:f,options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{position:"top"}},scales:{y:{type:"linear",display:!0,position:"left",min:95,max:100},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1}}}}})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Defect Types"}),a.jsx("div",{className:"space-y-2",children:j.defectTypes?.map(e=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.type}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-32 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${e.percentage}%`}})}),a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white w-12 text-right",children:e.count})]})]},e.type))})]}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Recent Issues"}),a.jsx("div",{className:"space-y-2",children:j.recentIssues?.map(e=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.time}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.product}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.issue})]})]}),a.jsx("span",{className:`text-xs px-2 py-1 rounded ${N(e.severity)}`,children:e.severity})]},e.id))})]}),a.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:3,minH:3},category:"Quality"},{id:"financial-overview",name:"Financial Overview",component:()=>{const{getToken:i}=d(),n=e(),{data:l,isLoading:c,error:u,refetch:h,isRefetching:p}=t({queryKey:["financial-overview"],queryFn:async()=>{const e=await i(),t=await fetch("https://sentia-manufacturing-production.onrender.com/api/api/financial/overview",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return b();throw new Error(`Failed to fetch financial overview: ${t.statusText}`)}return t.json()},refetchInterval:6e4,retry:2,retryDelay:1e3}),b=()=>({summary:{revenue:2456780,expenses:1890450,profit:566330,profitMargin:23.1,cashFlow:423500,workingCapital:789200,currentRatio:1.85,quickRatio:1.42},revenueBreakdown:[{source:"Product Sales",amount:1845e3,percentage:75.1},{source:"Services",amount:456780,percentage:18.6},{source:"Licensing",amount:155e3,percentage:6.3}],expenseBreakdown:[{category:"Raw Materials",amount:756e3,percentage:40},{category:"Labor",amount:567135,percentage:30},{category:"Operations",amount:378090,percentage:20},{category:"Marketing",amount:189225,percentage:10}],cashFlowTrend:{labels:["Jan","Feb","Mar","Apr","May","Jun"],operating:[38e4,395e3,41e4,423500,438e3,445e3],investing:[-12e4,-85e3,-95e3,-11e4,-75e3,-9e4],financing:[-5e4,-45e3,-55e3,-48e3,-52e3,-47e3]},profitTrend:{labels:["Q1 2024","Q2 2024","Q3 2024","Q4 2024"],revenue:[21e5,225e4,238e4,2456780],profit:[483e3,517500,548e3,566330],margin:[23,23,23,23.1]},keyRatios:{grossMargin:42.5,operatingMargin:28.3,netMargin:23.1,roe:18.7,roa:12.4,debtToEquity:.45},budgetComparison:{revenue:{actual:2456780,budget:24e5,variance:2.4},expenses:{actual:1890450,budget:195e4,variance:-3.1},profit:{actual:566330,budget:45e4,variance:25.8}}});if(c&&!l)return a.jsx(o,{title:"Financial Overview",height:"400px"});if(u&&!l)return a.jsx(m,{error:u,onRetry:h,title:"Financial Overview"});const j=l||b(),v={labels:j.cashFlowTrend?.labels||[],datasets:[{label:"Operating",data:j.cashFlowTrend?.operating||[],borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4},{label:"Investing",data:j.cashFlowTrend?.investing||[],borderColor:"rgb(245, 158, 11)",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.4},{label:"Financing",data:j.cashFlowTrend?.financing||[],borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",tension:.4}]},f={labels:j.profitTrend?.labels||[],datasets:[{type:"bar",label:"Revenue",data:j.profitTrend?.revenue||[],backgroundColor:"rgba(59, 130, 246, 0.8)",borderColor:"rgb(59, 130, 246)",borderWidth:1,yAxisID:"y"},{type:"bar",label:"Profit",data:j.profitTrend?.profit||[],backgroundColor:"rgba(16, 185, 129, 0.8)",borderColor:"rgb(16, 185, 129)",borderWidth:1,yAxisID:"y"},{type:"line",label:"Margin %",data:j.profitTrend?.margin||[],borderColor:"rgb(245, 158, 11)",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.4,yAxisID:"y1"}]},N=e=>e>=1e6?`$${(e/1e6).toFixed(2)}M`:`$${(e/1e3).toFixed(0)}k`;return a.jsxs(x,{title:"Financial Overview",onRefresh:()=>{n.invalidateQueries(["financial-overview"]),h()},isRefreshing:p,className:"col-span-2",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[a.jsx(g,{label:"Revenue",value:N(j.summary?.revenue||0),trend:{direction:"up",value:5.2},icon:C}),a.jsx(g,{label:"Profit",value:N(j.summary?.profit||0),trend:{direction:"up",value:8.3},icon:R}),a.jsx(g,{label:"Profit Margin",value:j.summary?.profitMargin||0,unit:"%",trend:{direction:"neutral",value:.1},icon:y}),a.jsx(g,{label:"Working Capital",value:N(j.summary?.workingCapital||0),trend:{direction:"up",value:3.5}})]}),a.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Budget vs Actual"}),a.jsx("div",{className:"space-y-3",children:Object.entries(j.budgetComparison||{}).map(([e,t])=>{return a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 capitalize",children:e}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:N(t.actual)}),a.jsxs("span",{className:"text-xs text-gray-500",children:["vs ",N(t.budget)]}),a.jsxs("span",{className:"text-sm font-medium "+(s=t.variance,s>0?"text-green-600":s<0?"text-red-600":"text-gray-600"),children:[t.variance>0?"+":"",t.variance,"%"]})]})]},e);var s})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Cash Flow Trend"}),a.jsx("div",{style:{height:"200px"},children:a.jsx(s,{data:v,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"k"}}}}}})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Key Ratios"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Current Ratio"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:j.summary?.currentRatio||0})]}),a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Quick Ratio"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:j.summary?.quickRatio||0})]}),a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Gross Margin"}),a.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[j.keyRatios?.grossMargin||0,"%"]})]}),a.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded",children:[a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"ROE"}),a.jsxs("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[j.keyRatios?.roe||0,"%"]})]})]})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Revenue & Profit Trend"}),a.jsx("div",{style:{height:"200px"},children:a.jsx(r,{data:f,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{type:"linear",display:!0,position:"left",ticks:{callback:function(e){return"$"+(e/1e6).toFixed(1)+"M"}}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},ticks:{callback:function(e){return e+"%"}}}}}})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Revenue Sources"}),a.jsx("div",{className:"space-y-2",children:j.revenueBreakdown?.map(e=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.source}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${e.percentage}%`}})}),a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white w-20 text-right",children:N(e.amount)})]})]},e.source))})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Expense Categories"}),a.jsx("div",{className:"space-y-2",children:j.expenseBreakdown?.map(e=>a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.category}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-24 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:a.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${e.percentage}%`}})}),a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white w-20 text-right",children:N(e.amount)})]})]},e.category))})]})]}),a.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:4,minH:3},category:"Finance"},{id:"working-capital",name:"Working Capital",component:D,defaultSize:{w:6,h:5},minSize:{minW:4,minH:4},category:"Finance"},{id:"supply-chain",name:"Supply Chain",component:E,defaultSize:{w:6,h:4},minSize:{minW:4,minH:3},category:"Supply Chain"},{id:"maintenance-schedule",name:"Maintenance Schedule",component:()=>{const{getToken:r}=d(),n=e(),{data:l,isLoading:c,error:y,refetch:p,isRefetching:j}=t({queryKey:["maintenance-schedule"],queryFn:async()=>{const e=await r(),t=await fetch("https://sentia-manufacturing-production.onrender.com/api/api/maintenance/schedule",{headers:{Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"}});if(!t.ok){if(404===t.status||500===t.status)return f();throw new Error(`Failed to fetch maintenance schedule: ${t.statusText}`)}return t.json()},refetchInterval:6e4,retry:2,retryDelay:1e3}),f=()=>({summary:{totalEquipment:125,scheduledMaintenance:18,completedThisMonth:24,overdue:3,upcomingWeek:7,availability:94.2,mtbf:720,mttr:2.5},equipment:[{id:"EQ-001",name:"CNC Machine A",type:"Production",status:"operational",lastMaintenance:"2024-01-10",nextMaintenance:"2024-02-10",hoursRun:1250,healthScore:92,criticality:"high"},{id:"EQ-002",name:"Assembly Line 1",type:"Assembly",status:"maintenance",lastMaintenance:"2024-01-05",nextMaintenance:"2024-01-17",hoursRun:2100,healthScore:78,criticality:"critical"},{id:"EQ-003",name:"Packaging Unit B",type:"Packaging",status:"operational",lastMaintenance:"2024-01-12",nextMaintenance:"2024-02-12",hoursRun:890,healthScore:95,criticality:"medium"},{id:"EQ-004",name:"Quality Test Station",type:"Quality",status:"warning",lastMaintenance:"2023-12-20",nextMaintenance:"2024-01-20",hoursRun:3200,healthScore:65,criticality:"high"}],maintenanceTypes:{preventive:65,corrective:20,predictive:10,emergency:5},upcomingSchedule:[{date:"2024-01-18",equipment:"CNC Machine B",type:"Preventive",duration:4,technician:"John Smith"},{date:"2024-01-19",equipment:"Assembly Line 2",type:"Preventive",duration:6,technician:"Mary Johnson"},{date:"2024-01-20",equipment:"Quality Test Station",type:"Corrective",duration:3,technician:"Bob Wilson"},{date:"2024-01-22",equipment:"Conveyor System",type:"Preventive",duration:2,technician:"Alice Brown"},{date:"2024-01-23",equipment:"Welding Robot",type:"Predictive",duration:5,technician:"John Smith"}],costAnalysis:{labels:["Jan","Feb","Mar","Apr","May","Jun"],planned:[45e3,42e3,48e3,41e3,43e3,44e3],actual:[43e3,44e3,46e3,42e3,41e3,43e3],savings:[2e3,-2e3,2e3,-1e3,2e3,1e3]},performanceMetrics:{labels:["Week 1","Week 2","Week 3","Week 4"],availability:[93.5,94.2,93.8,94.5],reliability:[96.2,95.8,96.5,97],oee:[85.3,86.1,85.8,86.5]},spareParts:[{part:"Bearing Type A",stock:45,minimum:20,usage:"High",leadTime:7},{part:"Motor Belt XL",stock:12,minimum:15,usage:"Medium",leadTime:14},{part:"Filter Element",stock:8,minimum:10,usage:"Low",leadTime:5},{part:"Control Board",stock:3,minimum:2,usage:"Low",leadTime:30}]});if(c&&!l)return a.jsx(o,{title:"Maintenance Schedule",height:"400px"});if(y&&!l)return a.jsx(m,{error:y,onRetry:p,title:"Maintenance Schedule"});const N=l||f(),w={labels:["Preventive","Corrective","Predictive","Emergency"],datasets:[{data:[N.maintenanceTypes?.preventive||0,N.maintenanceTypes?.corrective||0,N.maintenanceTypes?.predictive||0,N.maintenanceTypes?.emergency||0],backgroundColor:["rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)","rgba(59, 130, 246, 0.8)","rgba(239, 68, 68, 0.8)"],borderColor:["rgb(16, 185, 129)","rgb(245, 158, 11)","rgb(59, 130, 246)","rgb(239, 68, 68)"],borderWidth:1}]},k={labels:N.costAnalysis?.labels||[],datasets:[{label:"Planned Cost",data:N.costAnalysis?.planned||[],borderColor:"rgb(107, 114, 128)",backgroundColor:"rgba(107, 114, 128, 0.1)",borderDash:[5,5],tension:.4},{label:"Actual Cost",data:N.costAnalysis?.actual||[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},S=[{key:"name",label:"Equipment"},{key:"type",label:"Type"},{key:"status",label:"Status",render:e=>{const t={operational:{color:"text-green-600 bg-green-100 dark:bg-green-900/20",icon:b},maintenance:{color:"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20",icon:P},warning:{color:"text-orange-600 bg-orange-100 dark:bg-orange-900/20",icon:v}}[e]||{color:"text-gray-600 bg-gray-100",icon:h},s=t.icon;return a.jsxs("span",{className:`text-xs px-2 py-1 rounded inline-flex items-center ${t.color}`,children:[a.jsx(s,{className:"h-3 w-3 mr-1"}),e]})}},{key:"nextMaintenance",label:"Next Service"},{key:"healthScore",label:"Health",render:e=>{const t=e>=90?"text-green-600":e>=70?"text-yellow-600":"text-red-600";return a.jsxs("span",{className:`font-semibold ${t}`,children:[e,"%"]})}}],C=[{key:"part",label:"Part Name"},{key:"stock",label:"Stock",render:(e,t)=>{const s=e<t.minimum;return a.jsx("span",{className:s?"text-red-600 font-semibold":"",children:e})}},{key:"minimum",label:"Min Level"},{key:"usage",label:"Usage Rate"},{key:"leadTime",label:"Lead Time",render:e=>`${e} days`}];return a.jsxs(x,{title:"Maintenance Schedule",onRefresh:()=>{n.invalidateQueries(["maintenance-schedule"]),p()},isRefreshing:j,className:"col-span-2",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[a.jsx(g,{label:"Equipment Availability",value:N.summary?.availability||0,unit:"%",trend:{direction:N.summary?.availability>95?"up":"down",value:1.2},icon:b}),a.jsx(g,{label:"Scheduled Tasks",value:N.summary?.scheduledMaintenance||0,icon:M}),a.jsx(g,{label:"Overdue Tasks",value:N.summary?.overdue||0,trend:{direction:N.summary?.overdue>0?"down":"neutral",value:N.summary?.overdue},icon:v}),a.jsx(g,{label:"MTBF",value:N.summary?.mtbf||0,unit:"hrs",icon:T})]}),a.jsxs("div",{className:"mb-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Reliability Metrics"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:[N.summary?.mtbf||0,"h"]}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Mean Time Between Failures"})]}),a.jsxs("div",{className:"text-center",children:[a.jsxs("p",{className:"text-2xl font-bold text-green-600",children:[N.summary?.mttr||0,"h"]}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Mean Time To Repair"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:N.summary?.completedThisMonth||0}),a.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Completed This Month"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Maintenance Types"}),a.jsx("div",{style:{height:"200px"},children:a.jsx(i,{data:w,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{boxWidth:12}}}}})})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Cost Analysis"}),a.jsx("div",{style:{height:"200px"},children:a.jsx(s,{data:k,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!1,ticks:{callback:function(e){return"$"+(e/1e3).toFixed(0)+"k"}}}}}})})]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Equipment Status"}),a.jsx(u,{columns:S,data:N.equipment||[]})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Upcoming Maintenance"}),a.jsxs("span",{className:"text-xs text-blue-600 bg-blue-100 dark:bg-blue-900/20 px-2 py-1 rounded",children:["Next 7 days: ",N.summary?.upcomingWeek||0," tasks"]})]}),a.jsx(u,{columns:[{key:"date",label:"Date"},{key:"equipment",label:"Equipment"},{key:"type",label:"Type"},{key:"duration",label:"Duration",render:e=>`${e}h`},{key:"technician",label:"Technician"}],data:N.upcomingSchedule||[]})]}),a.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Critical Spare Parts"}),N.spareParts?.filter(e=>e.stock<e.minimum).length>0&&a.jsxs("span",{className:"text-xs text-red-600 bg-red-100 dark:bg-red-900/20 px-2 py-1 rounded",children:[N.spareParts.filter(e=>e.stock<e.minimum).length," below minimum"]})]}),a.jsx(u,{columns:C,data:N.spareParts||[]})]}),a.jsxs("div",{className:"mt-4 text-xs text-gray-500 dark:text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})},defaultSize:{w:6,h:4},minSize:{minW:4,minH:3},category:"Maintenance"}],K={admin:{lg:[{i:"production-metrics",x:0,y:0,w:6,h:4},{i:"financial-overview",x:6,y:0,w:6,h:4},{i:"inventory-levels",x:0,y:4,w:6,h:4},{i:"quality-control",x:6,y:4,w:6,h:4},{i:"working-capital",x:0,y:8,w:6,h:5},{i:"supply-chain",x:6,y:8,w:6,h:5}]},manager:{lg:[{i:"production-metrics",x:0,y:0,w:6,h:4},{i:"quality-control",x:6,y:0,w:6,h:4},{i:"inventory-levels",x:0,y:4,w:6,h:4},{i:"supply-chain",x:6,y:4,w:6,h:4}]},operator:{lg:[{i:"production-metrics",x:0,y:0,w:12,h:4},{i:"quality-control",x:0,y:4,w:6,h:4},{i:"maintenance-schedule",x:6,y:4,w:6,h:4}]},viewer:{lg:[{i:"production-metrics",x:0,y:0,w:6,h:4},{i:"financial-overview",x:6,y:0,w:6,h:4}]}},H=({userRole:e="viewer"})=>{const{user:t}=c(),[s,r]=n.useState({}),[i,l]=n.useState([]),[d,o]=n.useState(!1),[m,x]=n.useState(!1),[g,u]=n.useState(null),[h,y]=n.useState(e);n.useEffect(()=>{(async()=>{if(t?.id)try{const e=await fetch("/api/user/dashboard-layout",{headers:{Authorization:`Bearer ${await t.getToken()}`}});if(e.ok){const a=await e.json();if(a.layouts&&a.widgets)return r(a.layouts),l(a.widgets),localStorage.setItem(`dashboardLayout_${t.id}`,JSON.stringify(a.layouts)),void localStorage.setItem(`dashboardWidgets_${t.id}`,JSON.stringify(a.widgets))}}catch(i){logError("Failed to load layout from database:",i)}const a=localStorage.getItem(`dashboardLayout_${t?.id}`),s=localStorage.getItem(`dashboardWidgets_${t?.id}`);a&&s?(r(JSON.parse(a)),l(JSON.parse(s))):p(e)})()},[t,e]);const p=e=>{const t=K[e]||K.viewer,a=t.lg.map(e=>e.i);r({lg:t.lg,md:t.lg,sm:t.lg,xs:t.lg}),l(a),y(e)};if(g){const e=J.find(e=>e.id===g),t=e?.component;return a.jsxs("div",{className:"fixed inset-0 bg-white dark:bg-gray-900 z-50 overflow-auto",children:[a.jsx("div",{className:"absolute top-4 right-4 z-10",children:a.jsx("button",{onClick:()=>u(null),className:"p-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg",children:a.jsx(A,{className:"h-6 w-6"})})}),a.jsx("div",{className:"p-4 h-full",children:t&&a.jsx(t,{})})]})}return a.jsxs("div",{className:"dashboard-grid-container",children:[a.jsx("div",{className:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("button",{onClick:()=>o(!d),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center",children:[a.jsx(L,{className:"h-4 w-4 mr-2"}),"Add Widget"]}),a.jsxs("button",{onClick:()=>x(!m),className:"px-4 py-2 rounded flex items-center "+(m?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:[a.jsx(I,{className:"h-4 w-4 mr-2"}),m?"Done Editing":"Edit Layout"]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("select",{value:h,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700",children:[a.jsx("option",{value:"",children:"Load Preset"}),a.jsx("option",{value:"admin",children:"Admin Layout"}),a.jsx("option",{value:"manager",children:"Manager Layout"}),a.jsx("option",{value:"operator",children:"Operator Layout"}),a.jsx("option",{value:"viewer",children:"Viewer Layout"})]}),a.jsx("button",{onClick:()=>{t?.id&&(localStorage.removeItem(`dashboardLayout_${t.id}`),localStorage.removeItem(`dashboardWidgets_${t.id}`)),p(e)},className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600",children:"Reset Layout"}),a.jsx("button",{onClick:async()=>{if(t?.id)try{const e=await t.getToken(),a=await fetch("/api/user/dashboard-layout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({layouts:s,widgets:i})});if(a.ok){await a.json();const e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",e.textContent="Dashboard layout saved successfully!",document.body.appendChild(e),setTimeout(()=>e.remove(),3e3)}else{const e=await a.json();logError("Failed to save layout:",e)}}catch(e){logError("Failed to save layout:",e)}else logWarn("Cannot save layout: User not authenticated")},className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Save to Profile"})]})]})}),d&&a.jsxs("div",{className:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-sm",children:[a.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Widget Catalog"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:J.map(e=>a.jsx("div",{className:"p-3 border rounded-lg cursor-pointer transition-colors "+(i.includes(e.id)?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"),onClick:()=>!i.includes(e.id)&&(e=>{if(i.includes(e))return;const a=J.find(t=>t.id===e);if(!a)return;const n=[...i,e];l(n);const d={i:e,x:0,y:0,...a.defaultSize,...a.minSize},c={lg:[...s.lg||[],d],md:[...s.md||[],d],sm:[...s.sm||[],d],xs:[...s.xs||[],d]};r(c),t?.id&&(localStorage.setItem(`dashboardWidgets_${t.id}`,JSON.stringify(n)),localStorage.setItem(`dashboardLayout_${t.id}`,JSON.stringify(c)))})(e.id),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-sm",children:e.name}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.category})]}),i.includes(e.id)&&a.jsx(b,{className:"h-5 w-5 text-green-500"})]})},e.id))})]}),a.jsx(B,{className:"layout",layouts:s,onLayoutChange:(e,a)=>{r(a),t?.id&&localStorage.setItem(`dashboardLayout_${t.id}`,JSON.stringify(a))},breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:6,xs:4,xxs:2},rowHeight:100,isDraggable:m,isResizable:m,draggableHandle:".widget-header",compactType:"vertical",margin:[16,16],children:i.map(e=>(e=>{const n=J.find(t=>t.id===e);if(!n)return null;const d=n.component;return a.jsxs("div",{className:"dashboard-widget-container h-full",children:[m&&a.jsxs("div",{className:"widget-header absolute top-0 left-0 right-0 bg-gray-100 dark:bg-gray-700 p-2 flex justify-between items-center cursor-move z-10",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:n.name}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:()=>(e=>{u(g===e?null:e)})(e),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",title:"Toggle fullscreen",children:g===e?a.jsx(A,{className:"h-4 w-4"}):a.jsx(q,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>(e=>{const a=i.filter(t=>t!==e);l(a);const n={lg:(s.lg||[]).filter(t=>t.i!==e),md:(s.md||[]).filter(t=>t.i!==e),sm:(s.sm||[]).filter(t=>t.i!==e),xs:(s.xs||[]).filter(t=>t.i!==e)};r(n),t?.id&&(localStorage.setItem(`dashboardWidgets_${t.id}`,JSON.stringify(a)),localStorage.setItem(`dashboardLayout_${t.id}`,JSON.stringify(n)))})(e),className:"p-1 hover:bg-red-100 dark:hover:bg-red-900 rounded text-red-600",title:"Remove widget",children:a.jsx(W,{className:"h-4 w-4"})})]})]}),a.jsx("div",{className:`h-full ${m?"pt-10":""} overflow-auto`,children:a.jsx(d,{})})]},e)})(e))}),0===i.length&&a.jsxs("div",{className:"flex flex-col items-center justify-center h-96 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[a.jsx(F,{className:"h-16 w-16 text-gray-400 mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No Widgets Added"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:'Click "Add Widget" to start building your dashboard'}),a.jsx("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Add Your First Widget"})]})]})};function U(){Q();const{user:e}=c(),[s,r]=n.useState(!0),[i,l]=n.useState(null),[d,o]=n.useState("grid"),[m,x]=n.useState("viewer");z("/api/kpis/realtime");const{data:g,refetch:u}=t({queryKey:["dashboard-data",d],queryFn:async()=>{const e=await fetch("/api/dashboard/overview");return e.ok?e.json():mockDashboardData},refetchInterval:15e3});return n.useEffect(()=>{const e=setTimeout(()=>{r(!1)},1200);return()=>clearTimeout(e)},[]),n.useEffect(()=>{x(e?.publicMetadata?.role||e?.unsafeMetadata?.role||"viewer")},[e]),s?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Initializing Sentia Enterprise Platform..."}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading AI Analytics & MCP Integration"})]})}):i?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md",children:[a.jsx("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Dashboard Error"}),a.jsx("p",{className:"text-gray-600 mb-4",children:i}),a.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Retry"})]})}):"ai-analytics"===d?a.jsx(O,{}):a.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[a.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700",children:a.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-4",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sentia Manufacturing Dashboard"}),a.jsxs("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:["Welcome back, ",e?.firstName||"User"," • Role: ",a.jsx("span",{className:"font-medium capitalize",children:m})]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:[a.jsxs("button",{onClick:()=>o("grid"),className:"px-3 py-1 rounded flex items-center space-x-2 "+("grid"===d?"bg-white dark:bg-gray-600 shadow-sm text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"),children:[a.jsx(F,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Grid View"})]}),a.jsxs("button",{onClick:()=>o("classic"),className:"px-3 py-1 rounded flex items-center space-x-2 "+("classic"===d?"bg-white dark:bg-gray-600 shadow-sm text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"),children:[a.jsx($,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm",children:"Classic View"})]})]}),a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:"● Live Data"}),a.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:(new Date).toLocaleTimeString()})]})]})})}),"grid"===d?a.jsx("div",{className:"p-4 lg:p-6",children:a.jsx(H,{userRole:m})}):a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Production Output"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"1,234"}),a.jsx("p",{className:"text-sm text-green-600",children:"↗ +12% from yesterday"})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx("div",{className:"w-6 h-6 bg-green-600 rounded"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Efficiency Rate"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"94.2%"}),a.jsx("p",{className:"text-sm text-green-600",children:"↗ +2.1% from last week"})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:a.jsx("div",{className:"w-6 h-6 bg-yellow-600 rounded"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Quality Score"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"98.7%"}),a.jsx("p",{className:"text-sm text-yellow-600",children:"→ Stable"})]})]})}),a.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx("div",{className:"w-6 h-6 bg-purple-600 rounded"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Active Orders"}),a.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"87"}),a.jsx("p",{className:"text-sm text-blue-600",children:"24 urgent priority"})]})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Production Lines Status"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Line A - Assembly"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Running at 98% capacity"})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm font-medium text-green-600",children:"Running"}),a.jsx("p",{className:"text-xs text-gray-500",children:"234 units/hr"})]})]}),a.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Line B - Packaging"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Running at 95% capacity"})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm font-medium text-green-600",children:"Running"}),a.jsx("p",{className:"text-xs text-gray-500",children:"187 units/hr"})]})]}),a.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Line C - Quality Check"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Scheduled maintenance"})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-sm font-medium text-yellow-600",children:"Maintenance"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Resumes at 2:00 PM"})]})]})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("button",{className:"w-full text-left p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors",children:[a.jsx("p",{className:"font-medium text-blue-900",children:"Working Capital Analysis"}),a.jsx("p",{className:"text-sm text-blue-600",children:"Review financial metrics"})]}),a.jsxs("button",{className:"w-full text-left p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors",children:[a.jsx("p",{className:"font-medium text-green-900",children:"What-If Scenarios"}),a.jsx("p",{className:"text-sm text-green-600",children:"Model production changes"})]}),a.jsxs("button",{className:"w-full text-left p-3 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors",children:[a.jsx("p",{className:"font-medium text-purple-900",children:"Admin Panel"}),a.jsx("p",{className:"text-sm text-purple-600",children:"System configuration"})]})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Alerts"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-green-50 rounded-lg",children:[a.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm text-green-800",children:"Order #12345 completed"}),a.jsx("p",{className:"text-xs text-green-600",children:"2 minutes ago"})]})]}),a.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg",children:[a.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm text-yellow-800",children:"Maintenance scheduled"}),a.jsx("p",{className:"text-xs text-yellow-600",children:"10 minutes ago"})]})]}),a.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-blue-50 rounded-lg",children:[a.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm text-blue-800",children:"Quality check passed"}),a.jsx("p",{className:"text-xs text-blue-600",children:"15 minutes ago"})]})]})]})]})]})]}),a.jsxs("div",{className:"mt-8 bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Financial Overview"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[a.jsx("p",{className:"text-2xl font-bold text-blue-600",children:"£1.2M"}),a.jsx("p",{className:"text-gray-600 text-sm",children:"Current Cash Flow"}),a.jsx("p",{className:"text-xs text-green-600 mt-1",children:"↗ +5.2% this month"})]}),a.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[a.jsx("p",{className:"text-2xl font-bold text-green-600",children:"£890K"}),a.jsx("p",{className:"text-gray-600 text-sm",children:"Accounts Receivable"}),a.jsx("p",{className:"text-xs text-green-600 mt-1",children:"↗ +2.1% this month"})]}),a.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[a.jsx("p",{className:"text-2xl font-bold text-orange-600",children:"£450K"}),a.jsx("p",{className:"text-gray-600 text-sm",children:"Inventory Value"}),a.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"→ Stable"})]}),a.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[a.jsx("p",{className:"text-2xl font-bold text-purple-600",children:"89 days"}),a.jsx("p",{className:"text-gray-600 text-sm",children:"Cash Conversion Cycle"}),a.jsx("p",{className:"text-xs text-green-600 mt-1",children:"↘ -3 days improvement"})]})]})]})]})})]})}export{U as default};
