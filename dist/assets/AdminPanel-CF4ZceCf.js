import{j as e}from"./query-CJR12TOn.js";import{k as a}from"./index-BCCk1gmw.js";import{a as s}from"./vendor-BPOA5ME_.js";import{a as i}from"./axios-3c2ZL6GZ.js";import"./auth-zWw5cpzK.js";function t(){const t={firstName:"Admin"},[n,r]=s.useState([]),[l,d]=s.useState([]),[c,o]=s.useState(!0),[h,m]=s.useState(null),[u,p]=s.useState(""),[j,x]=s.useState("user"),[v,g]=s.useState(!1);s.useEffect(()=>{b(),N()},[]);const b=async()=>{try{const e=await null,a=await i.get("/api/admin/users",{headers:{Authorization:`Bearer ${e}`}});r(a.data.users||[])}catch(e){a.error("Error fetching users:",e),m("Failed to fetch users")}},N=async()=>{try{const e=await null,a=await i.get("/api/admin/invitations",{headers:{Authorization:`Bearer ${e}`}});d(a.data.invitations||[])}catch(e){a.error("Error fetching invitations:",e)}finally{o(!1)}};return c?e.jsx("div",{className:"admin-loading",children:e.jsx("div",{className:"spinner",children:"Loading admin panel..."})}):e.jsxs("div",{className:"admin-panel",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"Admin Panel"}),e.jsx("p",{children:"Manage users and access permissions for the Sentia Manufacturing Dashboard"})]}),h&&e.jsx("div",{className:"admin-error",children:e.jsx("p",{children:h})}),e.jsxs("div",{className:"admin-section",children:[e.jsx("h2",{children:"Send Invitation"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),u.trim())try{g(!0);const e=await null;await i.post("/api/admin/invite",{email:u.trim(),role:j,invitedBy:t.id},{headers:{Authorization:`Bearer ${e}`}}),p(""),x("user"),N(),alert("Invitation sent successfully!")}catch(s){a.error("Error sending invitation:",s),alert("Failed to send invitation: "+(s.response?.data?.error||s.message))}finally{g(!1)}},className:"invite-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"inviteEmail",children:"Email Address:"}),e.jsx("input",{type:"email",id:"inviteEmail",value:u,onChange:e=>p(e.target.value),placeholder:"user@company.com",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"inviteRole",children:"Role:"}),e.jsxs("select",{id:"inviteRole",value:j,onChange:e=>x(e.target.value),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v,children:v?"Sending...":"Send Invitation"})]})]}),e.jsxs("div",{className:"admin-section",children:[e.jsxs("h2",{children:["Pending Invitations (",l.length,")"]}),l.length>0?e.jsx("div",{className:"invitations-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Invited By"}),e.jsx("th",{children:"Date Sent"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.email}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${s.role}`,children:s.role})}),e.jsx("td",{children:s.invited_by_email}),e.jsx("td",{children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${s.status}`,children:s.status})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>(async e=>{try{const a=await null;await i.delete(`/api/admin/invitations/${e}`,{headers:{Authorization:`Bearer ${a}`}}),N(),alert("Invitation deleted successfully!")}catch(s){a.error("Error deleting invitation:",s),alert("Failed to delete invitation: "+(s.response?.data?.error||s.message))}})(s.id),className:"btn btn-danger btn-sm",children:"Delete"})})]},s.id))})]})}):e.jsx("p",{className:"no-data",children:"No pending invitations"})]}),e.jsxs("div",{className:"admin-section",children:[e.jsxs("h2",{children:["User Management (",n.length,")"]}),n.length>0?e.jsx("div",{className:"users-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Last Sign In"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.first_name&&s.last_name?`${s.first_name} ${s.last_name}`:s.username||"N/A"}),e.jsx("td",{children:s.email_addresses?.[0]?.email_address||"N/A"}),e.jsx("td",{children:e.jsx("span",{className:`role-badge ${s.public_metadata?.role||"user"}`,children:s.public_metadata?.role||"user"})}),e.jsx("td",{children:e.jsx("span",{className:"status-badge "+(s.public_metadata?.approved?"approved":"pending"),children:s.public_metadata?.approved?"Approved":"Pending"})}),e.jsx("td",{children:s.last_sign_in_at?new Date(s.last_sign_in_at).toLocaleDateString():"Never"}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[!s.public_metadata?.approved&&"admin"!==s.public_metadata?.role&&e.jsx("button",{onClick:()=>(async e=>{try{const a=await null;await i.post(`/api/admin/users/${e}/approve`,{},{headers:{Authorization:`Bearer ${a}`}}),b(),alert("User approved successfully!")}catch(s){a.error("Error approving user:",s),alert("Failed to approve user: "+(s.response?.data?.error||s.message))}})(s.id),className:"btn btn-success btn-sm",children:"Approve"}),s.public_metadata?.approved&&"admin"!==s.public_metadata?.role&&e.jsx("button",{onClick:()=>(async e=>{try{const a=await null;await i.post(`/api/admin/users/${e}/revoke`,{},{headers:{Authorization:`Bearer ${a}`}}),b(),alert("User access revoked successfully!")}catch(s){a.error("Error revoking user:",s),alert("Failed to revoke user: "+(s.response?.data?.error||s.message))}})(s.id),className:"btn btn-warning btn-sm",children:"Revoke"}),"admin"===s.public_metadata?.role&&e.jsx("span",{className:"admin-indicator",children:"Admin User"})]})})]},s.id))})]})}):e.jsx("p",{className:"no-data",children:"No users found"})]})]})}export{t as default};
