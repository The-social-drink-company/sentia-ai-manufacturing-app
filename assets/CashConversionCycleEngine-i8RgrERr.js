import{D as m}from"./DateContextEngine-AD4Dz4QU.js";class f{constructor(t={}){this.dateEngine=new m,this.config={targetDSO:t.targetDSO||45,targetDPO:t.targetDPO||60,targetDIO:t.targetDIO||30,creditTerms:t.creditTerms||{net15:.1,net30:.5,net45:.25,net60:.15},paymentTerms:t.paymentTerms||{net30:.3,net60:.45,net90:.25},inventoryCategories:t.inventoryCategories||{rawMaterials:{turnoverDays:21,percentage:.4},workInProcess:{turnoverDays:7,percentage:.15},finishedGoods:{turnoverDays:35,percentage:.45}}}}calculateCashConversionCycle(t={}){const a=this.dateEngine.getCurrentContext(),e={annualRevenue:t.annualRevenue||4e7,annualCOGS:t.annualCOGS||26e6,averageReceivables:t.averageReceivables||null,averageInventory:t.averageInventory||null,averagePayables:t.averagePayables||null,...t},r=e.annualRevenue/365,n=e.annualCOGS/365,o=e.averageReceivables||this.calculateReceivables(r),c=e.averageInventory||this.calculateInventory(n),l=e.averagePayables||this.calculatePayables(n),i=this.calculateDSO(o,r,a),s=this.calculateDIO(c,n,a),u=this.calculateDPO(l,n,a),h=i+s-u;return{cashConversionCycle:Math.round(h*10)/10,components:{dso:Math.round(i*10)/10,dio:Math.round(s*10)/10,dpo:Math.round(u*10)/10},balanceSheetItems:{receivables:Math.round(o),inventory:Math.round(c),payables:Math.round(l)},benchmarks:{targetDSO:this.config.targetDSO,targetDIO:this.config.targetDIO,targetDPO:this.config.targetDPO,targetCCC:this.config.targetDSO+this.config.targetDIO-this.config.targetDPO},performance:{dsoVariance:Math.round((i-this.config.targetDSO)*10)/10,dioVariance:Math.round((s-this.config.targetDIO)*10)/10,dpoVariance:Math.round((u-this.config.targetDPO)*10)/10},workingCapitalImpact:this.calculateWorkingCapitalImpact(h,r),recommendations:this.generateRecommendations(i,s,u),calculatedAt:a.currentDate}}calculateDSO(t,a,e){const r=t/a;let n=1;return e.dayOfMonth>25&&[3,6,9,12].includes(e.currentMonth)&&(n=1.15),[12,1].includes(e.currentMonth)&&(n=1.08),[7,8].includes(e.currentMonth)&&(n=1.05),r*n}calculateDIO(t,a,e){const r=t/a;let n=1;return[10,11].includes(e.currentMonth)&&(n=1.2),[1,2].includes(e.currentMonth)&&(n=.85),[6,7,8].includes(e.currentMonth)&&(n=.95),r*n}calculateDPO(t,a,e){const r=t/a;let n=1;return e.dayOfMonth<=15&&(n=1.1),e.dayOfMonth>25&&[3,6,9,12].includes(e.currentMonth)&&(n=1.08),r*n}calculateReceivables(t){let a=0;return Object.entries(this.config.creditTerms).forEach(([e,r])=>{const o=parseInt(e.replace("net",""))+7;a+=o*r}),t*a}calculateInventory(t){let a=0;return Object.entries(this.config.inventoryCategories).forEach(([e,r])=>{const n=t*r.turnoverDays*r.percentage;a+=n}),a}calculatePayables(t){let a=0;return Object.entries(this.config.paymentTerms).forEach(([e,r])=>{const n=parseInt(e.replace("net",""));a+=n*r}),t*.7*a}calculateWorkingCapitalImpact(t,a){const e=this.config.targetDSO+this.config.targetDIO-this.config.targetDPO,r=t-e,n=r*a;return{cccVarianceDays:Math.round(r*10)/10,workingCapitalImpact:Math.round(n),annualInterestCost:Math.round(n*.055),optimizationPotential:Math.round(Math.abs(n))}}generateRecommendations(t,a,e){const r=[];t>this.config.targetDSO+5&&r.push({area:"Collections",priority:"high",issue:`DSO of ${t.toFixed(1)} days exceeds target by ${(t-this.config.targetDSO).toFixed(1)} days`,recommendation:"Implement automated collections processes, offer early payment discounts, review credit terms",impact:`Could free up £${Math.round((t-this.config.targetDSO)*4e7/365).toLocaleString()} in working capital`}),a>this.config.targetDIO+5&&r.push({area:"Inventory",priority:"medium",issue:`Inventory days of ${a.toFixed(1)} exceeds target by ${(a-this.config.targetDIO).toFixed(1)} days`,recommendation:"Implement just-in-time ordering, improve demand forecasting, reduce safety stock levels",impact:`Could free up £${Math.round((a-this.config.targetDIO)*26e6/365).toLocaleString()} in working capital`}),e<this.config.targetDPO-5&&r.push({area:"Payables",priority:"low",issue:`Payable days of ${e.toFixed(1)} below target by ${(this.config.targetDPO-e).toFixed(1)} days`,recommendation:"Negotiate extended payment terms with suppliers, optimize payment timing",impact:`Could improve cash flow by £${Math.round((this.config.targetDPO-e)*26e6/365).toLocaleString()}`});const n=t+a-e,o=this.config.targetDSO+this.config.targetDIO-this.config.targetDPO;return n>o+10&&r.push({area:"Cash Conversion Cycle",priority:"high",issue:`CCC of ${n.toFixed(1)} days significantly exceeds target of ${o.toFixed(1)} days`,recommendation:"Comprehensive working capital optimization program focusing on collections and inventory",impact:`Total optimization potential: £${Math.round((n-o)*4e7/365).toLocaleString()}`}),r}projectCCCOverTime(t=12){const a=[],e=this.calculateCashConversionCycle();for(let r=0;r<t;r++){const n=new Date;n.setMonth(n.getMonth()+r);const o={currentMonth:n.getMonth()+1,dayOfMonth:n.getDate(),currentDate:n.toISOString().split("T")[0]};let c=e.components.dso,l=e.components.dio,i=e.components.dpo;[12,1].includes(o.currentMonth)&&(c*=1.08),[7,8].includes(o.currentMonth)&&(c*=1.05),[10,11].includes(o.currentMonth)&&(l*=1.2),[1,2].includes(o.currentMonth)&&(l*=.85),[3,6,9,12].includes(o.currentMonth)&&(i*=1.08);const s=c+l-i;a.push({month:n.toLocaleDateString("en-US",{month:"short",year:"numeric"}),date:o.currentDate,ccc:Math.round(s*10)/10,dso:Math.round(c*10)/10,dio:Math.round(l*10)/10,dpo:Math.round(i*10)/10,workingCapitalImpact:Math.round((s-e.benchmarks.targetCCC)*4e7/365)})}return a}analyzeCCCTrends(t){if(!t||t.length<3)return{trend:"insufficient_data",message:"Need at least 3 data points for trend analysis"};const a=t.length;let e=0,r=0,n=0,o=0;t.forEach((g,d)=>{e+=d,r+=g.ccc,n+=d*g.ccc,o+=d*d});const c=(a*n-e*r)/(a*o-e*e),l=c>1?"deteriorating":c<-1?"improving":"stable",i=t.map(g=>g.ccc),s=i.reduce((g,d)=>g+d,0)/i.length,u=i.reduce((g,d)=>g+Math.pow(d-s,2),0)/i.length,h=u>25?"high":u>10?"medium":"low";return{trend:l,slope:Math.round(c*100)/100,volatility:h,variance:Math.round(u*10)/10,averageCCC:Math.round(s*10)/10,recommendation:this.getTrendRecommendation(l,h,s)}}getTrendRecommendation(t,a,e){return t==="deteriorating"?"CCC is worsening over time. Immediate action needed on collections, inventory management, or supplier terms.":t==="improving"?"CCC is improving. Continue current optimization efforts and identify additional opportunities.":a==="high"?"CCC is highly volatile. Focus on stabilizing working capital processes and improving predictability.":"CCC is stable. Monitor for seasonal patterns and optimization opportunities."}}export{f as C};
