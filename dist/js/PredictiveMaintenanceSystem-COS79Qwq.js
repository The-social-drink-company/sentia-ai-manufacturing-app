import{a as e,j as t,a0 as a,b8 as r,b9 as s}from"./chunk-DPRQcyFe.js";import{u as n,a as i}from"./chunk-DXWZWqNt.js";import{f as l}from"./index-DNXzz1vj.js";import"./chunk-BfmujUnw.js";import"./chunk-B5P-aYZ_.js";import"./chunk-BS6JJXKa.js";import"./chunk-DC45jon4.js";import"./chunk-pU9d5F3v.js";import"./chunk-C7vLRJrk.js";import"./chunk-Dozjk7Op.js";const c=({className:c="",equipmentFilter:o=null,maintenanceHorizon:d=30,predictionThreshold:m=.7,...u})=>{const{aiServices:p,performAIAnalysis:h,isLoading:x}=n(),{subscribe:g,STREAM_TYPES:b}=i(),{resolvedTheme:y}=l(),[v,j]=e.useState([]),[N,f]=e.useState([]),[k,w]=e.useState([]),[S,$]=e.useState([]),[D,M]=e.useState(null),[H,C]=e.useState("overview"),[E,P]=e.useState(!1),R={label:"Excellent",color:"text-green-600",bg:"bg-green-100 dark:bg-green-900/30"},I={label:"Good",color:"text-blue-600",bg:"bg-blue-100 dark:bg-blue-900/30"},L={label:"Fair",color:"text-yellow-600",bg:"bg-yellow-100 dark:bg-yellow-900/30"},A={label:"Poor",color:"text-orange-600",bg:"bg-orange-100 dark:bg-orange-900/30"},T={label:"Critical",color:"text-red-600",bg:"bg-red-100 dark:bg-red-900/30"};e.useEffect(()=>{j([{id:"cnc-001",name:"CNC Milling Machine #1",type:"CNC_MACHINE",location:"Production Line A",installDate:"2020-03-15",lastMaintenance:"2024-08-15",operatingHours:8750,healthScore:.85,vibrationLevel:2.3,temperature:68.5,powerConsumption:12.4,efficiency:.92,predictedFailureRisk:.15},{id:"conv-001",name:"Conveyor Belt System #1",type:"CONVEYOR",location:"Assembly Line B",installDate:"2019-11-20",lastMaintenance:"2024-09-01",operatingHours:12200,healthScore:.78,vibrationLevel:1.8,temperature:45.2,powerConsumption:5.7,efficiency:.89,predictedFailureRisk:.35},{id:"pump-001",name:"Hydraulic Pump #1",type:"PUMP",location:"Utility Room",installDate:"2021-01-10",lastMaintenance:"2024-08-20",operatingHours:6800,healthScore:.91,vibrationLevel:1.2,temperature:72.1,powerConsumption:8.9,efficiency:.95,predictedFailureRisk:.08},{id:"press-001",name:"Hydraulic Press #1",type:"PRESS",location:"Production Line C",installDate:"2018-07-22",lastMaintenance:"2024-07-10",operatingHours:15600,healthScore:.68,vibrationLevel:3.1,temperature:85.3,powerConsumption:18.2,efficiency:.82,predictedFailureRisk:.52}])},[]),e.useEffect(()=>{const e=[g(b.VIBRATION_SENSORS,e=>{q(e,"vibrationLevel")}),g(b.TEMPERATURE_SENSORS,e=>{q(e,"temperature")}),g(b.EQUIPMENT_STATUS,e=>{U(e)})];return()=>{e.forEach(e=>e())}},[g,b]);const q=(e,t)=>{j(a=>a.map(a=>e.equipmentId===a.id?{...a,[t]:e.value,lastUpdate:Date.now()}:a))},U=e=>{j(t=>t.map(t=>e.equipmentId===t.id?{...t,...e,lastUpdate:Date.now()}:t))},F=e=>{const t=e.filter(e=>e.failureRisk>m).map(e=>{const t=O(e.equipmentId),a=Math.max(1,Math.floor(.8*e.timeToFailure));return{id:`maint-${e.equipmentId}-${Date.now()}`,equipmentId:e.equipmentId,equipmentName:t?.name||"Unknown Equipment",type:e.recommendedAction||"Preventive Maintenance",scheduledDate:new Date(Date.now()+24*a*60*60*1e3),priority:e.failureRisk>.8?"HIGH":"MEDIUM",estimatedDuration:e.estimatedRepairTime||4,description:e.description||"Preventive maintenance based on predictive analysis"}});$(t)},O=e=>v.find(t=>t.id===e),_=e=>{let t=1;const a=(Date.now()-new Date(e.installDate).getTime())/31536e6;t-=Math.min(.3,.05*a);const r=2e3*a,s=e.operatingHours/r;return t-=Math.min(.2,.5*Math.max(0,s-1)),e.vibrationLevel>3&&(t-=.1),e.temperature>80&&(t-=.1),e.efficiency<.85&&(t-=.1),Math.max(0,Math.min(1,t))},z=e.useMemo(()=>{let e=v;return o&&(e=e.filter(e=>e.type===o)),e.map(e=>{return{...e,calculatedHealthScore:_(e),healthState:(t=_(e),t>=.9?R:t>=.8?I:t>=.7?L:t>=.6?A:T)};var t})},[v,o]),B=e.useMemo(()=>S.filter(e=>new Date(e.scheduledDate)<=new Date(Date.now()+6048e5)).sort((e,t)=>new Date(e.scheduledDate)-new Date(t.scheduledDate)),[S]),G=`\n    rounded-lg border shadow-sm\n    ${"dark"===y?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}\n  `,V="dark"===y?"text-gray-100":"text-gray-900",Y="dark"===y?"text-gray-300":"text-gray-600",Q="dark"===y?"text-gray-400":"text-gray-500";return t.jsxs("div",{className:`space-y-6 ${c}`,...u,children:[t.jsx("div",{className:G,children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(a,{className:"w-6 h-6 mr-3 text-blue-600"}),t.jsx("h2",{className:`text-xl font-semibold ${V}`,children:"Predictive Maintenance System"})]}),t.jsx("div",{className:"flex items-center space-x-3",children:t.jsx("button",{onClick:async()=>{if(p.maintenancePrediction){P(!0);try{const e=v.map(e=>({equipmentId:e.id,type:e.type,operatingHours:e.operatingHours,vibrationLevel:e.vibrationLevel,temperature:e.temperature,powerConsumption:e.powerConsumption,efficiency:e.efficiency,lastMaintenanceDate:e.lastMaintenance,installDate:e.installDate})),t=await h("maintenancePrediction",{equipment:e,horizon:d,threshold:m});f(t.predictions||[]),w(t.anomalies||[]),F(t.predictions||[])}catch(e){}finally{P(!1)}}},disabled:E||x,className:`\n                  px-4 py-2 rounded-lg font-medium transition-colors\n                  ${E||x?"bg-gray-200 text-gray-500 cursor-not-allowed dark:bg-gray-700":"bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600"}\n                `,children:E?"Analyzing...":"Run AI Analysis"})})]}),t.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:["overview","predictions","schedule","analytics"].map(e=>t.jsx("button",{onClick:()=>C(e),className:`\n                  px-4 py-2 rounded-md text-sm font-medium transition-colors\n                  ${H===e?"bg-white shadow text-blue-600 dark:bg-gray-800 dark:text-blue-400":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"}\n                `,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})}),"overview"===H&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:`lg:col-span-2 ${G}`,children:t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:`text-lg font-semibold mb-4 ${V}`,children:"Equipment Health Status"}),t.jsx("div",{className:"space-y-4",children:z.map(e=>t.jsxs("div",{className:`\n                      p-4 rounded-lg border cursor-pointer transition-colors\n                      ${D?.id===e.id?"ring-2 ring-blue-500 border-blue-300 dark:border-blue-600":"border-gray-200 hover:border-gray-300 dark:border-gray-600 dark:hover:border-gray-500"}\n                      ${"dark"===y?"bg-slate-700":"bg-gray-50"}\n                    `,onClick:()=>M(e),children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`\n                          w-3 h-3 rounded-full\n                          ${e.healthState.color.includes("green")?"bg-green-500":e.healthState.color.includes("blue")?"bg-blue-500":e.healthState.color.includes("yellow")?"bg-yellow-500":e.healthState.color.includes("orange")?"bg-orange-500":"bg-red-500"}\n                        `}),t.jsxs("div",{children:[t.jsx("h4",{className:`font-medium ${V}`,children:e.name}),t.jsx("p",{className:`text-sm ${Q}`,children:e.location})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:`\n                          px-2 py-1 rounded-full text-xs font-medium\n                          ${e.healthState.bg} ${e.healthState.color}\n                        `,children:e.healthState.label}),t.jsxs("p",{className:`text-sm mt-1 ${Q}`,children:[Math.round(100*e.calculatedHealthScore),"% Health"]})]})]}),t.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs ${Q}`,children:"Vibration"}),t.jsxs("p",{className:`font-medium ${Y}`,children:[e.vibrationLevel,"mm/s"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs ${Q}`,children:"Temp"}),t.jsxs("p",{className:`font-medium ${Y}`,children:[e.temperature,"Â°C"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs ${Q}`,children:"Efficiency"}),t.jsxs("p",{className:`font-medium ${Y}`,children:[Math.round(100*e.efficiency),"%"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:`text-xs ${Q}`,children:"Hours"}),t.jsx("p",{className:`font-medium ${Y}`,children:e.operatingHours.toLocaleString()})]})]})]},e.id))})]})}),t.jsx("div",{className:G,children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx(r,{className:"w-5 h-5 mr-2 text-orange-600"}),t.jsx("h3",{className:`text-lg font-semibold ${V}`,children:"Pending Maintenance"})]}),B.length>0?t.jsx("div",{className:"space-y-3",children:B.slice(0,5).map(e=>t.jsxs("div",{className:"border-l-4 border-orange-500 pl-3",children:[t.jsx("h4",{className:`font-medium ${V}`,children:e.equipmentName}),t.jsx("p",{className:`text-sm ${Y}`,children:e.type}),t.jsxs("div",{className:"flex justify-between items-center mt-1",children:[t.jsx("span",{className:`text-xs ${Q}`,children:new Date(e.scheduledDate).toLocaleDateString()}),t.jsx("span",{className:`\n                          text-xs px-2 py-1 rounded\n                          ${"HIGH"===e.priority?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"}\n                        `,children:e.priority})]})]},e.id))}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(s,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),t.jsx("p",{className:Y,children:"No pending maintenance"})]})]})})]})]})};export{c as PredictiveMaintenanceSystem,c as default};
