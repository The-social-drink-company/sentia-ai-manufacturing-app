import{d as e,q as t}from"./index-D4EDaX83.js";import{r as a,a6 as s,j as r}from"./react-core-DkFbty9o.js";import{e as n,r as i,K as c,c as o,P as l,p as d,a8 as m,a as u,R as g}from"./ui-components-J4-_vVnI.js";import{m as p,A as y}from"./animation-CTJwy-Vh.js";const x={"job.forecast.started":(e,a)=>{a.setQueryData(t.forecastJob(e.jobId),{...e,status:"running",startedAt:(new Date).toISOString()})},"job.forecast.progress":(e,a)=>{a.setQueryData(t.forecastJob(e.jobId),t=>({...t,...e,updatedAt:(new Date).toISOString()}))},"job.forecast.completed":(e,a)=>{a.setQueryData(t.forecastJob(e.jobId),{...e,status:"completed",completedAt:(new Date).toISOString()}),a.invalidateQueries({queryKey:["forecasts"]}),a.invalidateQueries({queryKey:["forecast-series"]})},"job.forecast.failed":(e,a)=>{a.setQueryData(t.forecastJob(e.jobId),{...e,status:"failed",failedAt:(new Date).toISOString()})},"job.stock.started":(e,a)=>{a.setQueryData(t.stockOptimizationJob(e.jobId),{...e,status:"running",startedAt:(new Date).toISOString()})},"job.stock.completed":(e,a)=>{a.setQueryData(t.stockOptimizationJob(e.jobId),{...e,status:"completed",completedAt:(new Date).toISOString()}),a.invalidateQueries({queryKey:["stock-optimization"]}),a.invalidateQueries({queryKey:["stock-levels"]}),a.invalidateQueries({queryKey:["reorder-suggestions"]})},"job.stock.failed":(e,a)=>{a.setQueryData(t.stockOptimizationJob(e.jobId),{...e,status:"failed",failedAt:(new Date).toISOString()})},"job.workingcapital.completed":(e,a)=>{a.setQueryData(t.workingCapitalJob(e.jobId),{...e,status:"completed",completedAt:(new Date).toISOString()}),a.invalidateQueries({queryKey:["working-capital"]}),a.invalidateQueries({queryKey:["wc-projections"]}),a.invalidateQueries({queryKey:["wc-kpis"]})},"metrics.kpi.updated":(e,a)=>{a.setQueryData(t.kpiMetrics(e.timeRange,e.filters),t=>({...t,...e.metrics,updatedAt:(new Date).toISOString()}))},"metrics.capacity.updated":(e,a)=>{a.setQueryData(t.capacityUtilization(e.facilities,e.timeRange),t=>({...t,...e.utilization,updatedAt:(new Date).toISOString()}))},"metrics.system.health":(e,a)=>{a.setQueryData(t.systemHealth(),{...e,timestamp:(new Date).toISOString()})},"alert.stock.low":(e,t)=>{t.invalidateQueries({queryKey:["stock-levels"]}),t.invalidateQueries({queryKey:["reorder-suggestions"]})},"alert.stock.critical":(e,t)=>{t.invalidateQueries({queryKey:["stock-levels"]}),t.invalidateQueries({queryKey:["reorder-suggestions"]})},"alert.workingcapital.breach":(e,t)=>{t.invalidateQueries({queryKey:["wc-projections"]}),t.invalidateQueries({queryKey:["wc-kpis"]})},"job.import.started":(e,a)=>{a.setQueryData(t.importJob(e.jobId),{...e,status:"running",startedAt:(new Date).toISOString()})},"job.import.completed":(e,a)=>{a.setQueryData(t.importJob(e.jobId),{...e,status:"completed",completedAt:(new Date).toISOString()}),a.invalidateQueries({queryKey:["import-jobs"]})},"job.import.failed":(e,a)=>{a.setQueryData(t.importJob(e.jobId),{...e,status:"failed",failedAt:(new Date).toISOString()})},"system.maintenance.start":(e,a)=>{a.setQueryData(t.systemHealth(),t=>({...t,maintenance:!0,maintenanceMessage:e.message}))},"system.maintenance.end":(e,a)=>{a.setQueryData(t.systemHealth(),e=>({...e,maintenance:!1,maintenanceMessage:null}))}},h=({endpoint:t="/api/events",enabled:r=!0,reconnectDelay:n=3e3,maxReconnectAttempts:i=10,onConnect:c=null,onDisconnect:o=null,onError:l=null,onMessage:d=null}={})=>{const[m,u]=a.useState({connected:!1,connecting:!1,error:null,reconnectAttempts:0}),g=a.useRef(null),p=a.useRef(null),y=s(),[h,b]=a.useState([]),j=a.useCallback(e=>{},[]),f=a.useCallback(t=>{try{const e=JSON.parse(t.data);j({type:t.type,data:e}),d&&d(t.type,e);const a=x[t.type];a&&a(e,y),window.dispatchEvent(new CustomEvent("sse-message",{detail:{type:t.type,data:e}}))}catch(a){e.error("Error parsing SSE message:",a,t)}},[d,y,j]),w=a.useCallback(()=>{if(r&&!g.current){u(e=>({...e,connecting:!0,error:null}));try{const a=new EventSource(t);g.current=a,a.onopen=()=>{u({connected:!0,connecting:!1,error:null,reconnectAttempts:0}),c&&c(),p.current&&(clearTimeout(p.current),p.current=null)},a.onerror=t=>{e.error("SSE connection error:",t),u(e=>({connected:!1,connecting:!1,error:t,reconnectAttempts:e.reconnectAttempts+1})),l&&l(t),a.close(),g.current=null,m.reconnectAttempts<i&&(p.current=setTimeout(()=>{w()},n))},a.onmessage=e=>{f({type:"message",data:e.data})},Object.keys(x).forEach(e=>{a.addEventListener(e,f)})}catch(a){e.error("Failed to create SSE connection:",a),u(e=>({...e,connecting:!1,error:a}))}}},[r,t,i,n,c,l,f,m.reconnectAttempts]),v=a.useCallback(()=>{g.current&&(g.current.close(),g.current=null),p.current&&(clearTimeout(p.current),p.current=null),u({connected:!1,connecting:!1,error:null,reconnectAttempts:0}),o&&o()},[o]),N=a.useCallback(()=>{v(),setTimeout(w,100)},[v,w]);return a.useEffect(()=>(r&&w(),()=>{v()}),[r,w,v]),a.useEffect(()=>()=>{v()},[v]),{connectionState:m,eventLog:h,connect:w,disconnect:v,reconnect:N,isConnected:m.connected,isConnecting:m.connecting,hasError:!!m.error,canReconnect:m.reconnectAttempts<i}},b=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[e,t]=a.useState("all"),[s,x]=a.useState([]),[h,b]=a.useState(!0),[j,f]=a.useState([{id:"all",name:"All Insights",count:0},{id:"production",name:"Production",count:0},{id:"quality",name:"Quality",count:0},{id:"maintenance",name:"Maintenance",count:0},{id:"inventory",name:"Inventory",count:0},{id:"energy",name:"Energy",count:0},{id:"demand",name:"Demand",count:0}]);a.useEffect(()=>{(async()=>{try{b(!0);const t=await fetch("/api/ai/insights");if(t.ok){const a=(await t.json()).insights||[],s=j.map(e=>({...e,count:"all"===e.id?a.length:a.filter(t=>t.category===e.id).length}));f(s);const r="all"===e?a:a.filter(t=>t.category===e);x(r)}else x([])}catch(t){x([])}finally{b(!1)}})()},[e]);const w=e=>{switch(e){case"critical":return"border-red-500 bg-red-50";case"high":return"border-orange-500 bg-orange-50";case"medium":return"border-yellow-500 bg-yellow-50";case"low":return"border-green-500 bg-green-50";default:return"border-gray-500 bg-gray-50"}},v=e=>{switch(e){case"opportunity":return"text-yellow-600";case"alert":return"text-red-600";case"insight":return"text-purple-600";case"prediction":return"text-blue-600";case"optimization":return"text-green-600";case"forecast":return"text-indigo-600";default:return"text-gray-600"}};return r.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[r.jsxs("div",{className:"mb-8",children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[r.jsx(n,{className:"w-8 h-8 mr-3 text-blue-600"}),"AI Insights Dashboard"]}),r.jsx("p",{className:"text-gray-600 mt-2",children:"Real-time artificial intelligence insights and recommendations from your manufacturing data"})]}),r.jsx("div",{className:"mb-8 overflow-x-auto",children:r.jsx("div",{className:"flex space-x-2 pb-2",children:j.map(a=>r.jsxs(p.button,{onClick:()=>t(a.id),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap "+(e===a.id?"bg-blue-600 text-white shadow-md":"bg-white text-gray-600 border border-gray-200 hover:bg-gray-50"),whileHover:{scale:1.05},whileTap:{scale:.95},children:[a.name,r.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs "+(e===a.id?"bg-blue-500 text-white":"bg-gray-100 text-gray-600"),children:a.count})]},a.id))})}),h?r.jsx("div",{className:"space-y-4",children:[...Array(3)].map((e,t)=>r.jsx("div",{className:"bg-white rounded-lg p-6 border border-gray-200 animate-pulse",children:r.jsxs("div",{className:"flex items-start space-x-4",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-2"}),r.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-3"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-2"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})},t))}):0===s.length?r.jsxs("div",{className:"text-center py-16",children:[r.jsx(n,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"No AI Insights Available"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"No insights found for the selected category. The AI system may be processing new data."}),r.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh Insights"})]}):r.jsx("div",{className:"space-y-6",children:r.jsx(y,{mode:"wait",children:s.map(e=>{const t=(e=>{switch(e){case"opportunity":return g;case"alert":return u;case"insight":return m;case"prediction":case"forecast":return c;case"optimization":return d;default:return n}})(e.type);return r.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`bg-white rounded-lg shadow-sm border-l-4 p-6 hover:shadow-md transition-shadow ${w(e.impact)}`,children:r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[r.jsx("div",{className:`p-3 rounded-lg ${v(e.type)} bg-opacity-10`,children:r.jsx(t,{className:`w-6 h-6 ${v(e.type)}`})}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("critical"===e.impact?"bg-red-100 text-red-800":"high"===e.impact?"bg-orange-100 text-orange-800":"medium"===e.impact?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[e.impact," impact"]}),r.jsx("span",{className:"text-xs text-gray-500",children:e.timestamp})]}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.title}),r.jsx("p",{className:"text-gray-600 mb-4 leading-relaxed",children:e.description}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm",children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx(i,{className:"w-4 h-4 text-green-500 mr-1"}),r.jsxs("span",{className:"text-gray-600",children:["Confidence: ",e.confidence,"%"]})]}),e.estimatedSavings&&r.jsxs("div",{className:"flex items-center",children:[r.jsx(c,{className:"w-4 h-4 text-green-500 mr-1"}),r.jsxs("span",{className:"text-gray-600",children:["Est. Savings: £",e.estimatedSavings.toLocaleString()]})]}),r.jsxs("div",{className:"flex items-center",children:[r.jsx(o,{className:"w-4 h-4 text-blue-500 mr-1"}),r.jsxs("span",{className:"text-gray-600",children:["Timeline: ",e.timeline]})]})]}),e.actions&&e.actions.length>0&&r.jsxs("div",{className:"mt-4",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Recommended Actions:"}),r.jsx("ul",{className:"space-y-1",children:e.actions.map((e,t)=>r.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[r.jsx(l,{className:"w-3 h-3 mr-2 text-gray-400"}),e]},t))})]})]})]})})},e.id)})})})]})}},Symbol.toStringTag,{value:"Module"}));export{b as A,h as u};
