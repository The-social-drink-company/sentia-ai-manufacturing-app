import{r as e,j as t,a5 as a,aA as s}from"./react-core-DkFbty9o.js";import{d as r,g as i}from"./index-C8migC5L.js";import{p as n,a8 as o,K as l,a as c,R as d}from"./ui-components-J4-_vVnI.js";import"./vendor-CHbOot_X.js";import"./charts-DxLx1lqX.js";import"./vendor-utils-BvmCeSbq.js";import"./router-C0m1gglZ.js";import"./auth-M1VfQxmO.js";import"./forms-CtqjxpzJ.js";import"./animation-CTJwy-Vh.js";const m={};var h={};const x=()=>Promise.resolve({analysis:"Mock analysis",confidence:.5}),p=()=>Promise.resolve({insights:"Mock insights",trends:[]}),g=()=>Promise.resolve({analysis:"Mock manufacturing analysis"}),u=new class{constructor(){const e=void 0!==import.meta?m:{},t="undefined"!=typeof process&&h?h:{};this.mcpBaseUrl=e.VITE_MCP_SERVER_URL||t.VITE_MCP_SERVER_URL||"https://web-production-99691282.up.railway.app",this.cache=new Map,this.cacheTimeout=3e5}async generateDashboardInsights(e,t={}){try{const t=`insights_${JSON.stringify(e).substring(0,50)}`,a=this.getCached(t);if(a)return a;const[s,r,i]=await Promise.all([x(),p(),this.analyzeFinancialMetrics(e)]),n=this.mergeInsights({openAI:s,anthropic:r,xero:i}),o=this.categorizeInsights(n);return this.setCache(t,o),o}catch(a){return r.error("Failed to generate dashboard insights:",a),this.getFallbackInsights(e)}}async predictTrends(e,t={}){const{horizon:a=30,confidence:s=.95,includeSeasonality:i=!0,includeExternalFactors:n=!0}=t;try{const e=await x(),t=await g(await this.getBusinessContext());return{forecast:e.forecast,confidence:e.confidence,insights:t.insights,risks:t.risks,opportunities:t.opportunities,visualization:this.generateVisualizationConfig(e)}}catch(o){return r.error("Failed to predict trends:",o),null}}async detectAnomalies(e,t="medium"){try{const e=await x();if(e&&e.detected&&e.detected.length>0){const t=await p(e.detected);return{detected:e.detected,severity:this.calculateSeverity(e.detected),explanations:t.insights,recommendations:await this.generateAnomalyRecommendations(e.detected),alerts:this.generateAlerts(e.detected)}}return{detected:[],severity:"none"}}catch(a){return r.error("Failed to detect anomalies:",a),{detected:[],severity:"error"}}}async generateOptimizations(e,t={}){try{const a=await Promise.all([this.optimizeProduction(e),this.optimizeInventory(e),this.optimizeCosts(e),this.optimizeQuality(e)]),s=this.mergeOptimizations(a),r=this.prioritizeByImpact(s,t);return{recommendations:r,expectedImpact:this.calculateExpectedImpact(r),implementation:this.generateImplementationPlan(r),timeline:this.estimateTimeline(r)}}catch(a){return r.error("Failed to generate optimizations:",a),{recommendations:[]}}}async processNaturalQuery(e,t={}){try{const e=await p(),a=await this.fetchDataForIntent(e);return{answer:(await(JSON.stringify(a),JSON.stringify(t),Promise.resolve("Mock generated text"))).text,data:a,visualizations:this.suggestVisualizations(a),followUp:this.generateFollowUpQuestions(e,a)}}catch(a){return r.error("Failed to process natural query:",a),{answer:"I couldn't process that query. Please try rephrasing or be more specific.",error:!0}}}async generateExecutiveSummary(e){try{const e=await p();return{summary:e.summary,keyMetrics:e.metrics,criticalIssues:e.issues,recommendations:e.recommendations,nextSteps:e.nextSteps}}catch(t){return r.error("Failed to generate executive summary:",t),null}}async predictMaintenance(e,t){try{const e=await x(),t=await this.generateMaintenanceSchedule(e),a=await this.estimateMaintenanceCosts(e);return{predictions:e.predictions,riskScore:e.riskScore,schedule:t,costs:a,preventiveActions:e.preventiveActions}}catch(a){return r.error("Failed to predict maintenance:",a),null}}async analyzeQuality(e,t){try{const e=await g(),t=await x();return{currentQuality:e.score,trends:e.trends,defectProbability:t.probability,rootCauses:e.rootCauses,improvements:e.recommendations,costImpact:this.calculateQualityCosts(e)}}catch(a){return r.error("Failed to analyze quality:",a),null}}mergeInsights(e){const t=[];return e.openAI?.insights&&t.push(...e.openAI.insights),e.anthropic?.insights&&t.push(...e.anthropic.insights),e.xero&&t.push(...e.xero),this.deduplicateInsights(t)}categorizeInsights(e){return{critical:e.filter(e=>"critical"===e.priority||"high"===e.severity),opportunities:e.filter(e=>"opportunity"===e.type),risks:e.filter(e=>"risk"===e.type),performance:e.filter(e=>"performance"===e.category),recommendations:e.filter(e=>"recommendation"===e.type),general:e.filter(e=>!["critical","opportunity","risk","performance","recommendation"].includes(e.type))}}calculateSeverity(e){if(!e||0===e.length)return"none";const t=e.map(e=>e.severity||e.score||0),a=Math.max(...t);return a>.8?"critical":a>.6?"high":a>.4?"medium":"low"}async generateAnomalyRecommendations(e){const t=[];for(const a of e){const e=await this.generateSingleAnomalyRecommendation(a);e&&t.push(e)}return t}generateAlerts(e){return e.filter(e=>(e.severity||e.score||0)>.6).map(e=>({type:"anomaly",severity:this.calculateSeverity([e]),message:e.message||`Anomaly detected in ${e.metric||"system"}`,timestamp:(new Date).toISOString(),data:e}))}getCached(e){const t=this.cache.get(e);return t&&Date.now()-t.timestamp<this.cacheTimeout?t.data:null}setCache(e,t){this.cache.set(e,{data:t,timestamp:Date.now()})}async getBusinessContext(){return{date:(new Date).toISOString(),season:this.getCurrentSeason(),marketConditions:await this.getMarketConditions(),operationalStatus:await this.getOperationalStatus()}}getCurrentSeason(){const e=(new Date).getMonth();return e>=2&&e<=4?"spring":e>=5&&e<=7?"summer":e>=8&&e<=10?"autumn":"winter"}async getMarketConditions(){return{trend:"stable",demand:"moderate"}}async getOperationalStatus(){return{capacity:.75,efficiency:.85}}deduplicateInsights(e){const t=new Set;return e.filter(e=>{const a=JSON.stringify(e.message||e.text||e);return!t.has(a)&&(t.add(a),!0)})}generateVisualizationConfig(e){return{type:"line",showConfidenceInterval:!0,colors:["#3B82F6","#10B981","#F59E0B"],annotations:e.keyPoints||[]}}async analyzeFinancialMetrics(e){return[]}getFallbackInsights(e){return{critical:[],opportunities:[],risks:[],performance:[],recommendations:[{type:"info",message:"AI insights temporarily unavailable. Showing basic metrics.",priority:"low"}]}}async optimizeProduction(e){return{type:"production",recommendations:[]}}async optimizeInventory(e){return{type:"inventory",recommendations:[]}}async optimizeCosts(e){return{type:"costs",recommendations:[]}}async optimizeQuality(e){return{type:"quality",recommendations:[]}}mergeOptimizations(e){return e.flatMap(e=>e.recommendations||[])}prioritizeByImpact(e,t){return e.sort((e,t)=>(t.impact||0)-(e.impact||0))}calculateExpectedImpact(e){return e.reduce((e,t)=>e+(t.impact||0),0)}generateImplementationPlan(e){return e.map((e,t)=>({step:t+1,action:e.action,timeline:e.timeline||"1 week",resources:e.resources||[]}))}estimateTimeline(e){const t=e.reduce((e,t)=>e+(t.days||7),0);return`${Math.ceil(t/7)} weeks`}async fetchDataForIntent(e){return{}}suggestVisualizations(e){return["line","bar","pie"]}generateFollowUpQuestions(e,t){return["Would you like to see the trend over a different time period?","Should I compare this with industry benchmarks?","Would you like to export this data?"]}async generateSingleAnomalyRecommendation(e){return{action:`Investigate ${e.metric||"anomaly"}`,priority:this.calculateSeverity([e]),estimated_impact:"medium"}}async generateMaintenanceSchedule(e){return e.schedule||[]}async estimateMaintenanceCosts(e){return e.costs||{total:0,breakdown:[]}}calculateQualityCosts(e){return e.costImpact||{defects:0,rework:0,prevention:0}}},y=({data:r=[],metrics:m=[],timeRange:h=30,refreshInterval:x=6e4})=>{const[p,g]=e.useState({}),[y,b]=e.useState([]),[f,j]=e.useState([]),[v,N]=e.useState([]),[k,w]=e.useState(m[0]||"production"),[I,C]=e.useState(!1),[S,A]=e.useState(.95),[z,D]=e.useState("predictions");e.useEffect(()=>{F();const e=setInterval(F,x);return()=>clearInterval(e)},[r,k,h,S]);const F=async()=>{if(!I&&r.length){C(!0);try{const[e,t,a,s]=await Promise.all([u.predictTrends(r,{horizon:h,confidence:S,includeSeasonality:!0}),u.detectAnomalies(r,"high"),u.generateOptimizations({metrics:r,currentMetric:k}),u.generateDashboardInsights(r,{metric:k})]);g(e||{}),j(t?.detected||[]),N(a?.recommendations||[]),b([...s?.critical||[],...s?.opportunities||[]].slice(0,5))}catch(e){i("Predictive analysis failed",e,{component:"PredictiveAnalyticsDashboard"})}finally{C(!1)}}},M={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!1}}},P=[{id:"predictions",label:"Predictions",icon:l},{id:"anomalies",label:"Anomalies",icon:c},{id:"optimizations",label:"Optimizations",icon:d},{id:"insights",label:"AI Insights",icon:o}];return t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[t.jsx(n,{className:"h-7 w-7 mr-2 text-blue-600"}),"Predictive Analytics Dashboard"]}),I&&t.jsxs("div",{className:"flex items-center text-blue-600",children:[t.jsx(o,{className:"h-5 w-5 animate-pulse mr-2"}),t.jsx("span",{className:"text-sm",children:"Analyzing..."})]})]}),t.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[t.jsx("select",{value:k,onChange:e=>w(e.target.value),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:m.map(e=>t.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),t.jsxs("select",{value:h,onChange:e=>setTimeRange(Number(e.target.value)),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[t.jsx("option",{value:7,children:"7 Days"}),t.jsx("option",{value:14,children:"14 Days"}),t.jsx("option",{value:30,children:"30 Days"}),t.jsx("option",{value:90,children:"90 Days"})]}),t.jsxs("select",{value:S,onChange:e=>A(Number(e.target.value)),className:"px-4 py-2 border dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",children:[t.jsx("option",{value:.9,children:"90% Confidence"}),t.jsx("option",{value:.95,children:"95% Confidence"}),t.jsx("option",{value:.99,children:"99% Confidence"})]}),t.jsx("button",{onClick:F,disabled:I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Refresh Analysis"})]}),t.jsx("div",{className:"flex space-x-1 border-b dark:border-gray-700",children:P.map(e=>{const a=e.icon;return t.jsxs("button",{onClick:()=>D(e.id),className:"flex items-center px-4 py-2 font-medium text-sm transition-colors "+(z===e.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100"),children:[t.jsx(a,{className:"h-4 w-4 mr-2"}),e.label]},e.id)})})]}),t.jsxs("div",{className:"mt-6",children:["predictions"===z&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:[h,"-Day Forecast"]}),p.confidence&&t.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600 dark:text-gray-400",children:[t.jsxs("span",{children:["Confidence: ",(100*p.confidence).toFixed(1),"%"]}),t.jsxs("span",{children:["Model: ",p.model||"Time Series ARIMA"]})]})]}),t.jsx("div",{className:"h-80",children:t.jsx(a,{data:(()=>{const e=r.map(e=>e.date||e.timestamp),t=r.map(e=>e[k]||e.value),a=[],s=new Date;for(let r=1;r<=h;r++){const e=new Date(s);e.setDate(s.getDate()+r),a.push(e.toLocaleDateString())}const i=p.forecast||[],n=p.upperBound||i.map(e=>1.1*e),o=p.lowerBound||i.map(e=>.9*e);return{labels:[...e,...a],datasets:[{label:"Historical",data:[...t,...Array(a.length).fill(null)],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4},{label:"Forecast",data:[...Array(e.length-1).fill(null),t[t.length-1],...i],borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",borderDash:[5,5],tension:.4},{label:"Upper Bound",data:[...Array(e.length-1).fill(null),t[t.length-1],...n],borderColor:"rgba(16, 185, 129, 0.3)",backgroundColor:"rgba(16, 185, 129, 0.05)",borderDash:[2,2],fill:!1,tension:.4},{label:"Lower Bound",data:[...Array(e.length-1).fill(null),t[t.length-1],...o],borderColor:"rgba(16, 185, 129, 0.3)",backgroundColor:"rgba(16, 185, 129, 0.05)",borderDash:[2,2],fill:"-1",tension:.4}]}})(),options:M})}),p.insights&&p.insights.length>0&&t.jsxs("div",{className:"mt-6",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Prediction Insights"}),t.jsx("div",{className:"space-y-2",children:p.insights.map((e,a)=>t.jsxs("div",{className:"flex items-start p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[t.jsx(d,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mr-2 flex-shrink-0 mt-0.5"}),t.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:e})]},a))})]})]}),"anomalies"===z&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Anomaly Detection"}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[f.length," anomalies detected in the data"]})]}),f.length>0?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"h-80",children:t.jsx(s,{data:(()=>{const e=r.map((e,t)=>({x:t,y:e[k]||e.value})),t=f.map(e=>({x:e.index||0,y:e.value||0,r:10*(e.severity||.5)}));return{datasets:[{label:"Normal Data",data:e,backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgb(59, 130, 246)"},{label:"Anomalies",data:t,backgroundColor:"rgba(239, 68, 68, 0.8)",borderColor:"rgb(239, 68, 68)",pointRadius:t.map(e=>e.r)}]}})(),options:M})}),t.jsx("div",{className:"mt-6 space-y-3",children:f.slice(0,5).map((e,a)=>t.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-lg",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx(c,{className:"h-5 w-5 text-red-600 dark:text-red-400 mr-3 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:e.message||`Anomaly in ${k}`}),t.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:["Severity: ",(100*(e.severity||.5)).toFixed(0),"% | Time: ",e.timestamp||"Recent"]})]})]})},a))})]}):t.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[t.jsx(c,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"No anomalies detected in current data"})]})]}),"optimizations"===z&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"AI-Powered Optimization Recommendations"}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[v.length," optimization opportunities identified"]})]}),v.length>0?t.jsx("div",{className:"space-y-4",children:v.map((e,a)=>t.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:"h-10 w-10 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center",children:t.jsx("span",{className:"text-green-800 dark:text-green-200 font-semibold",children:a+1})})}),t.jsxs("div",{className:"ml-4 flex-1",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.title||e.action||"Optimization Opportunity"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description||e.recommendation}),t.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs",children:[e.impact&&t.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["Impact: ",e.impact,"%"]}),e.effort&&t.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["Effort: ",e.effort]}),e.timeline&&t.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Timeline: ",e.timeline]})]})]})]})},a))}):t.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[t.jsx(d,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"Analyzing for optimization opportunities..."})]})]}),"insights"===z&&t.jsxs("div",{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"AI-Generated Insights"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Real-time intelligence powered by OpenAI and Anthropic"})]}),y.length>0?t.jsx("div",{className:"grid gap-4",children:y.map((e,a)=>t.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-lg",children:t.jsxs("div",{className:"flex items-start",children:[t.jsx(o,{className:"h-5 w-5 text-purple-600 dark:text-purple-400 mr-3 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-800 dark:text-gray-200",children:e.message||e.text||e}),e.data&&t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Object.entries(e.data).slice(0,3).map(([e,a])=>t.jsxs("span",{className:"text-xs bg-white dark:bg-gray-800 px-2 py-1 rounded",children:[e,": ",a]},e))})]})]})},a))}):t.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[t.jsx(o,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),t.jsx("p",{children:"Generating insights from your data..."})]})]})]}),t.jsx("div",{className:"mt-6 pt-6 border-t dark:border-gray-700",children:t.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:p.forecast?p.forecast[p.forecast.length-1]?.toFixed(0):"-"}),t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Predicted Value"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.length}),t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Anomalies"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-2xl font-bold text-green-600",children:v.length}),t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Optimizations"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[(100*S).toFixed(0),"%"]}),t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Confidence"})]})]})})]})};export{y as default};
