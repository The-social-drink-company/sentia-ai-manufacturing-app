<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sentia Manufacturing Dashboard</title>
    <script type="module" crossorigin src="/js/index-CutrUd4C.js"></script>
    <link rel="modulepreload" crossorigin href="/js/chunk-2JyFY1uQ.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-BqLW636t.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-D_m0peg4.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-eaXxVZNm.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-D0O2t9oU.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-b9fRcCU5.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-C41_PK-U.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-Dozjk7Op.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-QTyaN28y.js">
    <link rel="stylesheet" crossorigin href="/assets/react-core-C9-ySRfk.css">
    <link rel="stylesheet" crossorigin href="/assets/index-LlA1FKMx.css">
  </head>
  <body>
    <div id="root"></div>
    <script>
      // Enterprise Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          // Only unregister in development to avoid stale caches
          if (window.location.hostname === 'localhost') {
            navigator.serviceWorker.getRegistrations().then(registrations => {
              registrations.forEach(reg => {
                reg.unregister().catch(() => {});
              });
            }).catch(() => {});
            return;
          }

          // Register service worker in production
          navigator.serviceWorker.register('/sw.js', {
            scope: '/',
            updateViaCache: 'none'
          })
          .then(registration => {
            console.log('[SW] Service worker registered successfully:', registration.scope);
            
            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New service worker installed, show update available message
                    if (window.dispatchEvent) {
                      window.dispatchEvent(new CustomEvent('sw-update-available'));
                    }
                  }
                });
              }
            });
          })
          .catch(error => {
            console.warn('[SW] Service worker registration failed:', error);
          });

          // Listen for service worker messages
          navigator.serviceWorker.addEventListener('message', event => {
            if (event.data && event.data.type === 'SKIP_WAITING') {
              window.location.reload();
            }
          });
        });

        // Handle service worker updates
        window.addEventListener('sw-update-available', () => {
          const updateBanner = document.createElement('div');
          updateBanner.innerHTML = `
            <div style="
              position: fixed; 
              top: 0; 
              left: 0; 
              right: 0; 
              background: #2563eb; 
              color: white; 
              padding: 12px 16px; 
              text-align: center; 
              z-index: 9999;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            ">
              <span style="margin-right: 16px;">A new version of Sentia Manufacturing Dashboard is available!</span>
              <button onclick="window.location.reload()" style="
                background: white; 
                color: #2563eb; 
                border: none; 
                padding: 6px 12px; 
                border-radius: 4px; 
                font-weight: 500; 
                cursor: pointer;
                margin-right: 8px;
              ">Update Now</button>
              <button onclick="this.parentElement.parentElement.remove()" style="
                background: transparent; 
                color: white; 
                border: 1px solid white; 
                padding: 6px 12px; 
                border-radius: 4px; 
                font-weight: 500; 
                cursor: pointer;
              ">Later</button>
            </div>
          `;
          document.body.appendChild(updateBanner);
        });
      }
    </script>
  </body>
</html>