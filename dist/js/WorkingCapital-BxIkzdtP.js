const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/chunk-dQ8ZuPJ5.js","js/chunk-CVC8ZTrn.js","js/chunk-CZm8CRZW.js","js/chunk-BYhzkSrP.js","js/chunk-BmDXyJMe.js","js/chunk-CULnPDSP.js","js/chunk-BqFGoBxF.js","js/chunk-Dozjk7Op.js","assets/react-core-C9-ySRfk.css"])))=>i.map(i=>d[i]);
import{a as e,j as s,_ as a,aC as t,q as i,ac as n,t as c,F as r,ai as l,$ as d}from"./chunk-dQ8ZuPJ5.js";import{at as o}from"./chunk-CZm8CRZW.js";import{b as h,e as m}from"./index-B85l1krK.js";import{C as x}from"./chunk-Bcr4iqHm.js";import{E as j}from"./chunk-DSiUAwty.js";import"./chunk-CVC8ZTrn.js";import"./chunk-CULnPDSP.js";import"./chunk-BYhzkSrP.js";import"./chunk-BqFGoBxF.js";import"./chunk-Dozjk7Op.js";import"./chunk-BmDXyJMe.js";import"./chunk-E_h9yjlz.js";function u(){const[t,i]=e.useState(null),[n,c]=e.useState(!1),[r,l]=e.useState(null),[d,m]=e.useState(12),[j]=e.useState(()=>new x),u=async()=>{try{c(!0),l(null);try{const e={Authorization:`Bearer ${await(async()=>{const{getToken:e}=await a(async()=>{const{getToken:e}=await import("./chunk-dQ8ZuPJ5.js").then(e=>e.cp);return{getToken:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]));return e()})()}`},s=await o.get(`/api/working-capital/kpis/trends?months=${d}`,{headers:e});return void i(s.data.data)}catch(e){}const s=j.calculateCashConversionCycle({annualRevenue:4e7,annualCOGS:26e6}),t=[],n=new Date;for(let e=d-1;e>=0;e--){const a=new Date(n);a.setMonth(a.getMonth()-e);const i=.05;t.push({createdAt:a.toISOString(),ccc:Math.round(10*(s.cashConversionCycle+s.cashConversionCycle*i))/10,dso:Math.round(10*(s.components.dso+s.components.dso*i))/10,dpo:Math.round(10*(s.components.dpo+s.components.dpo*i))/10,dio:Math.round(10*(s.components.dio+s.components.dio*i))/10,inv_turnover:Math.round(10*(365/s.components.dio+365/s.components.dio*i))/10,wc_turnover:Math.round(10*(4e7/(s.balanceSheetItems.receivables+s.balanceSheetItems.inventory-s.balanceSheetItems.payables)+i))/10,facility_utilization:Math.max(.1,Math.min(.9,.8))})}i({trends:t,summary:{currentCCC:s.cashConversionCycle,targetCCC:s.benchmarks.targetCCC,performance:s.performance,recommendations:s.recommendations}})}catch(s){h("KPI fetch error",s,{component:"KPIDashboard",timeframe:d}),l(s.message)}finally{c(!1)}};e.useEffect(()=>{u()},[d]);const v=(e,s)=>{const a={ccc:{excellent:45,good:55,threshold:65},dso:{excellent:30,good:35,threshold:45},dpo:{excellent:30,good:25,threshold:20},dio:{excellent:40,good:45,threshold:55},inv_turnover:{excellent:8,good:6,threshold:4},wc_turnover:{excellent:6.5,good:5,threshold:3.5},facility_utilization:{excellent:.3,good:.6,threshold:.8}}[e];return a&&null!=s?["ccc","dso","dio","facility_utilization"].includes(e)?s<=a.excellent?"excellent":s<=a.good?"good":s<=a.threshold?"warning":"critical":["dpo","inv_turnover","wc_turnover"].includes(e)?s>=a.excellent?"excellent":s>=a.good?"good":s>=a.threshold?"warning":"critical":"unknown":"unknown"},N=(e,s)=>null==s?"N/A":"facility_utilization"===e?`${Math.round(100*s)}%`:["inv_turnover","wc_turnover"].includes(e)?`${s.toFixed(1)}x`:`${Math.round(s)} days`,p=t?.trends&&0!==t.trends.length?t.trends[t.trends.length-1]:null;return s.jsxs("div",{className:"sentia-kpi-container",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"KPI Analysis"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-form-grid",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Time Period"}),s.jsxs("select",{className:"sentia-select",value:d,onChange:e=>m(parseInt(e.target.value)),children:[s.jsx("option",{value:3,children:"Last 3 Months"}),s.jsx("option",{value:6,children:"Last 6 Months"}),s.jsx("option",{value:12,children:"Last 12 Months"}),s.jsx("option",{value:24,children:"Last 24 Months"})]})]}),s.jsx("div",{className:"sentia-form-group",children:s.jsx("button",{className:"sentia-btn sentia-btn-primary",onClick:u,disabled:n,children:n?"Loading...":"Refresh KPIs"})})]})})]}),r&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"KPI Loading Error"}),s.jsx("p",{children:r}),s.jsx("button",{onClick:u,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),n&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-loading",children:[s.jsx("div",{className:"sentia-spinner"}),s.jsx("p",{children:"Loading KPI trends..."})]})})}),p&&!n&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"sentia-grid sentia-grid-4",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Cash Conversion Cycle"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${v("ccc",p.ccc)}`,children:v("ccc",p.ccc)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:N("ccc",p.ccc)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: <55 days"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Days Sales Outstanding"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${v("dso",p.dso)}`,children:v("dso",p.dso)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:N("dso",p.dso)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: <35 days"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Days Payable Outstanding"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${v("dpo",p.dpo)}`,children:v("dpo",p.dpo)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:N("dpo",p.dpo)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: >25 days"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Days Inventory Outstanding"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${v("dio",p.dio)}`,children:v("dio",p.dio)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:N("dio",p.dio)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: <45 days"})]})})]})]}),s.jsxs("div",{className:"sentia-grid sentia-grid-3",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Inventory Turnover"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${v("inv_turnover",p.inv_turnover)}`,children:v("inv_turnover",p.inv_turnover)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:N("inv_turnover",p.inv_turnover)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: >8x annually"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"WC Turnover"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${v("wc_turnover",p.wc_turnover)}`,children:v("wc_turnover",p.wc_turnover)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:N("wc_turnover",p.wc_turnover)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: >6.5x annually"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h4",{className:"sentia-card-title",children:"Credit Utilization"}),s.jsx("div",{className:`sentia-kpi-status sentia-status-${v("facility_utilization",p.facility_utilization)}`,children:v("facility_utilization",p.facility_utilization)})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsx("span",{className:"sentia-metric-value",children:N("facility_utilization",p.facility_utilization)}),s.jsx("span",{className:"sentia-metric-label",children:"Target: <60%"})]})})]})]}),t.trends.length>1&&s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"KPI Trends"}),s.jsxs("div",{className:"sentia-card-badge",children:[t.trends.length," data points"]})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Date"}),s.jsx("th",{children:"CCC"}),s.jsx("th",{children:"DSO"}),s.jsx("th",{children:"DPO"}),s.jsx("th",{children:"DIO"}),s.jsx("th",{children:"Inv Turnover"}),s.jsx("th",{children:"WC Turnover"}),s.jsx("th",{children:"Credit Util"})]})}),s.jsx("tbody",{children:t.trends.slice(-10).reverse().map((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{children:new Date(e.createdAt).toLocaleDateString("en-GB")}),s.jsx("td",{className:`sentia-kpi-cell sentia-${v("ccc",e.ccc)}`,children:N("ccc",e.ccc)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${v("dso",e.dso)}`,children:N("dso",e.dso)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${v("dpo",e.dpo)}`,children:N("dpo",e.dpo)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${v("dio",e.dio)}`,children:N("dio",e.dio)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${v("inv_turnover",e.inv_turnover)}`,children:N("inv_turnover",e.inv_turnover)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${v("wc_turnover",e.wc_turnover)}`,children:N("wc_turnover",e.wc_turnover)}),s.jsx("td",{className:`sentia-kpi-cell sentia-${v("facility_utilization",e.facility_utilization)}`,children:N("facility_utilization",e.facility_utilization)})]},a))})]})})})]})]}),!t&&!n&&!r&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No KPI data available"}),s.jsx("small",{children:"Historical KPI data will appear here once working capital projections are generated"})]})})})]})}function v(){const[a]=e.useState(()=>new j),[t,i]=e.useState(null),[n,c]=e.useState(!1),[r,l]=e.useState(null),[d,o]=e.useState({horizonMonths:12,currency:"GBP",scenarios:["baseline"]}),m=async()=>{try{c(!0),l(null);const e=await a.calculateWorkingCapitalRequirements({period:d.horizonMonths,currency:d.currency,includeForecasts:!0}),s=e.forecasts?.map(e=>({id:e.date,month:e.date.substring(0,7),openingCash:e.workingCapital-e.cashFlow,cash_in:Math.max(0,e.cashFlow),cash_out:Math.max(0,-e.cashFlow),net_change:e.cashFlow,ending_cash:e.workingCapital,workingCapital:e.workingCapital,accountsReceivable:e.accountsReceivable,inventory:e.inventory,accountsPayable:e.accountsPayable,revenue:e.revenue}))||[],t={scenarios:{baseline:{projections:s,summary:{totalCashIn:s.reduce((e,s)=>e+Math.max(0,s.cash_in),0),totalCashOut:s.reduce((e,s)=>e+Math.max(0,-s.cash_out),0),netCashFlow:s.reduce((e,s)=>e+s.net_change,0),minCash:Math.min(...s.map(e=>e.ending_cash)),breachMonths:s.filter(e=>e.ending_cash<5e5).length,avgWorkingCapital:s.reduce((e,s)=>e+s.workingCapital,0)/s.length}}},workingCapitalContext:{currentRatio:e.ratios?.current||0,quickRatio:e.ratios?.quick||0,cashConversionCycle:e.cashConversionCycle?.total||0,performanceScore:e.performanceScore||0,riskLevel:e.riskAssessment?.overall||"unknown"}};i(t)}catch(e){h("Projection error",e,{component:"CashFlowProjections"}),l(e.message)}finally{c(!1)}};e.useEffect(()=>{m()},[]);const x=(e,s)=>{o(a=>({...a,[e]:s}))};return s.jsxs("div",{className:"sentia-projections-container",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Projection Parameters"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-form-grid",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Horizon (Months)"}),s.jsxs("select",{className:"sentia-select",value:d.horizonMonths,onChange:e=>x("horizonMonths",parseInt(e.target.value)),children:[s.jsx("option",{value:3,children:"3 Months"}),s.jsx("option",{value:6,children:"6 Months"}),s.jsx("option",{value:12,children:"12 Months"}),s.jsx("option",{value:24,children:"24 Months"})]})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Currency"}),s.jsxs("select",{className:"sentia-select",value:d.currency,onChange:e=>x("currency",e.target.value),children:[s.jsx("option",{value:"GBP",children:"GBP (£)"}),s.jsx("option",{value:"EUR",children:"EUR (€)"}),s.jsx("option",{value:"USD",children:"USD ($)"})]})]}),s.jsx("div",{className:"sentia-form-group",children:s.jsx("button",{className:"sentia-btn sentia-btn-primary",onClick:m,disabled:n,children:n?"Generating...":"Generate Projection"})})]})})]}),r&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"Projection Error"}),s.jsx("p",{children:r}),s.jsx("button",{onClick:m,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),n&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-loading",children:[s.jsx("div",{className:"sentia-spinner"}),s.jsx("p",{children:"Generating cash flow projections..."})]})})}),t&&!n&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"sentia-grid sentia-grid-3",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h4",{className:"sentia-card-title",children:"Total Cash In"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsxs("span",{className:"sentia-metric-value",children:["£",t.scenarios.baseline.summary.totalCashIn.toLocaleString()]}),s.jsxs("span",{className:"sentia-metric-label",children:["Over ",d.horizonMonths," months"]})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h4",{className:"sentia-card-title",children:"Total Cash Out"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsxs("span",{className:"sentia-metric-value",children:["£",t.scenarios.baseline.summary.totalCashOut.toLocaleString()]}),s.jsxs("span",{className:"sentia-metric-label",children:["Over ",d.horizonMonths," months"]})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h4",{className:"sentia-card-title",children:"Net Cash Flow"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-metric",children:[s.jsxs("span",{className:"sentia-metric-value "+(t.scenarios.baseline.summary.netCashFlow>=0?"sentia-positive":"sentia-negative"),children:["£",t.scenarios.baseline.summary.netCashFlow.toLocaleString()]}),s.jsxs("span",{className:"sentia-metric-label",children:["Net over ",d.horizonMonths," months"]})]})})]})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Monthly Cash Flow Projections"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Month"}),s.jsx("th",{children:"Opening Cash"}),s.jsx("th",{children:"Cash In"}),s.jsx("th",{children:"Cash Out"}),s.jsx("th",{children:"Net Change"}),s.jsx("th",{children:"Ending Cash"}),s.jsx("th",{children:"Status"})]})}),s.jsx("tbody",{children:t.scenarios.baseline.projections.map((e,a)=>{const t=new Date(e.month).toLocaleDateString("en-GB",{month:"short",year:"numeric"}),i=e.ending_cash<5e4;return s.jsxs("tr",{children:[s.jsx("td",{children:t}),s.jsxs("td",{children:["£",e.openingCash?e.openingCash.toLocaleString():"0"]}),s.jsxs("td",{className:"sentia-positive",children:["£",e.cash_in.toLocaleString()]}),s.jsxs("td",{className:"sentia-negative",children:["£",e.cash_out.toLocaleString()]}),s.jsxs("td",{className:e.net_change>=0?"sentia-positive":"sentia-negative",children:["£",e.net_change.toLocaleString()]}),s.jsxs("td",{className:i?"sentia-negative":"sentia-positive",children:["£",e.ending_cash.toLocaleString()]}),s.jsxs("td",{children:[i&&s.jsx("span",{className:"sentia-status sentia-status-error",children:"Low Cash"}),!i&&e.net_change>=0&&s.jsx("span",{className:"sentia-status sentia-status-success",children:"Healthy"}),!i&&e.net_change<0&&s.jsx("span",{className:"sentia-status sentia-status-warning",children:"Declining"})]})]},e.id)})})]})})})]}),t.scenarios.baseline.summary.breachMonths>0&&s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Risk Analysis"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-alert sentia-alert-warning",children:s.jsxs("div",{className:"sentia-alert-content",children:[s.jsxs("div",{className:"sentia-alert-message",children:["WARNING: Cash falls below minimum buffer in ",t.scenarios.baseline.summary.breachMonths," months"]}),s.jsxs("div",{className:"sentia-alert-details",children:["Minimum cash level: £",t.scenarios.baseline.summary.minCash.toLocaleString()]})]})})})]})]}),!t&&!n&&!r&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No projection data available"}),s.jsx("small",{children:'Click "Generate Projection" to create cash flow projections'})]})})})]})}function N(){const[a,t]=e.useState(null),[i,n]=e.useState(!1),[c,r]=e.useState(null),[l,d]=e.useState({horizonMonths:12,currency:"GBP"}),[m,x]=e.useState([{name:"Optimistic",description:"Growth acceleration scenario",parameters:{demandAdjustment:.15,priceAdjustment:.05,arTermsAdjustment:-.1}},{name:"Pessimistic",description:"Economic downturn scenario",parameters:{demandAdjustment:-.2,cogsAdjustment:.1,arTermsAdjustment:.15}}]),j=async()=>{try{n(!0),r(null);const e={Authorization:`Bearer ${await(async()=>null)()}`},s=await o.post("/api/working-capital/scenarios",{baselineParams:{...l,startMonth:new Date},overrides:m},{headers:e});t(s.data.data)}catch(e){h("Scenario analysis error",e,{component:"ScenarioAnalysis"}),r(e.response?.data?.error||e.message)}finally{n(!1)}},u=(e,s,a)=>{const t=[...m];if(s.includes(".")){const[i,n]=s.split(".");t[e][i][n]=parseFloat(a)||0}else t[e][s]=a;x(t)};return s.jsxs("div",{className:"sentia-scenario-container",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Scenario Configuration"})}),s.jsxs("div",{className:"sentia-card-content",children:[s.jsxs("div",{className:"sentia-form-section",children:[s.jsx("h4",{children:"Baseline Parameters"}),s.jsxs("div",{className:"sentia-form-grid",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Horizon (Months)"}),s.jsxs("select",{className:"sentia-select",value:l.horizonMonths,onChange:e=>d({...l,horizonMonths:parseInt(e.target.value)}),children:[s.jsx("option",{value:6,children:"6 Months"}),s.jsx("option",{value:12,children:"12 Months"}),s.jsx("option",{value:24,children:"24 Months"})]})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Currency"}),s.jsxs("select",{className:"sentia-select",value:l.currency,onChange:e=>d({...l,currency:e.target.value}),children:[s.jsx("option",{value:"GBP",children:"GBP (£)"}),s.jsx("option",{value:"EUR",children:"EUR (€)"}),s.jsx("option",{value:"USD",children:"USD ($)"})]})]})]})]}),s.jsxs("div",{className:"sentia-form-section",children:[s.jsxs("div",{className:"sentia-section-header",children:[s.jsx("h4",{children:"Scenarios"}),s.jsx("button",{className:"sentia-btn sentia-btn-ghost",onClick:()=>{x([...m,{name:`Custom ${m.length+1}`,description:"Custom scenario",parameters:{demandAdjustment:0,priceAdjustment:0,cogsAdjustment:0,arTermsAdjustment:0}}])},children:"Add Custom Scenario"})]}),m.map((e,a)=>s.jsxs("div",{className:"sentia-scenario-form",children:[s.jsxs("div",{className:"sentia-scenario-header",children:[s.jsx("input",{type:"text",className:"sentia-input",value:e.name,onChange:e=>u(a,"name",e.target.value),placeholder:"Scenario name"}),s.jsx("button",{className:"sentia-btn sentia-btn-ghost sentia-btn-sm",onClick:()=>(e=>{x(m.filter((s,a)=>a!==e))})(a),children:"Remove"})]}),s.jsx("input",{type:"text",className:"sentia-input",value:e.description,onChange:e=>u(a,"description",e.target.value),placeholder:"Scenario description"}),s.jsxs("div",{className:"sentia-scenario-params",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Demand Change (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*e.parameters.demandAdjustment).toFixed(1),onChange:e=>u(a,"parameters.demandAdjustment",e.target.value/100),step:"0.1",placeholder:"0.0"})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Price Change (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*e.parameters.priceAdjustment).toFixed(1),onChange:e=>u(a,"parameters.priceAdjustment",e.target.value/100),step:"0.1",placeholder:"0.0"})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"COGS Change (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*(e.parameters.cogsAdjustment||0)).toFixed(1),onChange:e=>u(a,"parameters.cogsAdjustment",e.target.value/100),step:"0.1",placeholder:"0.0"})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Collection Terms (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*(e.parameters.arTermsAdjustment||0)).toFixed(1),onChange:e=>u(a,"parameters.arTermsAdjustment",e.target.value/100),step:"0.1",placeholder:"0.0"})]})]})]},a))]}),s.jsx("div",{className:"sentia-form-actions",children:s.jsx("button",{className:"sentia-btn sentia-btn-primary",onClick:j,disabled:i||0===m.length,children:i?"Analyzing...":"Run Scenario Analysis"})})]})]}),c&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"Scenario Analysis Error"}),s.jsx("p",{children:c}),s.jsx("button",{onClick:j,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),i&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-loading",children:[s.jsx("div",{className:"sentia-spinner"}),s.jsx("p",{children:"Running scenario analysis..."})]})})}),a&&!i&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Scenario Comparison"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Scenario"}),s.jsx("th",{children:"Net Cash Flow"}),s.jsx("th",{children:"Variance"}),s.jsx("th",{children:"Min Cash"}),s.jsx("th",{children:"Risk Score"}),s.jsx("th",{children:"CCC"}),s.jsx("th",{children:"CCC Change"})]})}),s.jsxs("tbody",{children:[s.jsxs("tr",{className:"sentia-baseline-row",children:[s.jsx("td",{children:s.jsx("strong",{children:"Baseline"})}),s.jsxs("td",{children:["£",a.baseline?.scenarios?.baseline?.summary?.netCashFlow?.toLocaleString()||"N/A"]}),s.jsx("td",{children:"-"}),s.jsxs("td",{children:["£",a.baseline?.scenarios?.baseline?.summary?.minCash?.toLocaleString()||"N/A"]}),s.jsx("td",{children:a.baseline?.summary?.riskScore||"N/A"}),s.jsxs("td",{children:[a.baseline?.summary?.ccc?.toFixed(1)||"N/A"," days"]}),s.jsx("td",{children:"-"})]}),a.scenarios?.map((e,t)=>{const i=a.baseline?.scenarios?.baseline?.summary?.netCashFlow||0,n=e.results?.scenarios?.baseline?.summary?.netCashFlow||0,c=(l=n,(r=i)&&l?((l-r)/r*100).toFixed(1)+"%":"N/A");var r,l;const d=a.baseline?.summary?.ccc&&e.results?.summary?.ccc?(e.results.summary.ccc-a.baseline.summary.ccc).toFixed(1):"N/A";return s.jsxs("tr",{children:[s.jsxs("td",{children:[s.jsx("strong",{children:e.name}),s.jsx("br",{}),s.jsx("small",{children:e.description})]}),s.jsxs("td",{className:n>=i?"sentia-positive":"sentia-negative",children:["£",n.toLocaleString()]}),s.jsx("td",{className:c.startsWith("+")?"sentia-positive":"sentia-negative",children:c}),s.jsxs("td",{children:["£",e.results?.scenarios?.baseline?.summary?.minCash?.toLocaleString()||"N/A"]}),s.jsx("td",{children:e.results?.summary?.riskScore||"N/A"}),s.jsxs("td",{children:[e.results?.summary?.ccc?.toFixed(1)||"N/A"," days"]}),s.jsx("td",{className:parseFloat(d)<=0?"sentia-positive":"sentia-negative",children:"N/A"!==d?(parseFloat(d)>=0?"+"+d:d)+" days":"N/A"})]},t)})]})]})})})]}),a.comparison?.recommendations&&a.comparison.recommendations.length>0&&s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Scenario Recommendations"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-recommendations",children:a.comparison.recommendations.map((e,a)=>s.jsx("div",{className:`sentia-alert sentia-alert-${e.type}`,children:s.jsxs("div",{className:"sentia-alert-content",children:[s.jsxs("div",{className:"sentia-alert-header",children:[s.jsx("strong",{children:e.scenario})," - ",e.metric]}),s.jsx("div",{className:"sentia-alert-message",children:e.description}),s.jsxs("div",{className:"sentia-alert-impact",children:["Impact: £",e.impact?.toLocaleString()||"N/A"]})]})},a))})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsx("div",{className:"sentia-card-header",children:s.jsx("h3",{className:"sentia-card-title",children:"Risk Analysis Summary"})}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-grid sentia-grid-3",children:[s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Best Case"}),s.jsx("div",{className:"sentia-metric-value sentia-positive",children:a.scenarios&&a.scenarios.length>0?Math.max(...a.scenarios.map(e=>e.results?.scenarios?.baseline?.summary?.netCashFlow||0)).toLocaleString():"N/A"})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Worst Case"}),s.jsx("div",{className:"sentia-metric-value sentia-negative",children:a.scenarios&&a.scenarios.length>0?Math.min(...a.scenarios.map(e=>e.results?.scenarios?.baseline?.summary?.netCashFlow||0)).toLocaleString():"N/A"})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Risk Range"}),s.jsx("div",{className:"sentia-metric-value",children:a.scenarios&&a.scenarios.length>0?(Math.max(...a.scenarios.map(e=>e.results?.scenarios?.baseline?.summary?.netCashFlow||0))-Math.min(...a.scenarios.map(e=>e.results?.scenarios?.baseline?.summary?.netCashFlow||0))).toLocaleString():"N/A"})]})]})})]})]}),!a&&!i&&!c&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No scenario analysis results"}),s.jsx("small",{children:'Configure scenarios above and click "Run Scenario Analysis" to compare different business scenarios'})]})})})]})}function p({hasManagementAccess:a=!1}){const t=async()=>null,[i,n]=e.useState([]),[c,r]=e.useState([]),[l,d]=e.useState(!1),[x,j]=e.useState(null),[u,v]=e.useState("ar"),[N,p]=e.useState(null);e.useEffect(()=>{y()},[]);const y=async()=>{try{d(!0),j(null);const e={Authorization:`Bearer ${await t()}`},[s,a]=await Promise.all([o.get("/api/working-capital/policies/ar",{headers:e}),o.get("/api/working-capital/policies/ap",{headers:e})]);n(s.data.data||[]),r(a.data.data||[])}catch(e){h("Policy fetch error",e,{component:"PolicyManagement"}),j(e.response?.data?.error||e.message)}finally{d(!1)}},b=e=>{try{return JSON.parse(e).map(e=>`${e.days} days (${(100*e.pct).toFixed(0)}%)`).join(", ")}catch{return"Invalid terms format"}},C=e=>(100*e).toFixed(2)+"%";return s.jsxs("div",{className:"sentia-policy-container",children:[s.jsx("div",{className:"sentia-tabs",children:s.jsxs("div",{className:"sentia-tab-list",children:[s.jsxs("button",{className:"sentia-tab "+("ar"===u?"sentia-tab-active":""),onClick:()=>v("ar"),children:[s.jsx("span",{className:"sentia-tab-icon",children:"📥"}),s.jsx("span",{className:"sentia-tab-label",children:"AR Policies"})]}),s.jsxs("button",{className:"sentia-tab "+("ap"===u?"sentia-tab-active":""),onClick:()=>v("ap"),children:[s.jsx("span",{className:"sentia-tab-icon",children:"📤"}),s.jsx("span",{className:"sentia-tab-label",children:"AP Policies"})]})]})}),x&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"Policy Management Error"}),s.jsx("p",{children:x}),s.jsx("button",{onClick:y,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),l&&!N&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-loading",children:[s.jsx("div",{className:"sentia-spinner"}),s.jsx("p",{children:"Loading policies..."})]})})}),"ar"===u&&!l&&s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Accounts Receivable Policies"}),s.jsx("div",{className:"sentia-card-badge",children:i.length})]}),s.jsx("div",{className:"sentia-card-content",children:i.length>0?s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Sales Channel"}),s.jsx("th",{children:"Channel Type"}),s.jsx("th",{children:"Market"}),s.jsx("th",{children:"Payment Terms"}),s.jsx("th",{children:"Bad Debt %"}),s.jsx("th",{children:"Fees %"}),s.jsx("th",{children:"Active From"}),a&&s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:i.map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:e.sales_channel?.name||"N/A"}),s.jsx("td",{children:s.jsx("span",{className:"sentia-badge",children:e.sales_channel?.channelType||"Unknown"})}),s.jsx("td",{children:e.sales_channel?.marketCode||"N/A"}),s.jsx("td",{children:b(e.terms)}),s.jsx("td",{children:C(e.bad_debt_pct)}),s.jsx("td",{children:C(e.fees_pct)}),s.jsx("td",{children:new Date(e.active_from).toLocaleDateString("en-GB")}),a&&s.jsx("td",{children:s.jsx("button",{className:"sentia-btn sentia-btn-ghost sentia-btn-sm",onClick:()=>p({...e,type:"ar"}),children:"Edit"})})]},e.id||t))})]})}):s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No AR policies configured"}),s.jsx("small",{children:"AR policies define payment terms and collection parameters for sales channels"})]})})]}),"ap"===u&&!l&&s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Accounts Payable Policies"}),s.jsx("div",{className:"sentia-card-badge",children:c.length})]}),s.jsx("div",{className:"sentia-card-content",children:c.length>0?s.jsx("div",{className:"sentia-table-container",children:s.jsxs("table",{className:"sentia-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Supplier ID"}),s.jsx("th",{children:"Term Days"}),s.jsx("th",{children:"Early Pay Discount"}),s.jsx("th",{children:"Early Pay Days"}),s.jsx("th",{children:"Strategy"}),s.jsx("th",{children:"Active From"}),a&&s.jsx("th",{children:"Actions"})]})}),s.jsx("tbody",{children:c.map((e,t)=>s.jsxs("tr",{children:[s.jsx("td",{children:e.supplier_id||"N/A"}),s.jsxs("td",{children:[e.term_days," days"]}),s.jsx("td",{children:C(e.early_pay_discount_pct||0)}),s.jsxs("td",{children:[e.early_pay_days||"N/A"," days"]}),s.jsx("td",{children:s.jsx("span",{className:"sentia-badge",children:e.strategy||"Standard"})}),s.jsx("td",{children:new Date(e.active_from).toLocaleDateString("en-GB")}),a&&s.jsx("td",{children:s.jsx("button",{className:"sentia-btn sentia-btn-ghost sentia-btn-sm",onClick:()=>p({...e,type:"ap"}),children:"Edit"})})]},e.id||t))})]})}):s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No AP policies configured"}),s.jsx("small",{children:"AP policies define payment terms and discount strategies for suppliers"})]})})]}),N&&a&&s.jsx(g,{policy:N,onSave:"ar"===N.type?async e=>{try{d(!0);const s={Authorization:`Bearer ${await t()}`};await o.post("/api/working-capital/policies/ar",e,{headers:s});await y(),p(null),m("AR Policy updated successfully",{component:"PolicyManagement",policy:e})}catch(s){h("AR Policy update error",s,{component:"PolicyManagement",policy:e}),j(s.response?.data?.error||s.message)}finally{d(!1)}}:null,onCancel:()=>p(null),loading:l}),!a&&s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsx("div",{className:"sentia-alert sentia-alert-info",children:s.jsx("div",{className:"sentia-alert-content",children:s.jsx("div",{className:"sentia-alert-message",children:"You have read-only access to policy information. Contact your financial manager to modify policies."})})})})}),s.jsx("div",{className:"sentia-dashboard-actions",children:s.jsxs("button",{onClick:y,className:"sentia-btn sentia-btn-ghost",disabled:l,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Refresh Policies"]})})]})}function g({policy:a,onSave:t,onCancel:i,loading:n}){const[c,r]=e.useState({channel_id:a.channel_id||"",terms:a.terms?JSON.parse(a.terms):[{days:30,pct:1}],bad_debt_pct:a.bad_debt_pct||.025,fees_pct:a.fees_pct||.029,description:a.description||""}),l=e=>{e.preventDefault(),t&&t(c)},d=(e,s,a)=>{const t=[...c.terms];t[e][s]="days"===s?parseInt(a):parseFloat(a),r({...c,terms:t})};return s.jsx("div",{className:"sentia-modal-overlay",children:s.jsxs("div",{className:"sentia-modal",children:[s.jsxs("div",{className:"sentia-modal-header",children:[s.jsx("h3",{children:"Edit AR Policy"}),s.jsx("button",{className:"sentia-modal-close",onClick:i,children:"×"})]}),s.jsxs("form",{onSubmit:l,className:"sentia-modal-content",children:[s.jsxs("div",{className:"sentia-form-section",children:[s.jsx("h4",{children:"Payment Terms"}),c.terms.map((e,a)=>s.jsxs("div",{className:"sentia-term-row",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Days"}),s.jsx("input",{type:"number",className:"sentia-input",value:e.days,onChange:e=>d(a,"days",e.target.value),min:"0",required:!0})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Percentage"}),s.jsx("input",{type:"number",className:"sentia-input",value:e.pct,onChange:e=>d(a,"pct",e.target.value),min:"0",max:"1",step:"0.01",required:!0})]}),c.terms.length>1&&s.jsx("button",{type:"button",className:"sentia-btn sentia-btn-ghost sentia-btn-sm",onClick:()=>(e=>{if(c.terms.length>1){const s=c.terms.filter((s,a)=>a!==e);r({...c,terms:s})}})(a),children:"Remove"})]},a)),s.jsx("button",{type:"button",className:"sentia-btn sentia-btn-ghost",onClick:()=>{r({...c,terms:[...c.terms,{days:30,pct:0}]})},children:"Add Term"})]}),s.jsxs("div",{className:"sentia-form-grid",children:[s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Bad Debt Rate (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*c.bad_debt_pct).toFixed(2),onChange:e=>r({...c,bad_debt_pct:parseFloat(e.target.value)/100}),min:"0",max:"100",step:"0.01",required:!0})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Fees Rate (%)"}),s.jsx("input",{type:"number",className:"sentia-input",value:(100*c.fees_pct).toFixed(2),onChange:e=>r({...c,fees_pct:parseFloat(e.target.value)/100}),min:"0",max:"100",step:"0.01",required:!0})]})]}),s.jsxs("div",{className:"sentia-form-group",children:[s.jsx("label",{className:"sentia-label",children:"Description"}),s.jsx("textarea",{className:"sentia-input",value:c.description,onChange:e=>r({...c,description:e.target.value}),rows:"3",placeholder:"Policy description or notes"})]})]}),s.jsxs("div",{className:"sentia-modal-actions",children:[s.jsx("button",{type:"button",className:"sentia-btn sentia-btn-ghost",onClick:i,children:"Cancel"}),s.jsx("button",{type:"submit",className:"sentia-btn sentia-btn-primary",onClick:l,disabled:n,children:n?"Saving...":"Save Policy"})]})]})})}function y({dashboardData:a}){const[t,i]=e.useState(a),[n]=e.useState(!1),[c,r]=e.useState(null),[l,d]=e.useState(!1),m=async()=>{try{d(!0),r(null);const e={Authorization:`Bearer ${await(async()=>null)()}`},s=await o.get("/api/working-capital/diagnostics",{headers:e});i(s.data.data)}catch(e){h("Diagnostics refresh error",e,{component:"SystemDiagnostics"}),r(e.response?.data?.error||e.message)}finally{d(!1)}},x=e=>e>=80?"sentia-excellent":e>=60?"sentia-good":e>=40?"sentia-warning":"sentia-critical",j=e=>"healthy"===e||"excellent"===e||"optimal"===e?"sentia-status-success":"good"===e||"acceptable"===e?"sentia-status-warning":"sentia-status-error";return t||n?s.jsxs("div",{className:"sentia-diagnostics-container",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"System Health Overview"}),s.jsxs("div",{className:`sentia-card-badge ${x(t?.overallHealthScore||0)}`,children:[t?.overallHealthScore||0,"/100"]})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-health-grid",children:[s.jsxs("div",{className:"sentia-health-item",children:[s.jsx("div",{className:"sentia-health-icon",children:"💾"}),s.jsxs("div",{className:"sentia-health-content",children:[s.jsx("div",{className:"sentia-health-label",children:"Database"}),s.jsx("div",{className:`sentia-status ${j(t?.systemHealth?.overallStatus)}`,children:t?.systemHealth?.overallStatus||"unknown"}),s.jsx("div",{className:"sentia-health-detail",children:t?.systemHealth?.database?.message||"No status available"})]})]}),s.jsxs("div",{className:"sentia-health-item",children:[s.jsx("div",{className:"sentia-health-icon",children:"🧮"}),s.jsxs("div",{className:"sentia-health-content",children:[s.jsx("div",{className:"sentia-health-label",children:"Calculations"}),s.jsx("div",{className:`sentia-status ${j(t?.systemHealth?.calculations?.status)}`,children:t?.systemHealth?.calculations?.status||"unknown"}),s.jsx("div",{className:"sentia-health-detail",children:t?.systemHealth?.calculations?.message||"No status available"})]})]})]})})]}),s.jsxs("div",{className:"sentia-grid sentia-grid-2",children:[s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Data Quality"}),s.jsxs("div",{className:`sentia-card-badge ${x(t?.dataQuality?.overallScore||0)}`,children:[t?.dataQuality?.overallScore||0,"/100"]})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-data-quality-grid",children:[s.jsxs("div",{className:"sentia-quality-item",children:[s.jsx("div",{className:"sentia-quality-label",children:"Product Coverage"}),s.jsx("div",{className:`sentia-status ${j(t?.dataQuality?.productCoverage?.status)}`,children:t?.dataQuality?.productCoverage?.status||"unknown"}),s.jsxs("div",{className:"sentia-quality-detail",children:[t?.dataQuality?.productCoverage?.count||0," products"]})]}),s.jsxs("div",{className:"sentia-quality-item",children:[s.jsx("div",{className:"sentia-quality-label",children:"Sales Data"}),s.jsx("div",{className:`sentia-status ${j(t?.dataQuality?.salesDataFreshness?.status)}`,children:t?.dataQuality?.salesDataFreshness?.status||"unknown"}),s.jsxs("div",{className:"sentia-quality-detail",children:[t?.dataQuality?.salesDataFreshness?.recentSalesCount||0," recent sales"]})]}),s.jsxs("div",{className:"sentia-quality-item",children:[s.jsx("div",{className:"sentia-quality-label",children:"Forecasts"}),s.jsx("div",{className:`sentia-status ${j(t?.dataQuality?.forecastCoverage?.status)}`,children:t?.dataQuality?.forecastCoverage?.status||"unknown"}),s.jsxs("div",{className:"sentia-quality-detail",children:[t?.dataQuality?.forecastCoverage?.count||0," forecasts"]})]}),s.jsxs("div",{className:"sentia-quality-item",children:[s.jsx("div",{className:"sentia-quality-label",children:"Inventory Data"}),s.jsx("div",{className:`sentia-status ${j(t?.dataQuality?.inventoryDataFreshness?.status)}`,children:t?.dataQuality?.inventoryDataFreshness?.status||"unknown"}),s.jsxs("div",{className:"sentia-quality-detail",children:[t?.dataQuality?.inventoryDataFreshness?.recentInventoryCount||0," recent records"]})]})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Model Accuracy"}),s.jsx("div",{className:`sentia-card-badge ${j(t?.modelAccuracy?.overallAccuracy)}`,children:t?.modelAccuracy?.overallAccuracy||"unknown"})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-accuracy-grid",children:[s.jsxs("div",{className:"sentia-accuracy-item",children:[s.jsx("div",{className:"sentia-accuracy-label",children:"Forecast Accuracy"}),s.jsxs("div",{className:"sentia-accuracy-value",children:[t?.modelAccuracy?.forecastAccuracy?.mape||0,"% MAPE"]}),s.jsx("div",{className:`sentia-status ${j(t?.modelAccuracy?.forecastAccuracy?.status)}`,children:t?.modelAccuracy?.forecastAccuracy?.status||"unknown"})]}),s.jsxs("div",{className:"sentia-accuracy-item",children:[s.jsx("div",{className:"sentia-accuracy-label",children:"Cash Flow Accuracy"}),s.jsxs("div",{className:"sentia-accuracy-value",children:[t?.modelAccuracy?.cashFlowAccuracy?.variance||0,"% variance"]}),s.jsx("div",{className:`sentia-status ${j(t?.modelAccuracy?.cashFlowAccuracy?.status)}`,children:t?.modelAccuracy?.cashFlowAccuracy?.status||"unknown"})]}),s.jsxs("div",{className:"sentia-accuracy-detail",children:["Last validation: ",t?.modelAccuracy?.lastValidation?new Date(t.modelAccuracy.lastValidation).toLocaleDateString("en-GB"):"Never"]})]})})]})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"Performance Metrics"}),s.jsx("div",{className:`sentia-card-badge ${j(t?.performanceMetrics?.status)}`,children:t?.performanceMetrics?.status||"unknown"})]}),s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-grid sentia-grid-4",children:[s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Avg Calculation Time"}),s.jsxs("div",{className:"sentia-metric-value",children:[t?.performanceMetrics?.averageCalculationTime||0,"s"]})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Cache Hit Rate"}),s.jsxs("div",{className:"sentia-metric-value",children:[(100*(t?.performanceMetrics?.cacheHitRate||0)).toFixed(1),"%"]})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Memory Usage"}),s.jsxs("div",{className:"sentia-metric-value",children:[t?.performanceMetrics?.memoryUsage||0,"MB"]})]}),s.jsxs("div",{className:"sentia-metric-card",children:[s.jsx("div",{className:"sentia-metric-label",children:"Concurrent Users"}),s.jsx("div",{className:"sentia-metric-value",children:t?.performanceMetrics?.concurrentUsers||0})]})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"System Alerts"}),s.jsx("div",{className:"sentia-card-badge",children:t?.alerts?.length||0})]}),s.jsx("div",{className:"sentia-card-content",children:t?.alerts&&t.alerts.length>0?s.jsx("div",{className:"sentia-alerts-list",children:t.alerts.map((e,a)=>s.jsx("div",{className:`sentia-alert sentia-alert-${e.level}`,children:s.jsxs("div",{className:"sentia-alert-content",children:[s.jsxs("div",{className:"sentia-alert-header",children:[s.jsx("span",{className:"sentia-alert-type",children:e.type}),s.jsx("span",{className:"sentia-alert-timestamp",children:new Date(e.timestamp).toLocaleString("en-GB")})]}),s.jsx("div",{className:"sentia-alert-message",children:e.message})]})},a))}):s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No active alerts"}),s.jsx("small",{children:"System is running normally with no issues detected"})]})})]}),s.jsxs("div",{className:"sentia-card",children:[s.jsxs("div",{className:"sentia-card-header",children:[s.jsx("h3",{className:"sentia-card-title",children:"System Recommendations"}),s.jsx("div",{className:"sentia-card-badge",children:t?.recommendations?.length||0})]}),s.jsx("div",{className:"sentia-card-content",children:t?.recommendations&&t.recommendations.length>0?s.jsx("div",{className:"sentia-recommendations-list",children:t.recommendations.map((e,a)=>s.jsx("div",{className:`sentia-recommendation sentia-priority-${e.priority}`,children:s.jsxs("div",{className:"sentia-recommendation-content",children:[s.jsxs("div",{className:"sentia-recommendation-header",children:[s.jsx("span",{className:"sentia-recommendation-title",children:e.title}),s.jsxs("div",{className:"sentia-recommendation-badges",children:[s.jsx("span",{className:`sentia-badge sentia-priority-${e.priority}`,children:e.priority}),s.jsxs("span",{className:"sentia-badge sentia-effort-{rec.estimatedEffort}",children:[e.estimatedEffort," effort"]})]})]}),s.jsx("div",{className:"sentia-recommendation-description",children:e.description}),s.jsxs("div",{className:"sentia-recommendation-category",children:["Category: ",e.category]})]})},a))}):s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No system recommendations"}),s.jsx("small",{children:"System is optimally configured with no immediate actions required"})]})})]}),c&&s.jsx("div",{className:"sentia-error",children:s.jsxs("div",{className:"sentia-error-content",children:[s.jsx("h4",{children:"Diagnostics Error"}),s.jsx("p",{children:c}),s.jsx("button",{onClick:m,className:"sentia-btn sentia-btn-secondary",children:"Retry"})]})}),s.jsx("div",{className:"sentia-dashboard-actions",children:s.jsxs("button",{onClick:m,className:"sentia-btn sentia-btn-primary",disabled:l,children:[s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),l?"Refreshing...":"Refresh Diagnostics"]})})]}):s.jsx("div",{className:"sentia-card",children:s.jsx("div",{className:"sentia-card-content",children:s.jsxs("div",{className:"sentia-empty-state",children:[s.jsx("p",{children:"No diagnostics data available"}),s.jsx("button",{onClick:m,className:"sentia-btn sentia-btn-primary",children:"Load Diagnostics"})]})})})}const b=()=>{const[a,o]=e.useState("overview"),[h,m]=e.useState(!0),[x,j]=e.useState(null);e.useEffect(()=>{(async()=>{try{m(!0);const e=await fetch("/api/working-capital/overview");if(e.ok){const s=await e.json();j(s)}else j(null)}catch(e){j(null)}finally{m(!1)}})()},[]);const g=[{id:"overview",label:"Overview",icon:c},{id:"projections",label:"Cash Flow",icon:n},{id:"scenarios",label:"What-If Analysis",icon:l},{id:"policies",label:"Policies",icon:d},{id:"diagnostics",label:"Diagnostics",icon:r}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Working Capital Management"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"Comprehensive financial analysis and optimization tools"})]}),s.jsx("div",{className:"flex items-center space-x-4",children:s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Last updated"}),s.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[s.jsx(t,{className:"w-4 h-4 mr-1"}),x.lastUpdated]})]})})]}),h?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map((e,a)=>s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded mb-4"}),s.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded mb-2"}),s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]})},a))}):x?s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:s.jsx(i,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Current Working Capital"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["£",((x.current||0)/1e6).toFixed(2),"M"]}),s.jsxs("div",{className:"flex items-center mt-1",children:[s.jsx(n,{className:"w-4 h-4 text-green-500 mr-1"}),s.jsx("span",{className:"text-sm text-green-600 dark:text-green-400",children:x.trend||"N/A"})]})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-lg",children:s.jsx(n,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Projected (30 days)"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["£",((x.projected||0)/1e6).toFixed(2),"M"]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:["+£",(((x.projected||0)-(x.current||0))/1e3).toFixed(0),"K improvement"]})]})]})}),s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900 rounded-lg",children:s.jsx(c,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Optimization Potential"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[x.optimizationPct||"0","%"]}),s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:["£",((x.current||0)*((x.optimizationPct||0)/100)/1e3).toFixed(0),"K available"]})]})]})})]}):s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Unable to load working capital data. Please check your API connection."})}),x?.alerts&&x.alerts.length>0&&s.jsx("div",{className:"space-y-3",children:x.alerts.map((e,a)=>s.jsx("div",{className:"p-4 rounded-lg border-l-4 "+("warning"===e.type?"bg-yellow-50 border-yellow-400 dark:bg-yellow-900/20 dark:border-yellow-600":"bg-blue-50 border-blue-400 dark:bg-blue-900/20 dark:border-blue-600"),children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(r,{className:"w-5 h-5 mr-3 "+("warning"===e.type?"text-yellow-600":"text-blue-600")}),s.jsx("p",{className:"text-sm "+("warning"===e.type?"text-yellow-800 dark:text-yellow-200":"text-blue-800 dark:text-blue-200"),children:e.message})]})},a))}),s.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:g.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>o(e.id),className:"flex items-center py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 "+(a===e.id?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:[s.jsx(t,{className:"w-4 h-4 mr-2"}),e.label]},e.id)})})}),s.jsxs("div",{className:"mt-6",children:["overview"===a&&s.jsx(u,{data:x}),"projections"===a&&s.jsx(v,{}),"scenarios"===a&&s.jsx(N,{}),"policies"===a&&s.jsx(p,{}),"diagnostics"===a&&s.jsx(y,{})]})]})};export{b as default};
