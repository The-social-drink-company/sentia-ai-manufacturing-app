<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clear Auth & Verify Clerk</title>
  <style>
    :root {
      color-scheme: light;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: #f3f4f6;
    }

    .container {
      max-width: 840px;
      margin: 40px auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.15);
    }

    h1 {
      margin-top: 0;
      font-size: 2rem;
      color: #1f2937;
    }

    h2 {
      margin-top: 2rem;
      font-size: 1.25rem;
      color: #1f2937;
    }

    .status {
      padding: 16px;
      margin: 16px 0;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      line-height: 1.5;
    }

    .status strong {
      display: block;
      margin-bottom: 6px;
      font-size: 0.9rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #374151;
    }

    .status.success {
      background: #ecfdf5;
      border-color: #6ee7b7;
    }

    .status.warning {
      background: #fff7ed;
      border-color: #fb923c;
    }

    .status.info {
      background: #eff6ff;
      border-color: #93c5fd;
    }

    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      margin: 10px 6px 0 0;
    }

    button:hover {
      background: #1d4ed8;
    }

    button.danger {
      background: #dc2626;
    }

    button.danger:hover {
      background: #b91c1c;
    }

    pre {
      background: #111827;
      color: #f3f4f6;
      padding: 14px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.85rem;
    }

    a {
      color: #2563eb;
    }

    ol {
      margin: 0;
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Clerk Authentication Setup</h1>

    <div id="local-storage-status" class="status info"></div>
    <div id="environment-status" class="status info"></div>
    <div id="clerk-status" class="status info"></div>

    <h2>Actions</h2>
    <button type="button" onclick="clearMockAuth()">Clear mock session</button>
    <button type="button" onclick="checkStatus()">Re-run checks</button>
    <button type="button" class="danger" onclick="clearAllStorage()">Clear all localStorage</button>

    <h2>Helpful context</h2>
    <pre id="context"></pre>

    <h2>Next steps</h2>
    <div class="status info">
      <ol>
        <li>Clear any mock session using the button above.</li>
        <li>Restart the dev server if you just updated environment keys.</li>
        <li>Visit <a href="/">the landing page</a> and choose “Sign In”.</li>
        <li>Complete Clerk authentication to reach <code>/dashboard</code>.</li>
      </ol>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'sentia-mock-auth-v1'

    function setStatus(elementId, variant, heading, message) {
      const node = document.getElementById(elementId)
      node.className = `status ${variant}`
      node.innerHTML = `<strong>${heading}</strong>${message}`
    }

    function formatJSON(value) {
      return JSON.stringify(value, null, 2)
    }

    function clearMockAuth() {
      localStorage.removeItem(STORAGE_KEY)
      checkStatus()
      alert('Mock auth session cleared. Return to /login to pick a role or enable Clerk to continue.')
    }

    function clearAllStorage() {
      const confirmation = confirm('This removes every key in localStorage for this origin. Continue?')
      if (!confirmation) {
        return
      }

      localStorage.clear()
      checkStatus()
      alert('All localStorage entries removed for this origin.')
    }

    function checkStatus() {
      const mockAuth = localStorage.getItem(STORAGE_KEY)
      if (mockAuth) {
        const preview = mockAuth.length > 120 ? `${mockAuth.slice(0, 120)}…` : mockAuth
        setStatus(
          'local-storage-status',
          'warning',
          'Mock auth found',
          `A mock role is active. Stored payload preview:<br /><code>${preview}</code>`
        )
      } else {
        setStatus('local-storage-status', 'success', 'Mock auth cleared', 'No mock sessions detected.')
      }

      const envMessage = [
        'This helper is served as a static asset, so build-time environment variables are not directly available.',
        'Confirm that `VITE_CLERK_PUBLISHABLE_KEY`, `CLERK_SECRET_KEY`, and related values are set via .env files or Render environment settings.',
        'After updating variables, restart the dev server and refresh this page.',
      ].join('<br />')
      setStatus('environment-status', 'info', 'Environment checklist', envMessage)

      const clerkMessage = [
        'Clerk is only loaded inside the main application shell. To confirm production mode, open a new tab to `/login` and verify the Clerk interface renders.',
        'If you still see the mock role picker, double-check the environment configuration and clear any cached sessions.',
      ].join('<br />')
      setStatus('clerk-status', 'info', 'Clerk verification tips', clerkMessage)

      const context = {
        location: window.location.href,
        mockAuthDetected: Boolean(mockAuth),
        localStorageKeys: Object.keys(localStorage),
        timestamp: new Date().toISOString(),
      }
      document.getElementById('context').textContent = formatJSON(context)
    }

    checkStatus()
  </script>
</body>
</html>
