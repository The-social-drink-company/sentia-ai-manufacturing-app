# Nixpacks configuration for Express.js app
# IMPORTANT: This is NOT a static site - do NOT use Caddy
providers = ["node"]

[phases.setup]
# Use Node.js 20 to match package.json engines requirement
nixPkgs = ["nodejs_20", "npm-9_x"]

[phases.install]
# Install dependencies with legacy peer deps flag for compatibility
cmds = ["npm ci --legacy-peer-deps"]

[phases.build]
# Build the React frontend
cmds = ["npm run build"]

[start]
# Start the Express server (which serves both API and static files)
cmd = "node server.js"

[variables]
NODE_ENV = "production"