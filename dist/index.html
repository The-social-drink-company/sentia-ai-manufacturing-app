<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sentia Manufacturing Dashboard</title>
    <script type="module" crossorigin src="/js/index-CfeaZj_o.js"></script>
    <link rel="modulepreload" crossorigin href="/js/chunk-BPLDaNyX.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-BkMGNTmt.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-BxMJBLkA.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-BHVxGnrP.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-Co7KGWd_.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-CsBkHOXX.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-Dozjk7Op.js">
    <link rel="modulepreload" crossorigin href="/js/chunk-BiELE_zb.js">
    <link rel="stylesheet" crossorigin href="/assets/react-core-C9-ySRfk.css">
    <link rel="stylesheet" crossorigin href="/assets/index-BM8T3WOU.css">
  </head>
  <body>
    <div id="root"></div>
    <script>
      // Enterprise Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          // Only unregister in development to avoid stale caches
          if (window.location.hostname === 'localhost') {
            navigator.serviceWorker.getRegistrations().then(registrations => {
              registrations.forEach(reg => {
                reg.unregister().catch(() => {});
              });
            }).catch(() => {});
            return;
          }

          // Register service worker in production
          navigator.serviceWorker.register('/sw.js', {
            scope: '/',
            updateViaCache: 'none'
          })
          .then(registration => {
            console.log('[SW] Service worker registered successfully:', registration.scope);
            
            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New service worker installed, show update available message
                    if (window.dispatchEvent) {
                      window.dispatchEvent(new CustomEvent('sw-update-available'));
                    }
                  }
                });
              }
            });
          })
          .catch(error => {
            console.warn('[SW] Service worker registration failed:', error);
          });

          // Listen for service worker messages
          navigator.serviceWorker.addEventListener('message', event => {
            if (event.data && event.data.type === 'SKIP_WAITING') {
              window.location.reload();
            }
          });
        });

        // Handle service worker updates
        window.addEventListener('sw-update-available', () => {
          const updateBanner = document.createElement('div');
          updateBanner.innerHTML = `
            <div id="sw-update-banner" style="
              position: fixed;
              top: 0;
              left: 0;
              right: 0;
              background: #2563eb;
              color: white;
              padding: 12px 16px;
              text-align: center;
              z-index: 9999;
              box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            ">
              <span style="margin-right: 16px;">A new version of Sentia Manufacturing Dashboard is available!</span>
              <button id="sw-update-now" style="
                background: white;
                color: #2563eb;
                border: none;
                padding: 6px 12px;
                border-radius: 4px;
                font-weight: 500;
                cursor: pointer;
                margin-right: 8px;
              ">Update Now</button>
              <button id="sw-update-later" style="
                background: transparent;
                color: white;
                border: 1px solid white;
                padding: 6px 12px;
                border-radius: 4px;
                font-weight: 500;
                cursor: pointer;
              ">Later</button>
            </div>
          `;
          document.body.appendChild(updateBanner);

          // Add event listeners instead of inline onclick
          document.getElementById('sw-update-now').addEventListener('click', () => {
            window.location.reload();
          });

          document.getElementById('sw-update-later').addEventListener('click', () => {
            document.getElementById('sw-update-banner').parentElement.remove();
          });
        });
      }
    </script>
  </body>
</html>