import{r as e,j as t}from"./react-core-DkFbty9o.js";import{u as s,a}from"./ManufacturingIntelligence-BS1xC4o2.js";import{u as r}from"./GlobalComplianceSystem-Ta5DwgEo.js";import{o as n,D as i,H as o,l,E as d}from"./ui-components-J4-_vVnI.js";import"./vendor-CHbOot_X.js";import"./charts-DxLx1lqX.js";import"./vendor-utils-BvmCeSbq.js";import"./index-D4EDaX83.js";import"./router-C0m1gglZ.js";import"./auth-M1VfQxmO.js";import"./forms-CtqjxpzJ.js";import"./animation-CTJwy-Vh.js";const c=({className:c="",autoExecute:m=!1,maxConcurrentWorkflows:p=5,...u})=>{const{performAIAnalysis:x,isLoading:g}=s(),{dataStreams:h,subscribe:b,STREAM_TYPES:y}=a(),{resolvedTheme:f}=r(),[j,v]=e.useState([]),[w,N]=e.useState(new Map),[k,S]=e.useState([]),[C,E]=e.useState([]),[D,$]=e.useState([]),[I,A]=e.useState(null),[M,T]=e.useState("active"),[L,P]=e.useState(!1),R={IDLE:{label:"Idle",color:"text-gray-500",bg:"bg-gray-100 dark:bg-gray-700"},RUNNING:{label:"Running",color:"text-blue-500",bg:"bg-blue-100 dark:bg-blue-900/30"},COMPLETED:{label:"Completed",color:"text-green-500",bg:"bg-green-100 dark:bg-green-900/30"},FAILED:{label:"Failed",color:"text-red-500",bg:"bg-red-100 dark:bg-red-900/30"},PAUSED:{label:"Paused",color:"text-yellow-500",bg:"bg-yellow-100 dark:bg-yellow-900/30"}},_=[{id:"quality-check",name:"Automated Quality Check",description:"Automated quality validation process for production batches",category:"quality",steps:[{id:"step-1",name:"Sample Collection",type:"trigger",duration:5},{id:"step-2",name:"Dimensional Analysis",type:"analysis",duration:10},{id:"step-3",name:"Surface Quality Check",type:"inspection",duration:8},{id:"step-4",name:"Generate QC Report",type:"documentation",duration:3},{id:"step-5",name:"Approval/Rejection",type:"decision",duration:2}],triggerConditions:["batch_completed","quality_schedule"],expectedDuration:28,successRate:96.8},{id:"maintenance-workflow",name:"Predictive Maintenance Workflow",description:"Automated maintenance workflow based on AI predictions",category:"maintenance",steps:[{id:"step-1",name:"Equipment Health Check",type:"monitoring",duration:2},{id:"step-2",name:"AI Risk Assessment",type:"analysis",duration:5},{id:"step-3",name:"Schedule Maintenance",type:"scheduling",duration:1},{id:"step-4",name:"Parts Ordering",type:"procurement",duration:15},{id:"step-5",name:"Maintenance Execution",type:"action",duration:120}],triggerConditions:["equipment_warning","schedule_based"],expectedDuration:143,successRate:94.2},{id:"production-optimization",name:"Production Line Optimization",description:"Optimize production parameters based on real-time data",category:"production",steps:[{id:"step-1",name:"Data Collection",type:"monitoring",duration:1},{id:"step-2",name:"Performance Analysis",type:"analysis",duration:3},{id:"step-3",name:"Parameter Optimization",type:"optimization",duration:2},{id:"step-4",name:"Implement Changes",type:"action",duration:5},{id:"step-5",name:"Monitor Results",type:"monitoring",duration:30}],triggerConditions:["efficiency_drop","scheduled_optimization"],expectedDuration:41,successRate:91.5},{id:"inventory-replenishment",name:"Smart Inventory Replenishment",description:"AI-driven inventory replenishment workflow",category:"inventory",steps:[{id:"step-1",name:"Inventory Level Check",type:"monitoring",duration:1},{id:"step-2",name:"Demand Forecasting",type:"analysis",duration:8},{id:"step-3",name:"Supplier Selection",type:"decision",duration:5},{id:"step-4",name:"Purchase Order Creation",type:"action",duration:2},{id:"step-5",name:"Order Confirmation",type:"verification",duration:10}],triggerConditions:["low_stock","reorder_point"],expectedDuration:26,successRate:98.1}];e.useEffect(()=>{(()=>{const e=_.map(e=>({...e,status:"IDLE",currentStep:null,startTime:null,endTime:null,executionCount:Math.floor(100*Math.random()),lastExecution:Date.now()-24*Math.random()*60*60*1e3,enabled:!0}));v(e)})()},[]),e.useEffect(()=>{const e=[b(y.PRODUCTION_METRICS,O),b(y.QUALITY_DATA,z),b(y.EQUIPMENT_STATUS,q),b(y.INVENTORY_LEVELS,U)];return()=>{e.forEach(e=>e())}},[b,y]);const O=e=>{e.batchCompleted&&m&&W("quality-check",{batchId:e.batchId}),e.efficiency<85&&m&&W("production-optimization",{reason:"efficiency_drop"})},z=e=>{e.defectRate>2&&m&&W("quality-check",{reason:"quality_issue"})},q=e=>{"high"===e.warningLevel&&m&&W("maintenance-workflow",{equipmentId:e.equipmentId})},U=e=>{e.stockLevel<e.reorderPoint&&m&&W("inventory-replenishment",{itemId:e.itemId})},W=(e,t={})=>{const s=j.find(t=>t.id===e);if(!s||!s.enabled)return;if(w.size>=p)return;const a=`exec-${Date.now()}-${crypto.randomUUID().substr(2,9)}`,r={id:a,workflowId:e,workflow:{...s},status:"RUNNING",currentStep:0,startTime:Date.now(),context:t,progress:0,logs:[]};N(e=>new Map(e.set(a,r))),F(r)},F=async e=>{const{steps:t}=e.workflow;try{for(let s=0;s<t.length;s++){const a=t[s];if(N(r=>{const n=new Map(r),i=n.get(e.id);return i&&(i.currentStep=s,i.progress=s/t.length*100,i.logs.push({timestamp:Date.now(),level:"info",message:`Starting step: ${a.name}`})),n}),await new Promise(e=>setTimeout(e,100*a.duration)),Math.random()<.05)throw new Error(`Step "${a.name}" failed during execution`);N(t=>{const s=new Map(t),r=s.get(e.id);return r&&r.logs.push({timestamp:Date.now(),level:"success",message:`Completed step: ${a.name}`}),s})}Q(e.id,"COMPLETED")}catch(s){N(t=>{const a=new Map(t),r=a.get(e.id);return r&&r.logs.push({timestamp:Date.now(),level:"error",message:`Workflow failed: ${s.message}`}),a}),Q(e.id,"FAILED")}},Q=(e,t)=>{N(s=>{const a=new Map(s),r=a.get(e);if(r){const s={...r,status:t,endTime:Date.now(),progress:100};S(e=>[s,...e].slice(0,100)),v(e=>e.map(e=>e.id===r.workflowId?{...e,status:"IDLE",executionCount:e.executionCount+1,lastExecution:Date.now()}:e)),a.delete(e)}return a})},G=`\n    rounded-lg border shadow-sm\n    ${"dark"===f?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}\n  `,Y="dark"===f?"text-gray-100":"text-gray-900",H="dark"===f?"text-gray-300":"text-gray-600",V="dark"===f?"text-gray-400":"text-gray-500";return t.jsxs("div",{className:`space-y-6 ${c}`,...u,children:[t.jsx("div",{className:G,children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx(n,{className:"w-6 h-6 mr-3 text-amber-600"}),t.jsx("h2",{className:`text-xl font-semibold ${Y}`,children:"Workflow Automation & Optimization"})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-lg font-bold text-amber-600",children:w.size}),t.jsx("div",{className:`text-sm ${V}`,children:"Active Workflows"})]}),t.jsx("button",{onClick:()=>P(!0),className:"px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors",children:"Create Workflow"})]})]}),t.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:["active","templates","history","analytics"].map(e=>t.jsx("button",{onClick:()=>T(e),className:`\n                  px-4 py-2 rounded-md text-sm font-medium transition-colors\n                  ${M===e?"bg-white shadow text-amber-600 dark:bg-gray-800 dark:text-amber-400":"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-gray-100"}\n                `,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})}),"active"===M&&t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx("div",{className:G,children:t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:`text-lg font-semibold mb-4 ${Y}`,children:"Active Executions"}),w.size>0?t.jsx("div",{className:"space-y-4",children:Array.from(w.values()).map(e=>t.jsxs("div",{className:`\n                      p-4 rounded-lg border\n                      ${"dark"===f?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"}\n                    `,children:[t.jsxs("div",{className:"flex justify-between items-start mb-3",children:[t.jsxs("div",{children:[t.jsx("h4",{className:`font-medium ${Y}`,children:e.workflow.name}),t.jsxs("p",{className:`text-sm ${H}`,children:["Step ",e.currentStep+1," of ",e.workflow.steps.length]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>{return t=e.id,void N(e=>{const s=new Map(e),a=s.get(t);return a&&(a.status="PAUSED"),s});var t},className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded dark:hover:bg-yellow-900/30",children:t.jsx(i,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{return t=e.id,void Q(t,"STOPPED");var t},className:"p-1 text-red-600 hover:bg-red-100 rounded dark:hover:bg-red-900/30",children:t.jsx(o,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{className:"mb-3",children:[t.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[t.jsx("span",{className:H,children:"Progress"}),t.jsxs("span",{className:H,children:[Math.round(e.progress),"%"]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700",children:t.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${e.progress}%`}})})]}),t.jsxs("div",{className:"text-sm",children:[t.jsxs("p",{className:`${H} mb-1`,children:["Current: ",e.workflow.steps[e.currentStep]?.name]}),t.jsxs("p",{className:V,children:["Started: ",new Date(e.startTime).toLocaleTimeString()]})]})]},e.id))}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx(l,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),t.jsx("p",{className:H,children:"No active workflows"}),t.jsx("p",{className:`text-sm ${V}`,children:"Start a workflow from the templates tab"})]})]})}),t.jsx("div",{className:G,children:t.jsxs("div",{className:"p-6",children:[t.jsx("h3",{className:`text-lg font-semibold mb-4 ${Y}`,children:"Recent Activity"}),t.jsx("div",{className:"space-y-3",children:k.slice(0,8).map(e=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`\n                        w-2 h-2 rounded-full\n                        ${"COMPLETED"===e.status?"bg-green-500":"FAILED"===e.status?"bg-red-500":"bg-gray-500"}\n                      `}),t.jsxs("div",{children:[t.jsx("p",{className:`font-medium ${Y}`,children:e.workflow.name}),t.jsx("p",{className:`text-sm ${V}`,children:new Date(e.endTime).toLocaleString()})]})]}),t.jsx("div",{className:`\n                      px-2 py-1 rounded-full text-xs font-medium\n                      ${R[e.status]?.bg} ${R[e.status]?.color}\n                    `,children:R[e.status]?.label})]},e.id))})]})})]}),"templates"===M&&t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:j.map(e=>{return t.jsx("div",{className:G,children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("h3",{className:`text-lg font-semibold ${Y}`,children:e.name}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a=e.category,{quality:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",maintenance:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",production:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",inventory:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400"}[a]||"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}`,children:e.category})]}),t.jsx("p",{className:`text-sm ${H}`,children:e.description})]}),t.jsx("button",{onClick:()=>{return t=e.id,void W(t,{trigger:"manual"});var t},disabled:w.size>=p,className:`\n                      p-2 rounded-lg transition-colors\n                      ${w.size>=p?"text-gray-400 cursor-not-allowed":"text-green-600 hover:bg-green-100 dark:hover:bg-green-900/30"}\n                    `,children:t.jsx(d,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-lg font-bold text-blue-600",children:e.executionCount}),t.jsx("div",{className:`text-sm ${V}`,children:"Executions"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-lg font-bold text-green-600",children:[e.successRate,"%"]}),t.jsx("div",{className:`text-sm ${V}`,children:"Success Rate"})]})]}),t.jsxs("div",{className:"border-t border-gray-200 dark:border-slate-700 pt-4",children:[t.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.jsxs("span",{className:H,children:[e.steps.length," steps"]}),t.jsxs("span",{className:H,children:["~",(s=e.expectedDuration,s<60?`${s} min`:s<1440?`${Math.floor(s/60)}h ${s%60}m`:`${Math.floor(s/1440)}d ${Math.floor(s%1440/60)}h`)]})]}),e.lastExecution&&t.jsxs("div",{className:`text-xs mt-2 ${V}`,children:["Last run: ",new Date(e.lastExecution).toLocaleDateString()]})]})]})},e.id);var s,a})})]})};export{c as WorkflowAutomation,c as default};
